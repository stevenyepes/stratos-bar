<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <style>:root {
  --color: black;
  --bg: white;
  --head-bg: white;
  --link: #338;

  --blue: #ccf;
  --red: #fcc;
  --yellow: #ffc;
  --green: #cfc;
}

[data-theme='dark'] {
  --color: white;
  --bg: black;
  --head-bg: #333;
  --link: #aaf;

  --blue: #225;
  --red: #522;
  --yellow: #552;
  --green: #252;
}

html,
body {
  margin: 0;
  padding: 0;
  color: var(--color);
  background: var(--bg);
}

.app {
  margin: 10px;
  padding: 0;
}

.files-list {
  margin: 10px 0 0;
  width: 100%;
  border-collapse: collapse;
}
.files-list__head {
  border: 1px solid #999;
}
.files-list__head > tr > th {
  padding: 10px;
  border: 1px solid #999;
  text-align: left;
  font-weight: normal;
  background: var(--head-bg);
}
.files-list__body {
}
.files-list__file {
  cursor: pointer;
}
.files-list__file:hover {
  background: var(--blue);
}
.files-list__file > td {
  padding: 10px;
  border: 1px solid #999;
}
.files-list__file > td:first-child::before {
  content: '\01F4C4';
  margin-right: 1em;
}
.files-list__file_low {
  background: var(--red);
}
.files-list__file_medium {
  background: var(--yellow);
}
.files-list__file_high {
  background: var(--green);
}
.files-list__file_folder > td:first-child::before {
  content: '\01F4C1';
  margin-right: 1em;
}

.file-header {
  border: 1px solid #999;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  background: var(--bg);
}

.file-header__back {
  margin: 10px;
  cursor: pointer;
  flex-shrink: 0;
  flex-grow: 0;
  text-decoration: underline;
  color: var(--link);
}

.file-header__name {
  margin: 10px;
  flex-shrink: 2;
  flex-grow: 2;
}

.file-header__stat {
  margin: 10px;
  flex-shrink: 0;
  flex-grow: 0;
}

.file-content {
  margin: 10px 0 0;
  border: 1px solid #999;
  padding: 10px;
  counter-reset: line;
  display: flex;
  flex-direction: column;
}

.code-line::before {
  content: counter(line);
  margin-right: 10px;
}
.code-line {
  margin: 0;
  padding: 0.3em;
  height: 1em;
  counter-increment: line;
}
.code-line_covered {
  background: var(--green);
}
.code-line_uncovered {
  background: var(--red);
}

#theme-toggle-label {
  margin-left: 1ch;
}
</style>
</head>
<body>
    <div id="root"></div>
    <script>
        var data = {"files":[{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","build.rs"],"content":"fn main() {\n    tauri_build::build()\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","adapters","cached_icon_resolver.rs"],"content":"use crate::ports::icon_port::IconResolver;\nuse std::collections::HashMap;\nuse std::sync::{Arc, Mutex};\n\npub struct CachedIconResolver {\n    cache: Arc\u003cMutex\u003cHashMap\u003cString, Option\u003cString\u003e\u003e\u003e\u003e,\n}\n\nimpl CachedIconResolver {\n    pub fn new() -\u003e Self {\n        Self {\n            cache: Arc::new(Mutex::new(HashMap::new())),\n        }\n    }\n\n    fn resolve_icon_internal(\u0026self, icon_name: \u0026str) -\u003e Option\u003cString\u003e {\n        // 1. Direct path check\n        let path = std::path::Path::new(icon_name);\n        if path.is_absolute() \u0026\u0026 path.exists() {\n            let resolved_path = match std::fs::canonicalize(path) {\n                Ok(p) =\u003e p.to_string_lossy().to_string(),\n                Err(_) =\u003e icon_name.to_string(),\n            };\n            return Some(resolved_path);\n        }\n\n        // 2. Use linicon\n        // Iterate over all results instead of just first, prioritize scalable/png\n        if let Some(icon_path) = linicon::lookup_icon(icon_name).next() {\n            if let Ok(path_str) = icon_path {\n                let resolved_path = match std::fs::canonicalize(\u0026path_str.path) {\n                    Ok(p) =\u003e p.to_string_lossy().to_string(),\n                    Err(_) =\u003e path_str.path.to_string_lossy().to_string(),\n                };\n                return Some(resolved_path);\n            }\n        }\n\n        // 3. Fallback: Manual search in standard paths\n        // Linicon might fail if theme config is weird or specific sizes not found?\n        // Let's do a robust manual search for common cases (steam, hicolor default)\n\n        // This part requires `dirs`\n        let mut search_paths = Vec::new();\n\n        // Standard XDG paths\n        if let Ok(dirs) = std::env::var(\"XDG_DATA_DIRS\") {\n            for dir in dirs.split(':') {\n                let p = std::path::Path::new(dir);\n                search_paths.push(p.join(\"icons/hicolor/48x48/apps\"));\n                search_paths.push(p.join(\"icons/hicolor/32x32/apps\"));\n                search_paths.push(p.join(\"icons/hicolor/128x128/apps\"));\n                search_paths.push(p.join(\"icons/hicolor/scalable/apps\"));\n                search_paths.push(p.join(\"pixmaps\"));\n                search_paths.push(p.join(\"icons\"));\n            }\n        } else {\n            search_paths.push(std::path::PathBuf::from(\n                \"/usr/share/icons/hicolor/48x48/apps\",\n            ));\n            search_paths.push(std::path::PathBuf::from(\n                \"/usr/share/icons/hicolor/32x32/apps\",\n            ));\n            search_paths.push(std::path::PathBuf::from(\n                \"/usr/share/icons/hicolor/scalable/apps\",\n            ));\n            search_paths.push(std::path::PathBuf::from(\"/usr/share/pixmaps\"));\n            search_paths.push(std::path::PathBuf::from(\"/usr/share/icons\"));\n        }\n\n        // User local paths\n        if let Some(home) = dirs::data_local_dir() {\n            search_paths.push(home.join(\"icons/hicolor/48x48/apps\"));\n            search_paths.push(home.join(\"icons/hicolor/32x32/apps\"));\n            search_paths.push(home.join(\"icons/hicolor/128x128/apps\"));\n            search_paths.push(home.join(\"icons/hicolor/scalable/apps\"));\n            search_paths.push(home.join(\"icons\"));\n        }\n\n        // Steam specific paths\n        if let Some(home) = dirs::home_dir() {\n            search_paths.push(home.join(\".steam/root/appcache/librarycache\"));\n            search_paths.push(home.join(\".local/share/icons/hicolor/48x48/apps\"));\n        }\n\n        let extensions = vec![\"png\", \"svg\", \"xpm\", \"ico\", \"jpg\"];\n\n        for base in \u0026search_paths {\n            if !base.exists() {\n                continue;\n            }\n\n            // Steam specific cache check (icon_name usually steam_icon_APPID)\n            if base.ends_with(\"librarycache\") \u0026\u0026 icon_name.starts_with(\"steam_icon_\") {\n                let app_id = icon_name.trim_start_matches(\"steam_icon_\");\n                // try app_id_icon.jpg\n                let p = base.join(format!(\"{}_icon.jpg\", app_id));\n                if p.exists() {\n                    return Some(p.to_string_lossy().to_string());\n                }\n            }\n\n            for ext in \u0026extensions {\n                let p = base.join(format!(\"{}.{}\", icon_name, ext));\n                if p.exists() {\n                    let resolved_path = match std::fs::canonicalize(\u0026p) {\n                        Ok(canonical) =\u003e canonical.to_string_lossy().to_string(),\n                        Err(_) =\u003e p.to_string_lossy().to_string(),\n                    };\n                    return Some(resolved_path);\n                }\n            }\n        }\n\n        // Try stripping extension if present in name but not a path\n        if let Some(stem) = std::path::Path::new(icon_name).file_stem() {\n            if stem != icon_name {\n                let stem_str = stem.to_string_lossy();\n                if let Some(icon_path) = linicon::lookup_icon(\u0026stem_str).next() {\n                    if let Ok(path_str) = icon_path {\n                        return Some(path_str.path.to_string_lossy().to_string());\n                    }\n                }\n            }\n        }\n\n        None\n    }\n}\n\nimpl IconResolver for CachedIconResolver {\n    fn resolve_icon(\u0026self, icon_name: \u0026str) -\u003e Option\u003cString\u003e {\n        // Check cache\n        if let Ok(guard) = self.cache.lock() {\n            if let Some(cached) = guard.get(icon_name) {\n                return cached.clone();\n            }\n        }\n\n        let result = self.resolve_icon_internal(icon_name);\n\n        // Update cache\n        if let Ok(mut guard) = self.cache.lock() {\n            guard.insert(icon_name.to_string(), result.clone());\n        }\n\n        result\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use std::fs::File;\n    use tempfile::tempdir;\n\n    #[test]\n    fn test_resolve_absolute_path() {\n        let dir = tempdir().unwrap();\n        let file_path = dir.path().join(\"test_icon.png\");\n        File::create(\u0026file_path).unwrap();\n\n        let resolver = CachedIconResolver::new();\n        let result = resolver.resolve_icon(file_path.to_str().unwrap());\n\n        assert!(result.is_some());\n        // Canonicalization might resolve symlinks or change format, but for temp dir it should be close\n        // We just check it's some valid path\n        assert!(result.unwrap().contains(\"test_icon.png\"));\n    }\n\n    #[test]\n    fn test_caching_behavior() {\n        let dir = tempdir().unwrap();\n        let file_path = dir.path().join(\"test_cache.png\");\n        File::create(\u0026file_path).unwrap();\n\n        let resolver = CachedIconResolver::new();\n        let path_str = file_path.to_str().unwrap();\n\n        // First resolution\n        assert!(resolver.resolve_icon(path_str).is_some());\n\n        // Delete valid file\n        std::fs::remove_file(\u0026file_path).unwrap();\n\n        // Second resolution should hit cache and still return result even if file is gone\n        // functionality of \"resolve_icon_internal\" checks existence, but \"resolve_icon\" checks cache first.\n        let result = resolver.resolve_icon(path_str);\n        assert!(result.is_some());\n    }\n\n    #[test]\n    fn test_missing_icon_returns_none() {\n        let resolver = CachedIconResolver::new();\n        let result = resolver.resolve_icon(\"/non/existent/path/icon.png\");\n        assert!(result.is_none());\n    }\n}\n","traces":[{"line":10,"address":[43363296],"length":1,"stats":{"Line":3}},{"line":12,"address":[41931108],"length":1,"stats":{"Line":3}},{"line":16,"address":[41930519,41923758,41922656],"length":1,"stats":{"Line":1}},{"line":18,"address":[41922703],"length":1,"stats":{"Line":2}},{"line":19,"address":[41922763,41922856],"length":1,"stats":{"Line":3}},{"line":20,"address":[41922883],"length":1,"stats":{"Line":1}},{"line":21,"address":[43362770],"length":1,"stats":{"Line":1}},{"line":22,"address":[41930532,41930907],"length":1,"stats":{"Line":0}},{"line":24,"address":[41930936],"length":1,"stats":{"Line":1}},{"line":29,"address":[41922987,41922773],"length":1,"stats":{"Line":2}},{"line":30,"address":[43355380,43355230],"length":1,"stats":{"Line":0}},{"line":31,"address":[41923331,41923280],"length":1,"stats":{"Line":0}},{"line":32,"address":[41923402],"length":1,"stats":{"Line":0}},{"line":33,"address":[41923376,41923788],"length":1,"stats":{"Line":0}},{"line":35,"address":[41923915],"length":1,"stats":{"Line":0}},{"line":44,"address":[41923106],"length":1,"stats":{"Line":1}},{"line":47,"address":[41924295,41923123,41924343],"length":1,"stats":{"Line":3}},{"line":48,"address":[41924466,41924383],"length":1,"stats":{"Line":2}},{"line":49,"address":[41924800,41924673],"length":1,"stats":{"Line":2}},{"line":50,"address":[41924838],"length":1,"stats":{"Line":1}},{"line":51,"address":[41924913],"length":1,"stats":{"Line":1}},{"line":52,"address":[41924988],"length":1,"stats":{"Line":1}},{"line":53,"address":[41925063],"length":1,"stats":{"Line":1}},{"line":54,"address":[41925138],"length":1,"stats":{"Line":1}},{"line":55,"address":[41925213],"length":1,"stats":{"Line":1}},{"line":58,"address":[41925277,41924309],"length":1,"stats":{"Line":0}},{"line":61,"address":[41925304],"length":1,"stats":{"Line":0}},{"line":64,"address":[41925362],"length":1,"stats":{"Line":0}},{"line":67,"address":[41925420],"length":1,"stats":{"Line":0}},{"line":68,"address":[41925478],"length":1,"stats":{"Line":0}},{"line":72,"address":[41925560],"length":1,"stats":{"Line":1}},{"line":73,"address":[41925656,41925761],"length":1,"stats":{"Line":2}},{"line":74,"address":[41925828],"length":1,"stats":{"Line":1}},{"line":75,"address":[41925934],"length":1,"stats":{"Line":1}},{"line":76,"address":[41926040],"length":1,"stats":{"Line":1}},{"line":77,"address":[41926146],"length":1,"stats":{"Line":1}},{"line":81,"address":[41926266,41925679],"length":1,"stats":{"Line":2}},{"line":82,"address":[41926343,41926454],"length":1,"stats":{"Line":2}},{"line":83,"address":[41926521],"length":1,"stats":{"Line":1}},{"line":86,"address":[41926649,41926376],"length":1,"stats":{"Line":2}},{"line":88,"address":[43359036,43359131],"length":1,"stats":{"Line":2}},{"line":89,"address":[41928361,41927061],"length":1,"stats":{"Line":2}},{"line":94,"address":[41928515,41928399],"length":1,"stats":{"Line":2}},{"line":95,"address":[41928574],"length":1,"stats":{"Line":0}},{"line":97,"address":[41928669],"length":1,"stats":{"Line":0}},{"line":98,"address":[41928910,41928993],"length":1,"stats":{"Line":0}},{"line":99,"address":[43361246,43362528],"length":1,"stats":{"Line":0}},{"line":103,"address":[41928477,41929089],"length":1,"stats":{"Line":2}},{"line":104,"address":[43361397],"length":1,"stats":{"Line":1}},{"line":105,"address":[41929477,41929548],"length":1,"stats":{"Line":2}},{"line":106,"address":[43361787],"length":1,"stats":{"Line":0}},{"line":107,"address":[41929679],"length":1,"stats":{"Line":0}},{"line":108,"address":[41930037,41929659],"length":1,"stats":{"Line":0}},{"line":110,"address":[41930164],"length":1,"stats":{"Line":0}},{"line":116,"address":[41927087],"length":1,"stats":{"Line":1}},{"line":117,"address":[41927284,41927348],"length":1,"stats":{"Line":2}},{"line":118,"address":[41927354],"length":1,"stats":{"Line":1}},{"line":119,"address":[41927523,41927401,41927452],"length":1,"stats":{"Line":3}},{"line":120,"address":[41927690,41927586],"length":1,"stats":{"Line":0}},{"line":121,"address":[41927853,41927762],"length":1,"stats":{"Line":0}},{"line":127,"address":[43359504],"length":1,"stats":{"Line":1}},{"line":132,"address":[41922060,41922066,41921680],"length":1,"stats":{"Line":3}},{"line":134,"address":[43353915,43353856],"length":1,"stats":{"Line":3}},{"line":135,"address":[41921824,41921888],"length":1,"stats":{"Line":3}},{"line":136,"address":[41921956],"length":1,"stats":{"Line":1}},{"line":140,"address":[41922121],"length":1,"stats":{"Line":2}},{"line":143,"address":[41922131,41922238,41922194],"length":1,"stats":{"Line":3}},{"line":144,"address":[41922337,41922553,41922276,41922388],"length":1,"stats":{"Line":2}},{"line":147,"address":[41922613],"length":1,"stats":{"Line":1}}],"covered":48,"coverable":69},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","adapters","file_history.rs"],"content":"use crate::domain::action::Action;\nuse crate::ports::history::HistoryRepository;\nuse async_trait::async_trait;\nuse std::fs;\nuse std::path::PathBuf;\nuse std::sync::Mutex;\n\npub struct FileHistoryAdapter {\n    file_path: PathBuf,\n    cache: Mutex\u003cVec\u003cAction\u003e\u003e,\n}\n\nimpl FileHistoryAdapter {\n    pub fn new(app_data_dir: PathBuf) -\u003e Self {\n        let file_path = app_data_dir.join(\"history.json\");\n        let cache = if file_path.exists() {\n            if let Ok(content) = fs::read_to_string(\u0026file_path) {\n                serde_json::from_str(\u0026content).unwrap_or_else(|_| Vec::new())\n            } else {\n                Vec::new()\n            }\n        } else {\n            Vec::new()\n        };\n\n        Self {\n            file_path,\n            cache: Mutex::new(cache),\n        }\n    }\n\n    fn save(\u0026self) -\u003e Result\u003c(), String\u003e {\n        let cache = self.cache.lock().map_err(|e| e.to_string())?;\n        let content = serde_json::to_string_pretty(\u0026*cache).map_err(|e| e.to_string())?;\n        if let Some(parent) = self.file_path.parent() {\n            fs::create_dir_all(parent).map_err(|e| e.to_string())?;\n        }\n        fs::write(\u0026self.file_path, content).map_err(|e| e.to_string())?;\n        Ok(())\n    }\n}\n\n#[async_trait]\nimpl HistoryRepository for FileHistoryAdapter {\n    async fn get_recent(\u0026self, limit: usize) -\u003e Result\u003cVec\u003cAction\u003e, String\u003e {\n        let cache = self.cache.lock().map_err(|e| e.to_string())?;\n        let mut actions = cache.clone();\n\n        // Sort by last_accessed descending\n        actions.sort_by(|a, b| b.last_accessed.cmp(\u0026a.last_accessed));\n\n        Ok(actions.into_iter().take(limit).collect())\n    }\n\n    async fn record(\u0026self, mut new_action: Action) -\u003e Result\u003c(), String\u003e {\n        let mut cache = self.cache.lock().map_err(|e| e.to_string())?;\n\n        if let Some(existing) = cache.iter_mut().find(|a| a.id == new_action.id) {\n            existing.last_accessed = new_action.last_accessed;\n            existing.frequency += 1;\n            // Update other fields just in case they changed (dynamic titles etc)\n            existing.name = new_action.name;\n            existing.content = new_action.content;\n            if new_action.icon.is_some() {\n                existing.icon = new_action.icon;\n            }\n        } else {\n            new_action.frequency = 1;\n            cache.push(new_action);\n        }\n\n        // Limit total history size to avoid infinte growth\n        if cache.len() \u003e 100 {\n            // Remove least recently used or least frequent.\n            // For now simple LRU removal\n            cache.sort_by(|a, b| b.last_accessed.cmp(\u0026a.last_accessed));\n            cache.truncate(100);\n        }\n\n        drop(cache); // Release lock before saving which does I/O\n        self.save()\n    }\n\n    async fn clear(\u0026self) -\u003e Result\u003c(), String\u003e {\n        let mut cache = self.cache.lock().map_err(|e| e.to_string())?;\n        cache.clear();\n        drop(cache);\n        self.save()\n    }\n}\n","traces":[{"line":14,"address":[40674785,40674550,40673840],"length":1,"stats":{"Line":0}},{"line":15,"address":[45420634,45420558],"length":1,"stats":{"Line":0}},{"line":16,"address":[45420676,45420741],"length":1,"stats":{"Line":0}},{"line":17,"address":[45420774,45420889,45420941],"length":1,"stats":{"Line":0}},{"line":18,"address":[45420981,45421057],"length":1,"stats":{"Line":0}},{"line":20,"address":[40674246,40674556],"length":1,"stats":{"Line":0}},{"line":23,"address":[45420798,45420767],"length":1,"stats":{"Line":0}},{"line":28,"address":[45420834],"length":1,"stats":{"Line":0}},{"line":32,"address":[45421472,45422668,45422676],"length":1,"stats":{"Line":0}},{"line":33,"address":[45421502],"length":1,"stats":{"Line":0}},{"line":34,"address":[45421764,45422674,45421702],"length":1,"stats":{"Line":0}},{"line":35,"address":[45422042,45421974],"length":1,"stats":{"Line":0}},{"line":36,"address":[45522176,45522192],"length":1,"stats":{"Line":0}},{"line":38,"address":[45422419,45422173,45422602],"length":1,"stats":{"Line":0}},{"line":39,"address":[45422558],"length":1,"stats":{"Line":0}},{"line":45,"address":[45517046,45517008,45517119,45517372,45518025,45517308,45518048,45518059,45517246],"length":1,"stats":{"Line":0}},{"line":46,"address":[45517274,45517427,45518054,45518160,45518190],"length":1,"stats":{"Line":0}},{"line":47,"address":[45517612,45517685],"length":1,"stats":{"Line":0}},{"line":50,"address":[45517708,45517773,45518096,45518128],"length":1,"stats":{"Line":0}},{"line":52,"address":[40681339],"length":1,"stats":{"Line":0}},{"line":55,"address":[45519184,45521548,45519382,45521618,45521108,45519622,45521149,45519231,45519649,45521218,45521317,45521486,45519510],"length":1,"stats":{"Line":0}},{"line":56,"address":[40683203,40685552,40683294,40685577],"length":1,"stats":{"Line":0}},{"line":58,"address":[45521856,45521873,45519903,45519967],"length":1,"stats":{"Line":0}},{"line":59,"address":[45520136],"length":1,"stats":{"Line":0}},{"line":60,"address":[45520219,45520148,45520281],"length":1,"stats":{"Line":0}},{"line":62,"address":[45520226,45520306],"length":1,"stats":{"Line":0}},{"line":63,"address":[45520398,45520458],"length":1,"stats":{"Line":0}},{"line":64,"address":[40684411,40684182],"length":1,"stats":{"Line":0}},{"line":65,"address":[45520671,45520611],"length":1,"stats":{"Line":0}},{"line":68,"address":[45520174],"length":1,"stats":{"Line":0}},{"line":69,"address":[45520780,45520194],"length":1,"stats":{"Line":0}},{"line":73,"address":[45520591,45520874],"length":1,"stats":{"Line":0}},{"line":76,"address":[45521936,45520936,45521904],"length":1,"stats":{"Line":0}},{"line":77,"address":[45520995],"length":1,"stats":{"Line":0}},{"line":80,"address":[45520897],"length":1,"stats":{"Line":0}},{"line":81,"address":[40684713],"length":1,"stats":{"Line":0}},{"line":84,"address":[45420409],"length":1,"stats":{"Line":0}},{"line":85,"address":[45518512,45518661,45519072,45519102],"length":1,"stats":{"Line":0}},{"line":86,"address":[45518852,45518908],"length":1,"stats":{"Line":0}},{"line":87,"address":[45518915],"length":1,"stats":{"Line":0}},{"line":88,"address":[45518953],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":41},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","adapters","fs_app_repository.rs"],"content":"use crate::domain::apps::AppEntry;\nuse crate::ports::app_port::AppRepository;\nuse crate::ports::icon_port::IconResolver;\nuse freedesktop_desktop_entry::Iter;\nuse std::collections::HashSet;\nuse std::path::PathBuf;\nuse std::sync::Arc;\n\npub struct FsAppRepository {\n    icon_resolver: Arc\u003cdyn IconResolver\u003e,\n    custom_paths: Option\u003cVec\u003cPathBuf\u003e\u003e,\n}\n\nimpl FsAppRepository {\n    pub fn new(icon_resolver: Arc\u003cdyn IconResolver\u003e) -\u003e Self {\n        Self {\n            icon_resolver,\n            custom_paths: None,\n        }\n    }\n\n    #[cfg(test)]\n    pub fn new_with_paths(icon_resolver: Arc\u003cdyn IconResolver\u003e, paths: Vec\u003cPathBuf\u003e) -\u003e Self {\n        Self {\n            icon_resolver,\n            custom_paths: Some(paths),\n        }\n    }\n\n    fn parse_desktop_file(\u0026self, path: \u0026std::path::Path) -\u003e Option\u003cAppEntry\u003e {\n        let content = std::fs::read_to_string(path).ok()?;\n        let mut in_desktop_entry = false;\n        let mut name = None;\n        let mut exec = None;\n        let mut icon = None;\n        let mut no_display = false;\n\n        for line in content.lines() {\n            let line = line.trim();\n            if line.starts_with('[') \u0026\u0026 line.ends_with(']') {\n                in_desktop_entry = line == \"[Desktop Entry]\";\n                continue;\n            }\n\n            if in_desktop_entry {\n                if let Some(val) = line.strip_prefix(\"Name=\") {\n                    if name.is_none() {\n                        name = Some(val.to_string());\n                    }\n                } else if let Some(val) = line.strip_prefix(\"Exec=\") {\n                    if exec.is_none() {\n                        // Cleanup exec command (remove field codes)\n                        let clean_exec = val\n                            .replace(\"%f\", \"\")\n                            .replace(\"%F\", \"\")\n                            .replace(\"%u\", \"\")\n                            .replace(\"%U\", \"\")\n                            .replace(\"%i\", \"\")\n                            .replace(\"%c\", \"\")\n                            .replace(\"%k\", \"\")\n                            .trim()\n                            .to_string();\n                        exec = Some(clean_exec);\n                    }\n                } else if let Some(val) = line.strip_prefix(\"Icon=\") {\n                    if icon.is_none() {\n                        icon = Some(val.to_string());\n                    }\n                } else if let Some(val) = line.strip_prefix(\"NoDisplay=\") {\n                    if val.to_lowercase() == \"true\" {\n                        no_display = true;\n                    }\n                }\n            }\n        }\n\n        if !no_display {\n            if let (Some(name), Some(exec)) = (name, exec) {\n                // Check if icon resolves\n                // If icon is None, maybe we can try to guess from name or use default?\n                // lib.rs logic: icon.and_then(|i| resolve_icon(\u0026i))\n                let icon_path = if let Some(i) = icon {\n                    self.icon_resolver.resolve_icon(\u0026i)\n                } else {\n                    None\n                };\n\n                return Some(AppEntry {\n                    name,\n                    exec,\n                    icon: icon_path.filter(|i| !i.is_empty()),\n                });\n            }\n        }\n        None\n    }\n}\n\nimpl AppRepository for FsAppRepository {\n    fn list_apps(\u0026self) -\u003e Result\u003cVec\u003cAppEntry\u003e, String\u003e {\n        let mut apps = Vec::new();\n        let mut seen_ids = HashSet::new();\n\n        // Construct search paths\n        // Construct search paths\n        let mut search_paths = Vec::new();\n\n        if let Some(ref custom) = self.custom_paths {\n            search_paths.extend(custom.clone());\n        } else {\n            if let Ok(dirs) = std::env::var(\"XDG_DATA_DIRS\") {\n                for dir in dirs.split(':') {\n                    search_paths.push(PathBuf::from(dir).join(\"applications\"));\n                }\n            } else {\n                search_paths.push(PathBuf::from(\"/usr/share/applications\"));\n                search_paths.push(PathBuf::from(\"/usr/local/share/applications\"));\n            }\n            if let Some(home) = dirs::data_local_dir() {\n                search_paths.push(home.join(\"applications\"));\n            }\n        }\n\n        // Iterate over paths using the crate's iterator\n        for path in Iter::new(search_paths.clone().into_iter()) {\n            if let Some(app) = self.parse_desktop_file(\u0026path) {\n                let id = app.name.clone();\n                if !seen_ids.contains(\u0026id) {\n                    apps.push(app);\n                    seen_ids.insert(id);\n                }\n            }\n        }\n\n        // 2. Scan Flatpak Exports explicitly if available (SKIP IF TESTING)\n        let mut flatpak_paths = Vec::new();\n        if self.custom_paths.is_none() {\n            flatpak_paths.push(PathBuf::from(\"/var/lib/flatpak/exports/share/applications\"));\n            flatpak_paths.push(\n                dirs::data_local_dir()\n                    .map(|d| d.join(\"flatpak/exports/share/applications\"))\n                    .unwrap_or_default(),\n            );\n        }\n\n        for path in Iter::new(flatpak_paths.into_iter()) {\n            if let Some(app) = self.parse_desktop_file(\u0026path) {\n                let id = app.name.clone();\n                if !seen_ids.contains(\u0026id) {\n                    apps.push(app);\n                    seen_ids.insert(id);\n                }\n            }\n        }\n\n        // 3. Scan AppImages\n        if let Some(home) = dirs::home_dir() {\n            let applications_dir = home.join(\"Applications\");\n            if applications_dir.exists() \u0026\u0026 self.custom_paths.is_none() {\n                let glob_pattern = applications_dir.join(\"*.AppImage\");\n                if let Ok(glob_paths) = glob::glob(\u0026glob_pattern.to_string_lossy()) {\n                    for entry in glob_paths.filter_map(|e| e.ok()) {\n                        let name = entry\n                            .file_stem()\n                            .unwrap_or_default()\n                            .to_string_lossy()\n                            .to_string();\n                        if name.is_empty() {\n                            continue;\n                        }\n                        if seen_ids.contains(\u0026name) {\n                            continue;\n                        }\n\n                        let icon = self.icon_resolver.resolve_icon(\u0026name).or_else(|| {\n                            self.icon_resolver.resolve_icon(\"application-x-executable\")\n                        });\n\n                        apps.push(AppEntry {\n                            name: name.clone(),\n                            exec: entry.to_string_lossy().to_string(),\n                            icon,\n                        });\n                        seen_ids.insert(name);\n                    }\n                }\n            }\n        }\n\n        Ok(apps)\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::ports::icon_port::IconResolver;\n    use std::fs::File;\n    use std::io::Write;\n    use tempfile::tempdir;\n\n    struct MockIconResolver;\n    impl IconResolver for MockIconResolver {\n        fn resolve_icon(\u0026self, _icon_name: \u0026str) -\u003e Option\u003cString\u003e {\n            Some(\"/tmp/icon.png\".to_string())\n        }\n    }\n\n    #[test]\n    fn test_list_apps_finds_desktop_entry() {\n        let dir = tempdir().unwrap();\n        let apps_dir = dir.path().join(\"applications\");\n        std::fs::create_dir(\u0026apps_dir).unwrap();\n\n        let desktop_file_path = apps_dir.join(\"test-app.desktop\");\n        let mut file = File::create(desktop_file_path).unwrap();\n        writeln!(\n            file,\n            \"[Desktop Entry]\\nName=Test App\\nExec=test-exec %f\\nIcon=test-icon\\nType=Application\"\n        )\n        .unwrap();\n\n        let resolver = Arc::new(MockIconResolver);\n        let repo = FsAppRepository::new_with_paths(resolver, vec![apps_dir]);\n\n        let apps = repo.list_apps().unwrap();\n\n        // Assertions\n        assert_eq!(apps.len(), 1);\n        assert_eq!(apps[0].name, \"Test App\");\n        assert_eq!(apps[0].exec, \"test-exec\");\n        assert_eq!(apps[0].icon, Some(\"/tmp/icon.png\".to_string()));\n    }\n\n    #[test]\n    fn test_list_apps_ignores_no_display() {\n        let dir = tempdir().unwrap();\n        let apps_dir = dir.path().join(\"applications\");\n        std::fs::create_dir(\u0026apps_dir).unwrap();\n\n        let desktop_file_path = apps_dir.join(\"hidden-app.desktop\");\n        let mut file = File::create(desktop_file_path).unwrap();\n        writeln!(\n            file,\n            \"[Desktop Entry]\\nName=Hidden App\\nExec=hidden\\nNoDisplay=true\"\n        )\n        .unwrap();\n\n        let resolver = Arc::new(MockIconResolver);\n        let repo = FsAppRepository::new_with_paths(resolver, vec![apps_dir]);\n\n        let apps = repo.list_apps().unwrap();\n\n        assert!(apps.is_empty());\n    }\n}\n","traces":[{"line":15,"address":[43375728],"length":1,"stats":{"Line":0}},{"line":23,"address":[40727680],"length":1,"stats":{"Line":2}},{"line":26,"address":[40727693],"length":1,"stats":{"Line":2}},{"line":30,"address":[40733690,40729517,40727760],"length":1,"stats":{"Line":1}},{"line":31,"address":[40727853],"length":1,"stats":{"Line":2}},{"line":32,"address":[40728094],"length":1,"stats":{"Line":1}},{"line":33,"address":[40728102],"length":1,"stats":{"Line":1}},{"line":34,"address":[40728128],"length":1,"stats":{"Line":1}},{"line":35,"address":[40728144],"length":1,"stats":{"Line":1}},{"line":36,"address":[40728160],"length":1,"stats":{"Line":1}},{"line":38,"address":[40728176,40728289],"length":1,"stats":{"Line":3}},{"line":39,"address":[40730356,40728475],"length":1,"stats":{"Line":4}},{"line":40,"address":[40730439,40730372],"length":1,"stats":{"Line":3}},{"line":41,"address":[40733596,40730491],"length":1,"stats":{"Line":2}},{"line":45,"address":[40730424],"length":1,"stats":{"Line":1}},{"line":46,"address":[40730527],"length":1,"stats":{"Line":1}},{"line":47,"address":[43373043,43372809,43372718],"length":1,"stats":{"Line":3}},{"line":48,"address":[40730809,40730879],"length":1,"stats":{"Line":1}},{"line":50,"address":[40730719,40731039],"length":1,"stats":{"Line":2}},{"line":51,"address":[40731134,40731225,40732899],"length":1,"stats":{"Line":3}},{"line":53,"address":[43374141,43373887,43373609,43373331,43373748,43374014,43373470],"length":1,"stats":{"Line":7}},{"line":63,"address":[43374777,43374686],"length":1,"stats":{"Line":1}},{"line":65,"address":[40731160,40732942],"length":1,"stats":{"Line":2}},{"line":66,"address":[43375363,43375056,43375135],"length":1,"stats":{"Line":3}},{"line":67,"address":[40733199,40733129],"length":1,"stats":{"Line":1}},{"line":69,"address":[40733353,40733054],"length":1,"stats":{"Line":2}},{"line":70,"address":[40733584,40733436],"length":1,"stats":{"Line":2}},{"line":71,"address":[40733576],"length":1,"stats":{"Line":1}},{"line":77,"address":[40730093,40728501],"length":1,"stats":{"Line":1}},{"line":78,"address":[40728821,40728904,40728515],"length":1,"stats":{"Line":3}},{"line":82,"address":[40729162,40729032],"length":1,"stats":{"Line":1}},{"line":83,"address":[40729117,40729251],"length":1,"stats":{"Line":2}},{"line":85,"address":[40729144],"length":1,"stats":{"Line":0}},{"line":88,"address":[40729575],"length":1,"stats":{"Line":1}},{"line":89,"address":[43371403],"length":1,"stats":{"Line":1}},{"line":90,"address":[40729422],"length":1,"stats":{"Line":1}},{"line":91,"address":[40363920,40363929],"length":1,"stats":{"Line":3}},{"line":95,"address":[40728796],"length":1,"stats":{"Line":1}},{"line":100,"address":[40727650,40721376,40722474],"length":1,"stats":{"Line":2}},{"line":101,"address":[40721415],"length":1,"stats":{"Line":2}},{"line":102,"address":[43363472],"length":1,"stats":{"Line":2}},{"line":106,"address":[43363532],"length":1,"stats":{"Line":2}},{"line":108,"address":[40721624],"length":1,"stats":{"Line":2}},{"line":109,"address":[43363742,43363648],"length":1,"stats":{"Line":4}},{"line":111,"address":[43363667,43363801,43363849],"length":1,"stats":{"Line":0}},{"line":112,"address":[43363889,43363972],"length":1,"stats":{"Line":0}},{"line":113,"address":[43364290,43364179],"length":1,"stats":{"Line":0}},{"line":116,"address":[40721835,40722480],"length":1,"stats":{"Line":0}},{"line":117,"address":[43364487],"length":1,"stats":{"Line":0}},{"line":119,"address":[40722589],"length":1,"stats":{"Line":0}},{"line":120,"address":[43364752,43364669],"length":1,"stats":{"Line":0}},{"line":125,"address":[40723023,40721791,40722853],"length":1,"stats":{"Line":6}},{"line":126,"address":[40723100,40727024,40727568],"length":1,"stats":{"Line":4}},{"line":127,"address":[40727156,40727246],"length":1,"stats":{"Line":2}},{"line":128,"address":[40727270,40727323],"length":1,"stats":{"Line":2}},{"line":129,"address":[40727329],"length":1,"stats":{"Line":1}},{"line":130,"address":[43369528],"length":1,"stats":{"Line":1}},{"line":136,"address":[40723145],"length":1,"stats":{"Line":1}},{"line":137,"address":[40723172,40723242],"length":1,"stats":{"Line":2}},{"line":138,"address":[43365310],"length":1,"stats":{"Line":0}},{"line":139,"address":[40723441],"length":1,"stats":{"Line":0}},{"line":140,"address":[40723376],"length":1,"stats":{"Line":0}},{"line":141,"address":[40363760,40363787],"length":1,"stats":{"Line":0}},{"line":142,"address":[43365414],"length":1,"stats":{"Line":0}},{"line":146,"address":[43365473,43365240,43365624],"length":1,"stats":{"Line":3}},{"line":147,"address":[43365701,43368374,43368926],"length":1,"stats":{"Line":0}},{"line":148,"address":[40726544,40726454],"length":1,"stats":{"Line":0}},{"line":149,"address":[40726568,40726621],"length":1,"stats":{"Line":0}},{"line":150,"address":[40726627],"length":1,"stats":{"Line":0}},{"line":151,"address":[43368810],"length":1,"stats":{"Line":0}},{"line":157,"address":[40723738],"length":1,"stats":{"Line":1}},{"line":158,"address":[40724029,40723834],"length":1,"stats":{"Line":2}},{"line":159,"address":[40724209,40724152,40724069],"length":1,"stats":{"Line":3}},{"line":160,"address":[43366256],"length":1,"stats":{"Line":0}},{"line":161,"address":[40724516,40724594,40724414,40724323],"length":1,"stats":{"Line":0}},{"line":162,"address":[40724773,40724706,40724869],"length":1,"stats":{"Line":0}},{"line":163,"address":[40724946],"length":1,"stats":{"Line":0}},{"line":168,"address":[40725255],"length":1,"stats":{"Line":0}},{"line":171,"address":[40725329,40725292],"length":1,"stats":{"Line":0}},{"line":175,"address":[43367383],"length":1,"stats":{"Line":0}},{"line":176,"address":[40363664],"length":1,"stats":{"Line":0}},{"line":179,"address":[40725754],"length":1,"stats":{"Line":0}},{"line":180,"address":[40725484],"length":1,"stats":{"Line":0}},{"line":181,"address":[40725560,40725636],"length":1,"stats":{"Line":0}},{"line":182,"address":[40725714],"length":1,"stats":{"Line":0}},{"line":184,"address":[40725936],"length":1,"stats":{"Line":0}},{"line":190,"address":[40723868],"length":1,"stats":{"Line":1}}],"covered":55,"coverable":87},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","adapters","fs_config_service.rs"],"content":"use crate::domain::config::AppConfig;\nuse crate::ports::config_port::ConfigService;\nuse std::fs;\nuse std::path::PathBuf;\n\npub struct FsConfigService {\n    custom_root: Option\u003cPathBuf\u003e,\n}\n\nimpl FsConfigService {\n    pub fn new() -\u003e Self {\n        Self { custom_root: None }\n    }\n\n    #[cfg(test)]\n    pub fn new_with_root(root: PathBuf) -\u003e Self {\n        Self {\n            custom_root: Some(root),\n        }\n    }\n}\n\nimpl ConfigService for FsConfigService {\n    fn get_config_dir(\u0026self) -\u003e Option\u003cPathBuf\u003e {\n        if let Some(ref root) = self.custom_root {\n            return Some(root.clone());\n        }\n        dirs::config_dir().map(|p| p.join(\"stratos-bar\"))\n    }\n\n    fn load_config(\u0026self) -\u003e AppConfig {\n        let mut config = if let Some(config_dir) = self.get_config_dir() {\n            let config_path = config_dir.join(\"config.json\");\n            if config_path.exists() {\n                if let Ok(content) = fs::read_to_string(config_path) {\n                    serde_json::from_str(\u0026content).unwrap_or_default()\n                } else {\n                    AppConfig::default()\n                }\n            } else {\n                AppConfig::default()\n            }\n        } else {\n            AppConfig::default()\n        };\n\n        // Set Defaults if empty\n        config.apply_defaults();\n\n        config\n    }\n\n    fn save_config(\u0026self, config: \u0026AppConfig) -\u003e Result\u003c(), String\u003e {\n        if let Some(config_dir) = self.get_config_dir() {\n            if !config_dir.exists() {\n                fs::create_dir_all(\u0026config_dir).map_err(|e| e.to_string())?;\n            }\n            let config_path = config_dir.join(\"config.json\");\n            let content = serde_json::to_string_pretty(config).map_err(|e| e.to_string())?;\n            fs::write(config_path, content).map_err(|e| e.to_string())?;\n            Ok(())\n        } else {\n            Err(\"Could not find config directory\".to_string())\n        }\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use tempfile::tempdir;\n\n    #[test]\n    fn test_save_and_load_config() {\n        let dir = tempdir().unwrap();\n        let service = FsConfigService::new_with_root(dir.path().to_path_buf());\n\n        let mut config = AppConfig::default();\n        config.preferred_model = \"test_model\".to_string();\n\n        // Save\n        service.save_config(\u0026config).expect(\"Failed to save config\");\n\n        // Load\n        let loaded_config = service.load_config();\n        assert_eq!(loaded_config.preferred_model, \"test_model\");\n    }\n\n    #[test]\n    fn test_load_defaults_if_missing() {\n        let dir = tempdir().unwrap();\n        let service = FsConfigService::new_with_root(dir.path().to_path_buf());\n\n        let config = service.load_config();\n        // Should have defaults applied\n        assert_eq!(config.preferred_model, \"local\");\n    }\n}\n","traces":[{"line":11,"address":[41423920],"length":1,"stats":{"Line":0}},{"line":16,"address":[41516320],"length":1,"stats":{"Line":2}},{"line":18,"address":[41516323],"length":1,"stats":{"Line":2}},{"line":24,"address":[41516176],"length":1,"stats":{"Line":2}},{"line":25,"address":[41516199],"length":1,"stats":{"Line":2}},{"line":26,"address":[41423840],"length":1,"stats":{"Line":2}},{"line":28,"address":[42332160,42332187],"length":1,"stats":{"Line":0}},{"line":31,"address":[41514813,41513920,41514684],"length":1,"stats":{"Line":1}},{"line":32,"address":[41513945],"length":1,"stats":{"Line":1}},{"line":33,"address":[41514129,41514043],"length":1,"stats":{"Line":2}},{"line":34,"address":[41514177,41514245],"length":1,"stats":{"Line":2}},{"line":35,"address":[41514414,41514278,41514362],"length":1,"stats":{"Line":3}},{"line":36,"address":[41514454,41514530],"length":1,"stats":{"Line":2}},{"line":38,"address":[41514690,41514404],"length":1,"stats":{"Line":0}},{"line":41,"address":[41514271,41514341],"length":1,"stats":{"Line":2}},{"line":44,"address":[41514060],"length":1,"stats":{"Line":0}},{"line":48,"address":[41422306],"length":1,"stats":{"Line":1}},{"line":50,"address":[41514865],"length":1,"stats":{"Line":1}},{"line":53,"address":[41516100,41514896,41516162],"length":1,"stats":{"Line":1}},{"line":54,"address":[41514934],"length":1,"stats":{"Line":1}},{"line":55,"address":[41515022,41515161],"length":1,"stats":{"Line":2}},{"line":56,"address":[41492528,41492512],"length":1,"stats":{"Line":0}},{"line":58,"address":[41515208,41515403],"length":1,"stats":{"Line":2}},{"line":59,"address":[41492304,41492288],"length":1,"stats":{"Line":2}},{"line":60,"address":[41492400,41492416],"length":1,"stats":{"Line":2}},{"line":61,"address":[41516003],"length":1,"stats":{"Line":1}},{"line":63,"address":[41515039],"length":1,"stats":{"Line":0}}],"covered":21,"coverable":27},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","adapters","google_translation_service.rs"],"content":"use crate::domain::translation::{TranslationRequest, TranslationResult};\nuse crate::ports::translation_port::TranslationService;\nuse async_trait::async_trait;\nuse reqwest::Client;\nuse serde_json::Value;\nuse std::error::Error;\n\npub struct GoogleTranslationService {\n    client: Client,\n    base_url: String,\n}\n\nimpl GoogleTranslationService {\n    pub fn new(base_url: Option\u003cString\u003e) -\u003e Self {\n        Self {\n            client: Client::new(),\n            base_url: base_url.unwrap_or_else(|| {\n                \"https://translate.googleapis.com/translate_a/single\".to_string()\n            }),\n        }\n    }\n}\n\n#[async_trait]\nimpl TranslationService for GoogleTranslationService {\n    async fn translate(\n        \u0026self,\n        request: TranslationRequest,\n    ) -\u003e Result\u003cTranslationResult, Box\u003cdyn Error + Send + Sync\u003e\u003e {\n        let source_lang = request.source_lang.unwrap_or_else(|| \"auto\".to_string());\n        let target_lang = request.target_lang; // e.g. \"en\"\n\n        // client=gtx \u0026 sl=auto \u0026 tl=en \u0026 dt=t \u0026 q=...\n        let res = self\n            .client\n            .get(\u0026self.base_url)\n            .query(\u0026[\n                (\"client\", \"gtx\"),\n                (\"sl\", \u0026source_lang),\n                (\"tl\", \u0026target_lang),\n                (\"dt\", \"t\"),\n                (\"q\", \u0026request.text),\n            ])\n            .send()\n            .await?\n            .json::\u003cValue\u003e()\n            .await?;\n\n        // Parse logic:\n        // Response is roughly: [[[\"Target\", \"Source\", null, null, ...]], null, \"detected_lang\", ...]\n\n        let translated_text = res\n            .get(0)\n            .and_then(|v| v.as_array())\n            .and_then(|arr| {\n                // Iterate over all segments (for multi-sentence input)\n                let mut full_translation = String::new();\n                for segment in arr {\n                    if let Some(text) = segment.get(0).and_then(|s| s.as_str()) {\n                        full_translation.push_str(text);\n                    }\n                }\n                if full_translation.is_empty() {\n                    None\n                } else {\n                    Some(full_translation)\n                }\n            })\n            .ok_or(\"Failed to parse translation from response\")?;\n\n        let detected_source = res\n            .get(2)\n            .and_then(|v| v.as_str())\n            .unwrap_or(\u0026source_lang)\n            .to_string();\n\n        Ok(TranslationResult {\n            original_text: request.text,\n            translated_text,\n            source_language: detected_source,\n            target_language: target_lang,\n        })\n    }\n}\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use wiremock::matchers::{method, path, query_param};\n    use wiremock::{Mock, MockServer, ResponseTemplate};\n\n    #[tokio::test]\n    async fn test_translate_success() {\n        let mock_server = MockServer::start().await;\n\n        // Simplified Google Translate API response\n        // [[[\"Hola\",\"Hello\",null,null,10]],null,\"en\",...]\n        let response_body = serde_json::json!([[[\"Hola\", \"Hello\", null, null, 10]], null, \"en\"]);\n\n        Mock::given(method(\"GET\"))\n            .and(path(\"/translate_a/single\"))\n            .and(query_param(\"sl\", \"auto\"))\n            .and(query_param(\"tl\", \"es\"))\n            .and(query_param(\"q\", \"Hello\"))\n            .respond_with(ResponseTemplate::new(200).set_body_json(response_body))\n            .mount(\u0026mock_server)\n            .await;\n\n        // Use the mock server URI as base_url\n        // Note: mock_server.uri() returns \"http://127.0.0.1:xxx\".\n        // Our service appends \"?...\" to it.\n        // However, the service code does: let url = format!(\"{}/translate_a/single\", self.base_url); NO\n        // The service code does: client.get(\u0026self.base_url)\n        // So we need to pass the FULL path in the base_url or change the service logic to append path.\n        // Currently service logic: client.get(\u0026self.base_url)\n        // And default base_url is \"https://translate.googleapis.com/translate_a/single\"\n        // So for the mock, we should pass \"http://127.0.0.1:xxx/translate_a/single\"\n\n        let mut base_url = mock_server.uri();\n        base_url.push_str(\"/translate_a/single\");\n\n        let service = GoogleTranslationService::new(Some(base_url));\n\n        let result = service\n            .translate(TranslationRequest {\n                text: \"Hello\".to_string(),\n                source_lang: None,\n                target_lang: \"es\".to_string(),\n            })\n            .await\n            .unwrap();\n\n        assert_eq!(result.translated_text, \"Hola\");\n        assert_eq!(result.source_language, \"en\");\n        assert_eq!(result.target_language, \"es\");\n    }\n}\n","traces":[{"line":14,"address":[45039294,45039072],"length":1,"stats":{"Line":1}},{"line":16,"address":[41633314,41633381],"length":1,"stats":{"Line":2}},{"line":17,"address":[39297904],"length":1,"stats":{"Line":1}},{"line":26,"address":[39301823,39299573,39298471,39298014,39298445,39298206,39301420,39301640,39297952,39299541,39298163,39301617,39301744],"length":1,"stats":{"Line":4}},{"line":30,"address":[39301980,39301968,39298378],"length":1,"stats":{"Line":3}},{"line":31,"address":[39298527],"length":1,"stats":{"Line":1}},{"line":34,"address":[39300269,39299790,39299826,39298563,39300024,39300076,39300381,39299906,39301513,39299454,39299309,39300331],"length":1,"stats":{"Line":8}},{"line":36,"address":[39298628,39298578],"length":1,"stats":{"Line":2}},{"line":37,"address":[39299149,39299333],"length":1,"stats":{"Line":2}},{"line":38,"address":[39298636],"length":1,"stats":{"Line":1}},{"line":39,"address":[39298690,39298788],"length":1,"stats":{"Line":2}},{"line":40,"address":[39298831,39298929],"length":1,"stats":{"Line":2}},{"line":41,"address":[39298972],"length":1,"stats":{"Line":1}},{"line":42,"address":[39299106,39299026],"length":1,"stats":{"Line":2}},{"line":45,"address":[39299891,39298193,39299439,39299607,39299800,39299487],"length":1,"stats":{"Line":4}},{"line":47,"address":[44160409,44160805,44160477,44160539,44158598,44160733],"length":1,"stats":{"Line":3}},{"line":52,"address":[39300626,39300702],"length":1,"stats":{"Line":1}},{"line":54,"address":[44163081,44160991,44163072],"length":1,"stats":{"Line":3}},{"line":55,"address":[44162480,44163046,44161012,44163040],"length":1,"stats":{"Line":2}},{"line":57,"address":[39302046],"length":1,"stats":{"Line":1}},{"line":58,"address":[44162613,44162541],"length":1,"stats":{"Line":2}},{"line":59,"address":[39302441,39302244,39302601,39302592],"length":1,"stats":{"Line":4}},{"line":60,"address":[44163028],"length":1,"stats":{"Line":1}},{"line":63,"address":[39302372,39302264],"length":1,"stats":{"Line":2}},{"line":64,"address":[39302379],"length":1,"stats":{"Line":0}},{"line":66,"address":[39302290],"length":1,"stats":{"Line":1}},{"line":73,"address":[39300865,39301913,39301904],"length":1,"stats":{"Line":3}},{"line":74,"address":[39300910],"length":1,"stats":{"Line":1}},{"line":77,"address":[39301110],"length":1,"stats":{"Line":1}},{"line":78,"address":[39301010],"length":1,"stats":{"Line":1}},{"line":79,"address":[39301041],"length":1,"stats":{"Line":1}},{"line":81,"address":[39301073],"length":1,"stats":{"Line":1}}],"covered":31,"coverable":32},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","adapters","http_ai_service.rs"],"content":"use crate::domain::ai::Message;\nuse crate::domain::config::AppConfig;\nuse crate::ports::ai_port::AiService;\nuse futures_util::stream::BoxStream;\nuse futures_util::StreamExt;\nuse reqwest::Client;\nuse serde_json::json;\n\npub struct HttpAiService {\n    client: Client,\n    openai_base_url: String,\n}\n\nimpl HttpAiService {\n    pub fn new() -\u003e Self {\n        Self {\n            client: Client::new(),\n            openai_base_url: \"https://api.openai.com/v1\".to_string(),\n        }\n    }\n\n    #[cfg(test)]\n    pub fn new_with_url(openai_url: String) -\u003e Self {\n        Self {\n            client: Client::new(),\n            openai_base_url: openai_url,\n        }\n    }\n}\n\n#[async_trait::async_trait]\nimpl AiService for HttpAiService {\n    async fn stream_completion\u003c'a\u003e(\n        \u0026'a self,\n        config: \u0026'a AppConfig,\n        messages: Vec\u003cMessage\u003e,\n    ) -\u003e Result\u003cBoxStream\u003c'a, Result\u003cString, String\u003e\u003e, String\u003e {\n        if config.preferred_model == \"local\" {\n            // Ollama\n            let url = format!(\n                \"{}/api/chat\",\n                config\n                    .local_model_url\n                    .as_deref()\n                    .unwrap_or(\"http://127.0.0.1:11434\")\n            );\n\n            let res = self\n                .client\n                .post(url)\n                .json(\u0026json!({\n                    \"model\": config.ollama_model.as_deref().unwrap_or(\"llama3\"),\n                    \"messages\": messages,\n                    \"stream\": true\n                }))\n                .send()\n                .await\n                .map_err(|e| e.to_string())?;\n\n            let stream = res.bytes_stream().map(|item| match item {\n                Ok(chunk) =\u003e {\n                    let chunk_str = String::from_utf8_lossy(\u0026chunk);\n                    let mut content = String::new();\n                    for line in chunk_str.lines() {\n                        if line.trim().is_empty() {\n                            continue;\n                        }\n                        if let Ok(val) = serde_json::from_str::\u003cserde_json::Value\u003e(line) {\n                            if let Some(c) = val[\"message\"][\"content\"].as_str() {\n                                content.push_str(c);\n                            }\n                        }\n                    }\n                    Ok(content)\n                }\n                Err(e) =\u003e Err(e.to_string()),\n            });\n\n            // Filter empty contents? Actually the map above aggregates per chunk, but might return empty strings if chunk had no content.\n            // Using Box::pin to create BoxStream\n            Ok(Box::pin(stream))\n        } else {\n            // OpenAI\n            if let Some(key) = \u0026config.openai_api_key {\n                let url = format!(\"{}/chat/completions\", self.openai_base_url);\n                let res = self\n                    .client\n                    .post(\u0026url)\n                    .header(\"Authorization\", format!(\"Bearer {}\", key))\n                    .json(\u0026json!({\n                        \"model\": \"gpt-4o\",\n                        \"messages\": messages,\n                        \"stream\": true\n                    }))\n                    .send()\n                    .await\n                    .map_err(|e| e.to_string())?;\n\n                let stream = res.bytes_stream().map(|item| match item {\n                    Ok(chunk) =\u003e {\n                        let chunk_str = String::from_utf8_lossy(\u0026chunk);\n                        let mut content = String::new();\n                        for line in chunk_str.lines() {\n                            let line = line.trim();\n                            if line.starts_with(\"data: \") {\n                                let data = \u0026line[6..];\n                                if data == \"[DONE]\" {\n                                    break;\n                                }\n                                if let Ok(val) = serde_json::from_str::\u003cserde_json::Value\u003e(data) {\n                                    if let Some(c) = val[\"choices\"][0][\"delta\"][\"content\"].as_str()\n                                    {\n                                        content.push_str(c);\n                                    }\n                                }\n                            }\n                        }\n                        Ok(content)\n                    }\n                    Err(e) =\u003e Err(e.to_string()),\n                });\n\n                Ok(Box::pin(stream))\n            } else {\n                Err(\"No OpenAI API Key configured\".to_string())\n            }\n        }\n    }\n\n    async fn check_connection(\u0026self, config: \u0026AppConfig) -\u003e Result\u003cString, String\u003e {\n        let start = std::time::Instant::now();\n\n        if config.preferred_model == \"local\" {\n            let url = format!(\n                \"{}/api/tags\",\n                config\n                    .local_model_url\n                    .as_deref()\n                    .unwrap_or(\"http://127.0.0.1:11434\")\n            );\n\n            let res = self\n                .client\n                .get(\u0026url)\n                .timeout(std::time::Duration::from_secs(2))\n                .send()\n                .await;\n\n            match res {\n                Ok(response) =\u003e {\n                    if response.status().is_success() {\n                        let duration = start.elapsed();\n                        Ok(format!(\"Connected to Ollama ({:?})\", duration))\n                    } else {\n                        Err(format!(\"Ollama returned error: {}\", response.status()))\n                    }\n                }\n                Err(e) =\u003e Err(format!(\"Failed to connect to Ollama: {}\", e)),\n            }\n        } else {\n            if let Some(key) = \u0026config.openai_api_key {\n                let url = format!(\"{}/models\", self.openai_base_url);\n                let res = self\n                    .client\n                    .get(\u0026url)\n                    .header(\"Authorization\", format!(\"Bearer {}\", key))\n                    .timeout(std::time::Duration::from_secs(5))\n                    .send()\n                    .await;\n\n                match res {\n                    Ok(response) =\u003e {\n                        if response.status().is_success() {\n                            let duration = start.elapsed();\n                            Ok(format!(\"Connected to OpenAI ({:?})\", duration))\n                        } else {\n                            Err(format!(\"OpenAI returned error: {}\", response.status()))\n                        }\n                    }\n                    Err(e) =\u003e Err(format!(\"Failed to connect to OpenAI: {}\", e)),\n                }\n            } else {\n                Err(\"No OpenAI API Key configured\".to_string())\n            }\n        }\n    }\n\n    async fn list_models(\u0026self, config: \u0026AppConfig) -\u003e Result\u003cVec\u003cString\u003e, String\u003e {\n        let url = format!(\n            \"{}/api/tags\",\n            config\n                .local_model_url\n                .as_deref()\n                .unwrap_or(\"http://127.0.0.1:11434\")\n        );\n\n        let res = self\n            .client\n            .get(url)\n            .send()\n            .await\n            .map_err(|e| e.to_string())?;\n        let body: serde_json::Value = res.json().await.map_err(|e| e.to_string())?;\n\n        if let Some(models) = body[\"models\"].as_array() {\n            let names = models\n                .iter()\n                .filter_map(|m| m[\"name\"].as_str().map(|s| s.to_string()))\n                .collect();\n            Ok(names)\n        } else {\n            Ok(vec![])\n        }\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use wiremock::matchers::{method, path};\n    use wiremock::{Mock, MockServer, ResponseTemplate};\n\n    #[tokio::test]\n    async fn test_local_ollama_completion() {\n        let mock_server = MockServer::start().await;\n        let service = HttpAiService::new();\n\n        let response_body = json!({\n            \"message\": {\n                \"content\": \"Hello world\"\n            },\n            \"done\": false\n        });\n\n        // Mock the ollama chat endpoint\n        Mock::given(method(\"POST\"))\n            .and(path(\"/api/chat\"))\n            .respond_with(ResponseTemplate::new(200).set_body_json(response_body))\n            .mount(\u0026mock_server)\n            .await;\n\n        let mut config = AppConfig::default();\n        config.preferred_model = \"local\".to_string();\n        config.local_model_url = Some(mock_server.uri());\n\n        let stream = service.stream_completion(\u0026config, vec![]).await.unwrap();\n        let result: Vec\u003cString\u003e = stream\n            .collect::\u003cVec\u003c_\u003e\u003e()\n            .await\n            .into_iter()\n            .map(|r| r.unwrap())\n            .collect();\n\n        assert!(!result.is_empty());\n        assert_eq!(result.concat(), \"Hello world\");\n    }\n\n    #[tokio::test]\n    async fn test_openai_completion() {\n        let mock_server = MockServer::start().await;\n        let service = HttpAiService::new_with_url(mock_server.uri());\n\n        // Mock OpenAI style stream response\n        let chunk = json!({\n            \"choices\": [{\n                \"delta\": {\n                    \"content\": \"Hello OpenAI\"\n                }\n            }]\n        });\n        let body = format!(\n            \"data: {}\\n\\ndata: [DONE]\",\n            serde_json::to_string(\u0026chunk).unwrap()\n        );\n\n        Mock::given(method(\"POST\"))\n            .and(path(\"/chat/completions\"))\n            .respond_with(ResponseTemplate::new(200).set_body_string(body))\n            .mount(\u0026mock_server)\n            .await;\n\n        let mut config = AppConfig::default();\n        config.preferred_model = \"cloud\".to_string();\n        config.openai_api_key = Some(\"test-key\".to_string());\n\n        let stream = service.stream_completion(\u0026config, vec![]).await.unwrap();\n        let result: Vec\u003cString\u003e = stream\n            .collect::\u003cVec\u003c_\u003e\u003e()\n            .await\n            .into_iter()\n            .map(|r| r.unwrap())\n            .collect();\n\n        assert_eq!(result.concat(), \"Hello OpenAI\");\n    }\n}\n","traces":[{"line":15,"address":[44861322,44861328,44861184],"length":1,"stats":{"Line":1}},{"line":17,"address":[45296430],"length":1,"stats":{"Line":1}},{"line":18,"address":[45296444],"length":1,"stats":{"Line":1}},{"line":23,"address":[45296240,45296385],"length":1,"stats":{"Line":1}},{"line":25,"address":[45296258],"length":1,"stats":{"Line":1}},{"line":33,"address":[39034169,39034197],"length":1,"stats":{"Line":6}},{"line":38,"address":[45028953,45029056,45033141],"length":1,"stats":{"Line":4}},{"line":40,"address":[44635739],"length":1,"stats":{"Line":1}},{"line":42,"address":[44633896,44635715],"length":1,"stats":{"Line":2}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[45029140],"length":1,"stats":{"Line":1}},{"line":45,"address":[44635660],"length":1,"stats":{"Line":1}},{"line":48,"address":[45031150,45032700,45032787,45032317,45032648],"length":1,"stats":{"Line":4}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[45031154],"length":1,"stats":{"Line":1}},{"line":51,"address":[44636030,44637062,44636110,44636473,44636197,44636540,44635944,44635992,44636280],"length":1,"stats":{"Line":3}},{"line":52,"address":[44636081,44636164,44636248],"length":1,"stats":{"Line":3}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[45032658,45032282,45032471,45032347,45028774],"length":1,"stats":{"Line":4}},{"line":58,"address":[45032212,45035760,45032910,45032673,45032755,45033176,45035744],"length":1,"stats":{"Line":2}},{"line":60,"address":[45034292,45032969,45035497,45034256,45035447],"length":1,"stats":{"Line":3}},{"line":61,"address":[44640830],"length":1,"stats":{"Line":1}},{"line":62,"address":[45034472,45034401],"length":1,"stats":{"Line":2}},{"line":63,"address":[45034499],"length":1,"stats":{"Line":1}},{"line":64,"address":[44641007,44641095],"length":1,"stats":{"Line":2}},{"line":65,"address":[44641426,44641279],"length":1,"stats":{"Line":2}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[44641461,44641543],"length":1,"stats":{"Line":2}},{"line":69,"address":[44641575,44641663],"length":1,"stats":{"Line":2}},{"line":70,"address":[44641815,44641844],"length":1,"stats":{"Line":2}},{"line":74,"address":[44641304],"length":1,"stats":{"Line":1}},{"line":76,"address":[44641962,44640787],"length":1,"stats":{"Line":0}},{"line":81,"address":[45033063],"length":1,"stats":{"Line":1}},{"line":84,"address":[44633834,44633958],"length":1,"stats":{"Line":2}},{"line":85,"address":[44633962,44634023],"length":1,"stats":{"Line":2}},{"line":86,"address":[44635374,44634143,44638084,44634386,44638148,44638215],"length":1,"stats":{"Line":5}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[44634209,44634147],"length":1,"stats":{"Line":2}},{"line":89,"address":[44634166,44634248,44634217,44634394,44635520],"length":1,"stats":{"Line":2}},{"line":90,"address":[44634834,44635426,44634504,44634453,44635454,44634607,44634901,44634542],"length":1,"stats":{"Line":2}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[44633563,44635359,44635404,44637904,44638094],"length":1,"stats":{"Line":4}},{"line":97,"address":[43482581,43482543],"length":1,"stats":{"Line":2}},{"line":99,"address":[44638896,44640389,44640309,44638935,44638393],"length":1,"stats":{"Line":3}},{"line":100,"address":[45035979],"length":1,"stats":{"Line":1}},{"line":101,"address":[44639129,44639046],"length":1,"stats":{"Line":2}},{"line":102,"address":[45036120],"length":1,"stats":{"Line":1}},{"line":103,"address":[44639204,44639304],"length":1,"stats":{"Line":2}},{"line":104,"address":[44639484,44639604],"length":1,"stats":{"Line":2}},{"line":105,"address":[44639636],"length":1,"stats":{"Line":1}},{"line":106,"address":[44639686],"length":1,"stats":{"Line":1}},{"line":107,"address":[44639745],"length":1,"stats":{"Line":1}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[45036753,45036851],"length":1,"stats":{"Line":2}},{"line":111,"address":[44640007,44639919],"length":1,"stats":{"Line":2}},{"line":113,"address":[45037205,45037234],"length":1,"stats":{"Line":2}},{"line":118,"address":[44639509],"length":1,"stats":{"Line":1}},{"line":120,"address":[44638969,44640402],"length":1,"stats":{"Line":0}},{"line":123,"address":[44638491],"length":1,"stats":{"Line":1}},{"line":125,"address":[44635542,44633989],"length":1,"stats":{"Line":0}},{"line":130,"address":[44630184,44628670,44628969,44628820,44628608,44628777,44629130,44628979,44629063,44630336,44630922],"length":1,"stats":{"Line":0}},{"line":131,"address":[44628998,44629200],"length":1,"stats":{"Line":0}},{"line":133,"address":[44629206],"length":1,"stats":{"Line":0}},{"line":134,"address":[45025624],"length":1,"stats":{"Line":0}},{"line":136,"address":[45025600,45024498],"length":1,"stats":{"Line":0}},{"line":138,"address":[44629322],"length":1,"stats":{"Line":0}},{"line":139,"address":[45025557],"length":1,"stats":{"Line":0}},{"line":142,"address":[44631127,44630705,44630571,44630854],"length":1,"stats":{"Line":0}},{"line":144,"address":[44630629,44630575],"length":1,"stats":{"Line":0}},{"line":145,"address":[44630642,44630658,44630900,44630594,44630713],"length":1,"stats":{"Line":0}},{"line":147,"address":[43481407],"length":1,"stats":{"Line":0}},{"line":149,"address":[44631152],"length":1,"stats":{"Line":0}},{"line":150,"address":[44631263],"length":1,"stats":{"Line":0}},{"line":151,"address":[45027088,45026547,45026486],"length":1,"stats":{"Line":0}},{"line":152,"address":[45026878,45026612],"length":1,"stats":{"Line":0}},{"line":153,"address":[45026901],"length":1,"stats":{"Line":0}},{"line":155,"address":[45026644,45026592],"length":1,"stats":{"Line":0}},{"line":158,"address":[45027119,45026392],"length":1,"stats":{"Line":0}},{"line":161,"address":[45024436,45024560],"length":1,"stats":{"Line":0}},{"line":162,"address":[44629380,44629441],"length":1,"stats":{"Line":0}},{"line":163,"address":[44632292,44629561,44630103,44629804,44629954],"length":1,"stats":{"Line":0}},{"line":165,"address":[45024815,45024749],"length":1,"stats":{"Line":0}},{"line":166,"address":[45024854,45025000,45024823,45024772,45025390],"length":1,"stats":{"Line":0}},{"line":167,"address":[45025068,45025352,45025154,45025090],"length":1,"stats":{"Line":0}},{"line":169,"address":[45025329,45027337,45024012,45027518,45025264],"length":1,"stats":{"Line":0}},{"line":171,"address":[44632317],"length":1,"stats":{"Line":0}},{"line":172,"address":[44632428],"length":1,"stats":{"Line":0}},{"line":173,"address":[44632435,44632496,44633037],"length":1,"stats":{"Line":0}},{"line":174,"address":[44632827,44632561],"length":1,"stats":{"Line":0}},{"line":175,"address":[44632850],"length":1,"stats":{"Line":0}},{"line":177,"address":[44632593,44632541],"length":1,"stats":{"Line":0}},{"line":180,"address":[44633068,44632345],"length":1,"stats":{"Line":0}},{"line":183,"address":[44630212,44629407],"length":1,"stats":{"Line":0}},{"line":188,"address":[44627279,44625736,44626114,44626033,44626620,44625831,44625680,44625874,44628226,44626181],"length":1,"stats":{"Line":0}},{"line":189,"address":[45021403],"length":1,"stats":{"Line":0}},{"line":191,"address":[44626052,44626291],"length":1,"stats":{"Line":0}},{"line":193,"address":[44626060],"length":1,"stats":{"Line":0}},{"line":194,"address":[44626236],"length":1,"stats":{"Line":0}},{"line":197,"address":[44626889,44626450,44626956,44627260,44626574,44626825],"length":1,"stats":{"Line":0}},{"line":199,"address":[44626470],"length":1,"stats":{"Line":0}},{"line":201,"address":[44626835,44625861,44626604,44626559,44626654],"length":1,"stats":{"Line":0}},{"line":202,"address":[45022032,45021950,45023536,45023552],"length":1,"stats":{"Line":0}},{"line":203,"address":[44625882,44627293,44627099,44628231,44628464,44627199,44628485],"length":1,"stats":{"Line":0}},{"line":205,"address":[44627768,44627680,44628109],"length":1,"stats":{"Line":0}},{"line":206,"address":[44627844],"length":1,"stats":{"Line":0}},{"line":208,"address":[44628582,44628368,44628403,44628560,44627928],"length":1,"stats":{"Line":0}},{"line":210,"address":[44627970],"length":1,"stats":{"Line":0}},{"line":212,"address":[44628049,44627865],"length":1,"stats":{"Line":0}}],"covered":50,"coverable":111},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","adapters","linux_window_service.rs"],"content":"use crate::domain::windows::WindowEntry;\nuse crate::ports::window_port::WindowService;\nuse std::env;\nuse std::process::Command;\nuse std::sync::Arc;\n\n#[cfg_attr(test, mockall::automock)]\npub trait CommandExecutor: Send + Sync {\n    fn execute(\u0026self, cmd: \u0026str, args: Vec\u003cString\u003e) -\u003e Result\u003cstd::process::Output, String\u003e;\n}\n\npub struct StdCommandExecutor;\n\nimpl CommandExecutor for StdCommandExecutor {\n    fn execute(\u0026self, cmd: \u0026str, args: Vec\u003cString\u003e) -\u003e Result\u003cstd::process::Output, String\u003e {\n        Command::new(cmd)\n            .args(args)\n            .output()\n            .map_err(|e| format!(\"Failed to execute {}: {}\", cmd, e))\n    }\n}\n\ntrait WindowBackend {\n    fn list_windows(\u0026self, executor: \u0026dyn CommandExecutor) -\u003e Result\u003cVec\u003cWindowEntry\u003e, String\u003e;\n    fn focus_window(\u0026self, executor: \u0026dyn CommandExecutor, id: \u0026str) -\u003e Result\u003c(), String\u003e;\n}\n\nstruct HyprlandBackend;\nstruct WlrctlBackend;\nstruct WmctrlBackend;\n\nimpl WindowBackend for HyprlandBackend {\n    fn list_windows(\u0026self, executor: \u0026dyn CommandExecutor) -\u003e Result\u003cVec\u003cWindowEntry\u003e, String\u003e {\n        let output = executor.execute(\"hyprctl\", vec![\"clients\".to_string(), \"-j\".to_string()])?;\n\n        if !output.status.success() {\n            return Err(\"hyprctl command failed\".to_string());\n        }\n\n        let clients: Vec\u003cserde_json::Value\u003e = serde_json::from_slice(\u0026output.stdout)\n            .map_err(|e| format!(\"Failed to parse hyprctl output: {}\", e))?;\n\n        Ok(clients\n            .into_iter()\n            .map(|client| {\n                let class = client[\"class\"].as_str().unwrap_or(\"\").to_string();\n                let title = client[\"title\"].as_str().unwrap_or(\"\").to_string();\n                let address = client[\"address\"].as_str().unwrap_or(\"\").to_string();\n                WindowEntry {\n                    title,\n                    class,\n                    address,\n                    icon: None, // Will be resolved by service or caller\n                }\n            })\n            .collect())\n    }\n\n    fn focus_window(\u0026self, executor: \u0026dyn CommandExecutor, id: \u0026str) -\u003e Result\u003c(), String\u003e {\n        let output = executor.execute(\n            \"hyprctl\",\n            vec![\n                \"dispatch\".to_string(),\n                \"focuswindow\".to_string(),\n                format!(\"address:{}\", id),\n            ],\n        )?;\n\n        if output.status.success() {\n            Ok(())\n        } else {\n            Err(\"Failed to focus window via hyprctl\".to_string())\n        }\n    }\n}\n\nimpl WindowBackend for WlrctlBackend {\n    fn list_windows(\u0026self, executor: \u0026dyn CommandExecutor) -\u003e Result\u003cVec\u003cWindowEntry\u003e, String\u003e {\n        let output =\n            executor.execute(\"wlrctl\", vec![\"toplevel\".to_string(), \"list\".to_string()])?;\n\n        if !output.status.success() {\n            return Err(\"wlrctl command failed\".to_string());\n        }\n\n        let stdout = String::from_utf8_lossy(\u0026output.stdout);\n        let mut windows = Vec::new();\n\n        for line in stdout.lines() {\n            let parts: Vec\u003c\u0026str\u003e = line.splitn(2, ':').collect();\n            if parts.len() == 2 {\n                let app_id = parts[0].trim().to_string();\n                let title = parts[1].trim().to_string();\n                windows.push(WindowEntry {\n                    title: title.clone(),\n                    class: app_id.clone(),\n                    address: app_id,\n                    icon: None,\n                });\n            }\n        }\n        Ok(windows)\n    }\n\n    fn focus_window(\u0026self, executor: \u0026dyn CommandExecutor, id: \u0026str) -\u003e Result\u003c(), String\u003e {\n        let output = executor.execute(\n            \"wlrctl\",\n            vec![\"toplevel\".to_string(), \"focus\".to_string(), id.to_string()],\n        )?;\n\n        if output.status.success() {\n            Ok(())\n        } else {\n            Err(\"Failed to focus window via wlrctl\".to_string())\n        }\n    }\n}\n\nimpl WindowBackend for WmctrlBackend {\n    fn list_windows(\u0026self, executor: \u0026dyn CommandExecutor) -\u003e Result\u003cVec\u003cWindowEntry\u003e, String\u003e {\n        let output = executor.execute(\"wmctrl\", vec![\"-l\".to_string(), \"-x\".to_string()])?;\n\n        let stdout = String::from_utf8_lossy(\u0026output.stdout);\n        let mut windows = Vec::new();\n\n        for line in stdout.lines() {\n            let parts: Vec\u003c\u0026str\u003e = line.split_whitespace().collect();\n            if parts.len() \u003e= 5 {\n                let id = parts[0].to_string();\n                let class_full = parts[2].to_string();\n                let title = parts[4..].join(\" \");\n                let class = class_full\n                    .split('.')\n                    .last()\n                    .unwrap_or(\u0026class_full)\n                    .to_string();\n\n                windows.push(WindowEntry {\n                    title,\n                    class,\n                    address: id,\n                    icon: None,\n                });\n            }\n        }\n        Ok(windows)\n    }\n\n    fn focus_window(\u0026self, executor: \u0026dyn CommandExecutor, id: \u0026str) -\u003e Result\u003c(), String\u003e {\n        let output = executor.execute(\n            \"wmctrl\",\n            vec![\"-i\".to_string(), \"-a\".to_string(), id.to_string()],\n        )?;\n\n        if output.status.success() {\n            Ok(())\n        } else {\n            Err(\"Failed to focus window via wmctrl\".to_string())\n        }\n    }\n}\n\npub struct LinuxWindowService {\n    executor: Arc\u003cdyn CommandExecutor\u003e,\n}\n\nimpl LinuxWindowService {\n    pub fn new(executor: Arc\u003cdyn CommandExecutor\u003e) -\u003e Self {\n        Self { executor }\n    }\n\n    fn get_backend(\u0026self) -\u003e Box\u003cdyn WindowBackend\u003e {\n        if env::var(\"HYPRLAND_INSTANCE_SIGNATURE\").is_ok() {\n            return Box::new(HyprlandBackend);\n        }\n        if env::var(\"WAYLAND_DISPLAY\").is_ok() {\n            return Box::new(WlrctlBackend);\n        }\n        Box::new(WmctrlBackend)\n    }\n}\n\nimpl WindowService for LinuxWindowService {\n    fn list_windows(\u0026self) -\u003e Result\u003cVec\u003cWindowEntry\u003e, String\u003e {\n        self.get_backend().list_windows(self.executor.as_ref())\n    }\n\n    fn focus_window(\u0026self, id: \u0026str) -\u003e Result\u003c(), String\u003e {\n        self.get_backend().focus_window(self.executor.as_ref(), id)\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use std::os::unix::process::ExitStatusExt;\n    use std::process::ExitStatus;\n\n    fn mock_success_output(stdout: \u0026str) -\u003e std::process::Output {\n        std::process::Output {\n            status: ExitStatus::from_raw(0), // 0 means success in unix\n            stdout: stdout.as_bytes().to_vec(),\n            stderr: Vec::new(),\n        }\n    }\n\n    #[test]\n    fn test_hyprland_backend_list_windows() {\n        let mut mock = MockCommandExecutor::new();\n        mock.expect_execute()\n            .with(\n                mockall::predicate::eq(\"hyprctl\"),\n                mockall::predicate::eq(vec![\"clients\".to_string(), \"-j\".to_string()]),\n            )\n            .times(1)\n            .returning(|_, _| {\n                Ok(mock_success_output(\n                    r#\"[\n                {\n                    \"class\": \"org.mozilla.firefox\",\n                    \"title\": \"Mozilla Firefox\",\n                    \"address\": \"0x12345678\"\n                }\n            ]\"#,\n                ))\n            });\n\n        let backend = HyprlandBackend;\n        let windows = backend.list_windows(\u0026mock).unwrap();\n\n        assert_eq!(windows.len(), 1);\n        assert_eq!(windows[0].title, \"Mozilla Firefox\");\n        assert_eq!(windows[0].class, \"org.mozilla.firefox\");\n        assert_eq!(windows[0].address, \"0x12345678\");\n    }\n\n    #[test]\n    fn test_wlrctl_backend_list_windows() {\n        let mut mock = MockCommandExecutor::new();\n        mock.expect_execute()\n            .with(\n                mockall::predicate::eq(\"wlrctl\"),\n                mockall::predicate::eq(vec![\"toplevel\".to_string(), \"list\".to_string()]),\n            )\n            .times(1)\n            .returning(|_, _| Ok(mock_success_output(\"org.wezfurlong.wezterm: WezTerm\\n\")));\n\n        let backend = WlrctlBackend;\n        let windows = backend.list_windows(\u0026mock).unwrap();\n\n        assert_eq!(windows.len(), 1);\n        assert_eq!(windows[0].title, \"WezTerm\");\n        assert_eq!(windows[0].class, \"org.wezfurlong.wezterm\");\n    }\n\n    #[test]\n    fn test_wmctrl_backend_list_windows() {\n        let mut mock = MockCommandExecutor::new();\n        mock.expect_execute()\n            .with(\n                mockall::predicate::eq(\"wmctrl\"),\n                mockall::predicate::eq(vec![\"-l\".to_string(), \"-x\".to_string()]),\n            )\n            .times(1)\n            .returning(|_, _| {\n                Ok(mock_success_output(\n                    \"0x02800003  0 pycharm.PyCharm  ubuntu PyCharm Projects\\n\",\n                ))\n            });\n\n        let backend = WmctrlBackend;\n        let windows = backend.list_windows(\u0026mock).unwrap();\n\n        assert_eq!(windows.len(), 1);\n        assert_eq!(windows[0].title, \"PyCharm Projects\");\n        assert_eq!(windows[0].class, \"PyCharm\");\n    }\n}\n","traces":[{"line":15,"address":[43772656,43772948],"length":1,"stats":{"Line":0}},{"line":16,"address":[43387656],"length":1,"stats":{"Line":0}},{"line":17,"address":[43772784],"length":1,"stats":{"Line":0}},{"line":19,"address":[43772912],"length":1,"stats":{"Line":0}},{"line":33,"address":[43771248,43772626,43772607],"length":1,"stats":{"Line":1}},{"line":34,"address":[43772639,43771299],"length":1,"stats":{"Line":1}},{"line":36,"address":[43771951,43772007],"length":1,"stats":{"Line":2}},{"line":37,"address":[43772013,43772074],"length":1,"stats":{"Line":0}},{"line":40,"address":[43772044,43772150,43772254,43772196],"length":1,"stats":{"Line":3}},{"line":41,"address":[45392480,45392506],"length":1,"stats":{"Line":1}},{"line":43,"address":[43772510,43772351],"length":1,"stats":{"Line":2}},{"line":44,"address":[43772391],"length":1,"stats":{"Line":1}},{"line":45,"address":[43387425],"length":1,"stats":{"Line":2}},{"line":46,"address":[45392812,45392729],"length":1,"stats":{"Line":2}},{"line":47,"address":[45392905,45392985],"length":1,"stats":{"Line":2}},{"line":48,"address":[45393158,45393078],"length":1,"stats":{"Line":2}},{"line":49,"address":[45393368],"length":1,"stats":{"Line":1}},{"line":50,"address":[45393254],"length":1,"stats":{"Line":1}},{"line":51,"address":[45393302],"length":1,"stats":{"Line":1}},{"line":53,"address":[45393350],"length":1,"stats":{"Line":1}},{"line":56,"address":[43772498],"length":1,"stats":{"Line":1}},{"line":59,"address":[43771230,43770112,43771224],"length":1,"stats":{"Line":0}},{"line":60,"address":[43770894,43770737],"length":1,"stats":{"Line":0}},{"line":62,"address":[43770828,43770376,43770517,43770188,43770240,43770303,43771243],"length":1,"stats":{"Line":0}},{"line":63,"address":[43770206],"length":1,"stats":{"Line":0}},{"line":64,"address":[43770272],"length":1,"stats":{"Line":0}},{"line":65,"address":[43770349,43770417],"length":1,"stats":{"Line":0}},{"line":69,"address":[43771103,43771047,43771158],"length":1,"stats":{"Line":0}},{"line":70,"address":[43771145],"length":1,"stats":{"Line":0}},{"line":72,"address":[43771165,43771109],"length":1,"stats":{"Line":0}},{"line":78,"address":[43379344,43381576,43381548],"length":1,"stats":{"Line":1}},{"line":79,"address":[43766699,43764566],"length":1,"stats":{"Line":1}},{"line":82,"address":[43765292,43765233],"length":1,"stats":{"Line":2}},{"line":83,"address":[43765298,43765366],"length":1,"stats":{"Line":0}},{"line":86,"address":[43380199,43380319],"length":1,"stats":{"Line":2}},{"line":87,"address":[43765476],"length":1,"stats":{"Line":1}},{"line":89,"address":[43765611,43765527],"length":1,"stats":{"Line":2}},{"line":90,"address":[43765936,43765804],"length":1,"stats":{"Line":2}},{"line":91,"address":[43766016,43766653,43765943],"length":1,"stats":{"Line":3}},{"line":92,"address":[43766084,43766022],"length":1,"stats":{"Line":2}},{"line":93,"address":[43381113,43381031],"length":1,"stats":{"Line":2}},{"line":94,"address":[43381361],"length":1,"stats":{"Line":1}},{"line":95,"address":[43381164],"length":1,"stats":{"Line":1}},{"line":96,"address":[43381235],"length":1,"stats":{"Line":1}},{"line":97,"address":[43766417],"length":1,"stats":{"Line":1}},{"line":98,"address":[43381353],"length":1,"stats":{"Line":1}},{"line":102,"address":[43765819],"length":1,"stats":{"Line":1}},{"line":105,"address":[43379318,43379324,43378288],"length":1,"stats":{"Line":0}},{"line":106,"address":[43764119,43763962],"length":1,"stats":{"Line":0}},{"line":108,"address":[43764468,43763516,43764053],"length":1,"stats":{"Line":0}},{"line":111,"address":[43764272,43764383,43764328],"length":1,"stats":{"Line":0}},{"line":112,"address":[43764370],"length":1,"stats":{"Line":0}},{"line":114,"address":[43764390,43764334],"length":1,"stats":{"Line":0}},{"line":120,"address":[43385025,43382640,43384997],"length":1,"stats":{"Line":1}},{"line":121,"address":[43770109,43767807],"length":1,"stats":{"Line":1}},{"line":123,"address":[43768504,43768599],"length":1,"stats":{"Line":2}},{"line":124,"address":[43383520],"length":1,"stats":{"Line":1}},{"line":126,"address":[43768674,43768770],"length":1,"stats":{"Line":2}},{"line":127,"address":[43769101,43768958],"length":1,"stats":{"Line":2}},{"line":128,"address":[43769108,43769181,43770041],"length":1,"stats":{"Line":3}},{"line":129,"address":[43769209],"length":1,"stats":{"Line":1}},{"line":130,"address":[43384197,43384279],"length":1,"stats":{"Line":2}},{"line":131,"address":[43384305,43384400],"length":1,"stats":{"Line":2}},{"line":132,"address":[43384448],"length":1,"stats":{"Line":1}},{"line":135,"address":[43769672],"length":1,"stats":{"Line":1}},{"line":138,"address":[43769855],"length":1,"stats":{"Line":1}},{"line":139,"address":[43769757],"length":1,"stats":{"Line":1}},{"line":141,"address":[43384722],"length":1,"stats":{"Line":1}},{"line":142,"address":[43769847],"length":1,"stats":{"Line":1}},{"line":146,"address":[43768973],"length":1,"stats":{"Line":1}},{"line":149,"address":[43766704,43767724,43767718],"length":1,"stats":{"Line":0}},{"line":150,"address":[43382137,43382295],"length":1,"stats":{"Line":0}},{"line":152,"address":[43767737,43766791,43767328],"length":1,"stats":{"Line":0}},{"line":155,"address":[43767652,43767541,43767597],"length":1,"stats":{"Line":0}},{"line":156,"address":[43767639],"length":1,"stats":{"Line":0}},{"line":158,"address":[43767603,43767659],"length":1,"stats":{"Line":0}},{"line":168,"address":[43774288],"length":1,"stats":{"Line":0}},{"line":172,"address":[43774260,43773920,43774266],"length":1,"stats":{"Line":0}},{"line":173,"address":[43773932,43774094],"length":1,"stats":{"Line":0}},{"line":174,"address":[43388137],"length":1,"stats":{"Line":0}},{"line":176,"address":[43774129,43774209,43774045],"length":1,"stats":{"Line":0}},{"line":177,"address":[43774220],"length":1,"stats":{"Line":0}},{"line":179,"address":[43774185],"length":1,"stats":{"Line":0}},{"line":184,"address":[43763232,43763402,43763408],"length":1,"stats":{"Line":0}},{"line":185,"address":[43763374,43763264],"length":1,"stats":{"Line":0}},{"line":188,"address":[43763207,43763201,43762992],"length":1,"stats":{"Line":0}},{"line":189,"address":[43763047,43763170],"length":1,"stats":{"Line":0}}],"covered":49,"coverable":87},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","adapters","mod.rs"],"content":"pub mod cached_icon_resolver;\npub mod file_history;\npub mod fs_app_repository;\npub mod fs_config_service;\npub mod google_translation_service;\npub mod http_ai_service;\npub mod linux_window_service;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","ai.rs"],"content":"use crate::domain::ai::Message;\nuse crate::state::AppState;\nuse futures_util::StreamExt;\nuse tauri::{Emitter, State};\n\n#[tauri::command]\npub async fn ask_ai(\n    window: tauri::Window,\n    state: State\u003c'_, AppState\u003e,\n    messages: Vec\u003cMessage\u003e,\n) -\u003e Result\u003c(), String\u003e {\n    let config = state.config_service.load_config();\n\n    window\n        .emit(\"ai-response-start\", ())\n        .map_err(|e| e.to_string())?;\n\n    match state.ai_service.stream_completion(\u0026config, messages).await {\n        Ok(mut stream) =\u003e {\n            while let Some(chunk_result) = stream.next().await {\n                match chunk_result {\n                    Ok(content) =\u003e {\n                        window\n                            .emit(\"ai-response-chunk\", content)\n                            .map_err(|e| e.to_string())?;\n                    }\n                    Err(e) =\u003e {\n                        window\n                            .emit(\"ai-response-error\", e.clone())\n                            .map_err(|e1| e1.to_string())?;\n                        return Err(e);\n                    }\n                }\n            }\n        }\n        Err(e) =\u003e {\n            window\n                .emit(\"ai-response-error\", e.clone())\n                .map_err(|e1| e1.to_string())?;\n            return Err(e);\n        }\n    }\n\n    window\n        .emit(\"ai-response-done\", ())\n        .map_err(|e| e.to_string())?;\n    Ok(())\n}\n\n#[tauri::command]\npub async fn check_ai_connection(state: State\u003c'_, AppState\u003e) -\u003e Result\u003cString, String\u003e {\n    let config = state.config_service.load_config();\n    state.ai_service.check_connection(\u0026config).await\n}\n\n#[tauri::command]\npub async fn list_ollama_models(state: State\u003c'_, AppState\u003e) -\u003e Result\u003cVec\u003cString\u003e, String\u003e {\n    let config = state.config_service.load_config();\n    match state.ai_service.list_models(\u0026config).await {\n        Ok(models) =\u003e Ok(models),\n        Err(_) =\u003e Ok(vec![]), // Graceful fallback\n    }\n}\n","traces":[{"line":7,"address":[44365392],"length":1,"stats":{"Line":0}},{"line":12,"address":[45879499,45879364],"length":1,"stats":{"Line":0}},{"line":14,"address":[45879665,45879761,45880030,45879561],"length":1,"stats":{"Line":0}},{"line":15,"address":[45879568],"length":1,"stats":{"Line":0}},{"line":16,"address":[45882992,45879729,45883008,45879658],"length":1,"stats":{"Line":0}},{"line":18,"address":[43613647],"length":1,"stats":{"Line":0}},{"line":19,"address":[45880467],"length":1,"stats":{"Line":0}},{"line":20,"address":[45880503,45880961,45881032,45881656,45879430],"length":1,"stats":{"Line":0}},{"line":21,"address":[45881291],"length":1,"stats":{"Line":0}},{"line":22,"address":[45881429],"length":1,"stats":{"Line":0}},{"line":23,"address":[45881622,45881461,45881526,45881703],"length":1,"stats":{"Line":0}},{"line":24,"address":[45881468],"length":1,"stats":{"Line":0}},{"line":25,"address":[45881590,45881519,45882704,45882720],"length":1,"stats":{"Line":0}},{"line":27,"address":[45881340],"length":1,"stats":{"Line":0}},{"line":28,"address":[44983140,44983621,44983867,44983717],"length":1,"stats":{"Line":0}},{"line":29,"address":[45881391,45881779],"length":1,"stats":{"Line":0}},{"line":30,"address":[45882912,45882896,45881830,45881901],"length":1,"stats":{"Line":0}},{"line":31,"address":[45881967],"length":1,"stats":{"Line":0}},{"line":36,"address":[45880383],"length":1,"stats":{"Line":0}},{"line":37,"address":[45880421,45880878,45880632,45880728],"length":1,"stats":{"Line":0}},{"line":38,"address":[45880574,45880432],"length":1,"stats":{"Line":0}},{"line":39,"address":[45883104,45883088,45880625,45880696],"length":1,"stats":{"Line":0}},{"line":40,"address":[45880762],"length":1,"stats":{"Line":0}},{"line":44,"address":[44984105,44983944,44984009,44984343],"length":1,"stats":{"Line":0}},{"line":45,"address":[45882167],"length":1,"stats":{"Line":0}},{"line":46,"address":[45882281,45882800,45882816,45882210],"length":1,"stats":{"Line":0}},{"line":47,"address":[45882368],"length":1,"stats":{"Line":0}},{"line":51,"address":[40435744,40435752],"length":1,"stats":{"Line":0}},{"line":52,"address":[44980130,44980025],"length":1,"stats":{"Line":0}},{"line":53,"address":[45878547,45878718,45878432,45878824,45878609],"length":1,"stats":{"Line":0}},{"line":57,"address":[44365328,44365336],"length":1,"stats":{"Line":0}},{"line":58,"address":[45877177,45877278],"length":1,"stats":{"Line":0}},{"line":59,"address":[43623079],"length":1,"stats":{"Line":0}},{"line":60,"address":[45877896],"length":1,"stats":{"Line":0}},{"line":61,"address":[45878061,45877874],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":35},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","apps.rs"],"content":"use crate::domain::apps::AppEntry;\nuse crate::ports::app_port::AppRepository;\nuse crate::state::AppState;\nuse std::os::unix::process::CommandExt;\nuse tauri::State;\n\n// Handler logic for testing\npub fn list_apps_logic(repo: \u0026dyn AppRepository) -\u003e Result\u003cVec\u003cAppEntry\u003e, String\u003e {\n    repo.list_apps()\n}\n\n#[tauri::command]\npub async fn list_apps(state: State\u003c'_, AppState\u003e) -\u003e Result\u003cVec\u003cAppEntry\u003e, String\u003e {\n    list_apps_logic(\u0026*state.app_repository)\n}\n\n// Helper to clean exec command - exposed for testing\npub fn parse_exec_command(exec_cmd: \u0026str) -\u003e Option\u003c(String, Vec\u003cString\u003e)\u003e {\n    let cleaned = exec_cmd\n        .replace(\"%f\", \"\")\n        .replace(\"%F\", \"\")\n        .replace(\"%u\", \"\")\n        .replace(\"%U\", \"\")\n        .replace(\"%i\", \"\")\n        .replace(\"%c\", \"\")\n        .replace(\"%k\", \"\");\n\n    let parts = shell_words::split(\u0026cleaned).ok()?;\n    if parts.is_empty() {\n        return None;\n    }\n\n    let cmd = parts[0].clone();\n    let args = parts[1..].to_vec();\n    Some((cmd, args))\n}\n\n#[tauri::command]\npub async fn launch_app(exec_cmd: String) -\u003e Result\u003c(), String\u003e {\n    let (cmd, args) = parse_exec_command(\u0026exec_cmd).ok_or_else(|| \"Empty command\".to_string())?;\n\n    std::process::Command::new(cmd)\n        .args(args)\n        .stdin(std::process::Stdio::null())\n        .stdout(std::process::Stdio::null())\n        .stderr(std::process::Stdio::null())\n        .process_group(0) // Sets the process group ID to the child's PID effectively creating a new session\n        .spawn()\n        .map_err(|e| e.to_string())?;\n\n    Ok(())\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::ports::app_port::MockAppRepository;\n\n    #[test]\n    fn test_list_apps() {\n        let mut mock = MockAppRepository::new();\n        mock.expect_list_apps().times(1).returning(|| {\n            Ok(vec![AppEntry {\n                name: \"Test App\".to_string(),\n                exec: \"test\".to_string(),\n                icon: None,\n            }])\n        });\n\n        let result = list_apps_logic(\u0026mock);\n        assert!(result.is_ok());\n        let apps = result.unwrap();\n        assert_eq!(apps.len(), 1);\n        assert_eq!(apps[0].name, \"Test App\");\n    }\n\n    #[test]\n    fn test_parse_exec_command() {\n        // Simple command\n        assert_eq!(\n            parse_exec_command(\"firefox\"),\n            Some((\"firefox\".to_string(), vec![]))\n        );\n\n        // Command with args\n        assert_eq!(\n            parse_exec_command(\"echo hello world\"),\n            Some((\n                \"echo\".to_string(),\n                vec![\"hello\".to_string(), \"world\".to_string()]\n            ))\n        );\n\n        // Command with % codes that should be removed\n        assert_eq!(\n            parse_exec_command(\"vlc %U\"),\n            Some((\"vlc\".to_string(), vec![]))\n        );\n\n        // Complex quoted args\n        assert_eq!(\n            parse_exec_command(\"grep \\\"hello world\\\" file.txt\"),\n            Some((\n                \"grep\".to_string(),\n                vec![\"hello world\".to_string(), \"file.txt\".to_string()]\n            ))\n        );\n\n        // Empty/Invalid\n        assert_eq!(parse_exec_command(\"\"), None);\n    }\n}\n","traces":[{"line":8,"address":[41105792],"length":1,"stats":{"Line":1}},{"line":9,"address":[44059797],"length":1,"stats":{"Line":1}},{"line":13,"address":[44061808,44061816],"length":1,"stats":{"Line":0}},{"line":14,"address":[44650735,44650812],"length":1,"stats":{"Line":0}},{"line":18,"address":[44059824,44061762,44061786],"length":1,"stats":{"Line":1}},{"line":19,"address":[44060064,44060457,44060203,44059925,44060330,44060584],"length":1,"stats":{"Line":6}},{"line":28,"address":[44061074,44061784],"length":1,"stats":{"Line":1}},{"line":29,"address":[44061356,44061285],"length":1,"stats":{"Line":2}},{"line":30,"address":[44061415],"length":1,"stats":{"Line":1}},{"line":33,"address":[44061445,44061362],"length":1,"stats":{"Line":2}},{"line":34,"address":[44061464,44061555],"length":1,"stats":{"Line":2}},{"line":35,"address":[41107614],"length":1,"stats":{"Line":1}},{"line":39,"address":[41105760,41105763],"length":1,"stats":{"Line":0}},{"line":40,"address":[44650496,44650508,44649169,44650456,44649267],"length":1,"stats":{"Line":0}},{"line":42,"address":[41101198,41101622,41101696],"length":1,"stats":{"Line":0}},{"line":43,"address":[41101306],"length":1,"stats":{"Line":0}},{"line":44,"address":[44649767],"length":1,"stats":{"Line":0}},{"line":45,"address":[44649811],"length":1,"stats":{"Line":0}},{"line":46,"address":[44649855],"length":1,"stats":{"Line":0}},{"line":49,"address":[44650134,44649726,44650544,44650560,44650328,44649956,44650001],"length":1,"stats":{"Line":0}},{"line":51,"address":[44650182],"length":1,"stats":{"Line":0}}],"covered":10,"coverable":21},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","config.rs"],"content":"use crate::domain::config::AppConfig;\nuse crate::ports::config_port::ConfigService;\nuse crate::state::AppState;\nuse tauri::State;\n\n// Handler logic separated from Tauri state injection for easier testing\npub fn get_config_logic(service: \u0026dyn ConfigService) -\u003e Result\u003cAppConfig, String\u003e {\n    Ok(service.load_config())\n}\n\npub fn save_config_logic(service: \u0026dyn ConfigService, config: \u0026AppConfig) -\u003e Result\u003c(), String\u003e {\n    service.save_config(config)\n}\n\n#[tauri::command]\npub async fn get_config(state: State\u003c'_, AppState\u003e) -\u003e Result\u003cAppConfig, String\u003e {\n    get_config_logic(\u0026*state.config_service)\n}\n\n#[tauri::command]\npub async fn save_config(state: State\u003c'_, AppState\u003e, config: AppConfig) -\u003e Result\u003c(), String\u003e {\n    save_config_logic(\u0026*state.config_service, \u0026config)\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::ports::config_port::MockConfigService;\n\n    #[test]\n    fn test_get_config() {\n        let mut mock = MockConfigService::new();\n        let expected_config = AppConfig::default();\n        let ret_config = expected_config.clone();\n\n        mock.expect_load_config()\n            .times(1)\n            .returning(move || ret_config.clone());\n\n        let result = get_config_logic(\u0026mock);\n        assert!(result.is_ok());\n        // Simple check, exact equality might require partialeq on AppConfig but it derives it\n    }\n\n    #[test]\n    fn test_save_config() {\n        let mut mock = MockConfigService::new();\n        mock.expect_save_config().times(1).returning(|_| Ok(()));\n\n        let config = AppConfig::default();\n        let result = save_config_logic(\u0026mock, \u0026config);\n        assert!(result.is_ok());\n    }\n}\n","traces":[{"line":7,"address":[46063952],"length":1,"stats":{"Line":1}},{"line":8,"address":[46063984],"length":1,"stats":{"Line":1}},{"line":11,"address":[46064032],"length":1,"stats":{"Line":1}},{"line":12,"address":[46064070],"length":1,"stats":{"Line":1}},{"line":16,"address":[44365542,44365504,44365601,44365628,44365755],"length":1,"stats":{"Line":0}},{"line":17,"address":[44365589,44365672],"length":1,"stats":{"Line":0}},{"line":21,"address":[44366044,44366151,44365792,44365830,44365915],"length":1,"stats":{"Line":0}},{"line":22,"address":[44365976,44365903],"length":1,"stats":{"Line":0}}],"covered":4,"coverable":8},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","history.rs"],"content":"use crate::domain::action::Action;\nuse crate::state::AppState;\nuse tauri::State;\n\n#[tauri::command]\npub async fn get_recent_actions(\n    state: State\u003c'_, AppState\u003e,\n    limit: usize,\n) -\u003e Result\u003cVec\u003cAction\u003e, String\u003e {\n    state.history_repository.get_recent(limit).await\n}\n\n#[tauri::command]\npub async fn record_action(state: State\u003c'_, AppState\u003e, action: Action) -\u003e Result\u003c(), String\u003e {\n    state.history_repository.record(action).await\n}\n\n#[tauri::command]\npub async fn clear_history(state: State\u003c'_, AppState\u003e) -\u003e Result\u003c(), String\u003e {\n    state.history_repository.clear().await\n}\n","traces":[{"line":6,"address":[43741600],"length":1,"stats":{"Line":0}},{"line":10,"address":[41813300,41813145,41813047,41813086],"length":1,"stats":{"Line":0}},{"line":14,"address":[41812211,41812890,41812329,41812176,41812593,41812908],"length":1,"stats":{"Line":0}},{"line":15,"address":[41812317,41812356,41812624,41812416],"length":1,"stats":{"Line":0}},{"line":19,"address":[41811635,41811903,41811698,41811600,41812169,41811740],"length":1,"stats":{"Line":0}},{"line":20,"address":[41811784,41811686,41811725,41811934],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":6},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","mod.rs"],"content":"pub mod ai;\npub mod apps;\npub mod config;\npub mod history;\npub mod scripts;\npub mod system;\npub mod translation;\npub mod windows;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","scripts.rs"],"content":"use crate::domain::config::ScriptConfig;\nuse crate::state::AppState;\nuse tauri::{Emitter, State};\nuse tokio::io::{AsyncBufReadExt, BufReader};\nuse tokio::process::Command;\n\n#[tauri::command]\npub async fn list_scripts(state: State\u003c'_, AppState\u003e) -\u003e Result\u003cVec\u003cScriptConfig\u003e, String\u003e {\n    let config = state.config_service.load_config();\n    Ok(config.scripts)\n}\n\n#[tauri::command]\npub async fn execute_script(\n    window: tauri::Window,\n    path: String,\n    args: Option\u003cString\u003e,\n) -\u003e Result\u003c(), String\u003e {\n    let path = path.trim();\n    let mut cmd;\n\n    if path.ends_with(\".sh\") {\n        cmd = Command::new(\"sh\");\n        cmd.arg(path);\n    } else {\n        cmd = Command::new(path);\n    }\n\n    if let Some(args_str) = args {\n        let parts = shell_words::split(\u0026args_str).map_err(|e| e.to_string())?;\n        cmd.args(parts);\n    }\n\n    cmd.stdout(std::process::Stdio::piped());\n    cmd.stderr(std::process::Stdio::piped());\n\n    let mut child = cmd\n        .spawn()\n        .map_err(|e| format!(\"Failed to spawn script: {}\", e))?;\n\n    let stdout = child.stdout.take().ok_or(\"Failed to open stdout\")?;\n    let stderr = child.stderr.take().ok_or(\"Failed to open stderr\")?;\n\n    let mut stdout_reader = BufReader::new(stdout).lines();\n    let mut stderr_reader = BufReader::new(stderr).lines();\n\n    window.emit(\"script-start\", ()).map_err(|e| e.to_string())?;\n\n    // Spawn tasks to handle stdout and stderr concurrently\n    let window_clone1 = window.clone();\n    tokio::spawn(async move {\n        while let Ok(Some(line)) = stdout_reader.next_line().await {\n            let _ = window_clone1.emit(\"script-output\", format!(\"\u003e {}\\n\", line));\n        }\n    });\n\n    let window_clone2 = window.clone();\n    tokio::spawn(async move {\n        while let Ok(Some(line)) = stderr_reader.next_line().await {\n            let _ = window_clone2.emit(\"script-output\", format!(\"ERR\u003e {}\\n\", line));\n        }\n    });\n\n    // Wait for the child process to finish\n    let output = child.wait().await.map_err(|e| e.to_string())?;\n\n    let status_msg = if output.success() {\n        format!(\"\u003e Success! (Exit code 0)\\n\")\n    } else {\n        format!(\"\u003e Failed! (Exit code {})\\n\", output.code().unwrap_or(-1))\n    };\n\n    window\n        .emit(\"script-output\", status_msg)\n        .map_err(|e| e.to_string())?;\n\n    window.emit(\"script-done\", ()).map_err(|e| e.to_string())?;\n\n    Ok(())\n}\n","traces":[{"line":8,"address":[39282688,39282696],"length":1,"stats":{"Line":0}},{"line":9,"address":[41406469,41406552],"length":1,"stats":{"Line":0}},{"line":10,"address":[41406596],"length":1,"stats":{"Line":0}},{"line":14,"address":[42133936],"length":1,"stats":{"Line":0}},{"line":19,"address":[41407557,41407402],"length":1,"stats":{"Line":0}},{"line":22,"address":[41407634,41407719],"length":1,"stats":{"Line":0}},{"line":23,"address":[41407756,41407880],"length":1,"stats":{"Line":0}},{"line":24,"address":[41407948],"length":1,"stats":{"Line":0}},{"line":26,"address":[41407791,41407749],"length":1,"stats":{"Line":0}},{"line":29,"address":[41407831,41407968],"length":1,"stats":{"Line":0}},{"line":30,"address":[41408013,41412716,41408147,41412704],"length":1,"stats":{"Line":0}},{"line":31,"address":[41408375],"length":1,"stats":{"Line":0}},{"line":34,"address":[41408607,41408044],"length":1,"stats":{"Line":0}},{"line":35,"address":[41408622],"length":1,"stats":{"Line":0}},{"line":37,"address":[41408676,41408804,41410698,41408737],"length":1,"stats":{"Line":0}},{"line":39,"address":[41413952,41408772,41408714,41413978],"length":1,"stats":{"Line":0}},{"line":41,"address":[41409010,41410660,41408926],"length":1,"stats":{"Line":0}},{"line":42,"address":[41409313,41410628,41409232],"length":1,"stats":{"Line":0}},{"line":44,"address":[41270079,41270200],"length":1,"stats":{"Line":0}},{"line":45,"address":[41409823,41409690],"length":1,"stats":{"Line":0}},{"line":47,"address":[41412608,41412624,41409845,41409943,41410600],"length":1,"stats":{"Line":0}},{"line":50,"address":[41410091],"length":1,"stats":{"Line":0}},{"line":51,"address":[41410121,41412736,41412846,41413725,41412761,41412798,41413845],"length":1,"stats":{"Line":0}},{"line":52,"address":[43424077],"length":1,"stats":{"Line":0}},{"line":53,"address":[41275713,41275624],"length":1,"stats":{"Line":0}},{"line":57,"address":[41410268],"length":1,"stats":{"Line":0}},{"line":58,"address":[41274305,41274437,41273342,41270878,41273394,41273305,41273280],"length":1,"stats":{"Line":0}},{"line":59,"address":[43424413],"length":1,"stats":{"Line":0}},{"line":60,"address":[41414704,41414793],"length":1,"stats":{"Line":0}},{"line":65,"address":[41274736,41271321,41267935,41272850,41274752,41271029],"length":1,"stats":{"Line":0}},{"line":67,"address":[41411114],"length":1,"stats":{"Line":0}},{"line":68,"address":[41272057,41271750],"length":1,"stats":{"Line":0}},{"line":70,"address":[41271735,41271787],"length":1,"stats":{"Line":0}},{"line":73,"address":[41411619,41411523,41411371,41412237],"length":1,"stats":{"Line":0}},{"line":74,"address":[41411378],"length":1,"stats":{"Line":0}},{"line":75,"address":[41415392,41415376,41411516,41411587],"length":1,"stats":{"Line":0}},{"line":77,"address":[41412232,41415584,41415600,41411664],"length":1,"stats":{"Line":0}},{"line":79,"address":[41411872],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":38},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","system.rs"],"content":"use walkdir::WalkDir;\n\n#[tauri::command]\npub fn greet(name: \u0026str) -\u003e String {\n    format!(\"Hello, {}! You've been greeted from Rust!\", name)\n}\n\n#[tauri::command]\npub async fn open_entity(path: String) -\u003e Result\u003c(), String\u003e {\n    std::thread::spawn(move || {\n        let _ = open::that(path);\n    });\n    Ok(())\n}\n\n#[derive(serde::Serialize)]\npub struct FileMetadata {\n    size: u64,\n    created: Option\u003cu64\u003e,\n    is_dir: bool,\n    readonly: bool,\n    mime_type: Option\u003cString\u003e,\n}\n\nfn calculate_file_score(name: \u0026str, ext: Option\u003c\u0026str\u003e, query: \u0026str) -\u003e i32 {\n    let mut score = 0;\n    let lower_name = name.to_lowercase();\n    let lower_query = query.to_lowercase();\n\n    // Name match bonuses\n    if lower_name == lower_query {\n        score += 100;\n    } else if lower_name.starts_with(\u0026lower_query) {\n        score += 50;\n    }\n\n    // Extension prioritization\n    if let Some(e) = ext {\n        let e_lower = e.to_lowercase();\n        match e_lower.as_str() {\n            // Images (Highest priority)\n            \"png\" | \"jpg\" | \"jpeg\" | \"webp\" | \"gif\" | \"svg\" | \"bmp\" | \"tiff\" =\u003e score += 40,\n\n            // Videos (Second priority)\n            \"mp4\" | \"mkv\" | \"avi\" | \"mov\" | \"webm\" | \"flv\" | \"wmv\" =\u003e score += 30,\n\n            // Common documents/code (Third priority)\n            \"rs\" | \"js\" | \"ts\" | \"vue\" | \"py\" | \"html\" | \"css\" | \"json\" | \"md\" | \"txt\" | \"pdf\"\n            | \"csv\" | \"docx\" | \"xlsx\" =\u003e score += 20,\n\n            _ =\u003e {}\n        }\n    }\n\n    score\n}\n\n#[tauri::command]\npub async fn search_files(\n    query: String,\n    path: String,\n    include_hidden: bool,\n) -\u003e Result\u003cVec\u003cString\u003e, String\u003e {\n    let lower_query = query.to_lowercase();\n\n    let walker = WalkDir::new(\u0026path).max_depth(10).into_iter();\n\n    // Collect matches\n    let mut matches = Vec::new();\n\n    // Use filter_entry to skip hidden directories efficiently if needed\n    let it = walker.filter_entry(move |e| {\n        if include_hidden {\n            return true;\n        }\n        !is_hidden(e)\n    });\n\n    for entry in it.filter_map(|e| e.ok()) {\n        let path = entry.path();\n        let path_str = path.to_string_lossy();\n\n        if path_str.to_lowercase().contains(\u0026lower_query) {\n            let name = path.file_name().and_then(|n| n.to_str()).unwrap_or(\"\");\n            let ext = path.extension().and_then(|e| e.to_str());\n\n            let score = calculate_file_score(name, ext, \u0026query);\n\n            matches.push((path_str.to_string(), score));\n            if matches.len() \u003e 500 {\n                // Increased limit slightly to allow better sorting\n                break;\n            }\n        }\n    }\n\n    // Sort by score descending\n    matches.sort_by(|a, b| b.1.cmp(\u0026a.1));\n\n    // Take top 50\n    let results: Vec\u003cString\u003e = matches.into_iter().take(50).map(|(p, _)| p).collect();\n\n    Ok(results)\n}\n\nfn is_hidden(entry: \u0026walkdir::DirEntry) -\u003e bool {\n    entry\n        .file_name()\n        .to_str()\n        .map(|s| s.starts_with('.') \u0026\u0026 s != \".\" \u0026\u0026 s != \"..\")\n        .unwrap_or(false)\n}\n\n#[tauri::command]\npub async fn read_file_preview(path: String, max_bytes: Option\u003cusize\u003e) -\u003e Result\u003cString, String\u003e {\n    use std::io::Read;\n    let limit = max_bytes.unwrap_or(2048);\n    let mut file = std::fs::File::open(\u0026path).map_err(|e| e.to_string())?;\n\n    let mut buffer = vec![0; limit];\n    let n = file.read(\u0026mut buffer).map_err(|e| e.to_string())?;\n    buffer.truncate(n);\n\n    // Check for null bytes to detect binary\n    if buffer.contains(\u00260) {\n        return Err(\"Binary file detected\".to_string());\n    }\n\n    String::from_utf8(buffer).map_err(|e| format!(\"Not valid UTF-8: {}\", e))\n}\n\n#[tauri::command]\npub async fn get_file_metadata(path: String) -\u003e Result\u003cFileMetadata, String\u003e {\n    let metadata = std::fs::metadata(\u0026path).map_err(|e| e.to_string())?;\n\n    let created = metadata\n        .created()\n        .ok()\n        .and_then(|t| t.duration_since(std::time::UNIX_EPOCH).ok())\n        .map(|d| d.as_secs());\n\n    Ok(FileMetadata {\n        size: metadata.len(),\n        created,\n        is_dir: metadata.is_dir(),\n        readonly: metadata.permissions().readonly(),\n        mime_type: None, // Could use `mime_guess` crate if added, but frontend handles mostly\n    })\n}\n\n#[tauri::command]\npub async fn get_selection_context() -\u003e Result\u003cString, String\u003e {\n    use arboard::Clipboard;\n\n    if let Ok(mut clipboard) = Clipboard::new() {\n        if let Ok(text) = clipboard.get_text() {\n            if !text.trim().is_empty() {\n                return Ok(text);\n            }\n        }\n    }\n\n    Err(\"No text found in selection or clipboard\".to_string())\n}\n\n#[tauri::command]\npub async fn copy_to_clipboard(text: String) -\u003e Result\u003c(), String\u003e {\n    use arboard::Clipboard;\n\n    let mut clipboard = Clipboard::new().map_err(|e| e.to_string())?;\n    clipboard.set_text(text).map_err(|e| e.to_string())?;\n\n    Ok(())\n}\n\n#[tauri::command]\npub async fn check_is_executable(path: String) -\u003e Result\u003cbool, String\u003e {\n    let p = std::path::Path::new(\u0026path);\n    if !p.exists() {\n        return Ok(false);\n    }\n    #[cfg(unix)]\n    {\n        use std::os::unix::fs::PermissionsExt;\n        let metadata = p.metadata().map_err(|e| e.to_string())?;\n        return Ok(metadata.permissions().mode() \u0026 0o111 != 0);\n    }\n    #[cfg(not(unix))]\n    {\n        Ok(true) // Assume executable on non-unix for now or just return true\n    }\n}\n\n#[tauri::command]\npub async fn make_file_executable(path: String) -\u003e Result\u003c(), String\u003e {\n    let p = std::path::Path::new(\u0026path);\n    if !p.exists() {\n        return Err(\"File not found\".to_string());\n    }\n    #[cfg(unix)]\n    {\n        use std::os::unix::fs::PermissionsExt;\n        let metadata = p.metadata().map_err(|e| e.to_string())?;\n        let mut perms = metadata.permissions();\n        perms.set_mode(perms.mode() | 0o111);\n        std::fs::set_permissions(p, perms).map_err(|e| e.to_string())?;\n    }\n    Ok(())\n}\n\n#[tauri::command]\npub async fn generate_video_thumbnail(\n    app_handle: tauri::AppHandle,\n    path: String,\n) -\u003e Result\u003cString, String\u003e {\n    use std::process::Command;\n    use tauri::Manager;\n\n    let cache_dir = app_handle\n        .path()\n        .app_cache_dir()\n        .map_err(|e| e.to_string())?;\n\n    // Create cache dir if it doesn't exist\n    if !cache_dir.exists() {\n        std::fs::create_dir_all(\u0026cache_dir).map_err(|e| e.to_string())?;\n    }\n\n    // Hash path to get unique filename\n    use std::collections::hash_map::DefaultHasher;\n    use std::hash::{Hash, Hasher};\n    let mut hasher = DefaultHasher::new();\n    path.hash(\u0026mut hasher);\n    let filename = format!(\"{}.jpg\", hasher.finish());\n    let thumb_path = cache_dir.join(\u0026filename);\n    let thumb_path_str = thumb_path.to_string_lossy().to_string();\n\n    if thumb_path.exists() {\n        return Ok(thumb_path_str);\n    }\n\n    // Run ffmpeg\n    // ffmpeg -y -i \u003cinput\u003e -ss 00:00:01 -vframes 1 -vf scale=640:-1 \u003coutput\u003e\n    let output = Command::new(\"ffmpeg\")\n        .arg(\"-y\")\n        .arg(\"-i\")\n        .arg(\u0026path)\n        .arg(\"-ss\")\n        .arg(\"00:00:01\")\n        .arg(\"-vframes\")\n        .arg(\"1\")\n        // Scale to reasonable width, keep aspect ratio\n        .arg(\"-vf\")\n        .arg(\"scale=640:-1\")\n        .arg(\u0026thumb_path_str)\n        .output()\n        .map_err(|e| format!(\"Failed to execute ffmpeg: {}\", e))?;\n\n    if !output.status.success() {\n        let stderr = String::from_utf8_lossy(\u0026output.stderr);\n        return Err(format!(\"ffmpeg failed: {}\", stderr));\n    }\n\n    Ok(thumb_path_str)\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use std::io::Write;\n\n    #[tokio::test]\n    async fn test_read_file_preview_text() {\n        let temp_dir = std::env::temp_dir();\n        let file_path = temp_dir.join(\"test_preview.txt\");\n        let mut file = std::fs::File::create(\u0026file_path).unwrap();\n        writeln!(file, \"Hello, World!\").unwrap();\n\n        let content = read_file_preview(file_path.to_string_lossy().to_string(), Some(1024))\n            .await\n            .unwrap();\n        assert!(content.contains(\"Hello, World!\"));\n    }\n\n    #[tokio::test]\n    async fn test_read_file_preview_binary() {\n        let temp_dir = std::env::temp_dir();\n        let file_path = temp_dir.join(\"test_preview.bin\");\n        let mut file = std::fs::File::create(\u0026file_path).unwrap();\n        file.write_all(\u0026[0, 1, 2, 3, 4]).unwrap();\n\n        let result = read_file_preview(file_path.to_string_lossy().to_string(), Some(1024)).await;\n        assert!(result.is_err());\n        assert_eq!(result.err().unwrap(), \"Binary file detected\");\n    }\n\n    #[tokio::test]\n    async fn test_get_file_metadata() {\n        let temp_dir = std::env::temp_dir();\n        let file_path = temp_dir.join(\"test_meta.txt\");\n        let mut file = std::fs::File::create(\u0026file_path).unwrap();\n        writeln!(file, \"Meta test\").unwrap();\n\n        let metadata = get_file_metadata(file_path.to_string_lossy().to_string())\n            .await\n            .unwrap();\n        assert!(metadata.size \u003e 0);\n        assert!(!metadata.is_dir);\n    }\n    #[test]\n    fn test_calculate_file_score() {\n        // Exact match\n        assert_eq!(calculate_file_score(\"test\", None, \"test\"), 100);\n\n        // Starts with\n        assert_eq!(calculate_file_score(\"test_file\", None, \"test\"), 50);\n\n        // Extensions\n        // Image (40)\n        assert_eq!(calculate_file_score(\"pic\", Some(\"png\"), \"pic\"), 140); // 100 + 40\n        assert_eq!(calculate_file_score(\"foo\", Some(\"jpg\"), \"bar\"), 40);\n\n        // Video (30)\n        assert_eq!(calculate_file_score(\"vid\", Some(\"mp4\"), \"bar\"), 30);\n\n        // Common (20)\n        assert_eq!(calculate_file_score(\"doc\", Some(\"txt\"), \"bar\"), 20);\n\n        // Prioritization check\n        let img = calculate_file_score(\"a\", Some(\"png\"), \"query\");\n        let vid = calculate_file_score(\"a\", Some(\"mp4\"), \"query\");\n        let doc = calculate_file_score(\"a\", Some(\"txt\"), \"query\");\n        let other = calculate_file_score(\"a\", Some(\"bin\"), \"query\");\n\n        assert!(img \u003e vid);\n        assert!(vid \u003e doc);\n        assert!(doc \u003e other);\n    }\n\n    #[tokio::test]\n    async fn test_search_files_hidden() {\n        let temp_dir = std::env::temp_dir().join(\"test_search_hidden\");\n        let _ = std::fs::remove_dir_all(\u0026temp_dir); // Cleanup previous\n        std::fs::create_dir_all(\u0026temp_dir).unwrap();\n\n        let visible = temp_dir.join(\"visible.txt\");\n        let hidden = temp_dir.join(\".hidden.txt\");\n        let hidden_dir = temp_dir.join(\".hidden_dir\");\n        let file_in_hidden = hidden_dir.join(\"file.txt\");\n\n        std::fs::File::create(\u0026visible).unwrap();\n        std::fs::File::create(\u0026hidden).unwrap();\n        std::fs::create_dir(\u0026hidden_dir).unwrap();\n        std::fs::File::create(\u0026file_in_hidden).unwrap();\n\n        // Test 1: Exclude hidden (default)\n        // Should find 'visible.txt' but not '.hidden.txt' or 'file.txt' inside hidden dir\n        // searching for \"txt\" or \".\" or \"\"\n        let results = search_files(\n            \"txt\".to_string(),\n            temp_dir.to_string_lossy().to_string(),\n            false,\n        )\n        .await\n        .unwrap();\n\n        // Results are absolute paths\n        let found_visible = results.iter().any(|r| r.contains(\"visible.txt\"));\n        let found_hidden = results.iter().any(|r| r.contains(\".hidden.txt\"));\n        let found_in_hidden = results\n            .iter()\n            .any(|r| r.contains(\"file.txt\") \u0026\u0026 r.contains(\".hidden_dir\"));\n\n        assert!(found_visible, \"Should find visible file\");\n        assert!(\n            !found_hidden,\n            \"Should NOT find hidden file when include_hidden=false\"\n        );\n        assert!(\n            !found_in_hidden,\n            \"Should NOT find file in hidden dir when include_hidden=false\"\n        );\n\n        // Test 2: Include hidden\n        let results_all = search_files(\n            \"txt\".to_string(),\n            temp_dir.to_string_lossy().to_string(),\n            true,\n        )\n        .await\n        .unwrap();\n\n        let found_hidden_2 = results_all.iter().any(|r| r.contains(\".hidden.txt\"));\n        let found_in_hidden_2 = results_all\n            .iter()\n            .any(|r| r.contains(\"file.txt\") \u0026\u0026 r.contains(\".hidden_dir\"));\n\n        assert!(\n            found_hidden_2,\n            \"Should find hidden file when include_hidden=true\"\n        );\n        assert!(\n            found_in_hidden_2,\n            \"Should find file in hidden dir when include_hidden=true\"\n        );\n\n        // Cleanup\n        let _ = std::fs::remove_dir_all(\u0026temp_dir);\n    }\n}\n","traces":[{"line":4,"address":[38883168],"length":1,"stats":{"Line":0}},{"line":5,"address":[40561979],"length":1,"stats":{"Line":0}},{"line":9,"address":[40559312,40559315],"length":1,"stats":{"Line":0}},{"line":10,"address":[44349504,44349287],"length":1,"stats":{"Line":0}},{"line":11,"address":[44349508],"length":1,"stats":{"Line":0}},{"line":13,"address":[44349419],"length":1,"stats":{"Line":0}},{"line":25,"address":[40561781,40561749,40559568],"length":1,"stats":{"Line":1}},{"line":26,"address":[40559648],"length":1,"stats":{"Line":1}},{"line":27,"address":[40559659],"length":1,"stats":{"Line":1}},{"line":28,"address":[38880932],"length":1,"stats":{"Line":1}},{"line":31,"address":[40560037,40559836,40559780],"length":1,"stats":{"Line":3}},{"line":32,"address":[38881246,38881083,38881255],"length":1,"stats":{"Line":2}},{"line":33,"address":[40559905,40560004,40559850],"length":1,"stats":{"Line":3}},{"line":34,"address":[40560006,40559974],"length":1,"stats":{"Line":1}},{"line":38,"address":[40559938,40560057],"length":1,"stats":{"Line":2}},{"line":39,"address":[38881305],"length":1,"stats":{"Line":1}},{"line":40,"address":[40560149,40560220],"length":1,"stats":{"Line":2}},{"line":42,"address":[40560236,40561719],"length":1,"stats":{"Line":2}},{"line":45,"address":[40561685,40560624],"length":1,"stats":{"Line":2}},{"line":48,"address":[38882279,38882181],"length":1,"stats":{"Line":2}},{"line":55,"address":[40560108],"length":1,"stats":{"Line":1}},{"line":59,"address":[40559344],"length":1,"stats":{"Line":1}},{"line":64,"address":[44349753,44349858],"length":1,"stats":{"Line":2}},{"line":66,"address":[44349893,44349952],"length":1,"stats":{"Line":2}},{"line":69,"address":[44350027],"length":1,"stats":{"Line":1}},{"line":72,"address":[44759899,44761952],"length":1,"stats":{"Line":2}},{"line":73,"address":[44352115],"length":1,"stats":{"Line":1}},{"line":74,"address":[44761997],"length":1,"stats":{"Line":1}},{"line":76,"address":[44352125],"length":1,"stats":{"Line":1}},{"line":79,"address":[44350349,44350230,44352188,44352160],"length":1,"stats":{"Line":4}},{"line":80,"address":[44350547,44350434],"length":1,"stats":{"Line":2}},{"line":81,"address":[44760433],"length":1,"stats":{"Line":1}},{"line":83,"address":[44350600,44350695],"length":1,"stats":{"Line":2}},{"line":84,"address":[44352032,44352046,44350920],"length":1,"stats":{"Line":3}},{"line":85,"address":[44352064,44351094,44352078],"length":1,"stats":{"Line":3}},{"line":87,"address":[44351192],"length":1,"stats":{"Line":1}},{"line":89,"address":[44351261],"length":1,"stats":{"Line":1}},{"line":90,"address":[44351362],"length":1,"stats":{"Line":1}},{"line":98,"address":[44352208,44351462,44352240],"length":1,"stats":{"Line":3}},{"line":101,"address":[44352000,44352008,44351496],"length":1,"stats":{"Line":3}},{"line":103,"address":[44351633],"length":1,"stats":{"Line":1}},{"line":106,"address":[40562112],"length":1,"stats":{"Line":1}},{"line":110,"address":[44364464,44364477],"length":1,"stats":{"Line":3}},{"line":115,"address":[44354566,44354670,44355539,44355798,44355806,44354528],"length":1,"stats":{"Line":4}},{"line":117,"address":[44354649,44354738],"length":1,"stats":{"Line":4}},{"line":118,"address":[44764666,44766128,44766112,44765756],"length":1,"stats":{"Line":2}},{"line":120,"address":[44355007,44354937],"length":1,"stats":{"Line":2}},{"line":121,"address":[44355092,44355856,44355015,44355840,44355731],"length":1,"stats":{"Line":2}},{"line":122,"address":[44355284],"length":1,"stats":{"Line":1}},{"line":125,"address":[44355303],"length":1,"stats":{"Line":1}},{"line":126,"address":[44355652,44355437],"length":1,"stats":{"Line":2}},{"line":129,"address":[44355952,44355487,44355374,44355973],"length":1,"stats":{"Line":2}},{"line":133,"address":[44354164,44353359,44353312,44354276,44353448],"length":1,"stats":{"Line":4}},{"line":134,"address":[44353441,44353530,44354432,44354416],"length":1,"stats":{"Line":2}},{"line":136,"address":[44353837],"length":1,"stats":{"Line":1}},{"line":139,"address":[44354365,44353785,44354352],"length":1,"stats":{"Line":3}},{"line":140,"address":[44354332,44354320,44353810],"length":1,"stats":{"Line":3}},{"line":142,"address":[44763930],"length":1,"stats":{"Line":1}},{"line":143,"address":[44763809],"length":1,"stats":{"Line":1}},{"line":145,"address":[44353897],"length":1,"stats":{"Line":1}},{"line":146,"address":[44763848],"length":1,"stats":{"Line":1}},{"line":147,"address":[44353990],"length":1,"stats":{"Line":1}},{"line":152,"address":[38883056],"length":1,"stats":{"Line":0}},{"line":155,"address":[44359875,44359952,44359794],"length":1,"stats":{"Line":0}},{"line":156,"address":[44770055,44770024,44769962],"length":1,"stats":{"Line":0}},{"line":157,"address":[44770163,44770092],"length":1,"stats":{"Line":0}},{"line":158,"address":[44360211],"length":1,"stats":{"Line":0}},{"line":163,"address":[44360679],"length":1,"stats":{"Line":0}},{"line":167,"address":[38880640,38880643],"length":1,"stats":{"Line":0}},{"line":170,"address":[44352996,44352375,44353120,44353136,44352464],"length":1,"stats":{"Line":0}},{"line":171,"address":[44353232,44353216,44352603,44352722],"length":1,"stats":{"Line":0}},{"line":173,"address":[44762773],"length":1,"stats":{"Line":0}},{"line":177,"address":[44766980,44766262,44766348,44766224,44766879],"length":1,"stats":{"Line":0}},{"line":178,"address":[44356367,44356472],"length":1,"stats":{"Line":0}},{"line":179,"address":[44766456],"length":1,"stats":{"Line":0}},{"line":180,"address":[44356525],"length":1,"stats":{"Line":0}},{"line":185,"address":[44766523,44766869,44766552,44767040,44767024],"length":1,"stats":{"Line":0}},{"line":186,"address":[44356819],"length":1,"stats":{"Line":0}},{"line":195,"address":[44768486,44769462,44768572,44769351,44768448],"length":1,"stats":{"Line":0}},{"line":196,"address":[44358664,44358559],"length":1,"stats":{"Line":0}},{"line":197,"address":[44768680],"length":1,"stats":{"Line":0}},{"line":198,"address":[44768757,44768701],"length":1,"stats":{"Line":0}},{"line":203,"address":[44768827,44769504,44769457,44769520,44768750],"length":1,"stats":{"Line":0}},{"line":204,"address":[44769058],"length":1,"stats":{"Line":0}},{"line":205,"address":[44359096],"length":1,"stats":{"Line":0}},{"line":206,"address":[44359452,44359504,44359520,44359139],"length":1,"stats":{"Line":0}},{"line":208,"address":[44359319],"length":1,"stats":{"Line":0}},{"line":212,"address":[40561856],"length":1,"stats":{"Line":0}},{"line":219,"address":[44361136,44361189,44363995],"length":1,"stats":{"Line":0}},{"line":222,"address":[44774464,44774480,44771189,44771121],"length":1,"stats":{"Line":0}},{"line":225,"address":[44771413,44771642,44771330],"length":1,"stats":{"Line":0}},{"line":226,"address":[44364256,44361404,44361465,44364272,44361603],"length":1,"stats":{"Line":0}},{"line":232,"address":[44361439],"length":1,"stats":{"Line":0}},{"line":233,"address":[44771671],"length":1,"stats":{"Line":0}},{"line":234,"address":[44771706],"length":1,"stats":{"Line":0}},{"line":235,"address":[44361919,44361836],"length":1,"stats":{"Line":0}},{"line":236,"address":[44771998,44772097],"length":1,"stats":{"Line":0}},{"line":238,"address":[44362207],"length":1,"stats":{"Line":0}},{"line":239,"address":[44362292],"length":1,"stats":{"Line":0}},{"line":244,"address":[44362881,44362261,44362805],"length":1,"stats":{"Line":0}},{"line":247,"address":[44772575],"length":1,"stats":{"Line":0}},{"line":255,"address":[44362730],"length":1,"stats":{"Line":0}},{"line":257,"address":[44364048,44362849,44363864,44364074,44362445,44362782,44363042],"length":1,"stats":{"Line":0}},{"line":259,"address":[44363105],"length":1,"stats":{"Line":0}},{"line":260,"address":[44363134,44363279],"length":1,"stats":{"Line":0}},{"line":261,"address":[44363377,44363306],"length":1,"stats":{"Line":0}},{"line":264,"address":[44363163],"length":1,"stats":{"Line":0}}],"covered":56,"coverable":107},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","translation.rs"],"content":"use crate::domain::translation::{TranslationRequest, TranslationResult};\nuse crate::state::AppState;\nuse tauri::{command, State};\n\n#[command]\npub async fn translate(\n    state: State\u003c'_, AppState\u003e,\n    text: String,\n    source_lang: Option\u003cString\u003e,\n    target_lang: String,\n) -\u003e Result\u003cTranslationResult, String\u003e {\n    let request = TranslationRequest {\n        text,\n        source_lang,\n        target_lang,\n    };\n\n    state\n        .translation_service\n        .translate(request)\n        .await\n        .map_err(|e| e.to_string())\n}\n","traces":[{"line":6,"address":[41673136],"length":1,"stats":{"Line":0}},{"line":18,"address":[41860328,41860610,41860542,41860866,41860423],"length":1,"stats":{"Line":0}},{"line":20,"address":[41860454,41860554],"length":1,"stats":{"Line":0}},{"line":21,"address":[41860623,41860723,41860367,41860962,41860578],"length":1,"stats":{"Line":0}},{"line":22,"address":[41861024,41861088,41861115],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":5},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","windows.rs"],"content":"use crate::domain::windows::WindowEntry;\nuse crate::state::AppState;\nuse tauri::{AppHandle, LogicalSize, Manager, State};\n\n#[tauri::command]\npub async fn list_windows(state: State\u003c'_, AppState\u003e) -\u003e Result\u003cVec\u003cWindowEntry\u003e, String\u003e {\n    let mut windows = state.window_service.list_windows()?;\n\n    // Enrich with icons\n    for window in \u0026mut windows {\n        if window.icon.is_none() {\n            window.icon = state\n                .icon_resolver\n                .resolve_icon(\u0026window.class.to_lowercase());\n        }\n    }\n\n    Ok(windows)\n}\n\n#[tauri::command]\npub async fn focus_window(state: State\u003c'_, AppState\u003e, address: String) -\u003e Result\u003c(), String\u003e {\n    state.window_service.focus_window(\u0026address)\n}\n\n#[tauri::command]\npub async fn resize_window(app_handle: AppHandle, width: u32, height: u32) -\u003e Result\u003c(), String\u003e {\n    if let Some(window) = app_handle.get_webview_window(\"main\") {\n        // Ensure not maximized and is resizable\n        let _ = window.unmaximize();\n        let _ = window.set_fullscreen(false);\n        let _ = window.set_resizable(true);\n\n        window\n            .set_size(LogicalSize::new(width, height))\n            .map_err(|e| e.to_string())?;\n    }\n    Ok(())\n}\n","traces":[{"line":6,"address":[43404792,43404784],"length":1,"stats":{"Line":0}},{"line":7,"address":[44392333,44392425,44393409],"length":1,"stats":{"Line":0}},{"line":10,"address":[44392646,44392713],"length":1,"stats":{"Line":0}},{"line":11,"address":[44392814,44393031],"length":1,"stats":{"Line":0}},{"line":12,"address":[44393269,44393289,44393248,44393048,44393357],"length":1,"stats":{"Line":0}},{"line":14,"address":[44393260,44393111,44393381,44393325],"length":1,"stats":{"Line":0}},{"line":18,"address":[44392836],"length":1,"stats":{"Line":0}},{"line":22,"address":[45522624,45522632],"length":1,"stats":{"Line":0}},{"line":23,"address":[44391959,44391879],"length":1,"stats":{"Line":0}},{"line":27,"address":[43404800,43404833],"length":1,"stats":{"Line":0}},{"line":28,"address":[44393583,44393673],"length":1,"stats":{"Line":0}},{"line":30,"address":[44393833,44393749],"length":1,"stats":{"Line":0}},{"line":31,"address":[44393870],"length":1,"stats":{"Line":0}},{"line":32,"address":[44393917],"length":1,"stats":{"Line":0}},{"line":34,"address":[44394022,44394118],"length":1,"stats":{"Line":0}},{"line":35,"address":[44393951],"length":1,"stats":{"Line":0}},{"line":36,"address":[44394352,44394086,44394368,44394015],"length":1,"stats":{"Line":0}},{"line":38,"address":[44393766],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":18},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","domain","action.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct Action {\n    pub id: String,\n    pub kind: String,    // \"app\", \"script\", \"window\", \"file\"\n    pub content: String, // The executable path, script path, or file path\n    pub name: String,    // Display name\n    pub icon: Option\u003cString\u003e,\n    pub last_accessed: u64,\n    pub frequency: u64,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","domain","ai.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Serialize, Deserialize, Debug, Clone)]\npub struct Message {\n    pub role: String,\n    pub content: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","domain","apps.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Serialize, Deserialize, Debug, Clone, PartialEq, Eq, Hash)]\npub struct AppEntry {\n    pub name: String,\n    pub exec: String,\n    pub icon: Option\u003cString\u003e,\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_app_entry_creation() {\n        let app = AppEntry {\n            name: \"Firefox\".to_string(),\n            exec: \"firefox\".to_string(),\n            icon: Some(\"firefox.png\".to_string()),\n        };\n\n        assert_eq!(app.name, \"Firefox\");\n        assert_eq!(app.exec, \"firefox\");\n        assert_eq!(app.icon, Some(\"firefox.png\".to_string()));\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","domain","config.rs"],"content":"use serde::{Deserialize, Serialize};\nuse std::collections::HashMap;\n\n#[derive(Serialize, Deserialize, Default, Clone, Debug)]\npub struct ThemeConfig {\n    pub name: String,\n    pub primary: String,\n    pub secondary: String,\n    pub background: String,\n    pub surface: String,\n    pub text: String,\n    #[serde(default)]\n    pub is_custom: bool,\n}\n\n#[derive(Serialize, Deserialize, Default, Clone, Debug)]\npub struct ScriptConfig {\n    pub id: String,\n    pub alias: String,\n    pub path: String,\n    pub args: Option\u003cString\u003e,\n}\n\n#[derive(Serialize, Deserialize, Default, Clone, Debug)]\npub struct AiTool {\n    pub id: String,\n    pub name: String,\n    pub description: String,\n    pub prompt_template: String,\n    pub keywords: Vec\u003cString\u003e,\n    pub icon: String,\n}\n\n#[derive(Serialize, Deserialize, Default, Clone)]\npub struct AppConfig {\n    pub openai_api_key: Option\u003cString\u003e,\n    pub local_model_url: Option\u003cString\u003e, // e.g. http://localhost:11434\n    pub preferred_model: String,         // \"local\" or \"cloud\"\n    pub ollama_model: Option\u003cString\u003e,    // Specific model name e.g. \"llama3\"\n\n    #[serde(default)]\n    pub ai_tools: Vec\u003cAiTool\u003e,\n\n    #[serde(default)]\n    pub shortcuts: HashMap\u003cString, String\u003e, // trigger -\u003e tool_id or app_name\n\n    #[serde(default)]\n    pub scripts: Vec\u003cScriptConfig\u003e,\n\n    #[serde(default)]\n    pub window_scale: Option\u003cf32\u003e,\n\n    pub theme: Option\u003cThemeConfig\u003e,\n\n    #[serde(default)]\n    pub file_search: FileSearchConfig,\n}\n\n#[derive(Serialize, Deserialize, Default, Clone, Debug)]\npub struct FileSearchConfig {\n    #[serde(default)]\n    pub include_hidden: bool,\n}\n\nimpl AppConfig {\n    pub fn apply_defaults(\u0026mut self) {\n        if self.preferred_model.is_empty() {\n            self.preferred_model = \"local\".to_string();\n            self.local_model_url = Some(\"http://localhost:11434\".to_string());\n            self.ollama_model = Some(\"llama3\".to_string());\n            self.ollama_model = Some(\"llama3\".to_string());\n        }\n\n        if self.window_scale.is_none() {\n            self.window_scale = Some(0.2); // Default to 20% of screen width\n        }\n\n        if self.theme.is_none() {\n            self.theme = Some(ThemeConfig {\n                name: \"Tokyo Night\".to_string(),\n                primary: \"#7aa2f7\".to_string(),\n                secondary: \"#bb9af7\".to_string(),\n                background: \"#1a1b26\".to_string(),\n                surface: \"#24283b\".to_string(),\n                text: \"#c0caf5\".to_string(),\n                is_custom: false,\n            });\n        }\n\n        if self.ai_tools.is_empty() {\n            self.ai_tools.push(AiTool {\n                 id: \"rephrase\".to_string(),\n                 name: \"Rephrase Selection\".to_string(),\n                 description: \"Improve clarity and grammar\".to_string(),\n                 prompt_template: \"Identity the language of the following text and rephrase it to improve clarity and grammar. Return ONLY the improved text wrapped in a markdown code block (using ```text or the appropriate language). Do not add any conversational text.\\n\\nText:\\n{{selection}}\".to_string(),\n                 keywords: vec![\"rephrase\".to_string(), \"rewrite\".to_string(), \"fix\".to_string(), \"improve\".to_string()],\n                 icon: \"\".to_string()\n             });\n        }\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_apply_defaults() {\n        let mut config = AppConfig::default();\n\n        // Initially empty/defaults\n        assert!(config.preferred_model.is_empty());\n        assert!(config.theme.is_none());\n        assert!(config.ai_tools.is_empty());\n\n        // Apply defaults\n        config.apply_defaults();\n\n        // Check defaults\n        assert_eq!(config.preferred_model, \"local\");\n        assert_eq!(\n            config.local_model_url.as_deref(),\n            Some(\"http://localhost:11434\")\n        );\n        assert_eq!(config.ollama_model.as_deref(), Some(\"llama3\"));\n\n        // Theme\n        assert!(config.theme.is_some());\n        let theme = config.theme.as_ref().unwrap();\n        assert_eq!(theme.name, \"Tokyo Night\");\n\n        // AI Tools\n        assert!(!config.ai_tools.is_empty());\n        assert_eq!(config.ai_tools[0].id, \"rephrase\");\n    }\n\n    #[test]\n    fn test_apply_defaults_preserves_existing() {\n        let mut config = AppConfig::default();\n        config.preferred_model = \"cloud\".to_string();\n        config.theme = Some(ThemeConfig {\n            name: \"Custom\".to_string(),\n            ..Default::default()\n        });\n\n        config.apply_defaults();\n\n        // Should preserve user settings\n        assert_eq!(config.preferred_model, \"cloud\");\n        assert_eq!(config.theme.as_ref().unwrap().name, \"Custom\");\n\n        // But should still fill in missing ones (ai_tools)\n        assert!(!config.ai_tools.is_empty());\n    }\n}\n","traces":[{"line":66,"address":[40305408,40308192,40308203],"length":1,"stats":{"Line":1}},{"line":67,"address":[40306134,40305428],"length":1,"stats":{"Line":2}},{"line":68,"address":[40305467,40305514],"length":1,"stats":{"Line":1}},{"line":69,"address":[40305589,40305660],"length":1,"stats":{"Line":1}},{"line":70,"address":[41426490,41426576],"length":1,"stats":{"Line":2}},{"line":71,"address":[40305936,40306018],"length":1,"stats":{"Line":2}},{"line":74,"address":[40305442,40306193],"length":1,"stats":{"Line":3}},{"line":75,"address":[40306167],"length":1,"stats":{"Line":2}},{"line":78,"address":[40306144,40306953],"length":1,"stats":{"Line":3}},{"line":79,"address":[40306617,40306871],"length":1,"stats":{"Line":2}},{"line":80,"address":[40306222],"length":1,"stats":{"Line":1}},{"line":81,"address":[40306261],"length":1,"stats":{"Line":1}},{"line":82,"address":[40306329],"length":1,"stats":{"Line":1}},{"line":83,"address":[40306401],"length":1,"stats":{"Line":1}},{"line":84,"address":[41427228],"length":1,"stats":{"Line":2}},{"line":85,"address":[40306545],"length":1,"stats":{"Line":1}},{"line":90,"address":[41426954],"length":1,"stats":{"Line":1}},{"line":91,"address":[40306971,40307886],"length":1,"stats":{"Line":4}},{"line":92,"address":[40306980],"length":1,"stats":{"Line":1}},{"line":93,"address":[40307019],"length":1,"stats":{"Line":1}},{"line":94,"address":[40307087],"length":1,"stats":{"Line":1}},{"line":95,"address":[40307159],"length":1,"stats":{"Line":3}},{"line":96,"address":[40308198,40307241,40307299],"length":1,"stats":{"Line":4}},{"line":97,"address":[40307806],"length":1,"stats":{"Line":1}}],"covered":24,"coverable":24},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","domain","mod.rs"],"content":"pub mod ai;\npub mod apps;\npub mod config;\npub mod windows;\n// Future domains: ai, etc.\npub mod action;\npub mod translation;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","domain","translation.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Debug, Serialize, Deserialize, Clone)]\npub struct TranslationResult {\n    pub original_text: String,\n    pub translated_text: String,\n    pub source_language: String,\n    pub target_language: String,\n}\n\n#[derive(Debug, Serialize, Deserialize, Clone)]\npub struct TranslationRequest {\n    pub text: String,\n    pub source_lang: Option\u003cString\u003e,\n    pub target_lang: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","domain","windows.rs"],"content":"use serde::Serialize;\n\n#[derive(Serialize, Clone, Debug)]\npub struct WindowEntry {\n    pub title: String,\n    pub class: String,\n    pub address: String, // ID or Address\n    pub icon: Option\u003cString\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","lib.rs"],"content":"pub mod adapters;\npub mod commands;\npub mod domain;\npub mod ports;\npub mod state;\npub mod tray;\npub mod utils;\n\nuse adapters::cached_icon_resolver::CachedIconResolver;\nuse adapters::file_history::FileHistoryAdapter;\nuse adapters::fs_app_repository::FsAppRepository;\nuse adapters::fs_config_service::FsConfigService;\nuse adapters::google_translation_service::GoogleTranslationService;\nuse adapters::http_ai_service::HttpAiService;\nuse adapters::linux_window_service::LinuxWindowService;\nuse state::AppState;\nuse std::path::PathBuf;\nuse std::sync::Arc;\nuse tauri::{Emitter, Manager};\nuse tray::PaletteTray;\nuse utils::toggle_main_window;\n\n#[cfg_attr(mobile, tauri::mobile_entry_point)]\npub fn run() {\n    tauri::Builder::default()\n        .plugin(tauri_plugin_fs::init())\n        .plugin(tauri_plugin_dialog::init())\n        .plugin(tauri_plugin_clipboard_manager::init())\n        .plugin(tauri_plugin_opener::init())\n        .setup(|app| {\n            // Instantiate Adapters\n            let config_service = Arc::new(FsConfigService::new());\n            let icon_resolver = Arc::new(CachedIconResolver::new());\n            // FsAppRepository needs icon resolver\n            let app_repository = Arc::new(FsAppRepository::new(icon_resolver.clone()));\n            let command_executor = Arc::new(adapters::linux_window_service::StdCommandExecutor);\n            let window_service = Arc::new(LinuxWindowService::new(command_executor));\n            let ai_service = Arc::new(HttpAiService::new());\n\n            let app_data_dir = app\n                .path()\n                .app_data_dir()\n                .unwrap_or_else(|_| PathBuf::from(\".\"));\n            let history_repository = Arc::new(FileHistoryAdapter::new(app_data_dir));\n            let translation_service = Arc::new(GoogleTranslationService::new(None));\n\n            // Manage State\n            app.manage(AppState {\n                app_repository,\n                window_service,\n                config_service: config_service.clone(),\n                icon_resolver: icon_resolver.clone(),\n                ai_service,\n                history_repository,\n                translation_service,\n            });\n\n            // Initialize KSNI Tray Service\n            let handle = app.handle().clone();\n            let tray = PaletteTray { handle };\n            let service = ksni::TrayService::new(tray);\n            let _handle = service.handle();\n\n            service.spawn();\n\n            Ok(())\n        })\n        .plugin(tauri_plugin_single_instance::init(|app, _args, _cwd| {\n            let _ = app.emit(\"open_request\", ());\n            toggle_main_window(app);\n        }))\n        .invoke_handler(tauri::generate_handler![\n            commands::system::greet,\n            commands::system::search_files,\n            commands::system::open_entity,\n            commands::system::read_file_preview,\n            commands::system::get_file_metadata,\n            commands::system::get_selection_context,\n            commands::system::copy_to_clipboard,\n            commands::system::check_is_executable,\n            commands::system::make_file_executable,\n            commands::apps::list_apps,\n            commands::apps::launch_app,\n            commands::config::get_config,\n            commands::config::save_config,\n            commands::ai::ask_ai,\n            commands::ai::check_ai_connection,\n            commands::ai::list_ollama_models,\n            commands::scripts::list_scripts,\n            commands::scripts::execute_script,\n            commands::windows::list_windows,\n            commands::windows::focus_window,\n            commands::windows::focus_window,\n            commands::windows::resize_window,\n            commands::system::generate_video_thumbnail,\n            commands::history::get_recent_actions,\n            commands::history::record_action,\n            commands::history::clear_history,\n            commands::translation::translate,\n        ])\n        .run(tauri::generate_context!())\n        .expect(\"error while running tauri application\");\n}\n","traces":[{"line":24,"address":[80595536],"length":1,"stats":{"Line":0}},{"line":25,"address":[98098832],"length":1,"stats":{"Line":0}},{"line":26,"address":[125797850],"length":1,"stats":{"Line":0}},{"line":27,"address":[98134048],"length":1,"stats":{"Line":0}},{"line":28,"address":[125797914],"length":1,"stats":{"Line":0}},{"line":29,"address":[109479600],"length":1,"stats":{"Line":1}},{"line":30,"address":[58838968,58838197],"length":1,"stats":{"Line":0}},{"line":32,"address":[42191492],"length":1,"stats":{"Line":1}},{"line":33,"address":[121411929],"length":1,"stats":{"Line":2}},{"line":35,"address":[61941035,61940916,61941008],"length":1,"stats":{"Line":3}},{"line":36,"address":[59628635,59629398],"length":1,"stats":{"Line":1}},{"line":37,"address":[42391405],"length":1,"stats":{"Line":1}},{"line":38,"address":[89510990],"length":1,"stats":{"Line":0}},{"line":40,"address":[61870633],"length":1,"stats":{"Line":1}},{"line":41,"address":[89053187,89054304,89054360,89050357,89054481,89050549,89050864,89050352,89050448,89050980,89050484,89050784,89052976],"length":1,"stats":{"Line":0}},{"line":42,"address":[59628747,59629514],"length":1,"stats":{"Line":0}},{"line":43,"address":[124969888,124969893],"length":1,"stats":{"Line":0}},{"line":44,"address":[42192146],"length":1,"stats":{"Line":0}},{"line":45,"address":[111493824],"length":1,"stats":{"Line":1}},{"line":48,"address":[42392202],"length":1,"stats":{"Line":2}},{"line":49,"address":[61151019],"length":1,"stats":{"Line":3}},{"line":50,"address":[75626595,75626569],"length":1,"stats":{"Line":4}},{"line":51,"address":[73816472],"length":1,"stats":{"Line":4}},{"line":52,"address":[53058547,53059618],"length":1,"stats":{"Line":1}},{"line":53,"address":[80561664,80561132,80561635],"length":1,"stats":{"Line":6}},{"line":54,"address":[53849942,53848874],"length":1,"stats":{"Line":2}},{"line":55,"address":[62694011],"length":1,"stats":{"Line":4}},{"line":59,"address":[77857634],"length":1,"stats":{"Line":1}},{"line":60,"address":[61279198,61278824],"length":1,"stats":{"Line":0}},{"line":61,"address":[82470657],"length":1,"stats":{"Line":1}},{"line":62,"address":[108623859,108623403,108623655,108623812,108623129],"length":1,"stats":{"Line":3}},{"line":64,"address":[124970535],"length":1,"stats":{"Line":1}},{"line":66,"address":[98076962,98078402,98076871,98078311],"length":1,"stats":{"Line":1}},{"line":68,"address":[85083654,85083581],"length":1,"stats":{"Line":1}},{"line":69,"address":[61167527,61166127],"length":1,"stats":{"Line":1}},{"line":70,"address":[85083663],"length":1,"stats":{"Line":1}},{"line":72,"address":[82470574,82470544],"length":1,"stats":{"Line":3}},{"line":73,"address":[75558612],"length":1,"stats":{"Line":0}},{"line":74,"address":[61876816],"length":1,"stats":{"Line":2}},{"line":75,"address":[61086504],"length":1,"stats":{"Line":1}},{"line":76,"address":[89543769],"length":1,"stats":{"Line":3}},{"line":77,"address":[95184746],"length":1,"stats":{"Line":2}},{"line":78,"address":[73617045],"length":1,"stats":{"Line":0}},{"line":79,"address":[113068463,113068457,113068368],"length":1,"stats":{"Line":1}},{"line":80,"address":[117735677,117735103,117735046],"length":1,"stats":{"Line":3}},{"line":81,"address":[125280827],"length":1,"stats":{"Line":1}},{"line":82,"address":[121408668],"length":1,"stats":{"Line":0}},{"line":83,"address":[89054282],"length":1,"stats":{"Line":0}},{"line":84,"address":[118068672],"length":1,"stats":{"Line":0}},{"line":85,"address":[104089072],"length":1,"stats":{"Line":2}},{"line":86,"address":[120283958,120283915],"length":1,"stats":{"Line":2}},{"line":87,"address":[104090254,104089110],"length":1,"stats":{"Line":2}},{"line":88,"address":[73094716],"length":1,"stats":{"Line":0}},{"line":89,"address":[113048928],"length":1,"stats":{"Line":0}},{"line":90,"address":[122816877],"length":1,"stats":{"Line":0}},{"line":91,"address":[124953544,124953919],"length":1,"stats":{"Line":1}},{"line":92,"address":[53829996],"length":1,"stats":{"Line":2}},{"line":93,"address":[86663221,86663951,86663919],"length":1,"stats":{"Line":3}},{"line":94,"address":[107735344],"length":1,"stats":{"Line":4}},{"line":95,"address":[118030793,118031003,118031140,118030206],"length":1,"stats":{"Line":2}},{"line":96,"address":[75627841],"length":1,"stats":{"Line":4}},{"line":97,"address":[110465930],"length":1,"stats":{"Line":4}},{"line":98,"address":[115284128],"length":1,"stats":{"Line":6}},{"line":99,"address":[120127925],"length":1,"stats":{"Line":3}},{"line":101,"address":[123920784],"length":1,"stats":{"Line":2}}],"covered":45,"coverable":65},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","main.rs"],"content":"// Prevents additional console window on Windows in release, DO NOT REMOVE!!\n#![cfg_attr(not(debug_assertions), windows_subsystem = \"windows\")]\n\nfn main() {\n    std::env::set_var(\"WEBKIT_DISABLE_DMABUF_RENDERER\", \"1\");\n    stratos_bar_lib::run()\n}\n","traces":[{"line":4,"address":[38462992],"length":1,"stats":{"Line":0}},{"line":5,"address":[38462993],"length":1,"stats":{"Line":0}},{"line":6,"address":[38463022],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":3},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","ports","ai_port.rs"],"content":"use crate::domain::ai::Message;\nuse crate::domain::config::AppConfig;\nuse futures_util::stream::BoxStream;\n\n#[async_trait::async_trait]\npub trait AiService: Send + Sync {\n    async fn stream_completion\u003c'a\u003e(\n        \u0026'a self,\n        config: \u0026'a AppConfig,\n        messages: Vec\u003cMessage\u003e,\n    ) -\u003e Result\u003cBoxStream\u003c'a, Result\u003cString, String\u003e\u003e, String\u003e;\n\n    async fn check_connection(\u0026self, config: \u0026AppConfig) -\u003e Result\u003cString, String\u003e;\n\n    async fn list_models(\u0026self, config: \u0026AppConfig) -\u003e Result\u003cVec\u003cString\u003e, String\u003e;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","ports","app_port.rs"],"content":"use crate::domain::apps::AppEntry;\n\n#[cfg_attr(test, mockall::automock)]\npub trait AppRepository: Send + Sync {\n    fn list_apps(\u0026self) -\u003e Result\u003cVec\u003cAppEntry\u003e, String\u003e;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","ports","config_port.rs"],"content":"use crate::domain::config::AppConfig;\nuse std::path::PathBuf;\n\n#[cfg_attr(test, mockall::automock)]\npub trait ConfigService: Send + Sync {\n    fn load_config(\u0026self) -\u003e AppConfig;\n    fn save_config(\u0026self, config: \u0026AppConfig) -\u003e Result\u003c(), String\u003e;\n    fn get_config_dir(\u0026self) -\u003e Option\u003cPathBuf\u003e;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","ports","history.rs"],"content":"use crate::domain::action::Action;\nuse async_trait::async_trait;\n\n#[async_trait]\npub trait HistoryRepository: Send + Sync {\n    async fn get_recent(\u0026self, limit: usize) -\u003e Result\u003cVec\u003cAction\u003e, String\u003e;\n    async fn record(\u0026self, action: Action) -\u003e Result\u003c(), String\u003e;\n    async fn clear(\u0026self) -\u003e Result\u003c(), String\u003e;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","ports","icon_port.rs"],"content":"pub trait IconResolver: Send + Sync {\n    fn resolve_icon(\u0026self, icon_name: \u0026str) -\u003e Option\u003cString\u003e;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","ports","mod.rs"],"content":"pub mod ai_port;\npub mod app_port;\npub mod config_port;\npub mod icon_port;\npub mod window_port;\n// pub mod ai_port; // To be added\npub mod history;\npub mod translation_port;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","ports","translation_port.rs"],"content":"use crate::domain::translation::{TranslationRequest, TranslationResult};\nuse async_trait::async_trait;\nuse std::error::Error;\n\n#[async_trait]\npub trait TranslationService: Send + Sync {\n    async fn translate(\n        \u0026self,\n        request: TranslationRequest,\n    ) -\u003e Result\u003cTranslationResult, Box\u003cdyn Error + Send + Sync\u003e\u003e;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","ports","window_port.rs"],"content":"use crate::domain::windows::WindowEntry;\n\npub trait WindowService: Send + Sync {\n    fn list_windows(\u0026self) -\u003e Result\u003cVec\u003cWindowEntry\u003e, String\u003e;\n    fn focus_window(\u0026self, id: \u0026str) -\u003e Result\u003c(), String\u003e;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","state.rs"],"content":"use crate::ports::ai_port::AiService;\nuse crate::ports::app_port::AppRepository;\nuse crate::ports::config_port::ConfigService;\nuse crate::ports::history::HistoryRepository;\nuse crate::ports::icon_port::IconResolver;\nuse crate::ports::translation_port::TranslationService;\nuse crate::ports::window_port::WindowService;\nuse std::sync::Arc;\n\npub struct AppState {\n    pub app_repository: Arc\u003cdyn AppRepository\u003e,\n    pub window_service: Arc\u003cdyn WindowService\u003e,\n    pub config_service: Arc\u003cdyn ConfigService\u003e,\n    pub icon_resolver: Arc\u003cdyn IconResolver\u003e,\n    pub ai_service: Arc\u003cdyn AiService\u003e,\n    pub history_repository: Arc\u003cdyn HistoryRepository\u003e,\n    pub translation_service: Arc\u003cdyn TranslationService\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","tray.rs"],"content":"use crate::utils::toggle_main_window;\n\n// Reuse PaletteTray as is.\npub struct PaletteTray {\n    pub handle: tauri::AppHandle,\n}\n\nimpl ksni::Tray for PaletteTray {\n    fn icon_pixmap(\u0026self) -\u003e Vec\u003cksni::Icon\u003e {\n        let mut icons = Vec::new();\n\n        let sizes = vec![\n            (include_bytes!(\"../icons/tray-icon-22.png\").to_vec(), 22),\n            (include_bytes!(\"../icons/tray-icon-32.png\").to_vec(), 32),\n            (include_bytes!(\"../icons/tray-icon-48.png\").to_vec(), 48),\n        ];\n\n        for (data, _expected_size) in sizes {\n            if let Ok(image) = image::load_from_memory(\u0026data) {\n                let rgba = image.to_rgba8();\n                let width = rgba.width() as i32;\n                let height = rgba.height() as i32;\n                let raw_rgba = rgba.into_raw();\n\n                let mut argb = Vec::with_capacity(raw_rgba.len());\n                for chunk in raw_rgba.chunks(4) {\n                    if chunk.len() == 4 {\n                        argb.push(chunk[3]); // A\n                        argb.push(chunk[0]); // R\n                        argb.push(chunk[1]); // G\n                        argb.push(chunk[2]); // B\n                    }\n                }\n\n                icons.push(ksni::Icon {\n                    width,\n                    height,\n                    data: argb,\n                });\n            }\n        }\n\n        if !icons.is_empty() {\n            icons\n        } else {\n            if let Some(img) = self.handle.default_window_icon() {\n                vec![ksni::Icon {\n                    width: img.width() as i32,\n                    height: img.height() as i32,\n                    data: img.rgba().to_vec(),\n                }]\n            } else {\n                vec![]\n            }\n        }\n    }\n\n    fn id(\u0026self) -\u003e String {\n        \"stratos-bar\".to_string()\n    }\n\n    fn title(\u0026self) -\u003e String {\n        \"stratos-bar\".to_string()\n    }\n\n    fn activate(\u0026mut self, _x: i32, _y: i32) {\n        toggle_main_window(\u0026self.handle);\n    }\n\n    fn menu(\u0026self) -\u003e Vec\u003cksni::MenuItem\u003cSelf\u003e\u003e {\n        use ksni::menu::*;\n        vec![\n            StandardItem {\n                label: \"Show\".into(),\n                activate: Box::new(|this: \u0026mut Self| {\n                    toggle_main_window(\u0026this.handle);\n                }),\n                ..Default::default()\n            }\n            .into(),\n            StandardItem {\n                label: \"Quit\".into(),\n                activate: Box::new(|this: \u0026mut Self| {\n                    this.handle.exit(0);\n                }),\n                ..Default::default()\n            }\n            .into(),\n        ]\n    }\n}\n","traces":[{"line":9,"address":[44676479,44674880,44678024],"length":1,"stats":{"Line":0}},{"line":10,"address":[44674919],"length":1,"stats":{"Line":0}},{"line":12,"address":[44675041,44675088,44674974,44675202,44675407,44675316,44678019],"length":1,"stats":{"Line":0}},{"line":13,"address":[44675049,44675120],"length":1,"stats":{"Line":0}},{"line":14,"address":[44675163,44675234],"length":1,"stats":{"Line":0}},{"line":15,"address":[41624356,41624281],"length":1,"stats":{"Line":0}},{"line":18,"address":[41624619,41624781],"length":1,"stats":{"Line":0}},{"line":19,"address":[44676595,44675840,44676677],"length":1,"stats":{"Line":0}},{"line":20,"address":[44676725,44676796],"length":1,"stats":{"Line":0}},{"line":21,"address":[44676869,44676804],"length":1,"stats":{"Line":0}},{"line":22,"address":[41625924],"length":1,"stats":{"Line":0}},{"line":23,"address":[44676910],"length":1,"stats":{"Line":0}},{"line":25,"address":[83738224],"length":1,"stats":{"Line":0}},{"line":26,"address":[44677077,44677154],"length":1,"stats":{"Line":0}},{"line":27,"address":[44677387],"length":1,"stats":{"Line":0}},{"line":28,"address":[41626689],"length":1,"stats":{"Line":0}},{"line":29,"address":[83738320],"length":1,"stats":{"Line":0}},{"line":30,"address":[44677774],"length":1,"stats":{"Line":0}},{"line":31,"address":[44677847],"length":1,"stats":{"Line":0}},{"line":35,"address":[44677450],"length":1,"stats":{"Line":0}},{"line":37,"address":[81114128,81113493,81113488,81114147,81115397,81116928,81115392,81116938],"length":1,"stats":{"Line":0}},{"line":38,"address":[44677410],"length":1,"stats":{"Line":0}},{"line":43,"address":[41625005,41624921],"length":1,"stats":{"Line":0}},{"line":44,"address":[44675930],"length":1,"stats":{"Line":0}},{"line":46,"address":[44675983,44676019],"length":1,"stats":{"Line":0}},{"line":47,"address":[44676129,44676485,44676275,44676160,44676089],"length":1,"stats":{"Line":0}},{"line":48,"address":[44676137],"length":1,"stats":{"Line":0}},{"line":49,"address":[44676197],"length":1,"stats":{"Line":0}},{"line":50,"address":[44676217],"length":1,"stats":{"Line":0}},{"line":53,"address":[44676490,44676109],"length":1,"stats":{"Line":0}},{"line":58,"address":[44678048],"length":1,"stats":{"Line":0}},{"line":59,"address":[44678065],"length":1,"stats":{"Line":0}},{"line":62,"address":[44679728],"length":1,"stats":{"Line":0}},{"line":63,"address":[41628865],"length":1,"stats":{"Line":0}},{"line":66,"address":[44679776],"length":1,"stats":{"Line":0}},{"line":67,"address":[41628913],"length":1,"stats":{"Line":0}},{"line":70,"address":[44679644,44678096,44679638],"length":1,"stats":{"Line":0}},{"line":72,"address":[44678658,44678184,44679089,44678583,44678131,44679692,44679057,44679662,44679712],"length":1,"stats":{"Line":0}},{"line":73,"address":[41627421],"length":1,"stats":{"Line":0}},{"line":74,"address":[44678141],"length":1,"stats":{"Line":0}},{"line":75,"address":[40747088],"length":1,"stats":{"Line":0}},{"line":76,"address":[41397577],"length":1,"stats":{"Line":0}},{"line":78,"address":[83741285,83735833,83737346],"length":1,"stats":{"Line":0}},{"line":80,"address":[41627623],"length":1,"stats":{"Line":0}},{"line":81,"address":[44678820],"length":1,"stats":{"Line":0}},{"line":82,"address":[41627695],"length":1,"stats":{"Line":0}},{"line":83,"address":[83734673],"length":1,"stats":{"Line":0}},{"line":84,"address":[41397529],"length":1,"stats":{"Line":0}},{"line":86,"address":[44678776],"length":1,"stats":{"Line":0}},{"line":88,"address":[44679022],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":50},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","utils.rs"],"content":"use tauri::{Emitter, Manager};\n\n/// Helper to toggle the main window's visibility.\n/// If visible, it hides it.\n/// If hidden, it shows, raises, focuses, and emits the 'window-shown' event.\npub fn toggle_main_window(handle: \u0026tauri::AppHandle) {\n    if let Some(window) = handle.get_webview_window(\"main\") {\n        let is_visible = window.is_visible().unwrap_or(false);\n        if is_visible {\n            let _ = window.hide();\n        } else {\n            // Re-assert always on top to ensure it floats above others\n            let _ = window.set_always_on_top(true);\n            let _ = window.show();\n            let _ = window.set_focus();\n            let _ = window.emit(\"window-shown\", ());\n        }\n    }\n}\n","traces":[{"line":6,"address":[48603807],"length":1,"stats":{"Line":0}},{"line":7,"address":[45526418],"length":1,"stats":{"Line":0}},{"line":8,"address":[48603824],"length":1,"stats":{"Line":0}},{"line":9,"address":[89262304],"length":1,"stats":{"Line":0}},{"line":10,"address":[89262328],"length":1,"stats":{"Line":0}},{"line":13,"address":[59061146,59061250],"length":1,"stats":{"Line":0}},{"line":14,"address":[59061245],"length":1,"stats":{"Line":0}},{"line":15,"address":[45526737],"length":1,"stats":{"Line":0}},{"line":16,"address":[45526763],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":9}]};
        var previousData = {"files":[{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","build.rs"],"content":"fn main() {\n    tauri_build::build()\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","adapters","cached_icon_resolver.rs"],"content":"use crate::ports::icon_port::IconResolver;\nuse std::collections::HashMap;\nuse std::sync::{Arc, Mutex};\n\npub struct CachedIconResolver {\n    cache: Arc\u003cMutex\u003cHashMap\u003cString, Option\u003cString\u003e\u003e\u003e\u003e,\n}\n\nimpl CachedIconResolver {\n    pub fn new() -\u003e Self {\n        Self {\n            cache: Arc::new(Mutex::new(HashMap::new())),\n        }\n    }\n\n    fn resolve_icon_internal(\u0026self, icon_name: \u0026str) -\u003e Option\u003cString\u003e {\n        // 1. Direct path check\n        let path = std::path::Path::new(icon_name);\n        if path.is_absolute() \u0026\u0026 path.exists() {\n            let resolved_path = match std::fs::canonicalize(path) {\n                Ok(p) =\u003e p.to_string_lossy().to_string(),\n                Err(_) =\u003e icon_name.to_string(),\n            };\n            return Some(resolved_path);\n        }\n\n        // 2. Use linicon\n        // Iterate over all results instead of just first, prioritize scalable/png\n        if let Some(icon_path) = linicon::lookup_icon(icon_name).next() {\n            if let Ok(path_str) = icon_path {\n                let resolved_path = match std::fs::canonicalize(\u0026path_str.path) {\n                    Ok(p) =\u003e p.to_string_lossy().to_string(),\n                    Err(_) =\u003e path_str.path.to_string_lossy().to_string(),\n                };\n                return Some(resolved_path);\n            }\n        }\n\n        // 3. Fallback: Manual search in standard paths\n        // Linicon might fail if theme config is weird or specific sizes not found?\n        // Let's do a robust manual search for common cases (steam, hicolor default)\n\n        // This part requires `dirs`\n        let mut search_paths = Vec::new();\n\n        // Standard XDG paths\n        if let Ok(dirs) = std::env::var(\"XDG_DATA_DIRS\") {\n            for dir in dirs.split(':') {\n                let p = std::path::Path::new(dir);\n                search_paths.push(p.join(\"icons/hicolor/48x48/apps\"));\n                search_paths.push(p.join(\"icons/hicolor/32x32/apps\"));\n                search_paths.push(p.join(\"icons/hicolor/128x128/apps\"));\n                search_paths.push(p.join(\"icons/hicolor/scalable/apps\"));\n                search_paths.push(p.join(\"pixmaps\"));\n                search_paths.push(p.join(\"icons\"));\n            }\n        } else {\n            search_paths.push(std::path::PathBuf::from(\n                \"/usr/share/icons/hicolor/48x48/apps\",\n            ));\n            search_paths.push(std::path::PathBuf::from(\n                \"/usr/share/icons/hicolor/32x32/apps\",\n            ));\n            search_paths.push(std::path::PathBuf::from(\n                \"/usr/share/icons/hicolor/scalable/apps\",\n            ));\n            search_paths.push(std::path::PathBuf::from(\"/usr/share/pixmaps\"));\n            search_paths.push(std::path::PathBuf::from(\"/usr/share/icons\"));\n        }\n\n        // User local paths\n        if let Some(home) = dirs::data_local_dir() {\n            search_paths.push(home.join(\"icons/hicolor/48x48/apps\"));\n            search_paths.push(home.join(\"icons/hicolor/32x32/apps\"));\n            search_paths.push(home.join(\"icons/hicolor/128x128/apps\"));\n            search_paths.push(home.join(\"icons/hicolor/scalable/apps\"));\n            search_paths.push(home.join(\"icons\"));\n        }\n\n        // Steam specific paths\n        if let Some(home) = dirs::home_dir() {\n            search_paths.push(home.join(\".steam/root/appcache/librarycache\"));\n            search_paths.push(home.join(\".local/share/icons/hicolor/48x48/apps\"));\n        }\n\n        let extensions = vec![\"png\", \"svg\", \"xpm\", \"ico\", \"jpg\"];\n\n        for base in \u0026search_paths {\n            if !base.exists() {\n                continue;\n            }\n\n            // Steam specific cache check (icon_name usually steam_icon_APPID)\n            if base.ends_with(\"librarycache\") \u0026\u0026 icon_name.starts_with(\"steam_icon_\") {\n                let app_id = icon_name.trim_start_matches(\"steam_icon_\");\n                // try app_id_icon.jpg\n                let p = base.join(format!(\"{}_icon.jpg\", app_id));\n                if p.exists() {\n                    return Some(p.to_string_lossy().to_string());\n                }\n            }\n\n            for ext in \u0026extensions {\n                let p = base.join(format!(\"{}.{}\", icon_name, ext));\n                if p.exists() {\n                    let resolved_path = match std::fs::canonicalize(\u0026p) {\n                        Ok(canonical) =\u003e canonical.to_string_lossy().to_string(),\n                        Err(_) =\u003e p.to_string_lossy().to_string(),\n                    };\n                    return Some(resolved_path);\n                }\n            }\n        }\n\n        // Try stripping extension if present in name but not a path\n        if let Some(stem) = std::path::Path::new(icon_name).file_stem() {\n            if stem != icon_name {\n                let stem_str = stem.to_string_lossy();\n                if let Some(icon_path) = linicon::lookup_icon(\u0026stem_str).next() {\n                    if let Ok(path_str) = icon_path {\n                        return Some(path_str.path.to_string_lossy().to_string());\n                    }\n                }\n            }\n        }\n\n        None\n    }\n}\n\nimpl IconResolver for CachedIconResolver {\n    fn resolve_icon(\u0026self, icon_name: \u0026str) -\u003e Option\u003cString\u003e {\n        // Check cache\n        if let Ok(guard) = self.cache.lock() {\n            if let Some(cached) = guard.get(icon_name) {\n                return cached.clone();\n            }\n        }\n\n        let result = self.resolve_icon_internal(icon_name);\n\n        // Update cache\n        if let Ok(mut guard) = self.cache.lock() {\n            guard.insert(icon_name.to_string(), result.clone());\n        }\n\n        result\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use std::fs::File;\n    use tempfile::tempdir;\n\n    #[test]\n    fn test_resolve_absolute_path() {\n        let dir = tempdir().unwrap();\n        let file_path = dir.path().join(\"test_icon.png\");\n        File::create(\u0026file_path).unwrap();\n\n        let resolver = CachedIconResolver::new();\n        let result = resolver.resolve_icon(file_path.to_str().unwrap());\n\n        assert!(result.is_some());\n        // Canonicalization might resolve symlinks or change format, but for temp dir it should be close\n        // We just check it's some valid path\n        assert!(result.unwrap().contains(\"test_icon.png\"));\n    }\n\n    #[test]\n    fn test_caching_behavior() {\n        let dir = tempdir().unwrap();\n        let file_path = dir.path().join(\"test_cache.png\");\n        File::create(\u0026file_path).unwrap();\n\n        let resolver = CachedIconResolver::new();\n        let path_str = file_path.to_str().unwrap();\n\n        // First resolution\n        assert!(resolver.resolve_icon(path_str).is_some());\n\n        // Delete valid file\n        std::fs::remove_file(\u0026file_path).unwrap();\n\n        // Second resolution should hit cache and still return result even if file is gone\n        // functionality of \"resolve_icon_internal\" checks existence, but \"resolve_icon\" checks cache first.\n        let result = resolver.resolve_icon(path_str);\n        assert!(result.is_some());\n    }\n\n    #[test]\n    fn test_missing_icon_returns_none() {\n        let resolver = CachedIconResolver::new();\n        let result = resolver.resolve_icon(\"/non/existent/path/icon.png\");\n        assert!(result.is_none());\n    }\n}\n","traces":[{"line":10,"address":[44253520],"length":1,"stats":{"Line":1}},{"line":12,"address":[41915940],"length":1,"stats":{"Line":2}},{"line":16,"address":[41915351,41908590,41907488],"length":1,"stats":{"Line":1}},{"line":18,"address":[41907535],"length":1,"stats":{"Line":1}},{"line":19,"address":[41907688,41907595],"length":1,"stats":{"Line":3}},{"line":20,"address":[41907715],"length":1,"stats":{"Line":1}},{"line":21,"address":[44252994],"length":1,"stats":{"Line":1}},{"line":22,"address":[41915739,41915364],"length":1,"stats":{"Line":0}},{"line":24,"address":[41915768],"length":1,"stats":{"Line":1}},{"line":29,"address":[41907605,41907819],"length":1,"stats":{"Line":2}},{"line":30,"address":[44245454,44245604],"length":1,"stats":{"Line":0}},{"line":31,"address":[41908112,41908163],"length":1,"stats":{"Line":0}},{"line":32,"address":[41908234],"length":1,"stats":{"Line":0}},{"line":33,"address":[41908208,41908620],"length":1,"stats":{"Line":0}},{"line":35,"address":[41908747],"length":1,"stats":{"Line":0}},{"line":44,"address":[41907938],"length":1,"stats":{"Line":1}},{"line":47,"address":[41907955,41909175,41909127],"length":1,"stats":{"Line":3}},{"line":48,"address":[41909298,41909215],"length":1,"stats":{"Line":2}},{"line":49,"address":[41909632,41909505],"length":1,"stats":{"Line":2}},{"line":50,"address":[41909670],"length":1,"stats":{"Line":1}},{"line":51,"address":[41909745],"length":1,"stats":{"Line":1}},{"line":52,"address":[41909820],"length":1,"stats":{"Line":1}},{"line":53,"address":[41909895],"length":1,"stats":{"Line":1}},{"line":54,"address":[41909970],"length":1,"stats":{"Line":1}},{"line":55,"address":[41910045],"length":1,"stats":{"Line":1}},{"line":58,"address":[41909141,41910109],"length":1,"stats":{"Line":0}},{"line":61,"address":[41910136],"length":1,"stats":{"Line":0}},{"line":64,"address":[41910194],"length":1,"stats":{"Line":0}},{"line":67,"address":[41910252],"length":1,"stats":{"Line":0}},{"line":68,"address":[41910310],"length":1,"stats":{"Line":0}},{"line":72,"address":[41910392],"length":1,"stats":{"Line":1}},{"line":73,"address":[41910593,41910488],"length":1,"stats":{"Line":2}},{"line":74,"address":[41910660],"length":1,"stats":{"Line":1}},{"line":75,"address":[41910766],"length":1,"stats":{"Line":1}},{"line":76,"address":[41910872],"length":1,"stats":{"Line":1}},{"line":77,"address":[41910978],"length":1,"stats":{"Line":1}},{"line":81,"address":[41910511,41911098],"length":1,"stats":{"Line":2}},{"line":82,"address":[41911286,41911175],"length":1,"stats":{"Line":2}},{"line":83,"address":[41911353],"length":1,"stats":{"Line":1}},{"line":86,"address":[41911481,41911208],"length":1,"stats":{"Line":2}},{"line":88,"address":[44249355,44249260],"length":1,"stats":{"Line":2}},{"line":89,"address":[41913193,41911893],"length":1,"stats":{"Line":2}},{"line":94,"address":[41913231,41913347],"length":1,"stats":{"Line":2}},{"line":95,"address":[41913406],"length":1,"stats":{"Line":0}},{"line":97,"address":[41913501],"length":1,"stats":{"Line":0}},{"line":98,"address":[41913742,41913825],"length":1,"stats":{"Line":0}},{"line":99,"address":[44251470,44252752],"length":1,"stats":{"Line":0}},{"line":103,"address":[41913921,41913309],"length":1,"stats":{"Line":2}},{"line":104,"address":[44251621],"length":1,"stats":{"Line":1}},{"line":105,"address":[41914309,41914380],"length":1,"stats":{"Line":2}},{"line":106,"address":[44252011],"length":1,"stats":{"Line":0}},{"line":107,"address":[41914511],"length":1,"stats":{"Line":0}},{"line":108,"address":[41914491,41914869],"length":1,"stats":{"Line":0}},{"line":110,"address":[41914996],"length":1,"stats":{"Line":0}},{"line":116,"address":[41911919],"length":1,"stats":{"Line":1}},{"line":117,"address":[41912180,41912116],"length":1,"stats":{"Line":2}},{"line":118,"address":[41912186],"length":1,"stats":{"Line":1}},{"line":119,"address":[41912355,41912284,41912233],"length":1,"stats":{"Line":3}},{"line":120,"address":[41912522,41912418],"length":1,"stats":{"Line":0}},{"line":121,"address":[41912685,41912594],"length":1,"stats":{"Line":0}},{"line":127,"address":[44249728],"length":1,"stats":{"Line":1}},{"line":132,"address":[41906892,41906898,41906512],"length":1,"stats":{"Line":1}},{"line":134,"address":[44244080,44244139],"length":1,"stats":{"Line":3}},{"line":135,"address":[41906656,41906720],"length":1,"stats":{"Line":3}},{"line":136,"address":[41906788],"length":1,"stats":{"Line":1}},{"line":140,"address":[41906953],"length":1,"stats":{"Line":2}},{"line":143,"address":[41906963,41907026,41907070],"length":1,"stats":{"Line":3}},{"line":144,"address":[41907169,41907108,41907385,41907220],"length":1,"stats":{"Line":2}},{"line":147,"address":[41907445],"length":1,"stats":{"Line":2}}],"covered":48,"coverable":69},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","adapters","file_history.rs"],"content":"use crate::domain::action::Action;\nuse crate::ports::history::HistoryRepository;\nuse async_trait::async_trait;\nuse std::fs;\nuse std::path::PathBuf;\nuse std::sync::Mutex;\n\npub struct FileHistoryAdapter {\n    file_path: PathBuf,\n    cache: Mutex\u003cVec\u003cAction\u003e\u003e,\n}\n\nimpl FileHistoryAdapter {\n    pub fn new(app_data_dir: PathBuf) -\u003e Self {\n        let file_path = app_data_dir.join(\"history.json\");\n        let cache = if file_path.exists() {\n            if let Ok(content) = fs::read_to_string(\u0026file_path) {\n                serde_json::from_str(\u0026content).unwrap_or_else(|_| Vec::new())\n            } else {\n                Vec::new()\n            }\n        } else {\n            Vec::new()\n        };\n\n        Self {\n            file_path,\n            cache: Mutex::new(cache),\n        }\n    }\n\n    fn save(\u0026self) -\u003e Result\u003c(), String\u003e {\n        let cache = self.cache.lock().map_err(|e| e.to_string())?;\n        let content = serde_json::to_string_pretty(\u0026*cache).map_err(|e| e.to_string())?;\n        if let Some(parent) = self.file_path.parent() {\n            fs::create_dir_all(parent).map_err(|e| e.to_string())?;\n        }\n        fs::write(\u0026self.file_path, content).map_err(|e| e.to_string())?;\n        Ok(())\n    }\n}\n\n#[async_trait]\nimpl HistoryRepository for FileHistoryAdapter {\n    async fn get_recent(\u0026self, limit: usize) -\u003e Result\u003cVec\u003cAction\u003e, String\u003e {\n        let cache = self.cache.lock().map_err(|e| e.to_string())?;\n        let mut actions = cache.clone();\n\n        // Sort by last_accessed descending\n        actions.sort_by(|a, b| b.last_accessed.cmp(\u0026a.last_accessed));\n\n        Ok(actions.into_iter().take(limit).collect())\n    }\n\n    async fn record(\u0026self, mut new_action: Action) -\u003e Result\u003c(), String\u003e {\n        let mut cache = self.cache.lock().map_err(|e| e.to_string())?;\n\n        if let Some(existing) = cache.iter_mut().find(|a| a.id == new_action.id) {\n            existing.last_accessed = new_action.last_accessed;\n            existing.frequency += 1;\n            // Update other fields just in case they changed (dynamic titles etc)\n            existing.name = new_action.name;\n            existing.content = new_action.content;\n            if new_action.icon.is_some() {\n                existing.icon = new_action.icon;\n            }\n        } else {\n            new_action.frequency = 1;\n            cache.push(new_action);\n        }\n\n        // Limit total history size to avoid infinte growth\n        if cache.len() \u003e 100 {\n            // Remove least recently used or least frequent.\n            // For now simple LRU removal\n            cache.sort_by(|a, b| b.last_accessed.cmp(\u0026a.last_accessed));\n            cache.truncate(100);\n        }\n\n        drop(cache); // Release lock before saving which does I/O\n        self.save()\n    }\n\n    async fn clear(\u0026self) -\u003e Result\u003c(), String\u003e {\n        let mut cache = self.cache.lock().map_err(|e| e.to_string())?;\n        cache.clear();\n        drop(cache);\n        self.save()\n    }\n}\n","traces":[{"line":14,"address":[44199846,44200081,44199136],"length":1,"stats":{"Line":0}},{"line":15,"address":[43756458,43756382],"length":1,"stats":{"Line":0}},{"line":16,"address":[43756565,43756500],"length":1,"stats":{"Line":0}},{"line":17,"address":[43756713,43756765,43756598],"length":1,"stats":{"Line":0}},{"line":18,"address":[43756805,43756881],"length":1,"stats":{"Line":0}},{"line":20,"address":[44199852,44199542],"length":1,"stats":{"Line":0}},{"line":23,"address":[43756622,43756591],"length":1,"stats":{"Line":0}},{"line":28,"address":[43756658],"length":1,"stats":{"Line":0}},{"line":32,"address":[43758500,43757296,43758492],"length":1,"stats":{"Line":0}},{"line":33,"address":[43757326],"length":1,"stats":{"Line":0}},{"line":34,"address":[43757588,43758498,43757526],"length":1,"stats":{"Line":0}},{"line":35,"address":[43757866,43757798],"length":1,"stats":{"Line":0}},{"line":36,"address":[43773664,43773648],"length":1,"stats":{"Line":0}},{"line":38,"address":[43758243,43757997,43758426],"length":1,"stats":{"Line":0}},{"line":39,"address":[43758382],"length":1,"stats":{"Line":0}},{"line":45,"address":[43768654,43768716,43768416,43768454,43769467,43768780,43768527,43769433,43769456],"length":1,"stats":{"Line":0}},{"line":46,"address":[43769462,43769598,43768835,43768682,43769568],"length":1,"stats":{"Line":0}},{"line":47,"address":[43769093,43769020],"length":1,"stats":{"Line":0}},{"line":50,"address":[43769504,43769116,43769181,43769536],"length":1,"stats":{"Line":0}},{"line":52,"address":[41587163],"length":1,"stats":{"Line":0}},{"line":55,"address":[43772956,43773026,43772894,43770790,43770592,43771057,43771030,43772626,43770918,43772516,43772557,43772725,43770639],"length":1,"stats":{"Line":0}},{"line":56,"address":[41589118,41589027,41591376,41591401],"length":1,"stats":{"Line":0}},{"line":58,"address":[43771311,43771375,43773281,43773264],"length":1,"stats":{"Line":0}},{"line":59,"address":[43771544],"length":1,"stats":{"Line":0}},{"line":60,"address":[43771556,43771689,43771627],"length":1,"stats":{"Line":0}},{"line":62,"address":[43771714,43771634],"length":1,"stats":{"Line":0}},{"line":63,"address":[43771806,43771866],"length":1,"stats":{"Line":0}},{"line":64,"address":[41590006,41590235],"length":1,"stats":{"Line":0}},{"line":65,"address":[43772019,43772079],"length":1,"stats":{"Line":0}},{"line":68,"address":[43771582],"length":1,"stats":{"Line":0}},{"line":69,"address":[43772188,43771602],"length":1,"stats":{"Line":0}},{"line":73,"address":[43771999,43772282],"length":1,"stats":{"Line":0}},{"line":76,"address":[43772344,43773312,43773344],"length":1,"stats":{"Line":0}},{"line":77,"address":[43772403],"length":1,"stats":{"Line":0}},{"line":80,"address":[43772305],"length":1,"stats":{"Line":0}},{"line":81,"address":[41590537],"length":1,"stats":{"Line":0}},{"line":84,"address":[43756233],"length":1,"stats":{"Line":0}},{"line":85,"address":[43770069,43770510,43770480,43769920],"length":1,"stats":{"Line":0}},{"line":86,"address":[43770260,43770316],"length":1,"stats":{"Line":0}},{"line":87,"address":[43770323],"length":1,"stats":{"Line":0}},{"line":88,"address":[43770361],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":41},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","adapters","fs_app_repository.rs"],"content":"use crate::domain::apps::AppEntry;\nuse crate::ports::app_port::AppRepository;\nuse crate::ports::icon_port::IconResolver;\nuse freedesktop_desktop_entry::Iter;\nuse std::collections::HashSet;\nuse std::path::PathBuf;\nuse std::sync::Arc;\n\npub struct FsAppRepository {\n    icon_resolver: Arc\u003cdyn IconResolver\u003e,\n    custom_paths: Option\u003cVec\u003cPathBuf\u003e\u003e,\n}\n\nimpl FsAppRepository {\n    pub fn new(icon_resolver: Arc\u003cdyn IconResolver\u003e) -\u003e Self {\n        Self {\n            icon_resolver,\n            custom_paths: None,\n        }\n    }\n\n    #[cfg(test)]\n    pub fn new_with_paths(icon_resolver: Arc\u003cdyn IconResolver\u003e, paths: Vec\u003cPathBuf\u003e) -\u003e Self {\n        Self {\n            icon_resolver,\n            custom_paths: Some(paths),\n        }\n    }\n\n    fn parse_desktop_file(\u0026self, path: \u0026std::path::Path) -\u003e Option\u003cAppEntry\u003e {\n        let content = std::fs::read_to_string(path).ok()?;\n        let mut in_desktop_entry = false;\n        let mut name = None;\n        let mut exec = None;\n        let mut icon = None;\n        let mut no_display = false;\n\n        for line in content.lines() {\n            let line = line.trim();\n            if line.starts_with('[') \u0026\u0026 line.ends_with(']') {\n                in_desktop_entry = line == \"[Desktop Entry]\";\n                continue;\n            }\n\n            if in_desktop_entry {\n                if let Some(val) = line.strip_prefix(\"Name=\") {\n                    if name.is_none() {\n                        name = Some(val.to_string());\n                    }\n                } else if let Some(val) = line.strip_prefix(\"Exec=\") {\n                    if exec.is_none() {\n                        // Cleanup exec command (remove field codes)\n                        let clean_exec = val\n                            .replace(\"%f\", \"\")\n                            .replace(\"%F\", \"\")\n                            .replace(\"%u\", \"\")\n                            .replace(\"%U\", \"\")\n                            .replace(\"%i\", \"\")\n                            .replace(\"%c\", \"\")\n                            .replace(\"%k\", \"\")\n                            .trim()\n                            .to_string();\n                        exec = Some(clean_exec);\n                    }\n                } else if let Some(val) = line.strip_prefix(\"Icon=\") {\n                    if icon.is_none() {\n                        icon = Some(val.to_string());\n                    }\n                } else if let Some(val) = line.strip_prefix(\"NoDisplay=\") {\n                    if val.to_lowercase() == \"true\" {\n                        no_display = true;\n                    }\n                }\n            }\n        }\n\n        if !no_display {\n            if let (Some(name), Some(exec)) = (name, exec) {\n                // Check if icon resolves\n                // If icon is None, maybe we can try to guess from name or use default?\n                // lib.rs logic: icon.and_then(|i| resolve_icon(\u0026i))\n                let icon_path = if let Some(i) = icon {\n                    self.icon_resolver.resolve_icon(\u0026i)\n                } else {\n                    None\n                };\n\n                return Some(AppEntry {\n                    name,\n                    exec,\n                    icon: icon_path.filter(|i| !i.is_empty()),\n                });\n            }\n        }\n        None\n    }\n}\n\nimpl AppRepository for FsAppRepository {\n    fn list_apps(\u0026self) -\u003e Result\u003cVec\u003cAppEntry\u003e, String\u003e {\n        let mut apps = Vec::new();\n        let mut seen_ids = HashSet::new();\n\n        // Construct search paths\n        // Construct search paths\n        let mut search_paths = Vec::new();\n\n        if let Some(ref custom) = self.custom_paths {\n            search_paths.extend(custom.clone());\n        } else {\n            if let Ok(dirs) = std::env::var(\"XDG_DATA_DIRS\") {\n                for dir in dirs.split(':') {\n                    search_paths.push(PathBuf::from(dir).join(\"applications\"));\n                }\n            } else {\n                search_paths.push(PathBuf::from(\"/usr/share/applications\"));\n                search_paths.push(PathBuf::from(\"/usr/local/share/applications\"));\n            }\n            if let Some(home) = dirs::data_local_dir() {\n                search_paths.push(home.join(\"applications\"));\n            }\n        }\n\n        // Iterate over paths using the crate's iterator\n        for path in Iter::new(search_paths.clone().into_iter()) {\n            if let Some(app) = self.parse_desktop_file(\u0026path) {\n                let id = app.name.clone();\n                if !seen_ids.contains(\u0026id) {\n                    apps.push(app);\n                    seen_ids.insert(id);\n                }\n            }\n        }\n\n        // 2. Scan Flatpak Exports explicitly if available (SKIP IF TESTING)\n        let mut flatpak_paths = Vec::new();\n        if self.custom_paths.is_none() {\n            flatpak_paths.push(PathBuf::from(\"/var/lib/flatpak/exports/share/applications\"));\n            flatpak_paths.push(\n                dirs::data_local_dir()\n                    .map(|d| d.join(\"flatpak/exports/share/applications\"))\n                    .unwrap_or_default(),\n            );\n        }\n\n        for path in Iter::new(flatpak_paths.into_iter()) {\n            if let Some(app) = self.parse_desktop_file(\u0026path) {\n                let id = app.name.clone();\n                if !seen_ids.contains(\u0026id) {\n                    apps.push(app);\n                    seen_ids.insert(id);\n                }\n            }\n        }\n\n        // 3. Scan AppImages\n        if let Some(home) = dirs::home_dir() {\n            let applications_dir = home.join(\"Applications\");\n            if applications_dir.exists() \u0026\u0026 self.custom_paths.is_none() {\n                let glob_pattern = applications_dir.join(\"*.AppImage\");\n                if let Ok(glob_paths) = glob::glob(\u0026glob_pattern.to_string_lossy()) {\n                    for entry in glob_paths.filter_map(|e| e.ok()) {\n                        let name = entry\n                            .file_stem()\n                            .unwrap_or_default()\n                            .to_string_lossy()\n                            .to_string();\n                        if name.is_empty() {\n                            continue;\n                        }\n                        if seen_ids.contains(\u0026name) {\n                            continue;\n                        }\n\n                        let icon = self.icon_resolver.resolve_icon(\u0026name).or_else(|| {\n                            self.icon_resolver.resolve_icon(\"application-x-executable\")\n                        });\n\n                        apps.push(AppEntry {\n                            name: name.clone(),\n                            exec: entry.to_string_lossy().to_string(),\n                            icon,\n                        });\n                        seen_ids.insert(name);\n                    }\n                }\n            }\n        }\n\n        Ok(apps)\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::ports::icon_port::IconResolver;\n    use std::fs::File;\n    use std::io::Write;\n    use tempfile::tempdir;\n\n    struct MockIconResolver;\n    impl IconResolver for MockIconResolver {\n        fn resolve_icon(\u0026self, _icon_name: \u0026str) -\u003e Option\u003cString\u003e {\n            Some(\"/tmp/icon.png\".to_string())\n        }\n    }\n\n    #[test]\n    fn test_list_apps_finds_desktop_entry() {\n        let dir = tempdir().unwrap();\n        let apps_dir = dir.path().join(\"applications\");\n        std::fs::create_dir(\u0026apps_dir).unwrap();\n\n        let desktop_file_path = apps_dir.join(\"test-app.desktop\");\n        let mut file = File::create(desktop_file_path).unwrap();\n        writeln!(\n            file,\n            \"[Desktop Entry]\\nName=Test App\\nExec=test-exec %f\\nIcon=test-icon\\nType=Application\"\n        )\n        .unwrap();\n\n        let resolver = Arc::new(MockIconResolver);\n        let repo = FsAppRepository::new_with_paths(resolver, vec![apps_dir]);\n\n        let apps = repo.list_apps().unwrap();\n\n        // Assertions\n        assert_eq!(apps.len(), 1);\n        assert_eq!(apps[0].name, \"Test App\");\n        assert_eq!(apps[0].exec, \"test-exec\");\n        assert_eq!(apps[0].icon, Some(\"/tmp/icon.png\".to_string()));\n    }\n\n    #[test]\n    fn test_list_apps_ignores_no_display() {\n        let dir = tempdir().unwrap();\n        let apps_dir = dir.path().join(\"applications\");\n        std::fs::create_dir(\u0026apps_dir).unwrap();\n\n        let desktop_file_path = apps_dir.join(\"hidden-app.desktop\");\n        let mut file = File::create(desktop_file_path).unwrap();\n        writeln!(\n            file,\n            \"[Desktop Entry]\\nName=Hidden App\\nExec=hidden\\nNoDisplay=true\"\n        )\n        .unwrap();\n\n        let resolver = Arc::new(MockIconResolver);\n        let repo = FsAppRepository::new_with_paths(resolver, vec![apps_dir]);\n\n        let apps = repo.list_apps().unwrap();\n\n        assert!(apps.is_empty());\n    }\n}\n","traces":[{"line":15,"address":[43869568],"length":1,"stats":{"Line":0}},{"line":23,"address":[40731872],"length":1,"stats":{"Line":2}},{"line":26,"address":[40731885],"length":1,"stats":{"Line":2}},{"line":30,"address":[40737882,40731952,40733709],"length":1,"stats":{"Line":1}},{"line":31,"address":[40732045],"length":1,"stats":{"Line":1}},{"line":32,"address":[40732286],"length":1,"stats":{"Line":1}},{"line":33,"address":[40732294],"length":1,"stats":{"Line":1}},{"line":34,"address":[40732320],"length":1,"stats":{"Line":1}},{"line":35,"address":[40732336],"length":1,"stats":{"Line":1}},{"line":36,"address":[40732352],"length":1,"stats":{"Line":2}},{"line":38,"address":[40732368,40732481],"length":1,"stats":{"Line":4}},{"line":39,"address":[40734548,40732667],"length":1,"stats":{"Line":4}},{"line":40,"address":[40734631,40734564],"length":1,"stats":{"Line":4}},{"line":41,"address":[40737788,40734683],"length":1,"stats":{"Line":2}},{"line":45,"address":[40734616],"length":1,"stats":{"Line":1}},{"line":46,"address":[40734719],"length":1,"stats":{"Line":1}},{"line":47,"address":[43866649,43866558,43866883],"length":1,"stats":{"Line":3}},{"line":48,"address":[40735071,40735001],"length":1,"stats":{"Line":1}},{"line":50,"address":[40735231,40734911],"length":1,"stats":{"Line":2}},{"line":51,"address":[40735326,40735417,40737091],"length":1,"stats":{"Line":3}},{"line":53,"address":[43867588,43867727,43867854,43867449,43867171,43867310,43867981],"length":1,"stats":{"Line":7}},{"line":63,"address":[43868617,43868526],"length":1,"stats":{"Line":1}},{"line":65,"address":[40735352,40737134],"length":1,"stats":{"Line":2}},{"line":66,"address":[43869203,43868975,43868896],"length":1,"stats":{"Line":3}},{"line":67,"address":[40737321,40737391],"length":1,"stats":{"Line":1}},{"line":69,"address":[40737246,40737545],"length":1,"stats":{"Line":2}},{"line":70,"address":[40737776,40737628],"length":1,"stats":{"Line":2}},{"line":71,"address":[40737768],"length":1,"stats":{"Line":1}},{"line":77,"address":[40732693,40734285],"length":1,"stats":{"Line":1}},{"line":78,"address":[40733013,40732707,40733096],"length":1,"stats":{"Line":3}},{"line":82,"address":[40733354,40733224],"length":1,"stats":{"Line":1}},{"line":83,"address":[40733443,40733309],"length":1,"stats":{"Line":2}},{"line":85,"address":[40733336],"length":1,"stats":{"Line":0}},{"line":88,"address":[40733767],"length":1,"stats":{"Line":1}},{"line":89,"address":[43865243],"length":1,"stats":{"Line":1}},{"line":90,"address":[40733614],"length":1,"stats":{"Line":1}},{"line":91,"address":[41214912,41214921],"length":1,"stats":{"Line":3}},{"line":95,"address":[40732988],"length":1,"stats":{"Line":1}},{"line":100,"address":[40731842,40726666,40725568],"length":1,"stats":{"Line":2}},{"line":101,"address":[40725607],"length":1,"stats":{"Line":2}},{"line":102,"address":[43857312],"length":1,"stats":{"Line":2}},{"line":106,"address":[43857372],"length":1,"stats":{"Line":2}},{"line":108,"address":[40725816],"length":1,"stats":{"Line":1}},{"line":109,"address":[43857582,43857488],"length":1,"stats":{"Line":2}},{"line":111,"address":[43857641,43857689,43857507],"length":1,"stats":{"Line":0}},{"line":112,"address":[43857729,43857812],"length":1,"stats":{"Line":0}},{"line":113,"address":[43858130,43858019],"length":1,"stats":{"Line":0}},{"line":116,"address":[40726672,40726027],"length":1,"stats":{"Line":0}},{"line":117,"address":[43858327],"length":1,"stats":{"Line":0}},{"line":119,"address":[40726781],"length":1,"stats":{"Line":0}},{"line":120,"address":[43858509,43858592],"length":1,"stats":{"Line":0}},{"line":125,"address":[40727215,40725983,40727045],"length":1,"stats":{"Line":3}},{"line":126,"address":[40727292,40731216,40731760],"length":1,"stats":{"Line":3}},{"line":127,"address":[40731438,40731348],"length":1,"stats":{"Line":2}},{"line":128,"address":[40731515,40731462],"length":1,"stats":{"Line":2}},{"line":129,"address":[40731521],"length":1,"stats":{"Line":1}},{"line":130,"address":[43863368],"length":1,"stats":{"Line":1}},{"line":136,"address":[40727337],"length":1,"stats":{"Line":1}},{"line":137,"address":[40727364,40727434],"length":1,"stats":{"Line":2}},{"line":138,"address":[43859150],"length":1,"stats":{"Line":0}},{"line":139,"address":[40727633],"length":1,"stats":{"Line":0}},{"line":140,"address":[40727568],"length":1,"stats":{"Line":0}},{"line":141,"address":[40727603],"length":1,"stats":{"Line":0}},{"line":142,"address":[43859254],"length":1,"stats":{"Line":0}},{"line":146,"address":[43859313,43859080,43859464],"length":1,"stats":{"Line":3}},{"line":147,"address":[43862214,43859541,43862766],"length":1,"stats":{"Line":0}},{"line":148,"address":[40730736,40730646],"length":1,"stats":{"Line":0}},{"line":149,"address":[40730813,40730760],"length":1,"stats":{"Line":0}},{"line":150,"address":[40730819],"length":1,"stats":{"Line":0}},{"line":151,"address":[43862650],"length":1,"stats":{"Line":0}},{"line":157,"address":[40727930],"length":1,"stats":{"Line":1}},{"line":158,"address":[40728026,40728221],"length":1,"stats":{"Line":2}},{"line":159,"address":[40728401,40728344,40728261],"length":1,"stats":{"Line":4}},{"line":160,"address":[43860096],"length":1,"stats":{"Line":0}},{"line":161,"address":[40728515,40728606,40728708,40728786],"length":1,"stats":{"Line":0}},{"line":162,"address":[41212928,41212956],"length":1,"stats":{"Line":0}},{"line":163,"address":[40729138],"length":1,"stats":{"Line":0}},{"line":168,"address":[40729447],"length":1,"stats":{"Line":0}},{"line":171,"address":[40729521,40729484],"length":1,"stats":{"Line":0}},{"line":175,"address":[43861223],"length":1,"stats":{"Line":0}},{"line":176,"address":[41212880],"length":1,"stats":{"Line":0}},{"line":179,"address":[40729946],"length":1,"stats":{"Line":0}},{"line":180,"address":[40729676],"length":1,"stats":{"Line":0}},{"line":181,"address":[40729752,40729828],"length":1,"stats":{"Line":0}},{"line":182,"address":[40729906],"length":1,"stats":{"Line":0}},{"line":184,"address":[40730128],"length":1,"stats":{"Line":0}},{"line":190,"address":[40728060],"length":1,"stats":{"Line":2}}],"covered":55,"coverable":87},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","adapters","fs_config_service.rs"],"content":"use crate::domain::config::AppConfig;\nuse crate::ports::config_port::ConfigService;\nuse std::fs;\nuse std::path::PathBuf;\n\npub struct FsConfigService {\n    custom_root: Option\u003cPathBuf\u003e,\n}\n\nimpl FsConfigService {\n    pub fn new() -\u003e Self {\n        Self { custom_root: None }\n    }\n\n    #[cfg(test)]\n    pub fn new_with_root(root: PathBuf) -\u003e Self {\n        Self {\n            custom_root: Some(root),\n        }\n    }\n}\n\nimpl ConfigService for FsConfigService {\n    fn get_config_dir(\u0026self) -\u003e Option\u003cPathBuf\u003e {\n        if let Some(ref root) = self.custom_root {\n            return Some(root.clone());\n        }\n        dirs::config_dir().map(|p| p.join(\"stratos-bar\"))\n    }\n\n    fn load_config(\u0026self) -\u003e AppConfig {\n        let mut config = if let Some(config_dir) = self.get_config_dir() {\n            let config_path = config_dir.join(\"config.json\");\n            if config_path.exists() {\n                if let Ok(content) = fs::read_to_string(config_path) {\n                    serde_json::from_str(\u0026content).unwrap_or_default()\n                } else {\n                    AppConfig::default()\n                }\n            } else {\n                AppConfig::default()\n            }\n        } else {\n            AppConfig::default()\n        };\n\n        // Set Defaults if empty\n        config.apply_defaults();\n\n        config\n    }\n\n    fn save_config(\u0026self, config: \u0026AppConfig) -\u003e Result\u003c(), String\u003e {\n        if let Some(config_dir) = self.get_config_dir() {\n            if !config_dir.exists() {\n                fs::create_dir_all(\u0026config_dir).map_err(|e| e.to_string())?;\n            }\n            let config_path = config_dir.join(\"config.json\");\n            let content = serde_json::to_string_pretty(config).map_err(|e| e.to_string())?;\n            fs::write(config_path, content).map_err(|e| e.to_string())?;\n            Ok(())\n        } else {\n            Err(\"Could not find config directory\".to_string())\n        }\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use tempfile::tempdir;\n\n    #[test]\n    fn test_save_and_load_config() {\n        let dir = tempdir().unwrap();\n        let service = FsConfigService::new_with_root(dir.path().to_path_buf());\n\n        let mut config = AppConfig::default();\n        config.preferred_model = \"test_model\".to_string();\n\n        // Save\n        service.save_config(\u0026config).expect(\"Failed to save config\");\n\n        // Load\n        let loaded_config = service.load_config();\n        assert_eq!(loaded_config.preferred_model, \"test_model\");\n    }\n\n    #[test]\n    fn test_load_defaults_if_missing() {\n        let dir = tempdir().unwrap();\n        let service = FsConfigService::new_with_root(dir.path().to_path_buf());\n\n        let config = service.load_config();\n        // Should have defaults applied\n        assert_eq!(config.preferred_model, \"local\");\n    }\n}\n","traces":[{"line":11,"address":[44771568],"length":1,"stats":{"Line":0}},{"line":16,"address":[45374240],"length":1,"stats":{"Line":2}},{"line":18,"address":[45374243],"length":1,"stats":{"Line":2}},{"line":24,"address":[45374096],"length":1,"stats":{"Line":2}},{"line":25,"address":[45374119],"length":1,"stats":{"Line":1}},{"line":26,"address":[44771488],"length":1,"stats":{"Line":1}},{"line":28,"address":[44771531],"length":1,"stats":{"Line":0}},{"line":31,"address":[45372604,45371840,45372733],"length":1,"stats":{"Line":1}},{"line":32,"address":[45371865],"length":1,"stats":{"Line":1}},{"line":33,"address":[45372049,45371963],"length":1,"stats":{"Line":2}},{"line":34,"address":[45372165,45372097],"length":1,"stats":{"Line":2}},{"line":35,"address":[45372334,45372282,45372198],"length":1,"stats":{"Line":3}},{"line":36,"address":[45372450,45372374],"length":1,"stats":{"Line":2}},{"line":38,"address":[45372324,45372610],"length":1,"stats":{"Line":0}},{"line":41,"address":[45372261,45372191],"length":1,"stats":{"Line":2}},{"line":44,"address":[45371980],"length":1,"stats":{"Line":0}},{"line":48,"address":[44769954],"length":1,"stats":{"Line":1}},{"line":50,"address":[45372785],"length":1,"stats":{"Line":1}},{"line":53,"address":[45372816,45374020,45374082],"length":1,"stats":{"Line":1}},{"line":54,"address":[45372854],"length":1,"stats":{"Line":1}},{"line":55,"address":[45372942,45373081],"length":1,"stats":{"Line":2}},{"line":56,"address":[40056528,40056512],"length":1,"stats":{"Line":0}},{"line":58,"address":[45373323,45373128],"length":1,"stats":{"Line":2}},{"line":59,"address":[40056304,40056288],"length":1,"stats":{"Line":2}},{"line":60,"address":[40056400,40056416],"length":1,"stats":{"Line":2}},{"line":61,"address":[45373923],"length":1,"stats":{"Line":1}},{"line":63,"address":[45372959],"length":1,"stats":{"Line":0}}],"covered":21,"coverable":27},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","adapters","google_translation_service.rs"],"content":"use crate::domain::translation::{TranslationRequest, TranslationResult};\nuse crate::ports::translation_port::TranslationService;\nuse async_trait::async_trait;\nuse reqwest::Client;\nuse serde_json::Value;\nuse std::error::Error;\n\npub struct GoogleTranslationService {\n    client: Client,\n    base_url: String,\n}\n\nimpl GoogleTranslationService {\n    pub fn new(base_url: Option\u003cString\u003e) -\u003e Self {\n        Self {\n            client: Client::new(),\n            base_url: base_url.unwrap_or_else(|| {\n                \"https://translate.googleapis.com/translate_a/single\".to_string()\n            }),\n        }\n    }\n}\n\n#[async_trait]\nimpl TranslationService for GoogleTranslationService {\n    async fn translate(\n        \u0026self,\n        request: TranslationRequest,\n    ) -\u003e Result\u003cTranslationResult, Box\u003cdyn Error + Send + Sync\u003e\u003e {\n        let source_lang = request.source_lang.unwrap_or_else(|| \"auto\".to_string());\n        let target_lang = request.target_lang; // e.g. \"en\"\n\n        // client=gtx \u0026 sl=auto \u0026 tl=en \u0026 dt=t \u0026 q=...\n        let res = self\n            .client\n            .get(\u0026self.base_url)\n            .query(\u0026[\n                (\"client\", \"gtx\"),\n                (\"sl\", \u0026source_lang),\n                (\"tl\", \u0026target_lang),\n                (\"dt\", \"t\"),\n                (\"q\", \u0026request.text),\n            ])\n            .send()\n            .await?\n            .json::\u003cValue\u003e()\n            .await?;\n\n        // Parse logic:\n        // Response is roughly: [[[\"Target\", \"Source\", null, null, ...]], null, \"detected_lang\", ...]\n\n        let translated_text = res\n            .get(0)\n            .and_then(|v| v.as_array())\n            .and_then(|arr| {\n                // Iterate over all segments (for multi-sentence input)\n                let mut full_translation = String::new();\n                for segment in arr {\n                    if let Some(text) = segment.get(0).and_then(|s| s.as_str()) {\n                        full_translation.push_str(text);\n                    }\n                }\n                if full_translation.is_empty() {\n                    None\n                } else {\n                    Some(full_translation)\n                }\n            })\n            .ok_or(\"Failed to parse translation from response\")?;\n\n        let detected_source = res\n            .get(2)\n            .and_then(|v| v.as_str())\n            .unwrap_or(\u0026source_lang)\n            .to_string();\n\n        Ok(TranslationResult {\n            original_text: request.text,\n            translated_text,\n            source_language: detected_source,\n            target_language: target_lang,\n        })\n    }\n}\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use wiremock::matchers::{method, path, query_param};\n    use wiremock::{Mock, MockServer, ResponseTemplate};\n\n    #[tokio::test]\n    async fn test_translate_success() {\n        let mock_server = MockServer::start().await;\n\n        // Simplified Google Translate API response\n        // [[[\"Hola\",\"Hello\",null,null,10]],null,\"en\",...]\n        let response_body = serde_json::json!([[[\"Hola\", \"Hello\", null, null, 10]], null, \"en\"]);\n\n        Mock::given(method(\"GET\"))\n            .and(path(\"/translate_a/single\"))\n            .and(query_param(\"sl\", \"auto\"))\n            .and(query_param(\"tl\", \"es\"))\n            .and(query_param(\"q\", \"Hello\"))\n            .respond_with(ResponseTemplate::new(200).set_body_json(response_body))\n            .mount(\u0026mock_server)\n            .await;\n\n        // Use the mock server URI as base_url\n        // Note: mock_server.uri() returns \"http://127.0.0.1:xxx\".\n        // Our service appends \"?...\" to it.\n        // However, the service code does: let url = format!(\"{}/translate_a/single\", self.base_url); NO\n        // The service code does: client.get(\u0026self.base_url)\n        // So we need to pass the FULL path in the base_url or change the service logic to append path.\n        // Currently service logic: client.get(\u0026self.base_url)\n        // And default base_url is \"https://translate.googleapis.com/translate_a/single\"\n        // So for the mock, we should pass \"http://127.0.0.1:xxx/translate_a/single\"\n\n        let mut base_url = mock_server.uri();\n        base_url.push_str(\"/translate_a/single\");\n\n        let service = GoogleTranslationService::new(Some(base_url));\n\n        let result = service\n            .translate(TranslationRequest {\n                text: \"Hello\".to_string(),\n                source_lang: None,\n                target_lang: \"es\".to_string(),\n            })\n            .await\n            .unwrap();\n\n        assert_eq!(result.translated_text, \"Hola\");\n        assert_eq!(result.source_language, \"en\");\n        assert_eq!(result.target_language, \"es\");\n    }\n}\n","traces":[{"line":13,"address":[44343440],"length":1,"stats":{"Line":0}},{"line":15,"address":[44343441],"length":1,"stats":{"Line":0}},{"line":22,"address":[43512626,43512641,43512591],"length":1,"stats":{"Line":0}},{"line":26,"address":[44397264,44393669,44397276],"length":1,"stats":{"Line":0}},{"line":27,"address":[44393818],"length":1,"stats":{"Line":0}},{"line":29,"address":[44393278],"length":1,"stats":{"Line":0}},{"line":32,"address":[44395372,44395086,44395320,44395565,44394750,44396809,44395202,44395627,44395122,44394605,44395677],"length":1,"stats":{"Line":0}},{"line":34,"address":[44393854,44393924],"length":1,"stats":{"Line":0}},{"line":35,"address":[44394445,44394629],"length":1,"stats":{"Line":0}},{"line":36,"address":[44393932],"length":1,"stats":{"Line":0}},{"line":37,"address":[44393986,44394084],"length":1,"stats":{"Line":0}},{"line":38,"address":[44394127,44394225],"length":1,"stats":{"Line":0}},{"line":39,"address":[44394268],"length":1,"stats":{"Line":0}},{"line":40,"address":[44394402,44394322],"length":1,"stats":{"Line":0}},{"line":43,"address":[44395096,44394903,44394783,44393484,44394735,44395187],"length":1,"stats":{"Line":0}},{"line":45,"address":[43512393,43512286,43512358,43512425,43512705],"length":1,"stats":{"Line":0}},{"line":50,"address":[39342894,39342990],"length":1,"stats":{"Line":0}},{"line":52,"address":[44397232,44395839,44397241],"length":1,"stats":{"Line":0}},{"line":53,"address":[39344870,39344304,39342836,39344864],"length":1,"stats":{"Line":0}},{"line":55,"address":[44397342],"length":1,"stats":{"Line":0}},{"line":56,"address":[39344365,39344437],"length":1,"stats":{"Line":0}},{"line":57,"address":[44397737,44397540,44397888,44397897],"length":1,"stats":{"Line":0}},{"line":58,"address":[39344852],"length":1,"stats":{"Line":0}},{"line":61,"address":[44397668,44397560],"length":1,"stats":{"Line":0}},{"line":62,"address":[39344671],"length":1,"stats":{"Line":0}},{"line":64,"address":[44397586],"length":1,"stats":{"Line":0}},{"line":71,"address":[44397200,44397209,44396161],"length":1,"stats":{"Line":0}},{"line":72,"address":[44396206],"length":1,"stats":{"Line":0}},{"line":75,"address":[44396406],"length":1,"stats":{"Line":0}},{"line":76,"address":[44396306],"length":1,"stats":{"Line":0}},{"line":77,"address":[44396337],"length":1,"stats":{"Line":0}},{"line":79,"address":[44396369],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":32},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","adapters","http_ai_service.rs"],"content":"use crate::domain::ai::Message;\nuse crate::domain::config::AppConfig;\nuse crate::ports::ai_port::AiService;\nuse futures_util::stream::BoxStream;\nuse futures_util::StreamExt;\nuse reqwest::Client;\nuse serde_json::json;\n\npub struct HttpAiService {\n    client: Client,\n    openai_base_url: String,\n}\n\nimpl HttpAiService {\n    pub fn new() -\u003e Self {\n        Self {\n            client: Client::new(),\n            openai_base_url: \"https://api.openai.com/v1\".to_string(),\n        }\n    }\n\n    #[cfg(test)]\n    pub fn new_with_url(openai_url: String) -\u003e Self {\n        Self {\n            client: Client::new(),\n            openai_base_url: openai_url,\n        }\n    }\n}\n\n#[async_trait::async_trait]\nimpl AiService for HttpAiService {\n    async fn stream_completion\u003c'a\u003e(\n        \u0026'a self,\n        config: \u0026'a AppConfig,\n        messages: Vec\u003cMessage\u003e,\n    ) -\u003e Result\u003cBoxStream\u003c'a, Result\u003cString, String\u003e\u003e, String\u003e {\n        if config.preferred_model == \"local\" {\n            // Ollama\n            let url = format!(\n                \"{}/api/chat\",\n                config\n                    .local_model_url\n                    .as_deref()\n                    .unwrap_or(\"http://127.0.0.1:11434\")\n            );\n\n            let res = self\n                .client\n                .post(url)\n                .json(\u0026json!({\n                    \"model\": config.ollama_model.as_deref().unwrap_or(\"llama3\"),\n                    \"messages\": messages,\n                    \"stream\": true\n                }))\n                .send()\n                .await\n                .map_err(|e| e.to_string())?;\n\n            let stream = res.bytes_stream().map(|item| match item {\n                Ok(chunk) =\u003e {\n                    let chunk_str = String::from_utf8_lossy(\u0026chunk);\n                    let mut content = String::new();\n                    for line in chunk_str.lines() {\n                        if line.trim().is_empty() {\n                            continue;\n                        }\n                        if let Ok(val) = serde_json::from_str::\u003cserde_json::Value\u003e(line) {\n                            if let Some(c) = val[\"message\"][\"content\"].as_str() {\n                                content.push_str(c);\n                            }\n                        }\n                    }\n                    Ok(content)\n                }\n                Err(e) =\u003e Err(e.to_string()),\n            });\n\n            // Filter empty contents? Actually the map above aggregates per chunk, but might return empty strings if chunk had no content.\n            // Using Box::pin to create BoxStream\n            Ok(Box::pin(stream))\n        } else {\n            // OpenAI\n            if let Some(key) = \u0026config.openai_api_key {\n                let url = format!(\"{}/chat/completions\", self.openai_base_url);\n                let res = self\n                    .client\n                    .post(\u0026url)\n                    .header(\"Authorization\", format!(\"Bearer {}\", key))\n                    .json(\u0026json!({\n                        \"model\": \"gpt-4o\",\n                        \"messages\": messages,\n                        \"stream\": true\n                    }))\n                    .send()\n                    .await\n                    .map_err(|e| e.to_string())?;\n\n                let stream = res.bytes_stream().map(|item| match item {\n                    Ok(chunk) =\u003e {\n                        let chunk_str = String::from_utf8_lossy(\u0026chunk);\n                        let mut content = String::new();\n                        for line in chunk_str.lines() {\n                            let line = line.trim();\n                            if line.starts_with(\"data: \") {\n                                let data = \u0026line[6..];\n                                if data == \"[DONE]\" {\n                                    break;\n                                }\n                                if let Ok(val) = serde_json::from_str::\u003cserde_json::Value\u003e(data) {\n                                    if let Some(c) = val[\"choices\"][0][\"delta\"][\"content\"].as_str()\n                                    {\n                                        content.push_str(c);\n                                    }\n                                }\n                            }\n                        }\n                        Ok(content)\n                    }\n                    Err(e) =\u003e Err(e.to_string()),\n                });\n\n                Ok(Box::pin(stream))\n            } else {\n                Err(\"No OpenAI API Key configured\".to_string())\n            }\n        }\n    }\n\n    async fn check_connection(\u0026self, config: \u0026AppConfig) -\u003e Result\u003cString, String\u003e {\n        let start = std::time::Instant::now();\n\n        if config.preferred_model == \"local\" {\n            let url = format!(\n                \"{}/api/tags\",\n                config\n                    .local_model_url\n                    .as_deref()\n                    .unwrap_or(\"http://127.0.0.1:11434\")\n            );\n\n            let res = self\n                .client\n                .get(\u0026url)\n                .timeout(std::time::Duration::from_secs(2))\n                .send()\n                .await;\n\n            match res {\n                Ok(response) =\u003e {\n                    if response.status().is_success() {\n                        let duration = start.elapsed();\n                        Ok(format!(\"Connected to Ollama ({:?})\", duration))\n                    } else {\n                        Err(format!(\"Ollama returned error: {}\", response.status()))\n                    }\n                }\n                Err(e) =\u003e Err(format!(\"Failed to connect to Ollama: {}\", e)),\n            }\n        } else {\n            if let Some(key) = \u0026config.openai_api_key {\n                let url = format!(\"{}/models\", self.openai_base_url);\n                let res = self\n                    .client\n                    .get(\u0026url)\n                    .header(\"Authorization\", format!(\"Bearer {}\", key))\n                    .timeout(std::time::Duration::from_secs(5))\n                    .send()\n                    .await;\n\n                match res {\n                    Ok(response) =\u003e {\n                        if response.status().is_success() {\n                            let duration = start.elapsed();\n                            Ok(format!(\"Connected to OpenAI ({:?})\", duration))\n                        } else {\n                            Err(format!(\"OpenAI returned error: {}\", response.status()))\n                        }\n                    }\n                    Err(e) =\u003e Err(format!(\"Failed to connect to OpenAI: {}\", e)),\n                }\n            } else {\n                Err(\"No OpenAI API Key configured\".to_string())\n            }\n        }\n    }\n\n    async fn list_models(\u0026self, config: \u0026AppConfig) -\u003e Result\u003cVec\u003cString\u003e, String\u003e {\n        let url = format!(\n            \"{}/api/tags\",\n            config\n                .local_model_url\n                .as_deref()\n                .unwrap_or(\"http://127.0.0.1:11434\")\n        );\n\n        let res = self\n            .client\n            .get(url)\n            .send()\n            .await\n            .map_err(|e| e.to_string())?;\n        let body: serde_json::Value = res.json().await.map_err(|e| e.to_string())?;\n\n        if let Some(models) = body[\"models\"].as_array() {\n            let names = models\n                .iter()\n                .filter_map(|m| m[\"name\"].as_str().map(|s| s.to_string()))\n                .collect();\n            Ok(names)\n        } else {\n            Ok(vec![])\n        }\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use wiremock::matchers::{method, path};\n    use wiremock::{Mock, MockServer, ResponseTemplate};\n\n    #[tokio::test]\n    async fn test_local_ollama_completion() {\n        let mock_server = MockServer::start().await;\n        let service = HttpAiService::new();\n\n        let response_body = json!({\n            \"message\": {\n                \"content\": \"Hello world\"\n            },\n            \"done\": false\n        });\n\n        // Mock the ollama chat endpoint\n        Mock::given(method(\"POST\"))\n            .and(path(\"/api/chat\"))\n            .respond_with(ResponseTemplate::new(200).set_body_json(response_body))\n            .mount(\u0026mock_server)\n            .await;\n\n        let mut config = AppConfig::default();\n        config.preferred_model = \"local\".to_string();\n        config.local_model_url = Some(mock_server.uri());\n\n        let stream = service.stream_completion(\u0026config, vec![]).await.unwrap();\n        let result: Vec\u003cString\u003e = stream\n            .collect::\u003cVec\u003c_\u003e\u003e()\n            .await\n            .into_iter()\n            .map(|r| r.unwrap())\n            .collect();\n\n        assert!(!result.is_empty());\n        assert_eq!(result.concat(), \"Hello world\");\n    }\n\n    #[tokio::test]\n    async fn test_openai_completion() {\n        let mock_server = MockServer::start().await;\n        let service = HttpAiService::new_with_url(mock_server.uri());\n\n        // Mock OpenAI style stream response\n        let chunk = json!({\n            \"choices\": [{\n                \"delta\": {\n                    \"content\": \"Hello OpenAI\"\n                }\n            }]\n        });\n        let body = format!(\n            \"data: {}\\n\\ndata: [DONE]\",\n            serde_json::to_string(\u0026chunk).unwrap()\n        );\n\n        Mock::given(method(\"POST\"))\n            .and(path(\"/chat/completions\"))\n            .respond_with(ResponseTemplate::new(200).set_body_string(body))\n            .mount(\u0026mock_server)\n            .await;\n\n        let mut config = AppConfig::default();\n        config.preferred_model = \"cloud\".to_string();\n        config.openai_api_key = Some(\"test-key\".to_string());\n\n        let stream = service.stream_completion(\u0026config, vec![]).await.unwrap();\n        let result: Vec\u003cString\u003e = stream\n            .collect::\u003cVec\u003c_\u003e\u003e()\n            .await\n            .into_iter()\n            .map(|r| r.unwrap())\n            .collect();\n\n        assert_eq!(result.concat(), \"Hello OpenAI\");\n    }\n}\n","traces":[{"line":15,"address":[42475552,42475696,42475690],"length":1,"stats":{"Line":1}},{"line":17,"address":[44386686],"length":1,"stats":{"Line":1}},{"line":18,"address":[44386700],"length":1,"stats":{"Line":1}},{"line":23,"address":[44386496,44386641],"length":1,"stats":{"Line":1}},{"line":25,"address":[44386514],"length":1,"stats":{"Line":1}},{"line":33,"address":[42475479],"length":1,"stats":{"Line":5}},{"line":38,"address":[45027545,45031733,45027648],"length":1,"stats":{"Line":3}},{"line":40,"address":[44609691],"length":1,"stats":{"Line":1}},{"line":42,"address":[44607848,44609667],"length":1,"stats":{"Line":2}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[45027732],"length":1,"stats":{"Line":1}},{"line":45,"address":[44609612],"length":1,"stats":{"Line":1}},{"line":48,"address":[45031240,45029742,45031292,45031379,45030909],"length":1,"stats":{"Line":4}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[45029746],"length":1,"stats":{"Line":1}},{"line":51,"address":[44609896,44610492,44610149,44609944,44611014,44610232,44610062,44609982,44610425],"length":1,"stats":{"Line":3}},{"line":52,"address":[44610200,44610116,44610033],"length":1,"stats":{"Line":3}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[45030874,45030939,45031063,45027366,45031250],"length":1,"stats":{"Line":4}},{"line":58,"address":[45031768,45031347,45031265,45030804,45034336,45031502,45034352],"length":1,"stats":{"Line":2}},{"line":60,"address":[45031561,45032884,45034089,45032848,45034039],"length":1,"stats":{"Line":3}},{"line":61,"address":[44614782],"length":1,"stats":{"Line":1}},{"line":62,"address":[45033064,45032993],"length":1,"stats":{"Line":2}},{"line":63,"address":[45033091],"length":1,"stats":{"Line":1}},{"line":64,"address":[44615047,44614959],"length":1,"stats":{"Line":2}},{"line":65,"address":[44615378,44615231],"length":1,"stats":{"Line":2}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[44615495,44615413],"length":1,"stats":{"Line":2}},{"line":69,"address":[44615527,44615615],"length":1,"stats":{"Line":2}},{"line":70,"address":[44615767,44615796],"length":1,"stats":{"Line":2}},{"line":74,"address":[44615256],"length":1,"stats":{"Line":1}},{"line":76,"address":[44615914,44614739],"length":1,"stats":{"Line":0}},{"line":81,"address":[45031655],"length":1,"stats":{"Line":1}},{"line":84,"address":[44607910,44607786],"length":1,"stats":{"Line":2}},{"line":85,"address":[44607914,44607975],"length":1,"stats":{"Line":2}},{"line":86,"address":[44612100,44608338,44608095,44612036,44612167,44609326],"length":1,"stats":{"Line":5}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[44608161,44608099],"length":1,"stats":{"Line":2}},{"line":89,"address":[44608346,44608169,44609472,44608118,44608200],"length":1,"stats":{"Line":2}},{"line":90,"address":[44608494,44608786,44609406,44608559,44608405,44608456,44609378,44608853],"length":1,"stats":{"Line":2}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[44611856,44607515,44609356,44609311,44612046],"length":1,"stats":{"Line":4}},{"line":97,"address":[44614501,44609225,44612135,44612681,44612286,44612077,44614480],"length":1,"stats":{"Line":2}},{"line":99,"address":[44614261,44612848,44612345,44612887,44614341],"length":1,"stats":{"Line":3}},{"line":100,"address":[45034571],"length":1,"stats":{"Line":1}},{"line":101,"address":[44613081,44612998],"length":1,"stats":{"Line":2}},{"line":102,"address":[45034712],"length":1,"stats":{"Line":1}},{"line":103,"address":[44613156,44613256],"length":1,"stats":{"Line":2}},{"line":104,"address":[44613436,44613556],"length":1,"stats":{"Line":2}},{"line":105,"address":[44613588],"length":1,"stats":{"Line":1}},{"line":106,"address":[44613638],"length":1,"stats":{"Line":1}},{"line":107,"address":[44613697],"length":1,"stats":{"Line":1}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[45035443,45035345],"length":1,"stats":{"Line":2}},{"line":111,"address":[44613959,44613871],"length":1,"stats":{"Line":2}},{"line":113,"address":[45035826,45035797],"length":1,"stats":{"Line":2}},{"line":118,"address":[44613461],"length":1,"stats":{"Line":1}},{"line":120,"address":[44612921,44614354],"length":1,"stats":{"Line":0}},{"line":123,"address":[44612443],"length":1,"stats":{"Line":1}},{"line":125,"address":[44607941,44609494],"length":1,"stats":{"Line":0}},{"line":130,"address":[44383751],"length":1,"stats":{"Line":0}},{"line":131,"address":[44602950,44603152],"length":1,"stats":{"Line":0}},{"line":133,"address":[44603158],"length":1,"stats":{"Line":0}},{"line":134,"address":[45024216],"length":1,"stats":{"Line":0}},{"line":136,"address":[45023090,45024192],"length":1,"stats":{"Line":0}},{"line":138,"address":[44603274],"length":1,"stats":{"Line":0}},{"line":139,"address":[45024149],"length":1,"stats":{"Line":0}},{"line":142,"address":[44604523,44605079,44604806,44604657],"length":1,"stats":{"Line":0}},{"line":144,"address":[44604581,44604527],"length":1,"stats":{"Line":0}},{"line":145,"address":[44604665,44604594,44604852,44604546,44604610],"length":1,"stats":{"Line":0}},{"line":147,"address":[44602759,44605089,44604908,44604836,44604791],"length":1,"stats":{"Line":0}},{"line":149,"address":[44605104],"length":1,"stats":{"Line":0}},{"line":150,"address":[44605215],"length":1,"stats":{"Line":0}},{"line":151,"address":[45025680,45025139,45025078],"length":1,"stats":{"Line":0}},{"line":152,"address":[45025470,45025204],"length":1,"stats":{"Line":0}},{"line":153,"address":[45025493],"length":1,"stats":{"Line":0}},{"line":155,"address":[45025184,45025236],"length":1,"stats":{"Line":0}},{"line":158,"address":[45024984,45025711],"length":1,"stats":{"Line":0}},{"line":161,"address":[45023028,45023152],"length":1,"stats":{"Line":0}},{"line":162,"address":[44603332,44603393],"length":1,"stats":{"Line":0}},{"line":163,"address":[44604055,44603756,44603513,44606244,44603906],"length":1,"stats":{"Line":0}},{"line":165,"address":[45023407,45023341],"length":1,"stats":{"Line":0}},{"line":166,"address":[45023592,45023364,45023446,45023415,45023982],"length":1,"stats":{"Line":0}},{"line":167,"address":[45023746,45023660,45023682,45023944],"length":1,"stats":{"Line":0}},{"line":169,"address":[45022604,45023856,45023921,45025929,45026110],"length":1,"stats":{"Line":0}},{"line":171,"address":[44606269],"length":1,"stats":{"Line":0}},{"line":172,"address":[44606380],"length":1,"stats":{"Line":0}},{"line":173,"address":[44606387,44606989,44606448],"length":1,"stats":{"Line":0}},{"line":174,"address":[44606513,44606779],"length":1,"stats":{"Line":0}},{"line":175,"address":[44606802],"length":1,"stats":{"Line":0}},{"line":177,"address":[44606545,44606493],"length":1,"stats":{"Line":0}},{"line":180,"address":[44606297,44607020],"length":1,"stats":{"Line":0}},{"line":183,"address":[44604164,44603359],"length":1,"stats":{"Line":0}},{"line":188,"address":[44383687],"length":1,"stats":{"Line":0}},{"line":189,"address":[45019995],"length":1,"stats":{"Line":0}},{"line":191,"address":[44600004,44600243],"length":1,"stats":{"Line":0}},{"line":193,"address":[44600012],"length":1,"stats":{"Line":0}},{"line":194,"address":[44600188],"length":1,"stats":{"Line":0}},{"line":197,"address":[44601212,44600526,44600841,44600402,44600777,44600908],"length":1,"stats":{"Line":0}},{"line":199,"address":[44600422],"length":1,"stats":{"Line":0}},{"line":201,"address":[44600511,44599813,44600556,44600787,44600606],"length":1,"stats":{"Line":0}},{"line":202,"address":[45020542,45022144,45020624,45022128],"length":1,"stats":{"Line":0}},{"line":203,"address":[44599834,44602183,44601051,44602437,44602416,44601151,44601245],"length":1,"stats":{"Line":0}},{"line":205,"address":[44602061,44601720,44601632],"length":1,"stats":{"Line":0}},{"line":206,"address":[44601796],"length":1,"stats":{"Line":0}},{"line":208,"address":[44602534,44602320,44601880,44602512,44602355],"length":1,"stats":{"Line":0}},{"line":210,"address":[44601922],"length":1,"stats":{"Line":0}},{"line":212,"address":[44602001,44601817],"length":1,"stats":{"Line":0}}],"covered":50,"coverable":111},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","adapters","linux_window_service.rs"],"content":"use crate::domain::windows::WindowEntry;\nuse crate::ports::window_port::WindowService;\nuse std::env;\nuse std::process::Command;\nuse std::sync::Arc;\n\n#[cfg_attr(test, mockall::automock)]\npub trait CommandExecutor: Send + Sync {\n    fn execute(\u0026self, cmd: \u0026str, args: Vec\u003cString\u003e) -\u003e Result\u003cstd::process::Output, String\u003e;\n}\n\npub struct StdCommandExecutor;\n\nimpl CommandExecutor for StdCommandExecutor {\n    fn execute(\u0026self, cmd: \u0026str, args: Vec\u003cString\u003e) -\u003e Result\u003cstd::process::Output, String\u003e {\n        Command::new(cmd)\n            .args(args)\n            .output()\n            .map_err(|e| format!(\"Failed to execute {}: {}\", cmd, e))\n    }\n}\n\ntrait WindowBackend {\n    fn list_windows(\u0026self, executor: \u0026dyn CommandExecutor) -\u003e Result\u003cVec\u003cWindowEntry\u003e, String\u003e;\n    fn focus_window(\u0026self, executor: \u0026dyn CommandExecutor, id: \u0026str) -\u003e Result\u003c(), String\u003e;\n}\n\nstruct HyprlandBackend;\nstruct WlrctlBackend;\nstruct WmctrlBackend;\n\nimpl WindowBackend for HyprlandBackend {\n    fn list_windows(\u0026self, executor: \u0026dyn CommandExecutor) -\u003e Result\u003cVec\u003cWindowEntry\u003e, String\u003e {\n        let output = executor.execute(\"hyprctl\", vec![\"clients\".to_string(), \"-j\".to_string()])?;\n\n        if !output.status.success() {\n            return Err(\"hyprctl command failed\".to_string());\n        }\n\n        let clients: Vec\u003cserde_json::Value\u003e = serde_json::from_slice(\u0026output.stdout)\n            .map_err(|e| format!(\"Failed to parse hyprctl output: {}\", e))?;\n\n        Ok(clients\n            .into_iter()\n            .map(|client| {\n                let class = client[\"class\"].as_str().unwrap_or(\"\").to_string();\n                let title = client[\"title\"].as_str().unwrap_or(\"\").to_string();\n                let address = client[\"address\"].as_str().unwrap_or(\"\").to_string();\n                WindowEntry {\n                    title,\n                    class,\n                    address,\n                    icon: None, // Will be resolved by service or caller\n                }\n            })\n            .collect())\n    }\n\n    fn focus_window(\u0026self, executor: \u0026dyn CommandExecutor, id: \u0026str) -\u003e Result\u003c(), String\u003e {\n        let output = executor.execute(\n            \"hyprctl\",\n            vec![\n                \"dispatch\".to_string(),\n                \"focuswindow\".to_string(),\n                format!(\"address:{}\", id),\n            ],\n        )?;\n\n        if output.status.success() {\n            Ok(())\n        } else {\n            Err(\"Failed to focus window via hyprctl\".to_string())\n        }\n    }\n}\n\nimpl WindowBackend for WlrctlBackend {\n    fn list_windows(\u0026self, executor: \u0026dyn CommandExecutor) -\u003e Result\u003cVec\u003cWindowEntry\u003e, String\u003e {\n        let output =\n            executor.execute(\"wlrctl\", vec![\"toplevel\".to_string(), \"list\".to_string()])?;\n\n        if !output.status.success() {\n            return Err(\"wlrctl command failed\".to_string());\n        }\n\n        let stdout = String::from_utf8_lossy(\u0026output.stdout);\n        let mut windows = Vec::new();\n\n        for line in stdout.lines() {\n            let parts: Vec\u003c\u0026str\u003e = line.splitn(2, ':').collect();\n            if parts.len() == 2 {\n                let app_id = parts[0].trim().to_string();\n                let title = parts[1].trim().to_string();\n                windows.push(WindowEntry {\n                    title: title.clone(),\n                    class: app_id.clone(),\n                    address: app_id,\n                    icon: None,\n                });\n            }\n        }\n        Ok(windows)\n    }\n\n    fn focus_window(\u0026self, executor: \u0026dyn CommandExecutor, id: \u0026str) -\u003e Result\u003c(), String\u003e {\n        let output = executor.execute(\n            \"wlrctl\",\n            vec![\"toplevel\".to_string(), \"focus\".to_string(), id.to_string()],\n        )?;\n\n        if output.status.success() {\n            Ok(())\n        } else {\n            Err(\"Failed to focus window via wlrctl\".to_string())\n        }\n    }\n}\n\nimpl WindowBackend for WmctrlBackend {\n    fn list_windows(\u0026self, executor: \u0026dyn CommandExecutor) -\u003e Result\u003cVec\u003cWindowEntry\u003e, String\u003e {\n        let output = executor.execute(\"wmctrl\", vec![\"-l\".to_string(), \"-x\".to_string()])?;\n\n        let stdout = String::from_utf8_lossy(\u0026output.stdout);\n        let mut windows = Vec::new();\n\n        for line in stdout.lines() {\n            let parts: Vec\u003c\u0026str\u003e = line.split_whitespace().collect();\n            if parts.len() \u003e= 5 {\n                let id = parts[0].to_string();\n                let class_full = parts[2].to_string();\n                let title = parts[4..].join(\" \");\n                let class = class_full\n                    .split('.')\n                    .last()\n                    .unwrap_or(\u0026class_full)\n                    .to_string();\n\n                windows.push(WindowEntry {\n                    title,\n                    class,\n                    address: id,\n                    icon: None,\n                });\n            }\n        }\n        Ok(windows)\n    }\n\n    fn focus_window(\u0026self, executor: \u0026dyn CommandExecutor, id: \u0026str) -\u003e Result\u003c(), String\u003e {\n        let output = executor.execute(\n            \"wmctrl\",\n            vec![\"-i\".to_string(), \"-a\".to_string(), id.to_string()],\n        )?;\n\n        if output.status.success() {\n            Ok(())\n        } else {\n            Err(\"Failed to focus window via wmctrl\".to_string())\n        }\n    }\n}\n\npub struct LinuxWindowService {\n    executor: Arc\u003cdyn CommandExecutor\u003e,\n}\n\nimpl LinuxWindowService {\n    pub fn new(executor: Arc\u003cdyn CommandExecutor\u003e) -\u003e Self {\n        Self { executor }\n    }\n\n    fn get_backend(\u0026self) -\u003e Box\u003cdyn WindowBackend\u003e {\n        if env::var(\"HYPRLAND_INSTANCE_SIGNATURE\").is_ok() {\n            return Box::new(HyprlandBackend);\n        }\n        if env::var(\"WAYLAND_DISPLAY\").is_ok() {\n            return Box::new(WlrctlBackend);\n        }\n        Box::new(WmctrlBackend)\n    }\n}\n\nimpl WindowService for LinuxWindowService {\n    fn list_windows(\u0026self) -\u003e Result\u003cVec\u003cWindowEntry\u003e, String\u003e {\n        self.get_backend().list_windows(self.executor.as_ref())\n    }\n\n    fn focus_window(\u0026self, id: \u0026str) -\u003e Result\u003c(), String\u003e {\n        self.get_backend().focus_window(self.executor.as_ref(), id)\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use std::os::unix::process::ExitStatusExt;\n    use std::process::ExitStatus;\n\n    fn mock_success_output(stdout: \u0026str) -\u003e std::process::Output {\n        std::process::Output {\n            status: ExitStatus::from_raw(0), // 0 means success in unix\n            stdout: stdout.as_bytes().to_vec(),\n            stderr: Vec::new(),\n        }\n    }\n\n    #[test]\n    fn test_hyprland_backend_list_windows() {\n        let mut mock = MockCommandExecutor::new();\n        mock.expect_execute()\n            .with(\n                mockall::predicate::eq(\"hyprctl\"),\n                mockall::predicate::eq(vec![\"clients\".to_string(), \"-j\".to_string()]),\n            )\n            .times(1)\n            .returning(|_, _| {\n                Ok(mock_success_output(\n                    r#\"[\n                {\n                    \"class\": \"org.mozilla.firefox\",\n                    \"title\": \"Mozilla Firefox\",\n                    \"address\": \"0x12345678\"\n                }\n            ]\"#,\n                ))\n            });\n\n        let backend = HyprlandBackend;\n        let windows = backend.list_windows(\u0026mock).unwrap();\n\n        assert_eq!(windows.len(), 1);\n        assert_eq!(windows[0].title, \"Mozilla Firefox\");\n        assert_eq!(windows[0].class, \"org.mozilla.firefox\");\n        assert_eq!(windows[0].address, \"0x12345678\");\n    }\n\n    #[test]\n    fn test_wlrctl_backend_list_windows() {\n        let mut mock = MockCommandExecutor::new();\n        mock.expect_execute()\n            .with(\n                mockall::predicate::eq(\"wlrctl\"),\n                mockall::predicate::eq(vec![\"toplevel\".to_string(), \"list\".to_string()]),\n            )\n            .times(1)\n            .returning(|_, _| Ok(mock_success_output(\"org.wezfurlong.wezterm: WezTerm\\n\")));\n\n        let backend = WlrctlBackend;\n        let windows = backend.list_windows(\u0026mock).unwrap();\n\n        assert_eq!(windows.len(), 1);\n        assert_eq!(windows[0].title, \"WezTerm\");\n        assert_eq!(windows[0].class, \"org.wezfurlong.wezterm\");\n    }\n\n    #[test]\n    fn test_wmctrl_backend_list_windows() {\n        let mut mock = MockCommandExecutor::new();\n        mock.expect_execute()\n            .with(\n                mockall::predicate::eq(\"wmctrl\"),\n                mockall::predicate::eq(vec![\"-l\".to_string(), \"-x\".to_string()]),\n            )\n            .times(1)\n            .returning(|_, _| {\n                Ok(mock_success_output(\n                    \"0x02800003  0 pycharm.PyCharm  ubuntu PyCharm Projects\\n\",\n                ))\n            });\n\n        let backend = WmctrlBackend;\n        let windows = backend.list_windows(\u0026mock).unwrap();\n\n        assert_eq!(windows.len(), 1);\n        assert_eq!(windows[0].title, \"PyCharm Projects\");\n        assert_eq!(windows[0].class, \"PyCharm\");\n    }\n}\n","traces":[{"line":19,"address":[44050768,44051978,44051959],"length":1,"stats":{"Line":0}},{"line":20,"address":[43733705,43733917,43733998],"length":1,"stats":{"Line":0}},{"line":24,"address":[43733781,43733966,43734142,43734859,43733894],"length":1,"stats":{"Line":0}},{"line":26,"address":[43734202],"length":1,"stats":{"Line":0}},{"line":27,"address":[43734293,43734231],"length":1,"stats":{"Line":0}},{"line":30,"address":[43734262,43734474,43734416,43734370],"length":1,"stats":{"Line":0}},{"line":31,"address":[39820944,39820970],"length":1,"stats":{"Line":0}},{"line":33,"address":[43734571,43734730],"length":1,"stats":{"Line":0}},{"line":34,"address":[43734611],"length":1,"stats":{"Line":0}},{"line":35,"address":[43734695],"length":1,"stats":{"Line":0}},{"line":36,"address":[39820204,39820121],"length":1,"stats":{"Line":0}},{"line":37,"address":[41081005,41081089],"length":1,"stats":{"Line":0}},{"line":38,"address":[39820550,39820470],"length":1,"stats":{"Line":0}},{"line":39,"address":[39820760],"length":1,"stats":{"Line":0}},{"line":40,"address":[39820646],"length":1,"stats":{"Line":0}},{"line":41,"address":[39820694],"length":1,"stats":{"Line":0}},{"line":43,"address":[41081458],"length":1,"stats":{"Line":0}},{"line":46,"address":[43734718],"length":1,"stats":{"Line":0}},{"line":49,"address":[43732816,43733640,43733646],"length":1,"stats":{"Line":0}},{"line":50,"address":[43733288,43733207,43732851],"length":1,"stats":{"Line":0}},{"line":53,"address":[43732992],"length":1,"stats":{"Line":0}},{"line":55,"address":[43732914,43733436,43733184,43733256,43733659],"length":1,"stats":{"Line":0}},{"line":57,"address":[43733574,43733496],"length":1,"stats":{"Line":0}},{"line":58,"address":[43733561],"length":1,"stats":{"Line":0}},{"line":60,"address":[43733581,43733525],"length":1,"stats":{"Line":0}},{"line":66,"address":[43727888,43729829,43729857],"length":1,"stats":{"Line":0}},{"line":67,"address":[43727919,43728222,43728138],"length":1,"stats":{"Line":0}},{"line":71,"address":[43728115,43729870,43727999,43728375,43728190],"length":1,"stats":{"Line":0}},{"line":73,"address":[43728438],"length":1,"stats":{"Line":0}},{"line":74,"address":[43728467,43728535],"length":1,"stats":{"Line":0}},{"line":77,"address":[43728498,43728618],"length":1,"stats":{"Line":0}},{"line":78,"address":[43728645],"length":1,"stats":{"Line":0}},{"line":80,"address":[43728780,43728696],"length":1,"stats":{"Line":0}},{"line":81,"address":[43728973,43729105],"length":1,"stats":{"Line":0}},{"line":82,"address":[43729112,43729185,43729824],"length":1,"stats":{"Line":0}},{"line":83,"address":[43729191,43729253],"length":1,"stats":{"Line":0}},{"line":84,"address":[43729396,43729314],"length":1,"stats":{"Line":0}},{"line":85,"address":[43729646],"length":1,"stats":{"Line":0}},{"line":86,"address":[44046461],"length":1,"stats":{"Line":0}},{"line":87,"address":[44046532],"length":1,"stats":{"Line":0}},{"line":88,"address":[44046600],"length":1,"stats":{"Line":0}},{"line":89,"address":[44046650],"length":1,"stats":{"Line":0}},{"line":93,"address":[43728988],"length":1,"stats":{"Line":0}},{"line":96,"address":[44044826,44044096,44044832],"length":1,"stats":{"Line":0}},{"line":97,"address":[43727413,43727187,43727494],"length":1,"stats":{"Line":0}},{"line":100,"address":[44044306],"length":1,"stats":{"Line":0}},{"line":102,"address":[39819136,39819120],"length":1,"stats":{"Line":0}},{"line":104,"address":[43727702,43727780],"length":1,"stats":{"Line":0}},{"line":105,"address":[43727767],"length":1,"stats":{"Line":0}},{"line":107,"address":[43727787,43727731],"length":1,"stats":{"Line":0}},{"line":113,"address":[44049814,44047680,44049842],"length":1,"stats":{"Line":0}},{"line":114,"address":[43730687,43731004,43730920],"length":1,"stats":{"Line":0}},{"line":118,"address":[43732784,43731157,43730897,43730775,43730972],"length":1,"stats":{"Line":0}},{"line":120,"address":[43731220],"length":1,"stats":{"Line":0}},{"line":121,"address":[44048334],"length":1,"stats":{"Line":0}},{"line":123,"address":[43731445,43731349],"length":1,"stats":{"Line":0}},{"line":124,"address":[44048685,44048812],"length":1,"stats":{"Line":0}},{"line":125,"address":[44048912,44049787,44048839],"length":1,"stats":{"Line":0}},{"line":126,"address":[43731884],"length":1,"stats":{"Line":0}},{"line":127,"address":[44049096,44049014],"length":1,"stats":{"Line":0}},{"line":128,"address":[44049217,44049122],"length":1,"stats":{"Line":0}},{"line":129,"address":[43732202],"length":1,"stats":{"Line":0}},{"line":132,"address":[43732347],"length":1,"stats":{"Line":0}},{"line":135,"address":[44049597],"length":1,"stats":{"Line":0}},{"line":136,"address":[44049499],"length":1,"stats":{"Line":0}},{"line":138,"address":[44049539],"length":1,"stats":{"Line":0}},{"line":139,"address":[44049589],"length":1,"stats":{"Line":0}},{"line":143,"address":[43731648],"length":1,"stats":{"Line":0}},{"line":146,"address":[43729904,43730614,43730620],"length":1,"stats":{"Line":0}},{"line":147,"address":[43729955,43730262,43730181],"length":1,"stats":{"Line":0}},{"line":150,"address":[43730106],"length":1,"stats":{"Line":0}},{"line":152,"address":[39819456,39819440],"length":1,"stats":{"Line":0}},{"line":154,"address":[43730470,43730548],"length":1,"stats":{"Line":0}},{"line":155,"address":[43730535],"length":1,"stats":{"Line":0}},{"line":157,"address":[44047527,44047583],"length":1,"stats":{"Line":0}},{"line":169,"address":[43735220,43734880,43735226],"length":1,"stats":{"Line":0}},{"line":170,"address":[43735054,43734892],"length":1,"stats":{"Line":0}},{"line":171,"address":[43735065],"length":1,"stats":{"Line":0}},{"line":173,"address":[44052141,44052307,44052226],"length":1,"stats":{"Line":0}},{"line":174,"address":[43735180],"length":1,"stats":{"Line":0}},{"line":176,"address":[43735145],"length":1,"stats":{"Line":0}},{"line":181,"address":[43726992,43727116,43727110],"length":1,"stats":{"Line":0}},{"line":182,"address":[43727024],"length":1,"stats":{"Line":0}},{"line":185,"address":[43726976,43726816,43726970],"length":1,"stats":{"Line":0}},{"line":186,"address":[43726868],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":85},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","adapters","mod.rs"],"content":"pub mod cached_icon_resolver;\npub mod file_history;\npub mod fs_app_repository;\npub mod fs_config_service;\npub mod google_translation_service;\npub mod http_ai_service;\npub mod linux_window_service;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","ai.rs"],"content":"use crate::domain::ai::Message;\nuse crate::state::AppState;\nuse futures_util::StreamExt;\nuse tauri::{Emitter, State};\n\n#[tauri::command]\npub async fn ask_ai(\n    window: tauri::Window,\n    state: State\u003c'_, AppState\u003e,\n    messages: Vec\u003cMessage\u003e,\n) -\u003e Result\u003c(), String\u003e {\n    let config = state.config_service.load_config();\n\n    window\n        .emit(\"ai-response-start\", ())\n        .map_err(|e| e.to_string())?;\n\n    match state.ai_service.stream_completion(\u0026config, messages).await {\n        Ok(mut stream) =\u003e {\n            while let Some(chunk_result) = stream.next().await {\n                match chunk_result {\n                    Ok(content) =\u003e {\n                        window\n                            .emit(\"ai-response-chunk\", content)\n                            .map_err(|e| e.to_string())?;\n                    }\n                    Err(e) =\u003e {\n                        window\n                            .emit(\"ai-response-error\", e.clone())\n                            .map_err(|e1| e1.to_string())?;\n                        return Err(e);\n                    }\n                }\n            }\n        }\n        Err(e) =\u003e {\n            window\n                .emit(\"ai-response-error\", e.clone())\n                .map_err(|e1| e1.to_string())?;\n            return Err(e);\n        }\n    }\n\n    window\n        .emit(\"ai-response-done\", ())\n        .map_err(|e| e.to_string())?;\n    Ok(())\n}\n\n#[tauri::command]\npub async fn check_ai_connection(state: State\u003c'_, AppState\u003e) -\u003e Result\u003cString, String\u003e {\n    let config = state.config_service.load_config();\n    state.ai_service.check_connection(\u0026config).await\n}\n\n#[tauri::command]\npub async fn list_ollama_models(state: State\u003c'_, AppState\u003e) -\u003e Result\u003cVec\u003cString\u003e, String\u003e {\n    let config = state.config_service.load_config();\n    match state.ai_service.list_models(\u0026config).await {\n        Ok(models) =\u003e Ok(models),\n        Err(_) =\u003e Ok(vec![]), // Graceful fallback\n    }\n}\n","traces":[{"line":7,"address":[45644192],"length":1,"stats":{"Line":0}},{"line":12,"address":[45814212,45814347],"length":1,"stats":{"Line":0}},{"line":14,"address":[45814878,45814513,45814409,45814609],"length":1,"stats":{"Line":0}},{"line":15,"address":[45814416],"length":1,"stats":{"Line":0}},{"line":16,"address":[45817856,45814577,45814506,45817840],"length":1,"stats":{"Line":0}},{"line":18,"address":[43586351],"length":1,"stats":{"Line":0}},{"line":19,"address":[45815315],"length":1,"stats":{"Line":0}},{"line":20,"address":[45815351,45816504,45815880,45815809,45814278],"length":1,"stats":{"Line":0}},{"line":21,"address":[45816139],"length":1,"stats":{"Line":0}},{"line":22,"address":[45816277],"length":1,"stats":{"Line":0}},{"line":23,"address":[45816309,45816551,45816470,45816374],"length":1,"stats":{"Line":0}},{"line":24,"address":[45816316],"length":1,"stats":{"Line":0}},{"line":25,"address":[45817568,45817552,45816367,45816438],"length":1,"stats":{"Line":0}},{"line":27,"address":[45816188],"length":1,"stats":{"Line":0}},{"line":28,"address":[44982213,44981732,44982459,44982309],"length":1,"stats":{"Line":0}},{"line":29,"address":[45816239,45816627],"length":1,"stats":{"Line":0}},{"line":30,"address":[45816749,45817760,45817744,45816678],"length":1,"stats":{"Line":0}},{"line":31,"address":[45816815],"length":1,"stats":{"Line":0}},{"line":36,"address":[45815231],"length":1,"stats":{"Line":0}},{"line":37,"address":[45815480,45815726,45815576,45815269],"length":1,"stats":{"Line":0}},{"line":38,"address":[45815422,45815280],"length":1,"stats":{"Line":0}},{"line":39,"address":[45815544,45815473,45817936,45817952],"length":1,"stats":{"Line":0}},{"line":40,"address":[45815610],"length":1,"stats":{"Line":0}},{"line":44,"address":[44982601,44982536,44982697,44982935],"length":1,"stats":{"Line":0}},{"line":45,"address":[45817015],"length":1,"stats":{"Line":0}},{"line":46,"address":[45817664,45817058,45817648,45817129],"length":1,"stats":{"Line":0}},{"line":47,"address":[45817216],"length":1,"stats":{"Line":0}},{"line":51,"address":[44458912,44458920],"length":1,"stats":{"Line":0}},{"line":52,"address":[44978617,44978722],"length":1,"stats":{"Line":0}},{"line":53,"address":[45813566,45813672,45813280,45813395,45813457],"length":1,"stats":{"Line":0}},{"line":57,"address":[45644128,45644136],"length":1,"stats":{"Line":0}},{"line":58,"address":[45812126,45812025],"length":1,"stats":{"Line":0}},{"line":59,"address":[43595543],"length":1,"stats":{"Line":0}},{"line":60,"address":[45812744],"length":1,"stats":{"Line":0}},{"line":61,"address":[45812909,45812722],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":35},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","apps.rs"],"content":"use crate::domain::apps::AppEntry;\nuse crate::ports::app_port::AppRepository;\nuse crate::state::AppState;\nuse std::os::unix::process::CommandExt;\nuse tauri::State;\n\n// Handler logic for testing\npub fn list_apps_logic(repo: \u0026dyn AppRepository) -\u003e Result\u003cVec\u003cAppEntry\u003e, String\u003e {\n    repo.list_apps()\n}\n\n#[tauri::command]\npub async fn list_apps(state: State\u003c'_, AppState\u003e) -\u003e Result\u003cVec\u003cAppEntry\u003e, String\u003e {\n    list_apps_logic(\u0026*state.app_repository)\n}\n\n// Helper to clean exec command - exposed for testing\npub fn parse_exec_command(exec_cmd: \u0026str) -\u003e Option\u003c(String, Vec\u003cString\u003e)\u003e {\n    let cleaned = exec_cmd\n        .replace(\"%f\", \"\")\n        .replace(\"%F\", \"\")\n        .replace(\"%u\", \"\")\n        .replace(\"%U\", \"\")\n        .replace(\"%i\", \"\")\n        .replace(\"%c\", \"\")\n        .replace(\"%k\", \"\");\n\n    let parts = shell_words::split(\u0026cleaned).ok()?;\n    if parts.is_empty() {\n        return None;\n    }\n\n    let cmd = parts[0].clone();\n    let args = parts[1..].to_vec();\n    Some((cmd, args))\n}\n\n#[tauri::command]\npub async fn launch_app(exec_cmd: String) -\u003e Result\u003c(), String\u003e {\n    let (cmd, args) = parse_exec_command(\u0026exec_cmd).ok_or_else(|| \"Empty command\".to_string())?;\n\n    std::process::Command::new(cmd)\n        .args(args)\n        .stdin(std::process::Stdio::null())\n        .stdout(std::process::Stdio::null())\n        .stderr(std::process::Stdio::null())\n        .process_group(0) // Sets the process group ID to the child's PID effectively creating a new session\n        .spawn()\n        .map_err(|e| e.to_string())?;\n\n    Ok(())\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::ports::app_port::MockAppRepository;\n\n    #[test]\n    fn test_list_apps() {\n        let mut mock = MockAppRepository::new();\n        mock.expect_list_apps().times(1).returning(|| {\n            Ok(vec![AppEntry {\n                name: \"Test App\".to_string(),\n                exec: \"test\".to_string(),\n                icon: None,\n            }])\n        });\n\n        let result = list_apps_logic(\u0026mock);\n        assert!(result.is_ok());\n        let apps = result.unwrap();\n        assert_eq!(apps.len(), 1);\n        assert_eq!(apps[0].name, \"Test App\");\n    }\n\n    #[test]\n    fn test_parse_exec_command() {\n        // Simple command\n        assert_eq!(\n            parse_exec_command(\"firefox\"),\n            Some((\"firefox\".to_string(), vec![]))\n        );\n\n        // Command with args\n        assert_eq!(\n            parse_exec_command(\"echo hello world\"),\n            Some((\n                \"echo\".to_string(),\n                vec![\"hello\".to_string(), \"world\".to_string()]\n            ))\n        );\n\n        // Command with % codes that should be removed\n        assert_eq!(\n            parse_exec_command(\"vlc %U\"),\n            Some((\"vlc\".to_string(), vec![]))\n        );\n\n        // Complex quoted args\n        assert_eq!(\n            parse_exec_command(\"grep \\\"hello world\\\" file.txt\"),\n            Some((\n                \"grep\".to_string(),\n                vec![\"hello world\".to_string(), \"file.txt\".to_string()]\n            ))\n        );\n\n        // Empty/Invalid\n        assert_eq!(parse_exec_command(\"\"), None);\n    }\n}\n","traces":[{"line":8,"address":[41601296],"length":1,"stats":{"Line":1}},{"line":9,"address":[40656437],"length":1,"stats":{"Line":1}},{"line":13,"address":[40658448,40658456],"length":1,"stats":{"Line":0}},{"line":14,"address":[44935836,44935759],"length":1,"stats":{"Line":0}},{"line":18,"address":[40658402,40658426,40656464],"length":1,"stats":{"Line":1}},{"line":19,"address":[40656970,40657224,40656704,40657097,40656565,40656843],"length":1,"stats":{"Line":6}},{"line":28,"address":[40658424,40657714],"length":1,"stats":{"Line":1}},{"line":29,"address":[40657925,40657996],"length":1,"stats":{"Line":2}},{"line":30,"address":[40658055],"length":1,"stats":{"Line":1}},{"line":33,"address":[40658085,40658002],"length":1,"stats":{"Line":2}},{"line":34,"address":[40658195,40658104],"length":1,"stats":{"Line":2}},{"line":35,"address":[40658222],"length":1,"stats":{"Line":1}},{"line":39,"address":[44934210,44934118,44935251,44934080,44935482,44935403],"length":1,"stats":{"Line":0}},{"line":40,"address":[44935520,44934291,44935480,44935532,44934193],"length":1,"stats":{"Line":0}},{"line":42,"address":[44935057,44935003,44934578],"length":1,"stats":{"Line":0}},{"line":43,"address":[44934682],"length":1,"stats":{"Line":0}},{"line":44,"address":[44934791],"length":1,"stats":{"Line":0}},{"line":45,"address":[44934835],"length":1,"stats":{"Line":0}},{"line":46,"address":[44934879],"length":1,"stats":{"Line":0}},{"line":49,"address":[44935352,44935158,44934750,44935568,44935025,44934980,44935584],"length":1,"stats":{"Line":0}},{"line":51,"address":[44935206],"length":1,"stats":{"Line":0}}],"covered":10,"coverable":21},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","config.rs"],"content":"use crate::domain::config::AppConfig;\nuse crate::ports::config_port::ConfigService;\nuse crate::state::AppState;\nuse tauri::State;\n\n// Handler logic separated from Tauri state injection for easier testing\npub fn get_config_logic(service: \u0026dyn ConfigService) -\u003e Result\u003cAppConfig, String\u003e {\n    Ok(service.load_config())\n}\n\npub fn save_config_logic(service: \u0026dyn ConfigService, config: \u0026AppConfig) -\u003e Result\u003c(), String\u003e {\n    service.save_config(config)\n}\n\n#[tauri::command]\npub async fn get_config(state: State\u003c'_, AppState\u003e) -\u003e Result\u003cAppConfig, String\u003e {\n    get_config_logic(\u0026*state.config_service)\n}\n\n#[tauri::command]\npub async fn save_config(state: State\u003c'_, AppState\u003e, config: AppConfig) -\u003e Result\u003c(), String\u003e {\n    save_config_logic(\u0026*state.config_service, \u0026config)\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::ports::config_port::MockConfigService;\n\n    #[test]\n    fn test_get_config() {\n        let mut mock = MockConfigService::new();\n        let expected_config = AppConfig::default();\n        let ret_config = expected_config.clone();\n\n        mock.expect_load_config()\n            .times(1)\n            .returning(move || ret_config.clone());\n\n        let result = get_config_logic(\u0026mock);\n        assert!(result.is_ok());\n        // Simple check, exact equality might require partialeq on AppConfig but it derives it\n    }\n\n    #[test]\n    fn test_save_config() {\n        let mut mock = MockConfigService::new();\n        mock.expect_save_config().times(1).returning(|_| Ok(()));\n\n        let config = AppConfig::default();\n        let result = save_config_logic(\u0026mock, \u0026config);\n        assert!(result.is_ok());\n    }\n}\n","traces":[{"line":7,"address":[41597424],"length":1,"stats":{"Line":1}},{"line":8,"address":[41597456],"length":1,"stats":{"Line":1}},{"line":11,"address":[41597504],"length":1,"stats":{"Line":1}},{"line":12,"address":[41597542],"length":1,"stats":{"Line":1}},{"line":16,"address":[41318523,41318396,41318272,41318369,41318310],"length":1,"stats":{"Line":0}},{"line":17,"address":[41318440,41318357],"length":1,"stats":{"Line":0}},{"line":21,"address":[41318560,41318598,41318919,41318683,41318812],"length":1,"stats":{"Line":0}},{"line":22,"address":[41318744,41318671],"length":1,"stats":{"Line":0}}],"covered":4,"coverable":8},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","history.rs"],"content":"use crate::domain::action::Action;\nuse crate::state::AppState;\nuse tauri::State;\n\n#[tauri::command]\npub async fn get_recent_actions(\n    state: State\u003c'_, AppState\u003e,\n    limit: usize,\n) -\u003e Result\u003cVec\u003cAction\u003e, String\u003e {\n    state.history_repository.get_recent(limit).await\n}\n\n#[tauri::command]\npub async fn record_action(state: State\u003c'_, AppState\u003e, action: Action) -\u003e Result\u003c(), String\u003e {\n    state.history_repository.record(action).await\n}\n\n#[tauri::command]\npub async fn clear_history(state: State\u003c'_, AppState\u003e) -\u003e Result\u003c(), String\u003e {\n    state.history_repository.clear().await\n}\n","traces":[{"line":6,"address":[46000288],"length":1,"stats":{"Line":0}},{"line":10,"address":[43371124],"length":1,"stats":{"Line":0}},{"line":14,"address":[46000208,46000243],"length":1,"stats":{"Line":0}},{"line":15,"address":[43595821],"length":1,"stats":{"Line":0}},{"line":19,"address":[46000192,46000200],"length":1,"stats":{"Line":0}},{"line":20,"address":[43595716],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":6},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","mod.rs"],"content":"pub mod ai;\npub mod apps;\npub mod config;\npub mod history;\npub mod scripts;\npub mod system;\npub mod translation;\npub mod windows;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","scripts.rs"],"content":"use crate::domain::config::ScriptConfig;\nuse crate::state::AppState;\nuse tauri::{Emitter, State};\nuse tokio::io::{AsyncBufReadExt, BufReader};\nuse tokio::process::Command;\n\n#[tauri::command]\npub async fn list_scripts(state: State\u003c'_, AppState\u003e) -\u003e Result\u003cVec\u003cScriptConfig\u003e, String\u003e {\n    let config = state.config_service.load_config();\n    Ok(config.scripts)\n}\n\n#[tauri::command]\npub async fn execute_script(\n    window: tauri::Window,\n    path: String,\n    args: Option\u003cString\u003e,\n) -\u003e Result\u003c(), String\u003e {\n    let path = path.trim();\n    let mut cmd;\n\n    if path.ends_with(\".sh\") {\n        cmd = Command::new(\"sh\");\n        cmd.arg(path);\n    } else {\n        cmd = Command::new(path);\n    }\n\n    if let Some(args_str) = args {\n        let parts = shell_words::split(\u0026args_str).map_err(|e| e.to_string())?;\n        cmd.args(parts);\n    }\n\n    cmd.stdout(std::process::Stdio::piped());\n    cmd.stderr(std::process::Stdio::piped());\n\n    let mut child = cmd\n        .spawn()\n        .map_err(|e| format!(\"Failed to spawn script: {}\", e))?;\n\n    let stdout = child.stdout.take().ok_or(\"Failed to open stdout\")?;\n    let stderr = child.stderr.take().ok_or(\"Failed to open stderr\")?;\n\n    let mut stdout_reader = BufReader::new(stdout).lines();\n    let mut stderr_reader = BufReader::new(stderr).lines();\n\n    window.emit(\"script-start\", ()).map_err(|e| e.to_string())?;\n\n    // Spawn tasks to handle stdout and stderr concurrently\n    let window_clone1 = window.clone();\n    tokio::spawn(async move {\n        while let Ok(Some(line)) = stdout_reader.next_line().await {\n            let _ = window_clone1.emit(\"script-output\", format!(\"\u003e {}\\n\", line));\n        }\n    });\n\n    let window_clone2 = window.clone();\n    tokio::spawn(async move {\n        while let Ok(Some(line)) = stderr_reader.next_line().await {\n            let _ = window_clone2.emit(\"script-output\", format!(\"ERR\u003e {}\\n\", line));\n        }\n    });\n\n    // Wait for the child process to finish\n    let output = child.wait().await.map_err(|e| e.to_string())?;\n\n    let status_msg = if output.success() {\n        format!(\"\u003e Success! (Exit code 0)\\n\")\n    } else {\n        format!(\"\u003e Failed! (Exit code {})\\n\", output.code().unwrap_or(-1))\n    };\n\n    window\n        .emit(\"script-output\", status_msg)\n        .map_err(|e| e.to_string())?;\n\n    window.emit(\"script-done\", ()).map_err(|e| e.to_string())?;\n\n    Ok(())\n}\n","traces":[{"line":8,"address":[40712512,40712485,40713121,40712422,40712384],"length":1,"stats":{"Line":0}},{"line":9,"address":[41426149,41426232],"length":1,"stats":{"Line":0}},{"line":10,"address":[41426276],"length":1,"stats":{"Line":0}},{"line":14,"address":[45374368],"length":1,"stats":{"Line":0}},{"line":19,"address":[41427082,41427237],"length":1,"stats":{"Line":0}},{"line":22,"address":[41427399,41427314],"length":1,"stats":{"Line":0}},{"line":23,"address":[41427560,41427436],"length":1,"stats":{"Line":0}},{"line":24,"address":[41427628],"length":1,"stats":{"Line":0}},{"line":26,"address":[41427471,41427429],"length":1,"stats":{"Line":0}},{"line":29,"address":[41427648,41427511],"length":1,"stats":{"Line":0}},{"line":30,"address":[41432396,41427693,41432384,41427827],"length":1,"stats":{"Line":0}},{"line":31,"address":[41428055],"length":1,"stats":{"Line":0}},{"line":34,"address":[41427724,41428287],"length":1,"stats":{"Line":0}},{"line":35,"address":[41428302],"length":1,"stats":{"Line":0}},{"line":37,"address":[41430378,41428356,41428417,41428484],"length":1,"stats":{"Line":0}},{"line":39,"address":[41433658,41428394,41428452,41433632],"length":1,"stats":{"Line":0}},{"line":41,"address":[41428606,41430340,41428690],"length":1,"stats":{"Line":0}},{"line":42,"address":[41430308,41428993,41428912],"length":1,"stats":{"Line":0}},{"line":44,"address":[40715752,40715631],"length":1,"stats":{"Line":0}},{"line":45,"address":[41429370,41429503],"length":1,"stats":{"Line":0}},{"line":47,"address":[41432288,41432304,41430280,41429623,41429525],"length":1,"stats":{"Line":0}},{"line":50,"address":[41429771],"length":1,"stats":{"Line":0}},{"line":51,"address":[41432441,41432416,41433405,41432478,41432526,41433525,41429801],"length":1,"stats":{"Line":0}},{"line":52,"address":[41432895,41432818,41432499,41433337,41432476,41432557,41432581],"length":1,"stats":{"Line":0}},{"line":53,"address":[40721265,40721176],"length":1,"stats":{"Line":0}},{"line":57,"address":[41429948],"length":1,"stats":{"Line":0}},{"line":58,"address":[40719989,40718857,40716430,40718832,40718946,40718894,40719857],"length":1,"stats":{"Line":0}},{"line":59,"address":[43399965],"length":1,"stats":{"Line":0}},{"line":60,"address":[41434473,41434384],"length":1,"stats":{"Line":0}},{"line":65,"address":[39623188],"length":1,"stats":{"Line":0}},{"line":67,"address":[41430794],"length":1,"stats":{"Line":0}},{"line":68,"address":[40717302,40717609],"length":1,"stats":{"Line":0}},{"line":70,"address":[40717287,40717339],"length":1,"stats":{"Line":0}},{"line":73,"address":[41431917,41431299,41431051,41431203],"length":1,"stats":{"Line":0}},{"line":74,"address":[41431058],"length":1,"stats":{"Line":0}},{"line":75,"address":[41431267,41431196,41435056,41435072],"length":1,"stats":{"Line":0}},{"line":77,"address":[41435264,41431912,41431344,41435280],"length":1,"stats":{"Line":0}},{"line":79,"address":[41431552],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":38},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","system.rs"],"content":"use walkdir::WalkDir;\n\n#[tauri::command]\npub fn greet(name: \u0026str) -\u003e String {\n    format!(\"Hello, {}! You've been greeted from Rust!\", name)\n}\n\n#[tauri::command]\npub async fn open_entity(path: String) -\u003e Result\u003c(), String\u003e {\n    std::thread::spawn(move || {\n        let _ = open::that(path);\n    });\n    Ok(())\n}\n\n#[derive(serde::Serialize)]\npub struct FileMetadata {\n    size: u64,\n    created: Option\u003cu64\u003e,\n    is_dir: bool,\n    readonly: bool,\n    mime_type: Option\u003cString\u003e,\n}\n\nfn calculate_file_score(name: \u0026str, ext: Option\u003c\u0026str\u003e, query: \u0026str) -\u003e i32 {\n    let mut score = 0;\n    let lower_name = name.to_lowercase();\n    let lower_query = query.to_lowercase();\n\n    // Name match bonuses\n    if lower_name == lower_query {\n        score += 100;\n    } else if lower_name.starts_with(\u0026lower_query) {\n        score += 50;\n    }\n\n    // Extension prioritization\n    if let Some(e) = ext {\n        let e_lower = e.to_lowercase();\n        match e_lower.as_str() {\n            // Images (Highest priority)\n            \"png\" | \"jpg\" | \"jpeg\" | \"webp\" | \"gif\" | \"svg\" | \"bmp\" | \"tiff\" =\u003e score += 40,\n\n            // Videos (Second priority)\n            \"mp4\" | \"mkv\" | \"avi\" | \"mov\" | \"webm\" | \"flv\" | \"wmv\" =\u003e score += 30,\n\n            // Common documents/code (Third priority)\n            \"rs\" | \"js\" | \"ts\" | \"vue\" | \"py\" | \"html\" | \"css\" | \"json\" | \"md\" | \"txt\" | \"pdf\"\n            | \"csv\" | \"docx\" | \"xlsx\" =\u003e score += 20,\n\n            _ =\u003e {}\n        }\n    }\n\n    score\n}\n\n#[tauri::command]\npub async fn search_files(\n    query: String,\n    path: String,\n    include_hidden: bool,\n) -\u003e Result\u003cVec\u003cString\u003e, String\u003e {\n    let lower_query = query.to_lowercase();\n\n    let walker = WalkDir::new(\u0026path).max_depth(10).into_iter();\n\n    // Collect matches\n    let mut matches = Vec::new();\n\n    // Use filter_entry to skip hidden directories efficiently if needed\n    let it = walker.filter_entry(move |e| {\n        if include_hidden {\n            return true;\n        }\n        !is_hidden(e)\n    });\n\n    for entry in it.filter_map(|e| e.ok()) {\n        let path = entry.path();\n        let path_str = path.to_string_lossy();\n\n        if path_str.to_lowercase().contains(\u0026lower_query) {\n            let name = path.file_name().and_then(|n| n.to_str()).unwrap_or(\"\");\n            let ext = path.extension().and_then(|e| e.to_str());\n\n            let score = calculate_file_score(name, ext, \u0026query);\n\n            matches.push((path_str.to_string(), score));\n            if matches.len() \u003e 500 {\n                // Increased limit slightly to allow better sorting\n                break;\n            }\n        }\n    }\n\n    // Sort by score descending\n    matches.sort_by(|a, b| b.1.cmp(\u0026a.1));\n\n    // Take top 50\n    let results: Vec\u003cString\u003e = matches.into_iter().take(50).map(|(p, _)| p).collect();\n\n    Ok(results)\n}\n\nfn is_hidden(entry: \u0026walkdir::DirEntry) -\u003e bool {\n    entry\n        .file_name()\n        .to_str()\n        .map(|s| s.starts_with('.') \u0026\u0026 s != \".\" \u0026\u0026 s != \"..\")\n        .unwrap_or(false)\n}\n\n#[tauri::command]\npub async fn read_file_preview(path: String, max_bytes: Option\u003cusize\u003e) -\u003e Result\u003cString, String\u003e {\n    use std::io::Read;\n    let limit = max_bytes.unwrap_or(2048);\n    let mut file = std::fs::File::open(\u0026path).map_err(|e| e.to_string())?;\n\n    let mut buffer = vec![0; limit];\n    let n = file.read(\u0026mut buffer).map_err(|e| e.to_string())?;\n    buffer.truncate(n);\n\n    // Check for null bytes to detect binary\n    if buffer.contains(\u00260) {\n        return Err(\"Binary file detected\".to_string());\n    }\n\n    String::from_utf8(buffer).map_err(|e| format!(\"Not valid UTF-8: {}\", e))\n}\n\n#[tauri::command]\npub async fn get_file_metadata(path: String) -\u003e Result\u003cFileMetadata, String\u003e {\n    let metadata = std::fs::metadata(\u0026path).map_err(|e| e.to_string())?;\n\n    let created = metadata\n        .created()\n        .ok()\n        .and_then(|t| t.duration_since(std::time::UNIX_EPOCH).ok())\n        .map(|d| d.as_secs());\n\n    Ok(FileMetadata {\n        size: metadata.len(),\n        created,\n        is_dir: metadata.is_dir(),\n        readonly: metadata.permissions().readonly(),\n        mime_type: None, // Could use `mime_guess` crate if added, but frontend handles mostly\n    })\n}\n\n#[tauri::command]\npub async fn get_selection_context() -\u003e Result\u003cString, String\u003e {\n    use arboard::Clipboard;\n\n    if let Ok(mut clipboard) = Clipboard::new() {\n        if let Ok(text) = clipboard.get_text() {\n            if !text.trim().is_empty() {\n                return Ok(text);\n            }\n        }\n    }\n\n    Err(\"No text found in selection or clipboard\".to_string())\n}\n\n#[tauri::command]\npub async fn copy_to_clipboard(text: String) -\u003e Result\u003c(), String\u003e {\n    use arboard::Clipboard;\n\n    let mut clipboard = Clipboard::new().map_err(|e| e.to_string())?;\n    clipboard.set_text(text).map_err(|e| e.to_string())?;\n\n    Ok(())\n}\n\n#[tauri::command]\npub async fn check_is_executable(path: String) -\u003e Result\u003cbool, String\u003e {\n    let p = std::path::Path::new(\u0026path);\n    if !p.exists() {\n        return Ok(false);\n    }\n    #[cfg(unix)]\n    {\n        use std::os::unix::fs::PermissionsExt;\n        let metadata = p.metadata().map_err(|e| e.to_string())?;\n        return Ok(metadata.permissions().mode() \u0026 0o111 != 0);\n    }\n    #[cfg(not(unix))]\n    {\n        Ok(true) // Assume executable on non-unix for now or just return true\n    }\n}\n\n#[tauri::command]\npub async fn make_file_executable(path: String) -\u003e Result\u003c(), String\u003e {\n    let p = std::path::Path::new(\u0026path);\n    if !p.exists() {\n        return Err(\"File not found\".to_string());\n    }\n    #[cfg(unix)]\n    {\n        use std::os::unix::fs::PermissionsExt;\n        let metadata = p.metadata().map_err(|e| e.to_string())?;\n        let mut perms = metadata.permissions();\n        perms.set_mode(perms.mode() | 0o111);\n        std::fs::set_permissions(p, perms).map_err(|e| e.to_string())?;\n    }\n    Ok(())\n}\n\n#[tauri::command]\npub async fn generate_video_thumbnail(\n    app_handle: tauri::AppHandle,\n    path: String,\n) -\u003e Result\u003cString, String\u003e {\n    use std::process::Command;\n    use tauri::Manager;\n\n    let cache_dir = app_handle\n        .path()\n        .app_cache_dir()\n        .map_err(|e| e.to_string())?;\n\n    // Create cache dir if it doesn't exist\n    if !cache_dir.exists() {\n        std::fs::create_dir_all(\u0026cache_dir).map_err(|e| e.to_string())?;\n    }\n\n    // Hash path to get unique filename\n    use std::collections::hash_map::DefaultHasher;\n    use std::hash::{Hash, Hasher};\n    let mut hasher = DefaultHasher::new();\n    path.hash(\u0026mut hasher);\n    let filename = format!(\"{}.jpg\", hasher.finish());\n    let thumb_path = cache_dir.join(\u0026filename);\n    let thumb_path_str = thumb_path.to_string_lossy().to_string();\n\n    if thumb_path.exists() {\n        return Ok(thumb_path_str);\n    }\n\n    // Run ffmpeg\n    // ffmpeg -y -i \u003cinput\u003e -ss 00:00:01 -vframes 1 -vf scale=640:-1 \u003coutput\u003e\n    let output = Command::new(\"ffmpeg\")\n        .arg(\"-y\")\n        .arg(\"-i\")\n        .arg(\u0026path)\n        .arg(\"-ss\")\n        .arg(\"00:00:01\")\n        .arg(\"-vframes\")\n        .arg(\"1\")\n        // Scale to reasonable width, keep aspect ratio\n        .arg(\"-vf\")\n        .arg(\"scale=640:-1\")\n        .arg(\u0026thumb_path_str)\n        .output()\n        .map_err(|e| format!(\"Failed to execute ffmpeg: {}\", e))?;\n\n    if !output.status.success() {\n        let stderr = String::from_utf8_lossy(\u0026output.stderr);\n        return Err(format!(\"ffmpeg failed: {}\", stderr));\n    }\n\n    Ok(thumb_path_str)\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use std::io::Write;\n\n    #[tokio::test]\n    async fn test_read_file_preview_text() {\n        let temp_dir = std::env::temp_dir();\n        let file_path = temp_dir.join(\"test_preview.txt\");\n        let mut file = std::fs::File::create(\u0026file_path).unwrap();\n        writeln!(file, \"Hello, World!\").unwrap();\n\n        let content = read_file_preview(file_path.to_string_lossy().to_string(), Some(1024))\n            .await\n            .unwrap();\n        assert!(content.contains(\"Hello, World!\"));\n    }\n\n    #[tokio::test]\n    async fn test_read_file_preview_binary() {\n        let temp_dir = std::env::temp_dir();\n        let file_path = temp_dir.join(\"test_preview.bin\");\n        let mut file = std::fs::File::create(\u0026file_path).unwrap();\n        file.write_all(\u0026[0, 1, 2, 3, 4]).unwrap();\n\n        let result = read_file_preview(file_path.to_string_lossy().to_string(), Some(1024)).await;\n        assert!(result.is_err());\n        assert_eq!(result.err().unwrap(), \"Binary file detected\");\n    }\n\n    #[tokio::test]\n    async fn test_get_file_metadata() {\n        let temp_dir = std::env::temp_dir();\n        let file_path = temp_dir.join(\"test_meta.txt\");\n        let mut file = std::fs::File::create(\u0026file_path).unwrap();\n        writeln!(file, \"Meta test\").unwrap();\n\n        let metadata = get_file_metadata(file_path.to_string_lossy().to_string())\n            .await\n            .unwrap();\n        assert!(metadata.size \u003e 0);\n        assert!(!metadata.is_dir);\n    }\n    #[test]\n    fn test_calculate_file_score() {\n        // Exact match\n        assert_eq!(calculate_file_score(\"test\", None, \"test\"), 100);\n\n        // Starts with\n        assert_eq!(calculate_file_score(\"test_file\", None, \"test\"), 50);\n\n        // Extensions\n        // Image (40)\n        assert_eq!(calculate_file_score(\"pic\", Some(\"png\"), \"pic\"), 140); // 100 + 40\n        assert_eq!(calculate_file_score(\"foo\", Some(\"jpg\"), \"bar\"), 40);\n\n        // Video (30)\n        assert_eq!(calculate_file_score(\"vid\", Some(\"mp4\"), \"bar\"), 30);\n\n        // Common (20)\n        assert_eq!(calculate_file_score(\"doc\", Some(\"txt\"), \"bar\"), 20);\n\n        // Prioritization check\n        let img = calculate_file_score(\"a\", Some(\"png\"), \"query\");\n        let vid = calculate_file_score(\"a\", Some(\"mp4\"), \"query\");\n        let doc = calculate_file_score(\"a\", Some(\"txt\"), \"query\");\n        let other = calculate_file_score(\"a\", Some(\"bin\"), \"query\");\n\n        assert!(img \u003e vid);\n        assert!(vid \u003e doc);\n        assert!(doc \u003e other);\n    }\n\n    #[tokio::test]\n    async fn test_search_files_hidden() {\n        let temp_dir = std::env::temp_dir().join(\"test_search_hidden\");\n        let _ = std::fs::remove_dir_all(\u0026temp_dir); // Cleanup previous\n        std::fs::create_dir_all(\u0026temp_dir).unwrap();\n\n        let visible = temp_dir.join(\"visible.txt\");\n        let hidden = temp_dir.join(\".hidden.txt\");\n        let hidden_dir = temp_dir.join(\".hidden_dir\");\n        let file_in_hidden = hidden_dir.join(\"file.txt\");\n\n        std::fs::File::create(\u0026visible).unwrap();\n        std::fs::File::create(\u0026hidden).unwrap();\n        std::fs::create_dir(\u0026hidden_dir).unwrap();\n        std::fs::File::create(\u0026file_in_hidden).unwrap();\n\n        // Test 1: Exclude hidden (default)\n        // Should find 'visible.txt' but not '.hidden.txt' or 'file.txt' inside hidden dir\n        // searching for \"txt\" or \".\" or \"\"\n        let results = search_files(\n            \"txt\".to_string(),\n            temp_dir.to_string_lossy().to_string(),\n            false,\n        )\n        .await\n        .unwrap();\n\n        // Results are absolute paths\n        let found_visible = results.iter().any(|r| r.contains(\"visible.txt\"));\n        let found_hidden = results.iter().any(|r| r.contains(\".hidden.txt\"));\n        let found_in_hidden = results\n            .iter()\n            .any(|r| r.contains(\"file.txt\") \u0026\u0026 r.contains(\".hidden_dir\"));\n\n        assert!(found_visible, \"Should find visible file\");\n        assert!(\n            !found_hidden,\n            \"Should NOT find hidden file when include_hidden=false\"\n        );\n        assert!(\n            !found_in_hidden,\n            \"Should NOT find file in hidden dir when include_hidden=false\"\n        );\n\n        // Test 2: Include hidden\n        let results_all = search_files(\n            \"txt\".to_string(),\n            temp_dir.to_string_lossy().to_string(),\n            true,\n        )\n        .await\n        .unwrap();\n\n        let found_hidden_2 = results_all.iter().any(|r| r.contains(\".hidden.txt\"));\n        let found_in_hidden_2 = results_all\n            .iter()\n            .any(|r| r.contains(\"file.txt\") \u0026\u0026 r.contains(\".hidden_dir\"));\n\n        assert!(\n            found_hidden_2,\n            \"Should find hidden file when include_hidden=true\"\n        );\n        assert!(\n            found_in_hidden_2,\n            \"Should find file in hidden dir when include_hidden=true\"\n        );\n\n        // Cleanup\n        let _ = std::fs::remove_dir_all(\u0026temp_dir);\n    }\n}\n","traces":[{"line":4,"address":[40564928],"length":1,"stats":{"Line":0}},{"line":5,"address":[42131067],"length":1,"stats":{"Line":0}},{"line":9,"address":[42128400,42128403],"length":1,"stats":{"Line":0}},{"line":10,"address":[44303255,44303472],"length":1,"stats":{"Line":0}},{"line":11,"address":[44303476],"length":1,"stats":{"Line":0}},{"line":13,"address":[44303387],"length":1,"stats":{"Line":0}},{"line":25,"address":[42128656,42130869,42130837],"length":1,"stats":{"Line":1}},{"line":26,"address":[42128736],"length":1,"stats":{"Line":1}},{"line":27,"address":[42128747],"length":1,"stats":{"Line":1}},{"line":28,"address":[40562692],"length":1,"stats":{"Line":1}},{"line":31,"address":[42129125,42128868,42128924],"length":1,"stats":{"Line":3}},{"line":32,"address":[40563015,40563006,40562843],"length":1,"stats":{"Line":2}},{"line":33,"address":[42128993,42128938,42129092],"length":1,"stats":{"Line":3}},{"line":34,"address":[42129094,42129062],"length":1,"stats":{"Line":1}},{"line":38,"address":[42129145,42129026],"length":1,"stats":{"Line":2}},{"line":39,"address":[40563065],"length":1,"stats":{"Line":1}},{"line":40,"address":[42129237,42129308],"length":1,"stats":{"Line":2}},{"line":42,"address":[42130807,42129324],"length":1,"stats":{"Line":2}},{"line":45,"address":[42130773,42129712],"length":1,"stats":{"Line":2}},{"line":48,"address":[40563941,40564039],"length":1,"stats":{"Line":3}},{"line":55,"address":[42129196],"length":1,"stats":{"Line":1}},{"line":59,"address":[42128432],"length":1,"stats":{"Line":1}},{"line":64,"address":[44303826,44303721],"length":1,"stats":{"Line":2}},{"line":66,"address":[44303861,44303920],"length":1,"stats":{"Line":2}},{"line":69,"address":[44303995],"length":1,"stats":{"Line":1}},{"line":72,"address":[44755616,44753563],"length":1,"stats":{"Line":2}},{"line":73,"address":[44306083],"length":1,"stats":{"Line":1}},{"line":74,"address":[44755661],"length":1,"stats":{"Line":1}},{"line":76,"address":[44306093],"length":1,"stats":{"Line":1}},{"line":79,"address":[44306128,44304198,44304317,44306156],"length":1,"stats":{"Line":4}},{"line":80,"address":[44304515,44304402],"length":1,"stats":{"Line":2}},{"line":81,"address":[44754097],"length":1,"stats":{"Line":1}},{"line":83,"address":[44304568,44304663],"length":1,"stats":{"Line":2}},{"line":84,"address":[44306014,44306000,44304888],"length":1,"stats":{"Line":3}},{"line":85,"address":[44305062,44306032,44306046],"length":1,"stats":{"Line":3}},{"line":87,"address":[44305160],"length":1,"stats":{"Line":1}},{"line":89,"address":[44305229],"length":1,"stats":{"Line":1}},{"line":90,"address":[44305330],"length":1,"stats":{"Line":1}},{"line":98,"address":[44305430,44306176,44306208],"length":1,"stats":{"Line":3}},{"line":101,"address":[44305976,44305464,44305968],"length":1,"stats":{"Line":3}},{"line":103,"address":[44305601],"length":1,"stats":{"Line":1}},{"line":106,"address":[42131200],"length":1,"stats":{"Line":1}},{"line":110,"address":[44318432,44318445],"length":1,"stats":{"Line":3}},{"line":115,"address":[44308534,44308496,44309766,44309774,44308638,44309507],"length":1,"stats":{"Line":5}},{"line":117,"address":[44308617,44308706],"length":1,"stats":{"Line":2}},{"line":118,"address":[44759776,44759420,44759792,44758330],"length":1,"stats":{"Line":1}},{"line":120,"address":[44308905,44308975],"length":1,"stats":{"Line":2}},{"line":121,"address":[44308983,44309699,44309808,44309824,44309060],"length":1,"stats":{"Line":2}},{"line":122,"address":[44309252],"length":1,"stats":{"Line":1}},{"line":125,"address":[44309271],"length":1,"stats":{"Line":1}},{"line":126,"address":[44309405,44309620],"length":1,"stats":{"Line":2}},{"line":129,"address":[44309455,44309941,44309920,44309342],"length":1,"stats":{"Line":2}},{"line":133,"address":[44307416,44307327,44307280,44308132,44308244],"length":1,"stats":{"Line":4}},{"line":134,"address":[44307409,44308384,44308400,44307498],"length":1,"stats":{"Line":2}},{"line":136,"address":[44307805],"length":1,"stats":{"Line":1}},{"line":139,"address":[44308320,44308333,44307753],"length":1,"stats":{"Line":3}},{"line":140,"address":[44308288,44307778,44308300],"length":1,"stats":{"Line":3}},{"line":142,"address":[44757594],"length":1,"stats":{"Line":1}},{"line":143,"address":[44757473],"length":1,"stats":{"Line":1}},{"line":145,"address":[44307865],"length":1,"stats":{"Line":1}},{"line":146,"address":[44757512],"length":1,"stats":{"Line":1}},{"line":147,"address":[44307958],"length":1,"stats":{"Line":1}},{"line":152,"address":[40564816],"length":1,"stats":{"Line":0}},{"line":155,"address":[44313762,44313920,44313843],"length":1,"stats":{"Line":0}},{"line":156,"address":[44763688,44763719,44763626],"length":1,"stats":{"Line":0}},{"line":157,"address":[44763756,44763827],"length":1,"stats":{"Line":0}},{"line":158,"address":[44314179],"length":1,"stats":{"Line":0}},{"line":163,"address":[44314647],"length":1,"stats":{"Line":0}},{"line":167,"address":[40562400,40562403],"length":1,"stats":{"Line":0}},{"line":170,"address":[44306432,44306964,44307104,44307088,44306343],"length":1,"stats":{"Line":0}},{"line":171,"address":[44306690,44306571,44307200,44307184],"length":1,"stats":{"Line":0}},{"line":173,"address":[44756437],"length":1,"stats":{"Line":0}},{"line":177,"address":[44759888,44759926,44760543,44760012,44760644],"length":1,"stats":{"Line":0}},{"line":178,"address":[44310440,44310335],"length":1,"stats":{"Line":0}},{"line":179,"address":[44760120],"length":1,"stats":{"Line":0}},{"line":180,"address":[44310493],"length":1,"stats":{"Line":0}},{"line":185,"address":[44760688,44760533,44760187,44760704,44760216],"length":1,"stats":{"Line":0}},{"line":186,"address":[44310787],"length":1,"stats":{"Line":0}},{"line":195,"address":[44762236,44762150,44762112,44763015,44763126],"length":1,"stats":{"Line":0}},{"line":196,"address":[44312527,44312632],"length":1,"stats":{"Line":0}},{"line":197,"address":[44762344],"length":1,"stats":{"Line":0}},{"line":198,"address":[44762365,44762421],"length":1,"stats":{"Line":0}},{"line":203,"address":[44762491,44762414,44763121,44763168,44763184],"length":1,"stats":{"Line":0}},{"line":204,"address":[44762722],"length":1,"stats":{"Line":0}},{"line":205,"address":[44313064],"length":1,"stats":{"Line":0}},{"line":206,"address":[44313472,44313420,44313488,44313107],"length":1,"stats":{"Line":0}},{"line":208,"address":[44313287],"length":1,"stats":{"Line":0}},{"line":212,"address":[42130944],"length":1,"stats":{"Line":0}},{"line":219,"address":[44315104,44317963,44315157],"length":1,"stats":{"Line":0}},{"line":222,"address":[44768144,44764853,44764785,44768128],"length":1,"stats":{"Line":0}},{"line":225,"address":[44765077,44764994,44765306],"length":1,"stats":{"Line":0}},{"line":226,"address":[44315372,44318240,44318224,44315433,44315571],"length":1,"stats":{"Line":0}},{"line":232,"address":[44315407],"length":1,"stats":{"Line":0}},{"line":233,"address":[44765335],"length":1,"stats":{"Line":0}},{"line":234,"address":[44765370],"length":1,"stats":{"Line":0}},{"line":235,"address":[44315887,44315804],"length":1,"stats":{"Line":0}},{"line":236,"address":[44765662,44765761],"length":1,"stats":{"Line":0}},{"line":238,"address":[44316175],"length":1,"stats":{"Line":0}},{"line":239,"address":[44316260],"length":1,"stats":{"Line":0}},{"line":244,"address":[44316229,44316849,44316773],"length":1,"stats":{"Line":0}},{"line":247,"address":[44766239],"length":1,"stats":{"Line":0}},{"line":255,"address":[44316698],"length":1,"stats":{"Line":0}},{"line":257,"address":[44317010,44316413,44318042,44316750,44318016,44317832,44316817],"length":1,"stats":{"Line":0}},{"line":259,"address":[44317073],"length":1,"stats":{"Line":0}},{"line":260,"address":[44317247,44317102],"length":1,"stats":{"Line":0}},{"line":261,"address":[44317274,44317345],"length":1,"stats":{"Line":0}},{"line":264,"address":[44317131],"length":1,"stats":{"Line":0}}],"covered":56,"coverable":107},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","translation.rs"],"content":"use crate::domain::translation::{TranslationRequest, TranslationResult};\nuse crate::state::AppState;\nuse tauri::{command, State};\n\n#[command]\npub async fn translate(\n    state: State\u003c'_, AppState\u003e,\n    text: String,\n    source_lang: Option\u003cString\u003e,\n    target_lang: String,\n) -\u003e Result\u003cTranslationResult, String\u003e {\n    let request = TranslationRequest {\n        text,\n        source_lang,\n        target_lang,\n    };\n\n    state\n        .translation_service\n        .translate(request)\n        .await\n        .map_err(|e| e.to_string())\n}\n","traces":[{"line":6,"address":[41523680],"length":1,"stats":{"Line":0}},{"line":18,"address":[40354215,40354402,40354658,40354120,40354334],"length":1,"stats":{"Line":0}},{"line":20,"address":[40354246,40354346],"length":1,"stats":{"Line":0}},{"line":21,"address":[40354415,40354370,40354754,40354515,40354159],"length":1,"stats":{"Line":0}},{"line":22,"address":[40354907,40354880,40354816],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":5},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","commands","windows.rs"],"content":"use crate::domain::windows::WindowEntry;\nuse crate::state::AppState;\nuse tauri::{AppHandle, LogicalSize, Manager, State};\n\n#[tauri::command]\npub async fn list_windows(state: State\u003c'_, AppState\u003e) -\u003e Result\u003cVec\u003cWindowEntry\u003e, String\u003e {\n    let mut windows = state.window_service.list_windows()?;\n\n    // Enrich with icons\n    for window in \u0026mut windows {\n        if window.icon.is_none() {\n            window.icon = state\n                .icon_resolver\n                .resolve_icon(\u0026window.class.to_lowercase());\n        }\n    }\n\n    Ok(windows)\n}\n\n#[tauri::command]\npub async fn focus_window(state: State\u003c'_, AppState\u003e, address: String) -\u003e Result\u003c(), String\u003e {\n    state.window_service.focus_window(\u0026address)\n}\n\n#[tauri::command]\npub async fn resize_window(app_handle: AppHandle, width: u32, height: u32) -\u003e Result\u003c(), String\u003e {\n    if let Some(window) = app_handle.get_webview_window(\"main\") {\n        // Ensure not maximized and is resizable\n        let _ = window.unmaximize();\n        let _ = window.set_fullscreen(false);\n        let _ = window.set_resizable(true);\n\n        window\n            .set_size(LogicalSize::new(width, height))\n            .map_err(|e| e.to_string())?;\n    }\n    Ok(())\n}\n","traces":[{"line":6,"address":[41834136,41834128],"length":1,"stats":{"Line":0}},{"line":7,"address":[41576689,41575613,41575705],"length":1,"stats":{"Line":0}},{"line":10,"address":[41575993,41575926],"length":1,"stats":{"Line":0}},{"line":11,"address":[41576311,41576094],"length":1,"stats":{"Line":0}},{"line":12,"address":[41576328,41576637,41576569,41576528,41576549],"length":1,"stats":{"Line":0}},{"line":14,"address":[41576540,41576605,41576661,41576391],"length":1,"stats":{"Line":0}},{"line":18,"address":[41576116],"length":1,"stats":{"Line":0}},{"line":22,"address":[41575357,41575458,41575056,41575094,41575171],"length":1,"stats":{"Line":0}},{"line":23,"address":[41575159,41575239],"length":1,"stats":{"Line":0}},{"line":27,"address":[43898221,43897350,43897486,43897312,43898114],"length":1,"stats":{"Line":0}},{"line":28,"address":[41576953,41576863],"length":1,"stats":{"Line":0}},{"line":30,"address":[41577029,41577113],"length":1,"stats":{"Line":0}},{"line":31,"address":[41577150],"length":1,"stats":{"Line":0}},{"line":32,"address":[41577197],"length":1,"stats":{"Line":0}},{"line":34,"address":[41577302,41577398],"length":1,"stats":{"Line":0}},{"line":35,"address":[41577231],"length":1,"stats":{"Line":0}},{"line":36,"address":[41577366,41577648,41577632,41577295],"length":1,"stats":{"Line":0}},{"line":38,"address":[41577046],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":18},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","domain","action.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct Action {\n    pub id: String,\n    pub kind: String,    // \"app\", \"script\", \"window\", \"file\"\n    pub content: String, // The executable path, script path, or file path\n    pub name: String,    // Display name\n    pub icon: Option\u003cString\u003e,\n    pub last_accessed: u64,\n    pub frequency: u64,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","domain","ai.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Serialize, Deserialize, Debug, Clone)]\npub struct Message {\n    pub role: String,\n    pub content: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","domain","apps.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Serialize, Deserialize, Debug, Clone, PartialEq, Eq, Hash)]\npub struct AppEntry {\n    pub name: String,\n    pub exec: String,\n    pub icon: Option\u003cString\u003e,\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_app_entry_creation() {\n        let app = AppEntry {\n            name: \"Firefox\".to_string(),\n            exec: \"firefox\".to_string(),\n            icon: Some(\"firefox.png\".to_string()),\n        };\n\n        assert_eq!(app.name, \"Firefox\");\n        assert_eq!(app.exec, \"firefox\");\n        assert_eq!(app.icon, Some(\"firefox.png\".to_string()));\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","domain","config.rs"],"content":"use serde::{Deserialize, Serialize};\nuse std::collections::HashMap;\n\n#[derive(Serialize, Deserialize, Default, Clone, Debug)]\npub struct ThemeConfig {\n    pub name: String,\n    pub primary: String,\n    pub secondary: String,\n    pub background: String,\n    pub surface: String,\n    pub text: String,\n    #[serde(default)]\n    pub is_custom: bool,\n}\n\n#[derive(Serialize, Deserialize, Default, Clone, Debug)]\npub struct ScriptConfig {\n    pub id: String,\n    pub alias: String,\n    pub path: String,\n    pub args: Option\u003cString\u003e,\n}\n\n#[derive(Serialize, Deserialize, Default, Clone, Debug)]\npub struct AiTool {\n    pub id: String,\n    pub name: String,\n    pub description: String,\n    pub prompt_template: String,\n    pub keywords: Vec\u003cString\u003e,\n    pub icon: String,\n}\n\n#[derive(Serialize, Deserialize, Default, Clone)]\npub struct AppConfig {\n    pub openai_api_key: Option\u003cString\u003e,\n    pub local_model_url: Option\u003cString\u003e, // e.g. http://localhost:11434\n    pub preferred_model: String,         // \"local\" or \"cloud\"\n    pub ollama_model: Option\u003cString\u003e,    // Specific model name e.g. \"llama3\"\n\n    #[serde(default)]\n    pub ai_tools: Vec\u003cAiTool\u003e,\n\n    #[serde(default)]\n    pub shortcuts: HashMap\u003cString, String\u003e, // trigger -\u003e tool_id or app_name\n\n    #[serde(default)]\n    pub scripts: Vec\u003cScriptConfig\u003e,\n\n    #[serde(default)]\n    pub window_scale: Option\u003cf32\u003e,\n\n    pub theme: Option\u003cThemeConfig\u003e,\n\n    #[serde(default)]\n    pub file_search: FileSearchConfig,\n}\n\n#[derive(Serialize, Deserialize, Default, Clone, Debug)]\npub struct FileSearchConfig {\n    #[serde(default)]\n    pub include_hidden: bool,\n}\n\nimpl AppConfig {\n    pub fn apply_defaults(\u0026mut self) {\n        if self.preferred_model.is_empty() {\n            self.preferred_model = \"local\".to_string();\n            self.local_model_url = Some(\"http://localhost:11434\".to_string());\n            self.ollama_model = Some(\"llama3\".to_string());\n            self.ollama_model = Some(\"llama3\".to_string());\n        }\n\n        if self.window_scale.is_none() {\n            self.window_scale = Some(0.2); // Default to 20% of screen width\n        }\n\n        if self.theme.is_none() {\n            self.theme = Some(ThemeConfig {\n                name: \"Tokyo Night\".to_string(),\n                primary: \"#7aa2f7\".to_string(),\n                secondary: \"#bb9af7\".to_string(),\n                background: \"#1a1b26\".to_string(),\n                surface: \"#24283b\".to_string(),\n                text: \"#c0caf5\".to_string(),\n                is_custom: false,\n            });\n        }\n\n        if self.ai_tools.is_empty() {\n            self.ai_tools.push(AiTool {\n                 id: \"rephrase\".to_string(),\n                 name: \"Rephrase Selection\".to_string(),\n                 description: \"Improve clarity and grammar\".to_string(),\n                 prompt_template: \"Identity the language of the following text and rephrase it to improve clarity and grammar. Return ONLY the improved text wrapped in a markdown code block (using ```text or the appropriate language). Do not add any conversational text.\\n\\nText:\\n{{selection}}\".to_string(),\n                 keywords: vec![\"rephrase\".to_string(), \"rewrite\".to_string(), \"fix\".to_string(), \"improve\".to_string()],\n                 icon: \"\".to_string()\n             });\n        }\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_apply_defaults() {\n        let mut config = AppConfig::default();\n\n        // Initially empty/defaults\n        assert!(config.preferred_model.is_empty());\n        assert!(config.theme.is_none());\n        assert!(config.ai_tools.is_empty());\n\n        // Apply defaults\n        config.apply_defaults();\n\n        // Check defaults\n        assert_eq!(config.preferred_model, \"local\");\n        assert_eq!(\n            config.local_model_url.as_deref(),\n            Some(\"http://localhost:11434\")\n        );\n        assert_eq!(config.ollama_model.as_deref(), Some(\"llama3\"));\n\n        // Theme\n        assert!(config.theme.is_some());\n        let theme = config.theme.as_ref().unwrap();\n        assert_eq!(theme.name, \"Tokyo Night\");\n\n        // AI Tools\n        assert!(!config.ai_tools.is_empty());\n        assert_eq!(config.ai_tools[0].id, \"rephrase\");\n    }\n\n    #[test]\n    fn test_apply_defaults_preserves_existing() {\n        let mut config = AppConfig::default();\n        config.preferred_model = \"cloud\".to_string();\n        config.theme = Some(ThemeConfig {\n            name: \"Custom\".to_string(),\n            ..Default::default()\n        });\n\n        config.apply_defaults();\n\n        // Should preserve user settings\n        assert_eq!(config.preferred_model, \"cloud\");\n        assert_eq!(config.theme.as_ref().unwrap().name, \"Custom\");\n\n        // But should still fill in missing ones (ai_tools)\n        assert!(!config.ai_tools.is_empty());\n    }\n}\n","traces":[{"line":66,"address":[40302624,40305419,40305408],"length":1,"stats":{"Line":1}},{"line":67,"address":[40303350,40302644],"length":1,"stats":{"Line":2}},{"line":68,"address":[40302683,40302730],"length":1,"stats":{"Line":1}},{"line":69,"address":[40302876,40302805],"length":1,"stats":{"Line":1}},{"line":70,"address":[40904218,40904304],"length":1,"stats":{"Line":1}},{"line":71,"address":[40303152,40303234],"length":1,"stats":{"Line":1}},{"line":74,"address":[40303409,40302658],"length":1,"stats":{"Line":2}},{"line":75,"address":[40303383],"length":1,"stats":{"Line":1}},{"line":78,"address":[40303360,40304169],"length":1,"stats":{"Line":3}},{"line":79,"address":[40304087,40303833],"length":1,"stats":{"Line":2}},{"line":80,"address":[40303438],"length":1,"stats":{"Line":1}},{"line":81,"address":[40303477],"length":1,"stats":{"Line":1}},{"line":82,"address":[40303545],"length":1,"stats":{"Line":2}},{"line":83,"address":[40303617],"length":1,"stats":{"Line":1}},{"line":84,"address":[40904956],"length":1,"stats":{"Line":2}},{"line":85,"address":[40303761],"length":1,"stats":{"Line":1}},{"line":90,"address":[40904682],"length":1,"stats":{"Line":1}},{"line":91,"address":[40304187,40305102],"length":1,"stats":{"Line":4}},{"line":92,"address":[40304196],"length":1,"stats":{"Line":1}},{"line":93,"address":[40304235],"length":1,"stats":{"Line":1}},{"line":94,"address":[40304303],"length":1,"stats":{"Line":1}},{"line":95,"address":[40304375],"length":1,"stats":{"Line":1}},{"line":96,"address":[40304515,40305414,40304457],"length":1,"stats":{"Line":2}},{"line":97,"address":[40305022],"length":1,"stats":{"Line":1}}],"covered":24,"coverable":24},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","domain","mod.rs"],"content":"pub mod ai;\npub mod apps;\npub mod config;\npub mod windows;\n// Future domains: ai, etc.\npub mod action;\npub mod translation;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","domain","translation.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Debug, Serialize, Deserialize, Clone)]\npub struct TranslationResult {\n    pub original_text: String,\n    pub translated_text: String,\n    pub source_language: String,\n    pub target_language: String,\n}\n\n#[derive(Debug, Serialize, Deserialize, Clone)]\npub struct TranslationRequest {\n    pub text: String,\n    pub source_lang: Option\u003cString\u003e,\n    pub target_lang: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","domain","windows.rs"],"content":"use serde::Serialize;\n\n#[derive(Serialize, Clone, Debug)]\npub struct WindowEntry {\n    pub title: String,\n    pub class: String,\n    pub address: String, // ID or Address\n    pub icon: Option\u003cString\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","lib.rs"],"content":"pub mod adapters;\npub mod commands;\npub mod domain;\npub mod ports;\npub mod state;\npub mod tray;\npub mod utils;\n\nuse adapters::cached_icon_resolver::CachedIconResolver;\nuse adapters::file_history::FileHistoryAdapter;\nuse adapters::fs_app_repository::FsAppRepository;\nuse adapters::fs_config_service::FsConfigService;\nuse adapters::google_translation_service::GoogleTranslationService;\nuse adapters::http_ai_service::HttpAiService;\nuse adapters::linux_window_service::LinuxWindowService;\nuse state::AppState;\nuse std::path::PathBuf;\nuse std::sync::Arc;\nuse tauri::{Emitter, Manager};\nuse tray::PaletteTray;\nuse utils::toggle_main_window;\n\n#[cfg_attr(mobile, tauri::mobile_entry_point)]\npub fn run() {\n    tauri::Builder::default()\n        .plugin(tauri_plugin_fs::init())\n        .plugin(tauri_plugin_dialog::init())\n        .plugin(tauri_plugin_clipboard_manager::init())\n        .plugin(tauri_plugin_opener::init())\n        .setup(|app| {\n            // Instantiate Adapters\n            let config_service = Arc::new(FsConfigService::new());\n            let icon_resolver = Arc::new(CachedIconResolver::new());\n            // FsAppRepository needs icon resolver\n            let app_repository = Arc::new(FsAppRepository::new(icon_resolver.clone()));\n            let command_executor = Arc::new(adapters::linux_window_service::StdCommandExecutor);\n            let window_service = Arc::new(LinuxWindowService::new(command_executor));\n            let ai_service = Arc::new(HttpAiService::new());\n\n            let app_data_dir = app\n                .path()\n                .app_data_dir()\n                .unwrap_or_else(|_| PathBuf::from(\".\"));\n            let history_repository = Arc::new(FileHistoryAdapter::new(app_data_dir));\n            let translation_service = Arc::new(GoogleTranslationService::new(None));\n\n            // Manage State\n            app.manage(AppState {\n                app_repository,\n                window_service,\n                config_service: config_service.clone(),\n                icon_resolver: icon_resolver.clone(),\n                ai_service,\n                history_repository,\n                translation_service,\n            });\n\n            // Initialize KSNI Tray Service\n            let handle = app.handle().clone();\n            let tray = PaletteTray { handle };\n            let service = ksni::TrayService::new(tray);\n            let _handle = service.handle();\n\n            service.spawn();\n\n            Ok(())\n        })\n        .plugin(tauri_plugin_single_instance::init(|app, _args, _cwd| {\n            let _ = app.emit(\"open_request\", ());\n            toggle_main_window(app);\n        }))\n        .invoke_handler(tauri::generate_handler![\n            commands::system::greet,\n            commands::system::search_files,\n            commands::system::open_entity,\n            commands::system::read_file_preview,\n            commands::system::get_file_metadata,\n            commands::system::get_selection_context,\n            commands::system::copy_to_clipboard,\n            commands::system::check_is_executable,\n            commands::system::make_file_executable,\n            commands::apps::list_apps,\n            commands::apps::launch_app,\n            commands::config::get_config,\n            commands::config::save_config,\n            commands::ai::ask_ai,\n            commands::ai::check_ai_connection,\n            commands::ai::list_ollama_models,\n            commands::scripts::list_scripts,\n            commands::scripts::execute_script,\n            commands::windows::list_windows,\n            commands::windows::focus_window,\n            commands::windows::focus_window,\n            commands::windows::resize_window,\n            commands::system::generate_video_thumbnail,\n            commands::history::get_recent_actions,\n            commands::history::record_action,\n            commands::history::clear_history,\n            commands::translation::translate,\n        ])\n        .run(tauri::generate_context!())\n        .expect(\"error while running tauri application\");\n}\n","traces":[{"line":24,"address":[61044645],"length":1,"stats":{"Line":0}},{"line":25,"address":[98015520],"length":1,"stats":{"Line":0}},{"line":26,"address":[98097505],"length":1,"stats":{"Line":0}},{"line":27,"address":[89048770,89048901,89048752,89049040,89049050,89048533,89048896,89048528],"length":1,"stats":{"Line":0}},{"line":28,"address":[38463692,38463711,38464301,38463760],"length":1,"stats":{"Line":0}},{"line":29,"address":[38463879,38463830,38464282,38463811],"length":1,"stats":{"Line":1}},{"line":30,"address":[42181651,42179888,42181519],"length":1,"stats":{"Line":0}},{"line":32,"address":[123857323,123857288],"length":1,"stats":{"Line":1}},{"line":33,"address":[89512533],"length":1,"stats":{"Line":2}},{"line":35,"address":[61149360,61149268,61149387],"length":1,"stats":{"Line":3}},{"line":36,"address":[59565686,59564923],"length":1,"stats":{"Line":1}},{"line":37,"address":[86597856],"length":1,"stats":{"Line":1}},{"line":39,"address":[124891664],"length":1,"stats":{"Line":0}},{"line":40,"address":[61806921],"length":1,"stats":{"Line":1}},{"line":41,"address":[89509636],"length":1,"stats":{"Line":0}},{"line":42,"address":[86597954],"length":1,"stats":{"Line":0}},{"line":43,"address":[125732865,125732848,125732426],"length":1,"stats":{"Line":0}},{"line":44,"address":[87275086,87275080,87274448],"length":1,"stats":{"Line":0}},{"line":47,"address":[111538302,111539544,111536337,111537091],"length":1,"stats":{"Line":3}},{"line":48,"address":[98113745],"length":1,"stats":{"Line":2}},{"line":49,"address":[95201977],"length":1,"stats":{"Line":3}},{"line":50,"address":[111430119],"length":1,"stats":{"Line":4}},{"line":51,"address":[75002872,75002950],"length":1,"stats":{"Line":3}},{"line":52,"address":[98015361],"length":1,"stats":{"Line":1}},{"line":53,"address":[42895561],"length":1,"stats":{"Line":5}},{"line":54,"address":[118282532,118282576,118282594],"length":1,"stats":{"Line":2}},{"line":58,"address":[75752571],"length":1,"stats":{"Line":1}},{"line":59,"address":[122459944],"length":1,"stats":{"Line":0}},{"line":60,"address":[61771428,61771436,61770912],"length":1,"stats":{"Line":0}},{"line":61,"address":[85090801],"length":1,"stats":{"Line":1}},{"line":63,"address":[61893188,61893821],"length":1,"stats":{"Line":0}},{"line":65,"address":[114944235,114944108],"length":1,"stats":{"Line":0}},{"line":67,"address":[108570217,108568253,108560160],"length":1,"stats":{"Line":2}},{"line":68,"address":[84575522],"length":1,"stats":{"Line":1}},{"line":69,"address":[95104164,95104254,95104134],"length":1,"stats":{"Line":1}},{"line":71,"address":[61898464],"length":1,"stats":{"Line":2}},{"line":72,"address":[75557280],"length":1,"stats":{"Line":0}},{"line":73,"address":[53766624],"length":1,"stats":{"Line":0}},{"line":74,"address":[106982147,106981995],"length":1,"stats":{"Line":1}},{"line":75,"address":[84510696],"length":1,"stats":{"Line":1}},{"line":76,"address":[53038192],"length":1,"stats":{"Line":2}},{"line":77,"address":[75757240],"length":1,"stats":{"Line":2}},{"line":78,"address":[117950674],"length":1,"stats":{"Line":0}},{"line":79,"address":[99082016,99082040],"length":1,"stats":{"Line":0}},{"line":80,"address":[95163444,95164587],"length":1,"stats":{"Line":0}},{"line":81,"address":[121403714,121382674,121407523,121409500,121408399,121409951,121407315,121382776,121409075,121407344,121407948,121403816],"length":1,"stats":{"Line":0}},{"line":82,"address":[123854060],"length":1,"stats":{"Line":0}},{"line":83,"address":[124889728],"length":1,"stats":{"Line":0}},{"line":84,"address":[98799268,98826818,98827570,98799410,98799321],"length":1,"stats":{"Line":0}},{"line":85,"address":[89511130],"length":1,"stats":{"Line":1}},{"line":86,"address":[84510752],"length":1,"stats":{"Line":1}},{"line":87,"address":[61085240],"length":1,"stats":{"Line":1}},{"line":88,"address":[87210033],"length":1,"stats":{"Line":0}},{"line":89,"address":[75566944,75566963],"length":1,"stats":{"Line":0}},{"line":90,"address":[53766237],"length":1,"stats":{"Line":0}},{"line":91,"address":[124889832,124890207],"length":1,"stats":{"Line":1}},{"line":92,"address":[104025331],"length":1,"stats":{"Line":2}},{"line":93,"address":[114941216,114941972,114941868],"length":1,"stats":{"Line":2}},{"line":94,"address":[75626168,75626083],"length":1,"stats":{"Line":4}},{"line":95,"address":[73622313,73622366],"length":1,"stats":{"Line":2}},{"line":96,"address":[98088579,98088067,98085299,98085763,98088899,98088387,98085235,98085699,98088643,98088835,98088131,98088323],"length":1,"stats":{"Line":3}},{"line":97,"address":[61278779,61279024,61278862,61279046],"length":1,"stats":{"Line":2}},{"line":98,"address":[87207328],"length":1,"stats":{"Line":3}},{"line":100,"address":[118011242],"length":1,"stats":{"Line":2}}],"covered":37,"coverable":64},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","main.rs"],"content":"// Prevents additional console window on Windows in release, DO NOT REMOVE!!\n#![cfg_attr(not(debug_assertions), windows_subsystem = \"windows\")]\n\nfn main() {\n    std::env::set_var(\"WEBKIT_DISABLE_DMABUF_RENDERER\", \"1\");\n    stratos_bar_lib::run()\n}\n","traces":[{"line":4,"address":[38462800],"length":1,"stats":{"Line":0}},{"line":5,"address":[38462801],"length":1,"stats":{"Line":0}},{"line":6,"address":[38462830],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":3},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","ports","ai_port.rs"],"content":"use crate::domain::ai::Message;\nuse crate::domain::config::AppConfig;\nuse futures_util::stream::BoxStream;\n\n#[async_trait::async_trait]\npub trait AiService: Send + Sync {\n    async fn stream_completion\u003c'a\u003e(\n        \u0026'a self,\n        config: \u0026'a AppConfig,\n        messages: Vec\u003cMessage\u003e,\n    ) -\u003e Result\u003cBoxStream\u003c'a, Result\u003cString, String\u003e\u003e, String\u003e;\n\n    async fn check_connection(\u0026self, config: \u0026AppConfig) -\u003e Result\u003cString, String\u003e;\n\n    async fn list_models(\u0026self, config: \u0026AppConfig) -\u003e Result\u003cVec\u003cString\u003e, String\u003e;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","ports","app_port.rs"],"content":"use crate::domain::apps::AppEntry;\n\n#[cfg_attr(test, mockall::automock)]\npub trait AppRepository: Send + Sync {\n    fn list_apps(\u0026self) -\u003e Result\u003cVec\u003cAppEntry\u003e, String\u003e;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","ports","config_port.rs"],"content":"use crate::domain::config::AppConfig;\nuse std::path::PathBuf;\n\n#[cfg_attr(test, mockall::automock)]\npub trait ConfigService: Send + Sync {\n    fn load_config(\u0026self) -\u003e AppConfig;\n    fn save_config(\u0026self, config: \u0026AppConfig) -\u003e Result\u003c(), String\u003e;\n    fn get_config_dir(\u0026self) -\u003e Option\u003cPathBuf\u003e;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","ports","history.rs"],"content":"use crate::domain::action::Action;\nuse async_trait::async_trait;\n\n#[async_trait]\npub trait HistoryRepository: Send + Sync {\n    async fn get_recent(\u0026self, limit: usize) -\u003e Result\u003cVec\u003cAction\u003e, String\u003e;\n    async fn record(\u0026self, action: Action) -\u003e Result\u003c(), String\u003e;\n    async fn clear(\u0026self) -\u003e Result\u003c(), String\u003e;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","ports","icon_port.rs"],"content":"pub trait IconResolver: Send + Sync {\n    fn resolve_icon(\u0026self, icon_name: \u0026str) -\u003e Option\u003cString\u003e;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","ports","mod.rs"],"content":"pub mod ai_port;\npub mod app_port;\npub mod config_port;\npub mod icon_port;\npub mod window_port;\n// pub mod ai_port; // To be added\npub mod history;\npub mod translation_port;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","ports","translation_port.rs"],"content":"use crate::domain::translation::{TranslationRequest, TranslationResult};\nuse async_trait::async_trait;\nuse std::error::Error;\n\n#[async_trait]\npub trait TranslationService: Send + Sync {\n    async fn translate(\n        \u0026self,\n        request: TranslationRequest,\n    ) -\u003e Result\u003cTranslationResult, Box\u003cdyn Error + Send + Sync\u003e\u003e;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","ports","window_port.rs"],"content":"use crate::domain::windows::WindowEntry;\n\npub trait WindowService: Send + Sync {\n    fn list_windows(\u0026self) -\u003e Result\u003cVec\u003cWindowEntry\u003e, String\u003e;\n    fn focus_window(\u0026self, id: \u0026str) -\u003e Result\u003c(), String\u003e;\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","state.rs"],"content":"use crate::ports::ai_port::AiService;\nuse crate::ports::app_port::AppRepository;\nuse crate::ports::config_port::ConfigService;\nuse crate::ports::history::HistoryRepository;\nuse crate::ports::icon_port::IconResolver;\nuse crate::ports::translation_port::TranslationService;\nuse crate::ports::window_port::WindowService;\nuse std::sync::Arc;\n\npub struct AppState {\n    pub app_repository: Arc\u003cdyn AppRepository\u003e,\n    pub window_service: Arc\u003cdyn WindowService\u003e,\n    pub config_service: Arc\u003cdyn ConfigService\u003e,\n    pub icon_resolver: Arc\u003cdyn IconResolver\u003e,\n    pub ai_service: Arc\u003cdyn AiService\u003e,\n    pub history_repository: Arc\u003cdyn HistoryRepository\u003e,\n    pub translation_service: Arc\u003cdyn TranslationService\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","tray.rs"],"content":"use crate::utils::toggle_main_window;\n\n// Reuse PaletteTray as is.\npub struct PaletteTray {\n    pub handle: tauri::AppHandle,\n}\n\nimpl ksni::Tray for PaletteTray {\n    fn icon_pixmap(\u0026self) -\u003e Vec\u003cksni::Icon\u003e {\n        let mut icons = Vec::new();\n\n        let sizes = vec![\n            (include_bytes!(\"../icons/tray-icon-22.png\").to_vec(), 22),\n            (include_bytes!(\"../icons/tray-icon-32.png\").to_vec(), 32),\n            (include_bytes!(\"../icons/tray-icon-48.png\").to_vec(), 48),\n        ];\n\n        for (data, _expected_size) in sizes {\n            if let Ok(image) = image::load_from_memory(\u0026data) {\n                let rgba = image.to_rgba8();\n                let width = rgba.width() as i32;\n                let height = rgba.height() as i32;\n                let raw_rgba = rgba.into_raw();\n\n                let mut argb = Vec::with_capacity(raw_rgba.len());\n                for chunk in raw_rgba.chunks(4) {\n                    if chunk.len() == 4 {\n                        argb.push(chunk[3]); // A\n                        argb.push(chunk[0]); // R\n                        argb.push(chunk[1]); // G\n                        argb.push(chunk[2]); // B\n                    }\n                }\n\n                icons.push(ksni::Icon {\n                    width,\n                    height,\n                    data: argb,\n                });\n            }\n        }\n\n        if !icons.is_empty() {\n            icons\n        } else {\n            if let Some(img) = self.handle.default_window_icon() {\n                vec![ksni::Icon {\n                    width: img.width() as i32,\n                    height: img.height() as i32,\n                    data: img.rgba().to_vec(),\n                }]\n            } else {\n                vec![]\n            }\n        }\n    }\n\n    fn id(\u0026self) -\u003e String {\n        \"stratos-bar\".to_string()\n    }\n\n    fn title(\u0026self) -\u003e String {\n        \"stratos-bar\".to_string()\n    }\n\n    fn activate(\u0026mut self, _x: i32, _y: i32) {\n        toggle_main_window(\u0026self.handle);\n    }\n\n    fn menu(\u0026self) -\u003e Vec\u003cksni::MenuItem\u003cSelf\u003e\u003e {\n        use ksni::menu::*;\n        vec![\n            StandardItem {\n                label: \"Show\".into(),\n                activate: Box::new(|this: \u0026mut Self| {\n                    toggle_main_window(\u0026this.handle);\n                }),\n                ..Default::default()\n            }\n            .into(),\n            StandardItem {\n                label: \"Quit\".into(),\n                activate: Box::new(|this: \u0026mut Self| {\n                    this.handle.exit(0);\n                }),\n                ..Default::default()\n            }\n            .into(),\n        ]\n    }\n}\n","traces":[{"line":9,"address":[40358896,40362040,40360495],"length":1,"stats":{"Line":0}},{"line":10,"address":[40358935],"length":1,"stats":{"Line":0}},{"line":12,"address":[40359218,40359423,40362035,40359332,40359104,40359057,40358990],"length":1,"stats":{"Line":0}},{"line":13,"address":[40359136,40359065],"length":1,"stats":{"Line":0}},{"line":14,"address":[40359250,40359179],"length":1,"stats":{"Line":0}},{"line":15,"address":[44203508,44203433],"length":1,"stats":{"Line":0}},{"line":18,"address":[44203933,44203771],"length":1,"stats":{"Line":0}},{"line":19,"address":[40359856,40360693,40360611],"length":1,"stats":{"Line":0}},{"line":20,"address":[40360812,40360741],"length":1,"stats":{"Line":0}},{"line":21,"address":[40360820,40360885],"length":1,"stats":{"Line":0}},{"line":22,"address":[44205076],"length":1,"stats":{"Line":0}},{"line":23,"address":[40360926],"length":1,"stats":{"Line":0}},{"line":25,"address":[83736896],"length":1,"stats":{"Line":0}},{"line":26,"address":[40361093,40361170],"length":1,"stats":{"Line":0}},{"line":27,"address":[40361403],"length":1,"stats":{"Line":0}},{"line":28,"address":[44205841],"length":1,"stats":{"Line":0}},{"line":29,"address":[83736992],"length":1,"stats":{"Line":0}},{"line":30,"address":[40361790],"length":1,"stats":{"Line":0}},{"line":31,"address":[40361863],"length":1,"stats":{"Line":0}},{"line":35,"address":[40361466],"length":1,"stats":{"Line":0}},{"line":37,"address":[81051685,81050416,81049776,81053226,81051680,81053216,81049781,81050435],"length":1,"stats":{"Line":0}},{"line":38,"address":[40361426],"length":1,"stats":{"Line":0}},{"line":43,"address":[44204073,44204157],"length":1,"stats":{"Line":0}},{"line":44,"address":[40359946],"length":1,"stats":{"Line":0}},{"line":46,"address":[40360035,40359999],"length":1,"stats":{"Line":0}},{"line":47,"address":[40360291,40360501,40360176,40360145,40360105],"length":1,"stats":{"Line":0}},{"line":48,"address":[40360153],"length":1,"stats":{"Line":0}},{"line":49,"address":[40360213],"length":1,"stats":{"Line":0}},{"line":50,"address":[40360233],"length":1,"stats":{"Line":0}},{"line":53,"address":[40360125,40360506],"length":1,"stats":{"Line":0}},{"line":58,"address":[40362064],"length":1,"stats":{"Line":0}},{"line":59,"address":[40362081],"length":1,"stats":{"Line":0}},{"line":62,"address":[40363744],"length":1,"stats":{"Line":0}},{"line":63,"address":[44208017],"length":1,"stats":{"Line":0}},{"line":66,"address":[40363792],"length":1,"stats":{"Line":0}},{"line":67,"address":[44208065],"length":1,"stats":{"Line":0}},{"line":70,"address":[40363654,40362112,40363660],"length":1,"stats":{"Line":0}},{"line":72,"address":[40363708,40363728,40363678,40362674,40363105,40363073,40362599,40362147,40362200],"length":1,"stats":{"Line":0}},{"line":73,"address":[44206573],"length":1,"stats":{"Line":0}},{"line":74,"address":[40362157],"length":1,"stats":{"Line":0}},{"line":75,"address":[39105648],"length":1,"stats":{"Line":0}},{"line":76,"address":[45871465],"length":1,"stats":{"Line":0}},{"line":78,"address":[83734505,83736018,83739957],"length":1,"stats":{"Line":0}},{"line":80,"address":[44206775],"length":1,"stats":{"Line":0}},{"line":81,"address":[40362836],"length":1,"stats":{"Line":0}},{"line":82,"address":[44206847],"length":1,"stats":{"Line":0}},{"line":83,"address":[83733345],"length":1,"stats":{"Line":0}},{"line":84,"address":[45871417],"length":1,"stats":{"Line":0}},{"line":86,"address":[40362792],"length":1,"stats":{"Line":0}},{"line":88,"address":[40363038],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":50},{"path":["/","home","jsteven","Projects","stv-palette","src-tauri","src","utils.rs"],"content":"use tauri::{Emitter, Manager};\n\n/// Helper to toggle the main window's visibility.\n/// If visible, it hides it.\n/// If hidden, it shows, raises, focuses, and emits the 'window-shown' event.\npub fn toggle_main_window(handle: \u0026tauri::AppHandle) {\n    if let Some(window) = handle.get_webview_window(\"main\") {\n        let is_visible = window.is_visible().unwrap_or(false);\n        if is_visible {\n            let _ = window.hide();\n        } else {\n            // Re-assert always on top to ensure it floats above others\n            let _ = window.set_always_on_top(true);\n            let _ = window.show();\n            let _ = window.set_focus();\n            let _ = window.emit(\"window-shown\", ());\n        }\n    }\n}\n","traces":[{"line":6,"address":[48540095],"length":1,"stats":{"Line":0}},{"line":7,"address":[45366322],"length":1,"stats":{"Line":0}},{"line":8,"address":[48540112],"length":1,"stats":{"Line":0}},{"line":9,"address":[89260976],"length":1,"stats":{"Line":0}},{"line":10,"address":[89261000],"length":1,"stats":{"Line":0}},{"line":13,"address":[58997538,58997434],"length":1,"stats":{"Line":0}},{"line":14,"address":[58997533],"length":1,"stats":{"Line":0}},{"line":15,"address":[45366641],"length":1,"stats":{"Line":0}},{"line":16,"address":[45366667],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":9}]};
    </script>
    <script crossorigin>/** @license React v16.13.1
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';(function(d,r){"object"===typeof exports&&"undefined"!==typeof module?r(exports):"function"===typeof define&&define.amd?define(["exports"],r):(d=d||self,r(d.React={}))})(this,function(d){function r(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function w(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function da(){}function L(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function ea(a,b,c){var g,e={},fa=null,d=null;if(null!=b)for(g in void 0!==b.ref&&(d=b.ref),void 0!==b.key&&(fa=""+b.key),b)ha.call(b,g)&&!ia.hasOwnProperty(g)&&(e[g]=b[g]);var h=arguments.length-2;if(1===h)e.children=c;else if(1<h){for(var k=Array(h),f=0;f<h;f++)k[f]=arguments[f+2];e.children=k}if(a&&a.defaultProps)for(g in h=a.defaultProps,
h)void 0===e[g]&&(e[g]=h[g]);return{$$typeof:x,type:a,key:fa,ref:d,props:e,_owner:M.current}}function va(a,b){return{$$typeof:x,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function N(a){return"object"===typeof a&&null!==a&&a.$$typeof===x}function wa(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,function(a){return b[a]})}function ja(a,b,c,g){if(C.length){var e=C.pop();e.result=a;e.keyPrefix=b;e.func=c;e.context=g;e.count=0;return e}return{result:a,keyPrefix:b,func:c,
context:g,count:0}}function ka(a){a.result=null;a.keyPrefix=null;a.func=null;a.context=null;a.count=0;10>C.length&&C.push(a)}function O(a,b,c,g){var e=typeof a;if("undefined"===e||"boolean"===e)a=null;var d=!1;if(null===a)d=!0;else switch(e){case "string":case "number":d=!0;break;case "object":switch(a.$$typeof){case x:case xa:d=!0}}if(d)return c(g,a,""===b?"."+P(a,0):b),1;d=0;b=""===b?".":b+":";if(Array.isArray(a))for(var f=0;f<a.length;f++){e=a[f];var h=b+P(e,f);d+=O(e,h,c,g)}else if(null===a||
"object"!==typeof a?h=null:(h=la&&a[la]||a["@@iterator"],h="function"===typeof h?h:null),"function"===typeof h)for(a=h.call(a),f=0;!(e=a.next()).done;)e=e.value,h=b+P(e,f++),d+=O(e,h,c,g);else if("object"===e)throw c=""+a,Error(r(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return d}function Q(a,b,c){return null==a?0:O(a,"",b,c)}function P(a,b){return"object"===typeof a&&null!==a&&null!=a.key?wa(a.key):b.toString(36)}function ya(a,b,c){a.func.call(a.context,b,
a.count++)}function za(a,b,c){var g=a.result,e=a.keyPrefix;a=a.func.call(a.context,b,a.count++);Array.isArray(a)?R(a,g,c,function(a){return a}):null!=a&&(N(a)&&(a=va(a,e+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(ma,"$&/")+"/")+c)),g.push(a))}function R(a,b,c,g,e){var d="";null!=c&&(d=(""+c).replace(ma,"$&/")+"/");b=ja(b,d,g,e);Q(a,za,b);ka(b)}function t(){var a=na.current;if(null===a)throw Error(r(321));return a}function S(a,b){var c=a.length;a.push(b);a:for(;;){var g=c-1>>>1,e=a[g];if(void 0!==
e&&0<D(e,b))a[g]=b,a[c]=e,c=g;else break a}}function n(a){a=a[0];return void 0===a?null:a}function E(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var g=0,e=a.length;g<e;){var d=2*(g+1)-1,f=a[d],h=d+1,k=a[h];if(void 0!==f&&0>D(f,c))void 0!==k&&0>D(k,f)?(a[g]=k,a[h]=c,g=h):(a[g]=f,a[d]=c,g=d);else if(void 0!==k&&0>D(k,c))a[g]=k,a[h]=c,g=h;else break a}}return b}return null}function D(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}function F(a){for(var b=n(u);null!==
b;){if(null===b.callback)E(u);else if(b.startTime<=a)E(u),b.sortIndex=b.expirationTime,S(p,b);else break;b=n(u)}}function T(a){y=!1;F(a);if(!v)if(null!==n(p))v=!0,z(U);else{var b=n(u);null!==b&&G(T,b.startTime-a)}}function U(a,b){v=!1;y&&(y=!1,V());H=!0;var c=m;try{F(b);for(l=n(p);null!==l&&(!(l.expirationTime>b)||a&&!W());){var g=l.callback;if(null!==g){l.callback=null;m=l.priorityLevel;var e=g(l.expirationTime<=b);b=q();"function"===typeof e?l.callback=e:l===n(p)&&E(p);F(b)}else E(p);l=n(p)}if(null!==
l)var d=!0;else{var f=n(u);null!==f&&G(T,f.startTime-b);d=!1}return d}finally{l=null,m=c,H=!1}}function oa(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1E4;default:return 5E3}}var f="function"===typeof Symbol&&Symbol.for,x=f?Symbol.for("react.element"):60103,xa=f?Symbol.for("react.portal"):60106,Aa=f?Symbol.for("react.fragment"):60107,Ba=f?Symbol.for("react.strict_mode"):60108,Ca=f?Symbol.for("react.profiler"):60114,Da=f?Symbol.for("react.provider"):60109,
Ea=f?Symbol.for("react.context"):60110,Fa=f?Symbol.for("react.forward_ref"):60112,Ga=f?Symbol.for("react.suspense"):60113,Ha=f?Symbol.for("react.memo"):60115,Ia=f?Symbol.for("react.lazy"):60116,la="function"===typeof Symbol&&Symbol.iterator,pa=Object.getOwnPropertySymbols,Ja=Object.prototype.hasOwnProperty,Ka=Object.prototype.propertyIsEnumerable,I=function(){try{if(!Object.assign)return!1;var a=new String("abc");a[5]="de";if("5"===Object.getOwnPropertyNames(a)[0])return!1;var b={};for(a=0;10>a;a++)b["_"+
String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(b).map(function(a){return b[a]}).join(""))return!1;var c={};"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=a});return"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},c)).join("")?!1:!0}catch(g){return!1}}()?Object.assign:function(a,b){if(null===a||void 0===a)throw new TypeError("Object.assign cannot be called with null or undefined");var c=Object(a);for(var g,e=1;e<arguments.length;e++){var d=Object(arguments[e]);
for(var f in d)Ja.call(d,f)&&(c[f]=d[f]);if(pa){g=pa(d);for(var h=0;h<g.length;h++)Ka.call(d,g[h])&&(c[g[h]]=d[g[h]])}}return c},ca={isMounted:function(a){return!1},enqueueForceUpdate:function(a,b,c){},enqueueReplaceState:function(a,b,c,d){},enqueueSetState:function(a,b,c,d){}},ba={};w.prototype.isReactComponent={};w.prototype.setState=function(a,b){if("object"!==typeof a&&"function"!==typeof a&&null!=a)throw Error(r(85));this.updater.enqueueSetState(this,a,b,"setState")};w.prototype.forceUpdate=
function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};da.prototype=w.prototype;f=L.prototype=new da;f.constructor=L;I(f,w.prototype);f.isPureReactComponent=!0;var M={current:null},ha=Object.prototype.hasOwnProperty,ia={key:!0,ref:!0,__self:!0,__source:!0},ma=/\/+/g,C=[],na={current:null},X;if("undefined"===typeof window||"function"!==typeof MessageChannel){var A=null,qa=null,ra=function(){if(null!==A)try{var a=q();A(!0,a);A=null}catch(b){throw setTimeout(ra,0),b;}},La=Date.now();var q=
function(){return Date.now()-La};var z=function(a){null!==A?setTimeout(z,0,a):(A=a,setTimeout(ra,0))};var G=function(a,b){qa=setTimeout(a,b)};var V=function(){clearTimeout(qa)};var W=function(){return!1};f=X=function(){}}else{var Y=window.performance,sa=window.Date,Ma=window.setTimeout,Na=window.clearTimeout;"undefined"!==typeof console&&(f=window.cancelAnimationFrame,"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),
"function"!==typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));if("object"===typeof Y&&"function"===typeof Y.now)q=function(){return Y.now()};else{var Oa=sa.now();q=function(){return sa.now()-Oa}}var J=!1,K=null,Z=-1,ta=5,ua=0;W=function(){return q()>=ua};f=function(){};X=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):
ta=0<a?Math.floor(1E3/a):5};var B=new MessageChannel,aa=B.port2;B.port1.onmessage=function(){if(null!==K){var a=q();ua=a+ta;try{K(!0,a)?aa.postMessage(null):(J=!1,K=null)}catch(b){throw aa.postMessage(null),b;}}else J=!1};z=function(a){K=a;J||(J=!0,aa.postMessage(null))};G=function(a,b){Z=Ma(function(){a(q())},b)};V=function(){Na(Z);Z=-1}}var p=[],u=[],Pa=1,l=null,m=3,H=!1,v=!1,y=!1,Qa=0;B={ReactCurrentDispatcher:na,ReactCurrentOwner:M,IsSomeRendererActing:{current:!1},assign:I};I(B,{Scheduler:{__proto__:null,
unstable_ImmediatePriority:1,unstable_UserBlockingPriority:2,unstable_NormalPriority:3,unstable_IdlePriority:5,unstable_LowPriority:4,unstable_runWithPriority:function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=m;m=a;try{return b()}finally{m=c}},unstable_next:function(a){switch(m){case 1:case 2:case 3:var b=3;break;default:b=m}var c=m;m=b;try{return a()}finally{m=c}},unstable_scheduleCallback:function(a,b,c){var d=q();if("object"===typeof c&&null!==c){var e=c.delay;
e="number"===typeof e&&0<e?d+e:d;c="number"===typeof c.timeout?c.timeout:oa(a)}else c=oa(a),e=d;c=e+c;a={id:Pa++,callback:b,priorityLevel:a,startTime:e,expirationTime:c,sortIndex:-1};e>d?(a.sortIndex=e,S(u,a),null===n(p)&&a===n(u)&&(y?V():y=!0,G(T,e-d))):(a.sortIndex=c,S(p,a),v||H||(v=!0,z(U)));return a},unstable_cancelCallback:function(a){a.callback=null},unstable_wrapCallback:function(a){var b=m;return function(){var c=m;m=b;try{return a.apply(this,arguments)}finally{m=c}}},unstable_getCurrentPriorityLevel:function(){return m},
unstable_shouldYield:function(){var a=q();F(a);var b=n(p);return b!==l&&null!==l&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<l.expirationTime||W()},unstable_requestPaint:f,unstable_continueExecution:function(){v||H||(v=!0,z(U))},unstable_pauseExecution:function(){},unstable_getFirstCallbackNode:function(){return n(p)},get unstable_now(){return q},get unstable_forceFrameRate(){return X},unstable_Profiling:null},SchedulerTracing:{__proto__:null,__interactionsRef:null,__subscriberRef:null,
unstable_clear:function(a){return a()},unstable_getCurrent:function(){return null},unstable_getThreadID:function(){return++Qa},unstable_trace:function(a,b,c){return c()},unstable_wrap:function(a){return a},unstable_subscribe:function(a){},unstable_unsubscribe:function(a){}}});d.Children={map:function(a,b,c){if(null==a)return a;var d=[];R(a,d,null,b,c);return d},forEach:function(a,b,c){if(null==a)return a;b=ja(null,null,b,c);Q(a,ya,b);ka(b)},count:function(a){return Q(a,function(){return null},null)},
toArray:function(a){var b=[];R(a,b,null,function(a){return a});return b},only:function(a){if(!N(a))throw Error(r(143));return a}};d.Component=w;d.Fragment=Aa;d.Profiler=Ca;d.PureComponent=L;d.StrictMode=Ba;d.Suspense=Ga;d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B;d.cloneElement=function(a,b,c){if(null===a||void 0===a)throw Error(r(267,a));var d=I({},a.props),e=a.key,f=a.ref,m=a._owner;if(null!=b){void 0!==b.ref&&(f=b.ref,m=M.current);void 0!==b.key&&(e=""+b.key);if(a.type&&a.type.defaultProps)var h=
a.type.defaultProps;for(k in b)ha.call(b,k)&&!ia.hasOwnProperty(k)&&(d[k]=void 0===b[k]&&void 0!==h?h[k]:b[k])}var k=arguments.length-2;if(1===k)d.children=c;else if(1<k){h=Array(k);for(var l=0;l<k;l++)h[l]=arguments[l+2];d.children=h}return{$$typeof:x,type:a.type,key:e,ref:f,props:d,_owner:m}};d.createContext=function(a,b){void 0===b&&(b=null);a={$$typeof:Ea,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null};a.Provider={$$typeof:Da,_context:a};return a.Consumer=
a};d.createElement=ea;d.createFactory=function(a){var b=ea.bind(null,a);b.type=a;return b};d.createRef=function(){return{current:null}};d.forwardRef=function(a){return{$$typeof:Fa,render:a}};d.isValidElement=N;d.lazy=function(a){return{$$typeof:Ia,_ctor:a,_status:-1,_result:null}};d.memo=function(a,b){return{$$typeof:Ha,type:a,compare:void 0===b?null:b}};d.useCallback=function(a,b){return t().useCallback(a,b)};d.useContext=function(a,b){return t().useContext(a,b)};d.useDebugValue=function(a,b){};
d.useEffect=function(a,b){return t().useEffect(a,b)};d.useImperativeHandle=function(a,b,c){return t().useImperativeHandle(a,b,c)};d.useLayoutEffect=function(a,b){return t().useLayoutEffect(a,b)};d.useMemo=function(a,b){return t().useMemo(a,b)};d.useReducer=function(a,b,c){return t().useReducer(a,b,c)};d.useRef=function(a){return t().useRef(a)};d.useState=function(a){return t().useState(a)};d.version="16.13.1"});
</script>
    <script crossorigin>/** @license React v16.13.1
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/*
 Modernizr 3.0.0pre (Custom Build) | MIT
*/
'use strict';(function(I,ea){"object"===typeof exports&&"undefined"!==typeof module?ea(exports,require("react")):"function"===typeof define&&define.amd?define(["exports","react"],ea):(I=I||self,ea(I.ReactDOM={},I.React))})(this,function(I,ea){function k(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function ji(a,b,c,d,e,f,g,h,m){yb=!1;gc=null;ki.apply(li,arguments)}function mi(a,b,c,d,e,f,g,h,m){ji.apply(this,arguments);if(yb){if(yb){var n=gc;yb=!1;gc=null}else throw Error(k(198));hc||(hc=!0,pd=n)}}function lf(a,b,c){var d=a.type||"unknown-event";a.currentTarget=mf(c);mi(d,b,void 0,a);a.currentTarget=null}function nf(){if(ic)for(var a in cb){var b=cb[a],c=ic.indexOf(a);if(!(-1<c))throw Error(k(96,a));if(!jc[c]){if(!b.extractEvents)throw Error(k(97,a));jc[c]=b;c=b.eventTypes;for(var d in c){var e=
void 0;var f=c[d],g=b,h=d;if(qd.hasOwnProperty(h))throw Error(k(99,h));qd[h]=f;var m=f.phasedRegistrationNames;if(m){for(e in m)m.hasOwnProperty(e)&&of(m[e],g,h);e=!0}else f.registrationName?(of(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(k(98,d,a));}}}}function of(a,b,c){if(db[a])throw Error(k(100,a));db[a]=b;rd[a]=b.eventTypes[c].dependencies}function pf(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!cb.hasOwnProperty(c)||cb[c]!==d){if(cb[c])throw Error(k(102,c));cb[c]=
d;b=!0}}b&&nf()}function qf(a){if(a=rf(a)){if("function"!==typeof sd)throw Error(k(280));var b=a.stateNode;b&&(b=td(b),sd(a.stateNode,a.type,b))}}function sf(a){eb?fb?fb.push(a):fb=[a]:eb=a}function tf(){if(eb){var a=eb,b=fb;fb=eb=null;qf(a);if(b)for(a=0;a<b.length;a++)qf(b[a])}}function ud(){if(null!==eb||null!==fb)vd(),tf()}function uf(a,b,c){if(wd)return a(b,c);wd=!0;try{return vf(a,b,c)}finally{wd=!1,ud()}}function ni(a){if(wf.call(xf,a))return!0;if(wf.call(yf,a))return!1;if(oi.test(a))return xf[a]=
!0;yf[a]=!0;return!1}function pi(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case "function":case "symbol":return!0;case "boolean":if(d)return!1;if(null!==c)return!c.acceptsBooleans;a=a.toLowerCase().slice(0,5);return"data-"!==a&&"aria-"!==a;default:return!1}}function qi(a,b,c,d){if(null===b||"undefined"===typeof b||pi(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function L(a,
b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b;this.attributeName=d;this.attributeNamespace=e;this.mustUseProperty=c;this.propertyName=a;this.type=b;this.sanitizeURL=f}function xd(a,b,c,d){var e=E.hasOwnProperty(b)?E[b]:null;var f=null!==e?0===e.type:d?!1:!(2<b.length)||"o"!==b[0]&&"O"!==b[0]||"n"!==b[1]&&"N"!==b[1]?!1:!0;f||(qi(b,c,e,d)&&(c=null),d||null===e?ni(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3===e.type?!1:"":c:(b=e.attributeName,
d=e.attributeNamespace,null===c?a.removeAttribute(b):(e=e.type,c=3===e||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}function zb(a){if(null===a||"object"!==typeof a)return null;a=zf&&a[zf]||a["@@iterator"];return"function"===typeof a?a:null}function ri(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b();a._result=b;b.then(function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)},function(b){0===a._status&&(a._status=2,a._result=b)})}}function na(a){if(null==a)return null;
if("function"===typeof a)return a.displayName||a.name||null;if("string"===typeof a)return a;switch(a){case Ma:return"Fragment";case gb:return"Portal";case kc:return"Profiler";case Af:return"StrictMode";case lc:return"Suspense";case yd:return"SuspenseList"}if("object"===typeof a)switch(a.$$typeof){case Bf:return"Context.Consumer";case Cf:return"Context.Provider";case zd:var b=a.render;b=b.displayName||b.name||"";return a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case Ad:return na(a.type);
case Df:return na(a.render);case Ef:if(a=1===a._status?a._result:null)return na(a)}return null}function Bd(a){var b="";do{a:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break a;default:var d=a._debugOwner,e=a._debugSource,f=na(a.type);c=null;d&&(c=na(d.type));d=f;f="";e?f=" (at "+e.fileName.replace(si,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")");c="\n    in "+(d||"Unknown")+f}b+=c;a=a.return}while(a);return b}function va(a){switch(typeof a){case "boolean":case "number":case "object":case "string":case "undefined":return a;
default:return""}}function Ff(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function ti(a){var b=Ff(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&"undefined"!==typeof c&&"function"===typeof c.get&&"function"===typeof c.set){var e=c.get,f=c.set;Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a;f.call(this,a)}});Object.defineProperty(a,
b,{enumerable:c.enumerable});return{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null;delete a[b]}}}}function mc(a){a._valueTracker||(a._valueTracker=ti(a))}function Gf(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue();var d="";a&&(d=Ff(a)?a.checked?"true":"false":a.value);a=d;return a!==c?(b.setValue(a),!0):!1}function Cd(a,b){var c=b.checked;return M({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=
c?c:a._wrapperState.initialChecked})}function Hf(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=va(null!=b.value?b.value:c);a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function If(a,b){b=b.checked;null!=b&&xd(a,"checked",b,!1)}function Dd(a,b){If(a,b);var c=va(b.value),d=b.type;if(null!=c)if("number"===d){if(0===c&&""===a.value||a.value!=c)a.value=""+c}else a.value!==
""+c&&(a.value=""+c);else if("submit"===d||"reset"===d){a.removeAttribute("value");return}b.hasOwnProperty("value")?Ed(a,b.type,c):b.hasOwnProperty("defaultValue")&&Ed(a,b.type,va(b.defaultValue));null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Jf(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue;c||b===a.value||(a.value=
b);a.defaultValue=b}c=a.name;""!==c&&(a.name="");a.defaultChecked=!!a._wrapperState.initialChecked;""!==c&&(a.name=c)}function Ed(a,b,c){if("number"!==b||a.ownerDocument.activeElement!==a)null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c)}function ui(a){var b="";ea.Children.forEach(a,function(a){null!=a&&(b+=a)});return b}function Fd(a,b){a=M({children:void 0},b);if(b=ui(b.children))a.children=b;return a}function hb(a,b,c,d){a=a.options;if(b){b={};
for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{c=""+va(c);b=null;for(e=0;e<a.length;e++){if(a[e].value===c){a[e].selected=!0;d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Gd(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(k(91));return M({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}
function Kf(a,b){var c=b.value;if(null==c){c=b.children;b=b.defaultValue;if(null!=c){if(null!=b)throw Error(k(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(k(93));c=c[0]}b=c}null==b&&(b="");c=b}a._wrapperState={initialValue:va(c)}}function Lf(a,b){var c=va(b.value),d=va(b.defaultValue);null!=c&&(c=""+c,c!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c));null!=d&&(a.defaultValue=""+d)}function Mf(a,b){b=a.textContent;b===a._wrapperState.initialValue&&""!==
b&&null!==b&&(a.value=b)}function Nf(a){switch(a){case "svg":return"http://www.w3.org/2000/svg";case "math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hd(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Nf(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}function nc(a,b){var c={};c[a.toLowerCase()]=b.toLowerCase();c["Webkit"+a]="webkit"+b;c["Moz"+a]="moz"+b;return c}function oc(a){if(Id[a])return Id[a];
if(!ib[a])return a;var b=ib[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Of)return Id[a]=b[c];return a}function Jd(a){var b=Pf.get(a);void 0===b&&(b=new Map,Pf.set(a,b));return b}function Na(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do b=a,0!==(b.effectTag&1026)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function Qf(a){if(13===a.tag){var b=a.memoizedState;null===b&&(a=a.alternate,null!==a&&(b=a.memoizedState));if(null!==b)return b.dehydrated}return null}function Rf(a){if(Na(a)!==
a)throw Error(k(188));}function vi(a){var b=a.alternate;if(!b){b=Na(a);if(null===b)throw Error(k(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){d=e.return;if(null!==d){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return Rf(e),a;if(f===d)return Rf(e),b;f=f.sibling}throw Error(k(188));}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0;c=e;d=f;break}if(h===d){g=!0;d=e;c=f;break}h=h.sibling}if(!g){for(h=
f.child;h;){if(h===c){g=!0;c=f;d=e;break}if(h===d){g=!0;d=f;c=e;break}h=h.sibling}if(!g)throw Error(k(189));}}if(c.alternate!==d)throw Error(k(190));}if(3!==c.tag)throw Error(k(188));return c.stateNode.current===c?a:b}function Sf(a){a=vi(a);if(!a)return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}}return null}function jb(a,b){if(null==
b)throw Error(k(30));if(null==a)return b;if(Array.isArray(a)){if(Array.isArray(b))return a.push.apply(a,b),a;a.push(b);return a}return Array.isArray(b)?[a].concat(b):[a,b]}function Kd(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}function pc(a){null!==a&&(Ab=jb(Ab,a));a=Ab;Ab=null;if(a){Kd(a,wi);if(Ab)throw Error(k(95));if(hc)throw a=pd,hc=!1,pd=null,a;}}function Ld(a){a=a.target||a.srcElement||window;a.correspondingUseElement&&(a=a.correspondingUseElement);return 3===a.nodeType?a.parentNode:
a}function Tf(a){if(!wa)return!1;a="on"+a;var b=a in document;b||(b=document.createElement("div"),b.setAttribute(a,"return;"),b="function"===typeof b[a]);return b}function Uf(a){a.topLevelType=null;a.nativeEvent=null;a.targetInst=null;a.ancestors.length=0;10>qc.length&&qc.push(a)}function Vf(a,b,c,d){if(qc.length){var e=qc.pop();e.topLevelType=a;e.eventSystemFlags=d;e.nativeEvent=b;e.targetInst=c;return e}return{topLevelType:a,eventSystemFlags:d,nativeEvent:b,targetInst:c,ancestors:[]}}function Wf(a){var b=
a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;b=c.tag;5!==b&&6!==b||a.ancestors.push(c);c=Bb(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=Ld(a.nativeEvent);d=a.topLevelType;var f=a.nativeEvent,g=a.eventSystemFlags;0===c&&(g|=64);for(var h=null,m=0;m<jc.length;m++){var n=jc[m];n&&(n=n.extractEvents(d,b,f,e,g))&&(h=jb(h,n))}pc(h)}}function Md(a,
b,c){if(!c.has(a)){switch(a){case "scroll":Cb(b,"scroll",!0);break;case "focus":case "blur":Cb(b,"focus",!0);Cb(b,"blur",!0);c.set("blur",null);c.set("focus",null);break;case "cancel":case "close":Tf(a)&&Cb(b,a,!0);break;case "invalid":case "submit":case "reset":break;default:-1===Db.indexOf(a)&&w(a,b)}c.set(a,null)}}function xi(a,b){var c=Jd(b);Nd.forEach(function(a){Md(a,b,c)});yi.forEach(function(a){Md(a,b,c)})}function Od(a,b,c,d,e){return{blockedOn:a,topLevelType:b,eventSystemFlags:c|32,nativeEvent:e,
container:d}}function Xf(a,b){switch(a){case "focus":case "blur":xa=null;break;case "dragenter":case "dragleave":ya=null;break;case "mouseover":case "mouseout":za=null;break;case "pointerover":case "pointerout":Eb.delete(b.pointerId);break;case "gotpointercapture":case "lostpointercapture":Fb.delete(b.pointerId)}}function Gb(a,b,c,d,e,f){if(null===a||a.nativeEvent!==f)return a=Od(b,c,d,e,f),null!==b&&(b=Hb(b),null!==b&&Yf(b)),a;a.eventSystemFlags|=d;return a}function zi(a,b,c,d,e){switch(b){case "focus":return xa=
Gb(xa,a,b,c,d,e),!0;case "dragenter":return ya=Gb(ya,a,b,c,d,e),!0;case "mouseover":return za=Gb(za,a,b,c,d,e),!0;case "pointerover":var f=e.pointerId;Eb.set(f,Gb(Eb.get(f)||null,a,b,c,d,e));return!0;case "gotpointercapture":return f=e.pointerId,Fb.set(f,Gb(Fb.get(f)||null,a,b,c,d,e)),!0}return!1}function Ai(a){var b=Bb(a.target);if(null!==b){var c=Na(b);if(null!==c)if(b=c.tag,13===b){if(b=Qf(c),null!==b){a.blockedOn=b;Pd(a.priority,function(){Bi(c)});return}}else if(3===b&&c.stateNode.hydrate){a.blockedOn=
3===c.tag?c.stateNode.containerInfo:null;return}}a.blockedOn=null}function rc(a){if(null!==a.blockedOn)return!1;var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);if(null!==b){var c=Hb(b);null!==c&&Yf(c);a.blockedOn=b;return!1}return!0}function Zf(a,b,c){rc(a)&&c.delete(b)}function Ci(){for(Rd=!1;0<fa.length;){var a=fa[0];if(null!==a.blockedOn){a=Hb(a.blockedOn);null!==a&&Di(a);break}var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);null!==b?a.blockedOn=b:fa.shift()}null!==
xa&&rc(xa)&&(xa=null);null!==ya&&rc(ya)&&(ya=null);null!==za&&rc(za)&&(za=null);Eb.forEach(Zf);Fb.forEach(Zf)}function Ib(a,b){a.blockedOn===b&&(a.blockedOn=null,Rd||(Rd=!0,$f(ag,Ci)))}function bg(a){if(0<fa.length){Ib(fa[0],a);for(var b=1;b<fa.length;b++){var c=fa[b];c.blockedOn===a&&(c.blockedOn=null)}}null!==xa&&Ib(xa,a);null!==ya&&Ib(ya,a);null!==za&&Ib(za,a);b=function(b){return Ib(b,a)};Eb.forEach(b);Fb.forEach(b);for(b=0;b<Jb.length;b++)c=Jb[b],c.blockedOn===a&&(c.blockedOn=null);for(;0<Jb.length&&
(b=Jb[0],null===b.blockedOn);)Ai(b),null===b.blockedOn&&Jb.shift()}function Sd(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1],f="on"+(e[0].toUpperCase()+e.slice(1));f={phasedRegistrationNames:{bubbled:f,captured:f+"Capture"},dependencies:[d],eventPriority:b};Td.set(d,b);cg.set(d,f);dg[e]=f}}function w(a,b){Cb(b,a,!1)}function Cb(a,b,c){var d=Td.get(b);switch(void 0===d?2:d){case 0:d=Ei.bind(null,b,1,a);break;case 1:d=Fi.bind(null,b,1,a);break;default:d=sc.bind(null,b,1,a)}c?a.addEventListener(b,
d,!0):a.addEventListener(b,d,!1)}function Ei(a,b,c,d){Oa||vd();var e=sc,f=Oa;Oa=!0;try{eg(e,a,b,c,d)}finally{(Oa=f)||ud()}}function Fi(a,b,c,d){Gi(Hi,sc.bind(null,a,b,c,d))}function sc(a,b,c,d){if(tc)if(0<fa.length&&-1<Nd.indexOf(a))a=Od(null,a,b,c,d),fa.push(a);else{var e=Qd(a,b,c,d);if(null===e)Xf(a,d);else if(-1<Nd.indexOf(a))a=Od(e,a,b,c,d),fa.push(a);else if(!zi(e,a,b,c,d)){Xf(a,d);a=Vf(a,d,null,b);try{uf(Wf,a)}finally{Uf(a)}}}}function Qd(a,b,c,d){c=Ld(d);c=Bb(c);if(null!==c){var e=Na(c);if(null===
e)c=null;else{var f=e.tag;if(13===f){c=Qf(e);if(null!==c)return c;c=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;c=null}else e!==c&&(c=null)}}a=Vf(a,d,c,b);try{uf(Wf,a)}finally{Uf(a)}return null}function fg(a,b,c){return null==b||"boolean"===typeof b||""===b?"":c||"number"!==typeof b||0===b||Kb.hasOwnProperty(a)&&Kb[a]?(""+b).trim():b+"px"}function gg(a,b){a=a.style;for(var c in b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=fg(c,b[c],d);"float"===
c&&(c="cssFloat");d?a.setProperty(c,e):a[c]=e}}function Ud(a,b){if(b){if(Ii[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(k(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(k(60));if(!("object"===typeof b.dangerouslySetInnerHTML&&"__html"in b.dangerouslySetInnerHTML))throw Error(k(61));}if(null!=b.style&&"object"!==typeof b.style)throw Error(k(62,""));}}function Vd(a,b){if(-1===a.indexOf("-"))return"string"===typeof b.is;switch(a){case "annotation-xml":case "color-profile":case "font-face":case "font-face-src":case "font-face-uri":case "font-face-format":case "font-face-name":case "missing-glyph":return!1;
default:return!0}}function oa(a,b){a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument;var c=Jd(a);b=rd[b];for(var d=0;d<b.length;d++)Md(b[d],a,c)}function uc(){}function Wd(a){a=a||("undefined"!==typeof document?document:void 0);if("undefined"===typeof a)return null;try{return a.activeElement||a.body}catch(b){return a.body}}function hg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ig(a,b){var c=hg(a);a=0;for(var d;c;){if(3===c.nodeType){d=a+c.textContent.length;if(a<=b&&d>=b)return{node:c,
offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=hg(c)}}function jg(a,b){return a&&b?a===b?!0:a&&3===a.nodeType?!1:b&&3===b.nodeType?jg(a,b.parentNode):"contains"in a?a.contains(b):a.compareDocumentPosition?!!(a.compareDocumentPosition(b)&16):!1:!1}function kg(){for(var a=window,b=Wd();b instanceof a.HTMLIFrameElement;){try{var c="string"===typeof b.contentWindow.location.href}catch(d){c=!1}if(c)a=b.contentWindow;else break;b=Wd(a.document)}return b}
function Xd(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}function lg(a,b){switch(a){case "button":case "input":case "select":case "textarea":return!!b.autoFocus}return!1}function Yd(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"===typeof b.children||"number"===typeof b.children||"object"===typeof b.dangerouslySetInnerHTML&&
null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}function kb(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function mg(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if(c===ng||c===Zd||c===$d){if(0===b)return a;b--}else c===og&&b++}a=a.previousSibling}return null}function Bb(a){var b=a[Aa];if(b)return b;for(var c=a.parentNode;c;){if(b=c[Lb]||c[Aa]){c=b.alternate;if(null!==b.child||null!==c&&null!==c.child)for(a=mg(a);null!==
a;){if(c=a[Aa])return c;a=mg(a)}return b}a=c;c=a.parentNode}return null}function Hb(a){a=a[Aa]||a[Lb];return!a||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Pa(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(k(33));}function ae(a){return a[vc]||null}function pa(a){do a=a.return;while(a&&5!==a.tag);return a?a:null}function pg(a,b){var c=a.stateNode;if(!c)return null;var d=td(c);if(!d)return null;c=d[b];a:switch(b){case "onClick":case "onClickCapture":case "onDoubleClick":case "onDoubleClickCapture":case "onMouseDown":case "onMouseDownCapture":case "onMouseMove":case "onMouseMoveCapture":case "onMouseUp":case "onMouseUpCapture":case "onMouseEnter":(d=
!d.disabled)||(a=a.type,d=!("button"===a||"input"===a||"select"===a||"textarea"===a));a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!==typeof c)throw Error(k(231,b,typeof c));return c}function qg(a,b,c){if(b=pg(a,c.dispatchConfig.phasedRegistrationNames[b]))c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a)}function Ji(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=pa(b);for(b=c.length;0<b--;)qg(c[b],
"captured",a);for(b=0;b<c.length;b++)qg(c[b],"bubbled",a)}}function be(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=pg(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a))}function Ki(a){a&&a.dispatchConfig.registrationName&&be(a._targetInst,null,a)}function lb(a){Kd(a,Ji)}function rg(){if(wc)return wc;var a,b=ce,c=b.length,d,e="value"in Ba?Ba.value:Ba.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=
c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return wc=e.slice(a,1<d?1-d:void 0)}function xc(){return!0}function yc(){return!1}function R(a,b,c,d){this.dispatchConfig=a;this._targetInst=b;this.nativeEvent=c;a=this.constructor.Interface;for(var e in a)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?xc:yc;this.isPropagationStopped=yc;return this}function Li(a,b,c,d){if(this.eventPool.length){var e=
this.eventPool.pop();this.call(e,a,b,c,d);return e}return new this(a,b,c,d)}function Mi(a){if(!(a instanceof this))throw Error(k(279));a.destructor();10>this.eventPool.length&&this.eventPool.push(a)}function sg(a){a.eventPool=[];a.getPooled=Li;a.release=Mi}function tg(a,b){switch(a){case "keyup":return-1!==Ni.indexOf(b.keyCode);case "keydown":return 229!==b.keyCode;case "keypress":case "mousedown":case "blur":return!0;default:return!1}}function ug(a){a=a.detail;return"object"===typeof a&&"data"in
a?a.data:null}function Oi(a,b){switch(a){case "compositionend":return ug(b);case "keypress":if(32!==b.which)return null;vg=!0;return wg;case "textInput":return a=b.data,a===wg&&vg?null:a;default:return null}}function Pi(a,b){if(mb)return"compositionend"===a||!de&&tg(a,b)?(a=rg(),wc=ce=Ba=null,mb=!1,a):null;switch(a){case "paste":return null;case "keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;
case "compositionend":return xg&&"ko"!==b.locale?null:b.data;default:return null}}function yg(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!Qi[a.type]:"textarea"===b?!0:!1}function zg(a,b,c){a=R.getPooled(Ag.change,a,b,c);a.type="change";sf(c);lb(a);return a}function Ri(a){pc(a)}function zc(a){var b=Pa(a);if(Gf(b))return a}function Si(a,b){if("change"===a)return b}function Bg(){Mb&&(Mb.detachEvent("onpropertychange",Cg),Nb=Mb=null)}function Cg(a){if("value"===a.propertyName&&
zc(Nb))if(a=zg(Nb,a,Ld(a)),Oa)pc(a);else{Oa=!0;try{ee(Ri,a)}finally{Oa=!1,ud()}}}function Ti(a,b,c){"focus"===a?(Bg(),Mb=b,Nb=c,Mb.attachEvent("onpropertychange",Cg)):"blur"===a&&Bg()}function Ui(a,b){if("selectionchange"===a||"keyup"===a||"keydown"===a)return zc(Nb)}function Vi(a,b){if("click"===a)return zc(b)}function Wi(a,b){if("input"===a||"change"===a)return zc(b)}function Xi(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):(a=Yi[a])?!!b[a]:!1}function fe(a){return Xi}
function Zi(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}function Ob(a,b){if(Qa(a,b))return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!$i.call(b,c[d])||!Qa(a[c[d]],b[c[d]]))return!1;return!0}function Dg(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;if(ge||null==nb||nb!==Wd(c))return null;c=nb;"selectionStart"in c&&Xd(c)?c={start:c.selectionStart,
end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset});return Pb&&Ob(Pb,c)?null:(Pb=c,a=R.getPooled(Eg.select,he,a,b),a.type="select",a.target=nb,lb(a),a)}function Ac(a){var b=a.keyCode;"charCode"in a?(a=a.charCode,0===a&&13===b&&(a=13)):a=b;10===a&&(a=13);return 32<=a||13===a?a:0}function q(a,b){0>ob||(a.current=ie[ob],ie[ob]=null,ob--)}function y(a,b,c){ob++;
ie[ob]=a.current;a.current=b}function pb(a,b){var c=a.type.contextTypes;if(!c)return Ca;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e);return e}function N(a){a=a.childContextTypes;return null!==a&&void 0!==a}function Fg(a,b,c){if(B.current!==Ca)throw Error(k(168));y(B,b);y(G,c)}
function Gg(a,b,c){var d=a.stateNode;a=b.childContextTypes;if("function"!==typeof d.getChildContext)return c;d=d.getChildContext();for(var e in d)if(!(e in a))throw Error(k(108,na(b)||"Unknown",e));return M({},c,{},d)}function Bc(a){a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Ca;Ra=B.current;y(B,a);y(G,G.current);return!0}function Hg(a,b,c){var d=a.stateNode;if(!d)throw Error(k(169));c?(a=Gg(a,b,Ra),d.__reactInternalMemoizedMergedChildContext=a,q(G),q(B),y(B,a)):q(G);y(G,c)}function Cc(){switch(aj()){case Dc:return 99;
case Ig:return 98;case Jg:return 97;case Kg:return 96;case Lg:return 95;default:throw Error(k(332));}}function Mg(a){switch(a){case 99:return Dc;case 98:return Ig;case 97:return Jg;case 96:return Kg;case 95:return Lg;default:throw Error(k(332));}}function Da(a,b){a=Mg(a);return bj(a,b)}function Ng(a,b,c){a=Mg(a);return je(a,b,c)}function Og(a){null===qa?(qa=[a],Ec=je(Dc,Pg)):qa.push(a);return Qg}function ha(){if(null!==Ec){var a=Ec;Ec=null;Rg(a)}Pg()}function Pg(){if(!ke&&null!==qa){ke=!0;var a=0;
try{var b=qa;Da(99,function(){for(;a<b.length;a++){var c=b[a];do c=c(!0);while(null!==c)}});qa=null}catch(c){throw null!==qa&&(qa=qa.slice(a+1)),je(Dc,ha),c;}finally{ke=!1}}}function Fc(a,b,c){c/=10;return 1073741821-(((1073741821-a+b/10)/c|0)+1)*c}function aa(a,b){if(a&&a.defaultProps){b=M({},b);a=a.defaultProps;for(var c in a)void 0===b[c]&&(b[c]=a[c])}return b}function le(){Gc=qb=Hc=null}function me(a){var b=Ic.current;q(Ic);a.type._context._currentValue=b}function Sg(a,b){for(;null!==a;){var c=
a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else if(null!==c&&c.childExpirationTime<b)c.childExpirationTime=b;else break;a=a.return}}function rb(a,b){Hc=a;Gc=qb=null;a=a.dependencies;null!==a&&null!==a.firstContext&&(a.expirationTime>=b&&(ia=!0),a.firstContext=null)}function W(a,b){if(Gc!==a&&!1!==b&&0!==b){if("number"!==typeof b||1073741823===b)Gc=a,b=1073741823;b={context:a,observedBits:b,next:null};if(null===qb){if(null===
Hc)throw Error(k(308));qb=b;Hc.dependencies={expirationTime:0,firstContext:b,responders:null}}else qb=qb.next=b}return a._currentValue}function ne(a){a.updateQueue={baseState:a.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function oe(a,b){a=a.updateQueue;b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,baseQueue:a.baseQueue,shared:a.shared,effects:a.effects})}function Ea(a,b){a={expirationTime:a,suspenseConfig:b,tag:Tg,payload:null,callback:null,next:null};return a.next=
a}function Fa(a,b){a=a.updateQueue;if(null!==a){a=a.shared;var c=a.pending;null===c?b.next=b:(b.next=c.next,c.next=b);a.pending=b}}function Ug(a,b){var c=a.alternate;null!==c&&oe(c,a);a=a.updateQueue;c=a.baseQueue;null===c?(a.baseQueue=b.next=b,b.next=b):(b.next=c.next,c.next=b)}function Qb(a,b,c,d){var e=a.updateQueue;Ga=!1;var f=e.baseQueue,g=e.shared.pending;if(null!==g){if(null!==f){var h=f.next;f.next=g.next;g.next=h}f=g;e.shared.pending=null;h=a.alternate;null!==h&&(h=h.updateQueue,null!==h&&
(h.baseQueue=g))}if(null!==f){h=f.next;var m=e.baseState,n=0,k=null,ba=null,l=null;if(null!==h){var p=h;do{g=p.expirationTime;if(g<d){var t={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===l?(ba=l=t,k=m):l=l.next=t;g>n&&(n=g)}else{null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null});Vg(g,p.suspenseConfig);a:{var q=a,r=p;g=b;t=c;switch(r.tag){case 1:q=
r.payload;if("function"===typeof q){m=q.call(t,m,g);break a}m=q;break a;case 3:q.effectTag=q.effectTag&-4097|64;case Tg:q=r.payload;g="function"===typeof q?q.call(t,m,g):q;if(null===g||void 0===g)break a;m=M({},m,g);break a;case Jc:Ga=!0}}null!==p.callback&&(a.effectTag|=32,g=e.effects,null===g?e.effects=[p]:g.push(p))}p=p.next;if(null===p||p===h)if(g=e.shared.pending,null===g)break;else p=f.next=g.next,g.next=h,e.baseQueue=f=g,e.shared.pending=null}while(1)}null===l?k=m:l.next=ba;e.baseState=k;e.baseQueue=
l;Kc(n);a.expirationTime=n;a.memoizedState=m}}function Wg(a,b,c){a=b.effects;b.effects=null;if(null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){d.callback=null;d=e;e=c;if("function"!==typeof d)throw Error(k(191,d));d.call(e)}}}function Lc(a,b,c,d){b=a.memoizedState;c=c(d,b);c=null===c||void 0===c?b:M({},b,c);a.memoizedState=c;0===a.expirationTime&&(a.updateQueue.baseState=c)}function Xg(a,b,c,d,e,f,g){a=a.stateNode;return"function"===typeof a.shouldComponentUpdate?a.shouldComponentUpdate(d,
f,g):b.prototype&&b.prototype.isPureReactComponent?!Ob(c,d)||!Ob(e,f):!0}function Yg(a,b,c){var d=!1,e=Ca;var f=b.contextType;"object"===typeof f&&null!==f?f=W(f):(e=N(b)?Ra:B.current,d=b.contextTypes,f=(d=null!==d&&void 0!==d)?pb(a,e):Ca);b=new b(c,f);a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null;b.updater=Mc;a.stateNode=b;b._reactInternalFiber=a;d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f);return b}function Zg(a,
b,c,d){a=b.state;"function"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d);"function"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d);b.state!==a&&Mc.enqueueReplaceState(b,b.state,null)}function pe(a,b,c,d){var e=a.stateNode;e.props=c;e.state=a.memoizedState;e.refs=$g;ne(a);var f=b.contextType;"object"===typeof f&&null!==f?e.context=W(f):(f=N(b)?Ra:B.current,e.context=pb(a,f));Qb(a,c,e,d);e.state=a.memoizedState;f=b.getDerivedStateFromProps;
"function"===typeof f&&(Lc(a,b,f,c),e.state=a.memoizedState);"function"===typeof b.getDerivedStateFromProps||"function"===typeof e.getSnapshotBeforeUpdate||"function"!==typeof e.UNSAFE_componentWillMount&&"function"!==typeof e.componentWillMount||(b=e.state,"function"===typeof e.componentWillMount&&e.componentWillMount(),"function"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Mc.enqueueReplaceState(e,e.state,null),Qb(a,c,e,d),e.state=a.memoizedState);"function"===
typeof e.componentDidMount&&(a.effectTag|=4)}function Rb(a,b,c){a=c.ref;if(null!==a&&"function"!==typeof a&&"object"!==typeof a){if(c._owner){c=c._owner;if(c){if(1!==c.tag)throw Error(k(309));var d=c.stateNode}if(!d)throw Error(k(147,a));var e=""+a;if(null!==b&&null!==b.ref&&"function"===typeof b.ref&&b.ref._stringRef===e)return b.ref;b=function(a){var b=d.refs;b===$g&&(b=d.refs={});null===a?delete b[e]:b[e]=a};b._stringRef=e;return b}if("string"!==typeof a)throw Error(k(284));if(!c._owner)throw Error(k(290,
a));}return a}function Nc(a,b){if("textarea"!==a.type)throw Error(k(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""));}function ah(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c;c.nextEffect=null;c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,
b),b=b.sibling;return a}function e(a,b){a=Sa(a,b);a.index=0;a.sibling=null;return a}function f(b,c,d){b.index=d;if(!a)return c;d=b.alternate;if(null!==d)return d=d.index,d<c?(b.effectTag=2,c):d;b.effectTag=2;return c}function g(b){a&&null===b.alternate&&(b.effectTag=2);return b}function h(a,b,c,d){if(null===b||6!==b.tag)return b=qe(c,a.mode,d),b.return=a,b;b=e(b,c);b.return=a;return b}function m(a,b,c,d){if(null!==b&&b.elementType===c.type)return d=e(b,c.props),d.ref=Rb(a,b,c),d.return=a,d;d=Oc(c.type,
c.key,c.props,null,a.mode,d);d.ref=Rb(a,b,c);d.return=a;return d}function n(a,b,c,d){if(null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation)return b=re(c,a.mode,d),b.return=a,b;b=e(b,c.children||[]);b.return=a;return b}function l(a,b,c,d,f){if(null===b||7!==b.tag)return b=Ha(c,a.mode,d,f),b.return=a,b;b=e(b,c);b.return=a;return b}function ba(a,b,c){if("string"===typeof b||"number"===typeof b)return b=qe(""+b,a.mode,c),b.return=a,b;if("object"===
typeof b&&null!==b){switch(b.$$typeof){case Pc:return c=Oc(b.type,b.key,b.props,null,a.mode,c),c.ref=Rb(a,null,b),c.return=a,c;case gb:return b=re(b,a.mode,c),b.return=a,b}if(Qc(b)||zb(b))return b=Ha(b,a.mode,c,null),b.return=a,b;Nc(a,b)}return null}function p(a,b,c,d){var e=null!==b?b.key:null;if("string"===typeof c||"number"===typeof c)return null!==e?null:h(a,b,""+c,d);if("object"===typeof c&&null!==c){switch(c.$$typeof){case Pc:return c.key===e?c.type===Ma?l(a,b,c.props.children,d,e):m(a,b,c,
d):null;case gb:return c.key===e?n(a,b,c,d):null}if(Qc(c)||zb(c))return null!==e?null:l(a,b,c,d,null);Nc(a,c)}return null}function t(a,b,c,d,e){if("string"===typeof d||"number"===typeof d)return a=a.get(c)||null,h(b,a,""+d,e);if("object"===typeof d&&null!==d){switch(d.$$typeof){case Pc:return a=a.get(null===d.key?c:d.key)||null,d.type===Ma?l(b,a,d.props.children,e,d.key):m(b,a,d,e);case gb:return a=a.get(null===d.key?c:d.key)||null,n(b,a,d,e)}if(Qc(d)||zb(d))return a=a.get(c)||null,l(b,a,d,e,null);
Nc(b,d)}return null}function q(e,g,h,m){for(var n=null,k=null,l=g,r=g=0,C=null;null!==l&&r<h.length;r++){l.index>r?(C=l,l=null):C=l.sibling;var O=p(e,l,h[r],m);if(null===O){null===l&&(l=C);break}a&&l&&null===O.alternate&&b(e,l);g=f(O,g,r);null===k?n=O:k.sibling=O;k=O;l=C}if(r===h.length)return c(e,l),n;if(null===l){for(;r<h.length;r++)l=ba(e,h[r],m),null!==l&&(g=f(l,g,r),null===k?n=l:k.sibling=l,k=l);return n}for(l=d(e,l);r<h.length;r++)C=t(l,e,r,h[r],m),null!==C&&(a&&null!==C.alternate&&l.delete(null===
C.key?r:C.key),g=f(C,g,r),null===k?n=C:k.sibling=C,k=C);a&&l.forEach(function(a){return b(e,a)});return n}function w(e,g,h,n){var m=zb(h);if("function"!==typeof m)throw Error(k(150));h=m.call(h);if(null==h)throw Error(k(151));for(var l=m=null,r=g,C=g=0,O=null,v=h.next();null!==r&&!v.done;C++,v=h.next()){r.index>C?(O=r,r=null):O=r.sibling;var q=p(e,r,v.value,n);if(null===q){null===r&&(r=O);break}a&&r&&null===q.alternate&&b(e,r);g=f(q,g,C);null===l?m=q:l.sibling=q;l=q;r=O}if(v.done)return c(e,r),m;
if(null===r){for(;!v.done;C++,v=h.next())v=ba(e,v.value,n),null!==v&&(g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);return m}for(r=d(e,r);!v.done;C++,v=h.next())v=t(r,e,C,v.value,n),null!==v&&(a&&null!==v.alternate&&r.delete(null===v.key?C:v.key),g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);a&&r.forEach(function(a){return b(e,a)});return m}return function(a,d,f,h){var m="object"===typeof f&&null!==f&&f.type===Ma&&null===f.key;m&&(f=f.props.children);var n="object"===typeof f&&null!==f;if(n)switch(f.$$typeof){case Pc:a:{n=
f.key;for(m=d;null!==m;){if(m.key===n){switch(m.tag){case 7:if(f.type===Ma){c(a,m.sibling);d=e(m,f.props.children);d.return=a;a=d;break a}break;default:if(m.elementType===f.type){c(a,m.sibling);d=e(m,f.props);d.ref=Rb(a,m,f);d.return=a;a=d;break a}}c(a,m);break}else b(a,m);m=m.sibling}f.type===Ma?(d=Ha(f.props.children,a.mode,h,f.key),d.return=a,a=d):(h=Oc(f.type,f.key,f.props,null,a.mode,h),h.ref=Rb(a,d,f),h.return=a,a=h)}return g(a);case gb:a:{for(m=f.key;null!==d;){if(d.key===m)if(4===d.tag&&d.stateNode.containerInfo===
f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling);d=e(d,f.children||[]);d.return=a;a=d;break a}else{c(a,d);break}else b(a,d);d=d.sibling}d=re(f,a.mode,h);d.return=a;a=d}return g(a)}if("string"===typeof f||"number"===typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),d=e(d,f),d.return=a,a=d):(c(a,d),d=qe(f,a.mode,h),d.return=a,a=d),g(a);if(Qc(f))return q(a,d,f,h);if(zb(f))return w(a,d,f,h);n&&Nc(a,f);if("undefined"===typeof f&&!m)switch(a.tag){case 1:case 0:throw a=
a.type,Error(k(152,a.displayName||a.name||"Component"));}return c(a,d)}}function Ta(a){if(a===Sb)throw Error(k(174));return a}function se(a,b){y(Tb,b);y(Ub,a);y(ja,Sb);a=b.nodeType;switch(a){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Hd(null,"");break;default:a=8===a?b.parentNode:b,b=a.namespaceURI||null,a=a.tagName,b=Hd(b,a)}q(ja);y(ja,b)}function tb(a){q(ja);q(Ub);q(Tb)}function bh(a){Ta(Tb.current);var b=Ta(ja.current);var c=Hd(b,a.type);b!==c&&(y(Ub,a),y(ja,c))}function te(a){Ub.current===
a&&(q(ja),q(Ub))}function Rc(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(c=c.dehydrated,null===c||c.data===$d||c.data===Zd))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!==(b.effectTag&64))return b}else if(null!==b.child){b.child.return=b;b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}return null}function ue(a,b){return{responder:a,props:b}}
function S(){throw Error(k(321));}function ve(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!Qa(a[c],b[c]))return!1;return!0}function we(a,b,c,d,e,f){Ia=f;z=b;b.memoizedState=null;b.updateQueue=null;b.expirationTime=0;Sc.current=null===a||null===a.memoizedState?dj:ej;a=c(d,e);if(b.expirationTime===Ia){f=0;do{b.expirationTime=0;if(!(25>f))throw Error(k(301));f+=1;J=K=null;b.updateQueue=null;Sc.current=fj;a=c(d,e)}while(b.expirationTime===Ia)}Sc.current=Tc;b=null!==K&&null!==K.next;
Ia=0;J=K=z=null;Uc=!1;if(b)throw Error(k(300));return a}function ub(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};null===J?z.memoizedState=J=a:J=J.next=a;return J}function vb(){if(null===K){var a=z.alternate;a=null!==a?a.memoizedState:null}else a=K.next;var b=null===J?z.memoizedState:J.next;if(null!==b)J=b,K=a;else{if(null===a)throw Error(k(310));K=a;a={memoizedState:K.memoizedState,baseState:K.baseState,baseQueue:K.baseQueue,queue:K.queue,next:null};null===J?z.memoizedState=
J=a:J=J.next=a}return J}function Ua(a,b){return"function"===typeof b?b(a):b}function Vc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=K,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next;f.next=g}d.baseQueue=e=f;c.pending=null}if(null!==e){e=e.next;d=d.baseState;var h=g=f=null,m=e;do{var n=m.expirationTime;if(n<Ia){var l={expirationTime:m.expirationTime,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,
next:null};null===h?(g=h=l,f=d):h=h.next=l;n>z.expirationTime&&(z.expirationTime=n,Kc(n))}else null!==h&&(h=h.next={expirationTime:1073741823,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,next:null}),Vg(n,m.suspenseConfig),d=m.eagerReducer===a?m.eagerState:a(d,m.action);m=m.next}while(null!==m&&m!==e);null===h?f=d:h.next=g;Qa(d,b.memoizedState)||(ia=!0);b.memoizedState=d;b.baseState=f;b.baseQueue=h;c.lastRenderedState=d}return[b.memoizedState,
c.dispatch]}function Wc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do f=a(f,g.action),g=g.next;while(g!==e);Qa(f,b.memoizedState)||(ia=!0);b.memoizedState=f;null===b.baseQueue&&(b.baseState=f);c.lastRenderedState=f}return[f,d]}function xe(a){var b=ub();"function"===typeof a&&(a=a());b.memoizedState=b.baseState=a;a=b.queue={pending:null,dispatch:null,lastRenderedReducer:Ua,
lastRenderedState:a};a=a.dispatch=ch.bind(null,z,a);return[b.memoizedState,a]}function ye(a,b,c,d){a={tag:a,create:b,destroy:c,deps:d,next:null};b=z.updateQueue;null===b?(b={lastEffect:null},z.updateQueue=b,b.lastEffect=a.next=a):(c=b.lastEffect,null===c?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a));return a}function dh(a){return vb().memoizedState}function ze(a,b,c,d){var e=ub();z.effectTag|=a;e.memoizedState=ye(1|b,c,void 0,void 0===d?null:d)}function Ae(a,b,c,d){var e=vb();
d=void 0===d?null:d;var f=void 0;if(null!==K){var g=K.memoizedState;f=g.destroy;if(null!==d&&ve(d,g.deps)){ye(b,c,f,d);return}}z.effectTag|=a;e.memoizedState=ye(1|b,c,f,d)}function eh(a,b){return ze(516,4,a,b)}function Xc(a,b){return Ae(516,4,a,b)}function fh(a,b){return Ae(4,2,a,b)}function gh(a,b){if("function"===typeof b)return a=a(),b(a),function(){b(null)};if(null!==b&&void 0!==b)return a=a(),b.current=a,function(){b.current=null}}function hh(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;
return Ae(4,2,gh.bind(null,b,a),c)}function Be(a,b){}function ih(a,b){ub().memoizedState=[a,void 0===b?null:b];return a}function Yc(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];c.memoizedState=[a,b];return a}function jh(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];a=a();c.memoizedState=[a,b];return a}function Ce(a,b,c){var d=Cc();Da(98>d?98:d,function(){a(!0)});Da(97<d?97:d,function(){var d=
X.suspense;X.suspense=void 0===b?null:b;try{a(!1),c()}finally{X.suspense=d}})}function ch(a,b,c){var d=ka(),e=Vb.suspense;d=Va(d,a,e);e={expirationTime:d,suspenseConfig:e,action:c,eagerReducer:null,eagerState:null,next:null};var f=b.pending;null===f?e.next=e:(e.next=f.next,f.next=e);b.pending=e;f=a.alternate;if(a===z||null!==f&&f===z)Uc=!0,e.expirationTime=Ia,z.expirationTime=Ia;else{if(0===a.expirationTime&&(null===f||0===f.expirationTime)&&(f=b.lastRenderedReducer,null!==f))try{var g=b.lastRenderedState,
h=f(g,c);e.eagerReducer=f;e.eagerState=h;if(Qa(h,g))return}catch(m){}finally{}Ja(a,d)}}function kh(a,b){var c=la(5,null,null,0);c.elementType="DELETED";c.type="DELETED";c.stateNode=b;c.return=a;c.effectTag=8;null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function lh(a,b){switch(a.tag){case 5:var c=a.type;b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b;return null!==b?(a.stateNode=b,!0):!1;case 6:return b=""===a.pendingProps||3!==b.nodeType?
null:b,null!==b?(a.stateNode=b,!0):!1;case 13:return!1;default:return!1}}function De(a){if(Wa){var b=Ka;if(b){var c=b;if(!lh(a,b)){b=kb(c.nextSibling);if(!b||!lh(a,b)){a.effectTag=a.effectTag&-1025|2;Wa=!1;ra=a;return}kh(ra,c)}ra=a;Ka=kb(b.firstChild)}else a.effectTag=a.effectTag&-1025|2,Wa=!1,ra=a}}function mh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;ra=a}function Zc(a){if(a!==ra)return!1;if(!Wa)return mh(a),Wa=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==
b&&!Yd(b,a.memoizedProps))for(b=Ka;b;)kh(a,b),b=kb(b.nextSibling);mh(a);if(13===a.tag){a=a.memoizedState;a=null!==a?a.dehydrated:null;if(!a)throw Error(k(317));a:{a=a.nextSibling;for(b=0;a;){if(8===a.nodeType){var c=a.data;if(c===og){if(0===b){Ka=kb(a.nextSibling);break a}b--}else c!==ng&&c!==Zd&&c!==$d||b++}a=a.nextSibling}Ka=null}}else Ka=ra?kb(a.stateNode.nextSibling):null;return!0}function Ee(){Ka=ra=null;Wa=!1}function T(a,b,c,d){b.child=null===a?Fe(b,null,c,d):wb(b,a.child,c,d)}function nh(a,
b,c,d,e){c=c.render;var f=b.ref;rb(b,e);d=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,d,e);return b.child}function oh(a,b,c,d,e,f){if(null===a){var g=c.type;if("function"===typeof g&&!Ge(g)&&void 0===g.defaultProps&&null===c.compare&&void 0===c.defaultProps)return b.tag=15,b.type=g,ph(a,b,g,d,e,f);a=Oc(c.type,null,d,null,b.mode,f);a.ref=b.ref;a.return=b;return b.child=a}g=a.child;if(e<
f&&(e=g.memoizedProps,c=c.compare,c=null!==c?c:Ob,c(e,d)&&a.ref===b.ref))return sa(a,b,f);b.effectTag|=1;a=Sa(g,d);a.ref=b.ref;a.return=b;return b.child=a}function ph(a,b,c,d,e,f){return null!==a&&Ob(a.memoizedProps,d)&&a.ref===b.ref&&(ia=!1,e<f)?(b.expirationTime=a.expirationTime,sa(a,b,f)):He(a,b,c,d,f)}function qh(a,b){var c=b.ref;if(null===a&&null!==c||null!==a&&a.ref!==c)b.effectTag|=128}function He(a,b,c,d,e){var f=N(c)?Ra:B.current;f=pb(b,f);rb(b,e);c=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=
a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,c,e);return b.child}function rh(a,b,c,d,e){if(N(c)){var f=!0;Bc(b)}else f=!1;rb(b,e);if(null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Yg(b,c,d),pe(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var m=g.context,n=c.contextType;"object"===typeof n&&null!==n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n));var l=c.getDerivedStateFromProps,k="function"===
typeof l||"function"===typeof g.getSnapshotBeforeUpdate;k||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n);Ga=!1;var p=b.memoizedState;g.state=p;Qb(b,d,g,e);m=b.memoizedState;h!==d||p!==m||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),m=b.memoizedState),(h=Ga||Xg(b,c,h,d,p,m,n))?(k||"function"!==typeof g.UNSAFE_componentWillMount&&"function"!==typeof g.componentWillMount||("function"===typeof g.componentWillMount&&
g.componentWillMount(),"function"===typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"===typeof g.componentDidMount&&(b.effectTag|=4)):("function"===typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=m),g.props=d,g.state=m,g.context=n,d=h):("function"===typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,oe(a,b),h=b.memoizedProps,g.props=b.type===b.elementType?h:aa(b.type,h),m=g.context,n=c.contextType,"object"===typeof n&&null!==
n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n)),l=c.getDerivedStateFromProps,(k="function"===typeof l||"function"===typeof g.getSnapshotBeforeUpdate)||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n),Ga=!1,m=b.memoizedState,g.state=m,Qb(b,d,g,e),p=b.memoizedState,h!==d||m!==p||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),p=b.memoizedState),(l=Ga||Xg(b,c,h,d,m,p,n))?(k||"function"!==typeof g.UNSAFE_componentWillUpdate&&
"function"!==typeof g.componentWillUpdate||("function"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,p,n),"function"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,p,n)),"function"===typeof g.componentDidUpdate&&(b.effectTag|=4),"function"===typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===
a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=p),g.props=d,g.state=p,g.context=n,d=l):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=256),d=!1);return Ie(a,b,c,d,f,e)}function Ie(a,b,c,d,e,f){qh(a,b);var g=0!==(b.effectTag&64);if(!d&&!g)return e&&Hg(b,c,!1),sa(a,b,f);d=b.stateNode;gj.current=b;var h=g&&"function"!==typeof c.getDerivedStateFromError?
null:d.render();b.effectTag|=1;null!==a&&g?(b.child=wb(b,a.child,null,f),b.child=wb(b,null,h,f)):T(a,b,h,f);b.memoizedState=d.state;e&&Hg(b,c,!0);return b.child}function sh(a){var b=a.stateNode;b.pendingContext?Fg(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Fg(a,b.context,!1);se(a,b.containerInfo)}function th(a,b,c){var d=b.mode,e=b.pendingProps,f=D.current,g=!1,h;(h=0!==(b.effectTag&64))||(h=0!==(f&2)&&(null===a||null!==a.memoizedState));h?(g=!0,b.effectTag&=-65):null!==a&&null===
a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1);y(D,f&1);if(null===a){void 0!==e.fallback&&De(b);if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;b.memoizedState=Je;b.child=e;return c}d=e.children;b.memoizedState=null;return b.child=Fe(b,null,d,c)}if(null!==a.memoizedState){a=a.child;d=a.sibling;if(g){e=e.fallback;
c=Sa(a,a.pendingProps);c.return=b;if(0===(b.mode&2)&&(g=null!==b.memoizedState?b.child.child:b.child,g!==a.child))for(c.child=g;null!==g;)g.return=c,g=g.sibling;d=Sa(d,e);d.return=b;c.sibling=d;c.childExpirationTime=0;b.memoizedState=Je;b.child=c;return d}c=wb(b,a.child,e.children,c);b.memoizedState=null;return b.child=c}a=a.child;if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;e.child=a;null!==a&&(a.return=e);if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==
a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;c.effectTag|=2;e.childExpirationTime=0;b.memoizedState=Je;b.child=e;return c}b.memoizedState=null;return b.child=wb(b,a,e.children,c)}function uh(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);Sg(a.return,b)}function Ke(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailExpiration:0,tailMode:e,
lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function vh(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;T(a,b,d.children,c);d=D.current;if(0!==(d&2))d=d&1|2,b.effectTag|=64;else{if(null!==a&&0!==(a.effectTag&64))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&uh(a,c);else if(19===a.tag)uh(a,c);else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===
a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}d&=1}y(D,d);if(0===(b.mode&2))b.memoizedState=null;else switch(e){case "forwards":c=b.child;for(e=null;null!==c;)a=c.alternate,null!==a&&null===Rc(a)&&(e=c),c=c.sibling;c=e;null===c?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null);Ke(b,!1,e,c,f,b.lastEffect);break;case "backwards":c=null;e=b.child;for(b.child=null;null!==e;){a=e.alternate;if(null!==a&&null===Rc(a)){b.child=e;break}a=e.sibling;e.sibling=c;c=e;e=a}Ke(b,
!0,c,null,f,b.lastEffect);break;case "together":Ke(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function sa(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;0!==d&&Kc(d);if(b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(k(153));if(null!==b.child){a=b.child;c=Sa(a,a.pendingProps);b.child=c;for(c.return=b;null!==a.sibling;)a=a.sibling,c=c.sibling=Sa(a,a.pendingProps),c.return=b;c.sibling=null}return b.child}
function $c(a,b){switch(a.tailMode){case "hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case "collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function hj(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return N(b.type)&&(q(G),q(B)),
null;case 3:return tb(),q(G),q(B),c=b.stateNode,c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),null!==a&&null!==a.child||!Zc(b)||(b.effectTag|=4),wh(b),null;case 5:te(b);c=Ta(Tb.current);var e=b.type;if(null!==a&&null!=b.stateNode)ij(a,b,e,d,c),a.ref!==b.ref&&(b.effectTag|=128);else{if(!d){if(null===b.stateNode)throw Error(k(166));return null}a=Ta(ja.current);if(Zc(b)){d=b.stateNode;e=b.type;var f=b.memoizedProps;d[Aa]=b;d[vc]=f;switch(e){case "iframe":case "object":case "embed":w("load",
d);break;case "video":case "audio":for(a=0;a<Db.length;a++)w(Db[a],d);break;case "source":w("error",d);break;case "img":case "image":case "link":w("error",d);w("load",d);break;case "form":w("reset",d);w("submit",d);break;case "details":w("toggle",d);break;case "input":Hf(d,f);w("invalid",d);oa(c,"onChange");break;case "select":d._wrapperState={wasMultiple:!!f.multiple};w("invalid",d);oa(c,"onChange");break;case "textarea":Kf(d,f),w("invalid",d),oa(c,"onChange")}Ud(e,f);a=null;for(var g in f)if(f.hasOwnProperty(g)){var h=
f[g];"children"===g?"string"===typeof h?d.textContent!==h&&(a=["children",h]):"number"===typeof h&&d.textContent!==""+h&&(a=["children",""+h]):db.hasOwnProperty(g)&&null!=h&&oa(c,g)}switch(e){case "input":mc(d);Jf(d,f,!0);break;case "textarea":mc(d);Mf(d);break;case "select":case "option":break;default:"function"===typeof f.onClick&&(d.onclick=uc)}c=a;b.updateQueue=c;null!==c&&(b.effectTag|=4)}else{g=9===c.nodeType?c:c.ownerDocument;"http://www.w3.org/1999/xhtml"===a&&(a=Nf(e));"http://www.w3.org/1999/xhtml"===
a?"script"===e?(a=g.createElement("div"),a.innerHTML="<script>\x3c/script>",a=a.removeChild(a.firstChild)):"string"===typeof d.is?a=g.createElement(e,{is:d.is}):(a=g.createElement(e),"select"===e&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,e);a[Aa]=b;a[vc]=d;jj(a,b,!1,!1);b.stateNode=a;g=Vd(e,d);switch(e){case "iframe":case "object":case "embed":w("load",a);h=d;break;case "video":case "audio":for(h=0;h<Db.length;h++)w(Db[h],a);h=d;break;case "source":w("error",a);
h=d;break;case "img":case "image":case "link":w("error",a);w("load",a);h=d;break;case "form":w("reset",a);w("submit",a);h=d;break;case "details":w("toggle",a);h=d;break;case "input":Hf(a,d);h=Cd(a,d);w("invalid",a);oa(c,"onChange");break;case "option":h=Fd(a,d);break;case "select":a._wrapperState={wasMultiple:!!d.multiple};h=M({},d,{value:void 0});w("invalid",a);oa(c,"onChange");break;case "textarea":Kf(a,d);h=Gd(a,d);w("invalid",a);oa(c,"onChange");break;default:h=d}Ud(e,h);var m=h;for(f in m)if(m.hasOwnProperty(f)){var n=
m[f];"style"===f?gg(a,n):"dangerouslySetInnerHTML"===f?(n=n?n.__html:void 0,null!=n&&xh(a,n)):"children"===f?"string"===typeof n?("textarea"!==e||""!==n)&&Wb(a,n):"number"===typeof n&&Wb(a,""+n):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(db.hasOwnProperty(f)?null!=n&&oa(c,f):null!=n&&xd(a,f,n,g))}switch(e){case "input":mc(a);Jf(a,d,!1);break;case "textarea":mc(a);Mf(a);break;case "option":null!=d.value&&a.setAttribute("value",""+va(d.value));break;case "select":a.multiple=
!!d.multiple;c=d.value;null!=c?hb(a,!!d.multiple,c,!1):null!=d.defaultValue&&hb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"===typeof h.onClick&&(a.onclick=uc)}lg(e,d)&&(b.effectTag|=4)}null!==b.ref&&(b.effectTag|=128)}return null;case 6:if(a&&null!=b.stateNode)kj(a,b,a.memoizedProps,d);else{if("string"!==typeof d&&null===b.stateNode)throw Error(k(166));c=Ta(Tb.current);Ta(ja.current);Zc(b)?(c=b.stateNode,d=b.memoizedProps,c[Aa]=b,c.nodeValue!==d&&(b.effectTag|=4)):(c=(9===c.nodeType?
c:c.ownerDocument).createTextNode(d),c[Aa]=b,b.stateNode=c)}return null;case 13:q(D);d=b.memoizedState;if(0!==(b.effectTag&64))return b.expirationTime=c,b;c=null!==d;d=!1;null===a?void 0!==b.memoizedProps.fallback&&Zc(b):(e=a.memoizedState,d=null!==e,c||null===e||(e=a.child.sibling,null!==e&&(f=b.firstEffect,null!==f?(b.firstEffect=e,e.nextEffect=f):(b.firstEffect=b.lastEffect=e,e.nextEffect=null),e.effectTag=8)));if(c&&!d&&0!==(b.mode&2))if(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||
0!==(D.current&1))F===Xa&&(F=ad);else{if(F===Xa||F===ad)F=bd;0!==Xb&&null!==U&&(Ya(U,P),yh(U,Xb))}if(c||d)b.effectTag|=4;return null;case 4:return tb(),wh(b),null;case 10:return me(b),null;case 17:return N(b.type)&&(q(G),q(B)),null;case 19:q(D);d=b.memoizedState;if(null===d)return null;e=0!==(b.effectTag&64);f=d.rendering;if(null===f)if(e)$c(d,!1);else{if(F!==Xa||null!==a&&0!==(a.effectTag&64))for(f=b.child;null!==f;){a=Rc(f);if(null!==a){b.effectTag|=64;$c(d,!1);e=a.updateQueue;null!==e&&(b.updateQueue=
e,b.effectTag|=4);null===d.lastEffect&&(b.firstEffect=null);b.lastEffect=d.lastEffect;for(d=b.child;null!==d;)e=d,f=c,e.effectTag&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null,a=e.alternate,null===a?(e.childExpirationTime=0,e.expirationTime=f,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null):(e.childExpirationTime=a.childExpirationTime,e.expirationTime=a.expirationTime,e.child=a.child,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,
e.updateQueue=a.updateQueue,f=a.dependencies,e.dependencies=null===f?null:{expirationTime:f.expirationTime,firstContext:f.firstContext,responders:f.responders}),d=d.sibling;y(D,D.current&1|2);return b.child}f=f.sibling}}else{if(!e)if(a=Rc(f),null!==a){if(b.effectTag|=64,e=!0,c=a.updateQueue,null!==c&&(b.updateQueue=c,b.effectTag|=4),$c(d,!0),null===d.tail&&"hidden"===d.tailMode&&!f.alternate)return b=b.lastEffect=d.lastEffect,null!==b&&(b.nextEffect=null),null}else 2*Y()-d.renderingStartTime>d.tailExpiration&&
1<c&&(b.effectTag|=64,e=!0,$c(d,!1),b.expirationTime=b.childExpirationTime=c-1);d.isBackwards?(f.sibling=b.child,b.child=f):(c=d.last,null!==c?c.sibling=f:b.child=f,d.last=f)}return null!==d.tail?(0===d.tailExpiration&&(d.tailExpiration=Y()+500),c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=Y(),c.sibling=null,b=D.current,y(D,e?b&1|2:b&1),c):null}throw Error(k(156,b.tag));}function lj(a,b){switch(a.tag){case 1:return N(a.type)&&(q(G),q(B)),b=a.effectTag,b&4096?
(a.effectTag=b&-4097|64,a):null;case 3:tb();q(G);q(B);b=a.effectTag;if(0!==(b&64))throw Error(k(285));a.effectTag=b&-4097|64;return a;case 5:return te(a),null;case 13:return q(D),b=a.effectTag,b&4096?(a.effectTag=b&-4097|64,a):null;case 19:return q(D),null;case 4:return tb(),null;case 10:return me(a),null;default:return null}}function Le(a,b){return{value:a,source:b,stack:Bd(b)}}function Me(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=Bd(c));null!==c&&na(c.type);b=b.value;null!==a&&1===a.tag&&
na(a.type);try{console.error(b)}catch(e){setTimeout(function(){throw e;})}}function mj(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){Za(a,c)}}function zh(a){var b=a.ref;if(null!==b)if("function"===typeof b)try{b(null)}catch(c){Za(a,c)}else b.current=null}function nj(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(b.effectTag&256&&null!==a){var c=a.memoizedProps,d=a.memoizedState;a=b.stateNode;b=a.getSnapshotBeforeUpdate(b.elementType===
b.type?c:aa(b.type,c),d);a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(k(163));}function Ah(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0;void 0!==d&&d()}c=c.next}while(c!==b)}}function Bh(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.create;c.destroy=d()}c=c.next}while(c!==b)}}function oj(a,b,c,d){switch(c.tag){case 0:case 11:case 15:case 22:Bh(3,
c);return;case 1:a=c.stateNode;c.effectTag&4&&(null===b?a.componentDidMount():(d=c.elementType===c.type?b.memoizedProps:aa(c.type,b.memoizedProps),a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate)));b=c.updateQueue;null!==b&&Wg(c,b,a);return;case 3:b=c.updateQueue;if(null!==b){a=null;if(null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Wg(c,b,a)}return;case 5:a=c.stateNode;null===b&&c.effectTag&4&&lg(c.type,c.memoizedProps)&&
a.focus();return;case 6:return;case 4:return;case 12:return;case 13:null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&bg(c))));return;case 19:case 17:case 20:case 21:return}throw Error(k(163));}function Ch(a,b,c){"function"===typeof Ne&&Ne(b);switch(b.tag){case 0:case 11:case 14:case 15:case 22:a=b.updateQueue;if(null!==a&&(a=a.lastEffect,null!==a)){var d=a.next;Da(97<c?97:c,function(){var a=d;do{var c=a.destroy;if(void 0!==c){var g=b;try{c()}catch(h){Za(g,
h)}}a=a.next}while(a!==d)})}break;case 1:zh(b);c=b.stateNode;"function"===typeof c.componentWillUnmount&&mj(b,c);break;case 5:zh(b);break;case 4:Dh(a,b,c)}}function Eh(a){var b=a.alternate;a.return=null;a.child=null;a.memoizedState=null;a.updateQueue=null;a.dependencies=null;a.alternate=null;a.firstEffect=null;a.lastEffect=null;a.pendingProps=null;a.memoizedProps=null;a.stateNode=null;null!==b&&Eh(b)}function Fh(a){return 5===a.tag||3===a.tag||4===a.tag}function Gh(a){a:{for(var b=a.return;null!==
b;){if(Fh(b)){var c=b;break a}b=b.return}throw Error(k(160));}b=c.stateNode;switch(c.tag){case 5:var d=!1;break;case 3:b=b.containerInfo;d=!0;break;case 4:b=b.containerInfo;d=!0;break;default:throw Error(k(161));}c.effectTag&16&&(Wb(b,""),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Fh(c.return)){c=null;break a}c=c.return}c.sibling.return=c.return;for(c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(c.effectTag&2)continue b;if(null===c.child||4===c.tag)continue b;
else c.child.return=c,c=c.child}if(!(c.effectTag&2)){c=c.stateNode;break a}}d?Oe(a,c,b):Pe(a,c,b)}function Oe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode,b.insertBefore(a,c)):(b=c,b.appendChild(a)),c=c._reactRootContainer,null!==c&&void 0!==c||null!==b.onclick||(b.onclick=uc));else if(4!==d&&(a=a.child,null!==a))for(Oe(a,b,c),a=a.sibling;null!==a;)Oe(a,b,c),a=a.sibling}
function Pe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&(a=a.child,null!==a))for(Pe(a,b,c),a=a.sibling;null!==a;)Pe(a,b,c),a=a.sibling}function Dh(a,b,c){for(var d=b,e=!1,f,g;;){if(!e){e=d.return;a:for(;;){if(null===e)throw Error(k(160));f=e.stateNode;switch(e.tag){case 5:g=!1;break a;case 3:f=f.containerInfo;g=!0;break a;case 4:f=f.containerInfo;g=!0;break a}e=e.return}e=!0}if(5===d.tag||6===d.tag){a:for(var h=
a,m=d,n=c,l=m;;)if(Ch(h,l,n),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===m)break a;for(;null===l.sibling;){if(null===l.return||l.return===m)break a;l=l.return}l.sibling.return=l.return;l=l.sibling}g?(h=f,m=d.stateNode,8===h.nodeType?h.parentNode.removeChild(m):h.removeChild(m)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo;g=!0;d.child.return=d;d=d.child;continue}}else if(Ch(a,d,c),null!==d.child){d.child.return=d;d=d.child;continue}if(d===
b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;d=d.return;4===d.tag&&(e=!1)}d.sibling.return=d.return;d=d.sibling}}function Qe(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:Ah(3,b);return;case 1:return;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;b.updateQueue=null;if(null!==f){c[vc]=d;"input"===a&&"radio"===d.type&&null!=d.name&&If(c,d);Vd(a,e);b=Vd(a,d);for(e=0;e<f.length;e+=2){var g=f[e],
h=f[e+1];"style"===g?gg(c,h):"dangerouslySetInnerHTML"===g?xh(c,h):"children"===g?Wb(c,h):xd(c,g,h,b)}switch(a){case "input":Dd(c,d);break;case "textarea":Lf(c,d);break;case "select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,a=d.value,null!=a?hb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?hb(c,!!d.multiple,d.defaultValue,!0):hb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(k(162));b.stateNode.nodeValue=b.memoizedProps;
return;case 3:b=b.stateNode;b.hydrate&&(b.hydrate=!1,bg(b.containerInfo));return;case 12:return;case 13:c=b;null===b.memoizedState?d=!1:(d=!0,c=b.child,Re=Y());if(null!==c)a:for(a=c;;){if(5===a.tag)f=a.stateNode,d?(f=f.style,"function"===typeof f.setProperty?f.setProperty("display","none","important"):f.display="none"):(f=a.stateNode,e=a.memoizedProps.style,e=void 0!==e&&null!==e&&e.hasOwnProperty("display")?e.display:null,f.style.display=fg("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?
"":a.memoizedProps;else if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){f=a.child.sibling;f.return=a;a=f;continue}else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===c)break;for(;null===a.sibling;){if(null===a.return||a.return===c)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}Hh(b);return;case 19:Hh(b);return;case 17:return}throw Error(k(163));}function Hh(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=
new pj);b.forEach(function(b){var d=qj.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))})}}function Ih(a,b,c){c=Ea(c,null);c.tag=3;c.payload={element:null};var d=b.value;c.callback=function(){cd||(cd=!0,Se=d);Me(a,b)};return c}function Jh(a,b,c){c=Ea(c,null);c.tag=3;var d=a.type.getDerivedStateFromError;if("function"===typeof d){var e=b.value;c.payload=function(){Me(a,b);return d(e)}}var f=a.stateNode;null!==f&&"function"===typeof f.componentDidCatch&&(c.callback=function(){"function"!==typeof d&&
(null===La?La=new Set([this]):La.add(this),Me(a,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})});return c}function ka(){return(p&(ca|ma))!==H?1073741821-(Y()/10|0):0!==dd?dd:dd=1073741821-(Y()/10|0)}function Va(a,b,c){b=b.mode;if(0===(b&2))return 1073741823;var d=Cc();if(0===(b&4))return 99===d?1073741823:1073741822;if((p&ca)!==H)return P;if(null!==c)a=Fc(a,c.timeoutMs|0||5E3,250);else switch(d){case 99:a=1073741823;break;case 98:a=Fc(a,150,100);break;case 97:case 96:a=
Fc(a,5E3,250);break;case 95:a=2;break;default:throw Error(k(326));}null!==U&&a===P&&--a;return a}function ed(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){c=d.alternate;d.childExpirationTime<b&&(d.childExpirationTime=b);null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);if(null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}null!==e&&
(U===e&&(Kc(b),F===bd&&Ya(e,P)),yh(e,b));return e}function fd(a){var b=a.lastExpiredTime;if(0!==b)return b;b=a.firstPendingTime;if(!Kh(a,b))return b;var c=a.lastPingedTime;a=a.nextKnownPendingLevel;a=c>a?c:a;return 2>=a&&b!==a?0:a}function V(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=Og(Te.bind(null,a));else{var b=fd(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=ka();
1073741823===b?d=99:1===b||2===b?d=95:(d=10*(1073741821-b)-10*(1073741821-d),d=0>=d?99:250>=d?98:5250>=d?97:95);if(null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==Qg&&Rg(c)}a.callbackExpirationTime=b;a.callbackPriority=d;b=1073741823===b?Og(Te.bind(null,a)):Ng(d,Lh.bind(null,a),{timeout:10*(1073741821-b)-Y()});a.callbackNode=b}}}function Lh(a,b){dd=0;if(b)return b=ka(),Ue(a,b),V(a),null;var c=fd(a);if(0!==c){b=a.callbackNode;if((p&(ca|ma))!==H)throw Error(k(327));
xb();a===U&&c===P||$a(a,c);if(null!==t){var d=p;p|=ca;var e=Mh();do try{rj();break}catch(h){Nh(a,h)}while(1);le();p=d;gd.current=e;if(F===hd)throw b=id,$a(a,c),Ya(a,c),V(a),b;if(null===t)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=F,U=null,d){case Xa:case hd:throw Error(k(345));case Oh:Ue(a,2<c?2:c);break;case ad:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(1073741823===ta&&(e=Re+Ph-Y(),10<e)){if(jd){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=
c;$a(a,c);break}}f=fd(a);if(0!==f&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=We(ab.bind(null,a),e);break}ab(a);break;case bd:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(jd&&(e=a.lastPingedTime,0===e||e>=c)){a.lastPingedTime=c;$a(a,c);break}e=fd(a);if(0!==e&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}1073741823!==Yb?d=10*(1073741821-Yb)-Y():1073741823===ta?d=0:(d=10*(1073741821-ta)-5E3,e=Y(),c=10*(1073741821-c)-e,d=e-d,0>d&&(d=0),d=
(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3E3>d?3E3:4320>d?4320:1960*sj(d/1960))-d,c<d&&(d=c));if(10<d){a.timeoutHandle=We(ab.bind(null,a),d);break}ab(a);break;case Xe:if(1073741823!==ta&&null!==kd){f=ta;var g=kd;d=g.busyMinDurationMs|0;0>=d?d=0:(e=g.busyDelayMs|0,f=Y()-(10*(1073741821-f)-(g.timeoutMs|0||5E3)),d=f<=e?0:e+d-f);if(10<d){Ya(a,c);a.timeoutHandle=We(ab.bind(null,a),d);break}}ab(a);break;default:throw Error(k(329));}V(a);if(a.callbackNode===b)return Lh.bind(null,a)}}return null}function Te(a){var b=
a.lastExpiredTime;b=0!==b?b:1073741823;if((p&(ca|ma))!==H)throw Error(k(327));xb();a===U&&b===P||$a(a,b);if(null!==t){var c=p;p|=ca;var d=Mh();do try{tj();break}catch(e){Nh(a,e)}while(1);le();p=c;gd.current=d;if(F===hd)throw c=id,$a(a,b),Ya(a,b),V(a),c;if(null!==t)throw Error(k(261));a.finishedWork=a.current.alternate;a.finishedExpirationTime=b;U=null;ab(a);V(a)}return null}function uj(){if(null!==bb){var a=bb;bb=null;a.forEach(function(a,c){Ue(c,a);V(c)});ha()}}function Qh(a,b){var c=p;p|=1;try{return a(b)}finally{p=
c,p===H&&ha()}}function Rh(a,b){var c=p;p&=-2;p|=Ye;try{return a(b)}finally{p=c,p===H&&ha()}}function $a(a,b){a.finishedWork=null;a.finishedExpirationTime=0;var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,vj(c));if(null!==t)for(c=t.return;null!==c;){var d=c;switch(d.tag){case 1:d=d.type.childContextTypes;null!==d&&void 0!==d&&(q(G),q(B));break;case 3:tb();q(G);q(B);break;case 5:te(d);break;case 4:tb();break;case 13:q(D);break;case 19:q(D);break;case 10:me(d)}c=c.return}U=a;t=Sa(a.current,null);
P=b;F=Xa;id=null;Yb=ta=1073741823;kd=null;Xb=0;jd=!1}function Nh(a,b){do{try{le();Sc.current=Tc;if(Uc)for(var c=z.memoizedState;null!==c;){var d=c.queue;null!==d&&(d.pending=null);c=c.next}Ia=0;J=K=z=null;Uc=!1;if(null===t||null===t.return)return F=hd,id=b,t=null;a:{var e=a,f=t.return,g=t,h=b;b=P;g.effectTag|=2048;g.firstEffect=g.lastEffect=null;if(null!==h&&"object"===typeof h&&"function"===typeof h.then){var m=h;if(0===(g.mode&2)){var n=g.alternate;n?(g.updateQueue=n.updateQueue,g.memoizedState=
n.memoizedState,g.expirationTime=n.expirationTime):(g.updateQueue=null,g.memoizedState=null)}var l=0!==(D.current&1),k=f;do{var p;if(p=13===k.tag){var q=k.memoizedState;if(null!==q)p=null!==q.dehydrated?!0:!1;else{var w=k.memoizedProps;p=void 0===w.fallback?!1:!0!==w.unstable_avoidThisFallback?!0:l?!1:!0}}if(p){var y=k.updateQueue;if(null===y){var r=new Set;r.add(m);k.updateQueue=r}else y.add(m);if(0===(k.mode&2)){k.effectTag|=64;g.effectTag&=-2981;if(1===g.tag)if(null===g.alternate)g.tag=17;else{var O=
Ea(1073741823,null);O.tag=Jc;Fa(g,O)}g.expirationTime=1073741823;break a}h=void 0;g=b;var v=e.pingCache;null===v?(v=e.pingCache=new wj,h=new Set,v.set(m,h)):(h=v.get(m),void 0===h&&(h=new Set,v.set(m,h)));if(!h.has(g)){h.add(g);var x=xj.bind(null,e,m,g);m.then(x,x)}k.effectTag|=4096;k.expirationTime=b;break a}k=k.return}while(null!==k);h=Error((na(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+
Bd(g))}F!==Xe&&(F=Oh);h=Le(h,g);k=f;do{switch(k.tag){case 3:m=h;k.effectTag|=4096;k.expirationTime=b;var A=Ih(k,m,b);Ug(k,A);break a;case 1:m=h;var u=k.type,B=k.stateNode;if(0===(k.effectTag&64)&&("function"===typeof u.getDerivedStateFromError||null!==B&&"function"===typeof B.componentDidCatch&&(null===La||!La.has(B)))){k.effectTag|=4096;k.expirationTime=b;var H=Jh(k,m,b);Ug(k,H);break a}}k=k.return}while(null!==k)}t=Sh(t)}catch(cj){b=cj;continue}break}while(1)}function Mh(a){a=gd.current;gd.current=
Tc;return null===a?Tc:a}function Vg(a,b){a<ta&&2<a&&(ta=a);null!==b&&a<Yb&&2<a&&(Yb=a,kd=b)}function Kc(a){a>Xb&&(Xb=a)}function tj(){for(;null!==t;)t=Th(t)}function rj(){for(;null!==t&&!yj();)t=Th(t)}function Th(a){var b=zj(a.alternate,a,P);a.memoizedProps=a.pendingProps;null===b&&(b=Sh(a));Uh.current=null;return b}function Sh(a){t=a;do{var b=t.alternate;a=t.return;if(0===(t.effectTag&2048)){b=hj(b,t,P);if(1===P||1!==t.childExpirationTime){for(var c=0,d=t.child;null!==d;){var e=d.expirationTime,
f=d.childExpirationTime;e>c&&(c=e);f>c&&(c=f);d=d.sibling}t.childExpirationTime=c}if(null!==b)return b;null!==a&&0===(a.effectTag&2048)&&(null===a.firstEffect&&(a.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=t.firstEffect),a.lastEffect=t.lastEffect),1<t.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=t:a.firstEffect=t,a.lastEffect=t))}else{b=lj(t);if(null!==b)return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=
2048)}b=t.sibling;if(null!==b)return b;t=a}while(null!==t);F===Xa&&(F=Xe);return null}function Ve(a){var b=a.expirationTime;a=a.childExpirationTime;return b>a?b:a}function ab(a){var b=Cc();Da(99,Aj.bind(null,a,b));return null}function Aj(a,b){do xb();while(null!==Zb);if((p&(ca|ma))!==H)throw Error(k(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;a.finishedWork=null;a.finishedExpirationTime=0;if(c===a.current)throw Error(k(177));a.callbackNode=null;a.callbackExpirationTime=
0;a.callbackPriority=90;a.nextKnownPendingLevel=0;var e=Ve(c);a.firstPendingTime=e;d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1);d<=a.lastPingedTime&&(a.lastPingedTime=0);d<=a.lastExpiredTime&&(a.lastExpiredTime=0);a===U&&(t=U=null,P=0);1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect;if(null!==e){var f=p;p|=ma;Uh.current=null;Ze=tc;var g=kg();if(Xd(g)){if("selectionStart"in
g)var h={start:g.selectionStart,end:g.selectionEnd};else a:{h=(h=g.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&0!==m.rangeCount){h=m.anchorNode;var n=m.anchorOffset,q=m.focusNode;m=m.focusOffset;try{h.nodeType,q.nodeType}catch(sb){h=null;break a}var ba=0,w=-1,y=-1,B=0,D=0,r=g,z=null;b:for(;;){for(var v;;){r!==h||0!==n&&3!==r.nodeType||(w=ba+n);r!==q||0!==m&&3!==r.nodeType||(y=ba+m);3===r.nodeType&&(ba+=r.nodeValue.length);if(null===(v=r.firstChild))break;z=r;
r=v}for(;;){if(r===g)break b;z===h&&++B===n&&(w=ba);z===q&&++D===m&&(y=ba);if(null!==(v=r.nextSibling))break;r=z;z=r.parentNode}r=v}h=-1===w||-1===y?null:{start:w,end:y}}else h=null}h=h||{start:0,end:0}}else h=null;$e={activeElementDetached:null,focusedElem:g,selectionRange:h};tc=!1;l=e;do try{Bj()}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=e;do try{for(g=a,h=b;null!==l;){var x=l.effectTag;x&16&&Wb(l.stateNode,"");if(x&128){var A=l.alternate;if(null!==A){var u=
A.ref;null!==u&&("function"===typeof u?u(null):u.current=null)}}switch(x&1038){case 2:Gh(l);l.effectTag&=-3;break;case 6:Gh(l);l.effectTag&=-3;Qe(l.alternate,l);break;case 1024:l.effectTag&=-1025;break;case 1028:l.effectTag&=-1025;Qe(l.alternate,l);break;case 4:Qe(l.alternate,l);break;case 8:n=l,Dh(g,n,h),Eh(n)}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);u=$e;A=kg();x=u.focusedElem;h=u.selectionRange;if(A!==x&&x&&x.ownerDocument&&jg(x.ownerDocument.documentElement,
x)){null!==h&&Xd(x)&&(A=h.start,u=h.end,void 0===u&&(u=A),"selectionStart"in x?(x.selectionStart=A,x.selectionEnd=Math.min(u,x.value.length)):(u=(A=x.ownerDocument||document)&&A.defaultView||window,u.getSelection&&(u=u.getSelection(),n=x.textContent.length,g=Math.min(h.start,n),h=void 0===h.end?g:Math.min(h.end,n),!u.extend&&g>h&&(n=h,h=g,g=n),n=ig(x,g),q=ig(x,h),n&&q&&(1!==u.rangeCount||u.anchorNode!==n.node||u.anchorOffset!==n.offset||u.focusNode!==q.node||u.focusOffset!==q.offset)&&(A=A.createRange(),
A.setStart(n.node,n.offset),u.removeAllRanges(),g>h?(u.addRange(A),u.extend(q.node,q.offset)):(A.setEnd(q.node,q.offset),u.addRange(A))))));A=[];for(u=x;u=u.parentNode;)1===u.nodeType&&A.push({element:u,left:u.scrollLeft,top:u.scrollTop});"function"===typeof x.focus&&x.focus();for(x=0;x<A.length;x++)u=A[x],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}tc=!!Ze;$e=Ze=null;a.current=c;l=e;do try{for(x=a;null!==l;){var F=l.effectTag;F&36&&oj(x,l.alternate,l);if(F&128){A=void 0;var E=l.ref;if(null!==
E){var G=l.stateNode;switch(l.tag){case 5:A=G;break;default:A=G}"function"===typeof E?E(A):E.current=A}}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=null;Cj();p=f}else a.current=c;if(ld)ld=!1,Zb=a,$b=b;else for(l=e;null!==l;)b=l.nextEffect,l.nextEffect=null,l=b;b=a.firstPendingTime;0===b&&(La=null);1073741823===b?a===af?ac++:(ac=0,af=a):ac=0;"function"===typeof bf&&bf(c.stateNode,d);V(a);if(cd)throw cd=!1,a=Se,Se=null,a;if((p&Ye)!==H)return null;
ha();return null}function Bj(){for(;null!==l;){var a=l.effectTag;0!==(a&256)&&nj(l.alternate,l);0===(a&512)||ld||(ld=!0,Ng(97,function(){xb();return null}));l=l.nextEffect}}function xb(){if(90!==$b){var a=97<$b?97:$b;$b=90;return Da(a,Dj)}}function Dj(){if(null===Zb)return!1;var a=Zb;Zb=null;if((p&(ca|ma))!==H)throw Error(k(331));var b=p;p|=ma;for(a=a.current.firstEffect;null!==a;){try{var c=a;if(0!==(c.effectTag&512))switch(c.tag){case 0:case 11:case 15:case 22:Ah(5,c),Bh(5,c)}}catch(d){if(null===
a)throw Error(k(330));Za(a,d)}c=a.nextEffect;a.nextEffect=null;a=c}p=b;ha();return!0}function Vh(a,b,c){b=Le(c,b);b=Ih(a,b,1073741823);Fa(a,b);a=ed(a,1073741823);null!==a&&V(a)}function Za(a,b){if(3===a.tag)Vh(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){Vh(c,a,b);break}else if(1===c.tag){var d=c.stateNode;if("function"===typeof c.type.getDerivedStateFromError||"function"===typeof d.componentDidCatch&&(null===La||!La.has(d))){a=Le(b,a);a=Jh(c,a,1073741823);Fa(c,a);c=ed(c,1073741823);null!==
c&&V(c);break}}c=c.return}}function xj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b);U===a&&P===c?F===bd||F===ad&&1073741823===ta&&Y()-Re<Ph?$a(a,P):jd=!0:Kh(a,c)&&(b=a.lastPingedTime,0!==b&&b<c||(a.lastPingedTime=c,V(a)))}function qj(a,b){var c=a.stateNode;null!==c&&c.delete(b);b=0;0===b&&(b=ka(),b=Va(b,a,null));a=ed(a,b);null!==a&&V(a)}function Ej(a){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=
b.inject(a);bf=function(a,e){try{b.onCommitFiberRoot(c,a,void 0,64===(a.current.effectTag&64))}catch(f){}};Ne=function(a){try{b.onCommitFiberUnmount(c,a)}catch(e){}}}catch(d){}return!0}function Fj(a,b,c,d){this.tag=a;this.key=c;this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null;this.index=0;this.ref=null;this.pendingProps=b;this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null;this.mode=d;this.effectTag=0;this.lastEffect=this.firstEffect=this.nextEffect=
null;this.childExpirationTime=this.expirationTime=0;this.alternate=null}function Ge(a){a=a.prototype;return!(!a||!a.isReactComponent)}function Gj(a){if("function"===typeof a)return Ge(a)?1:0;if(void 0!==a&&null!==a){a=a.$$typeof;if(a===zd)return 11;if(a===Ad)return 14}return 2}function Sa(a,b){var c=a.alternate;null===c?(c=la(a.tag,b,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=
null,c.lastEffect=null);c.childExpirationTime=a.childExpirationTime;c.expirationTime=a.expirationTime;c.child=a.child;c.memoizedProps=a.memoizedProps;c.memoizedState=a.memoizedState;c.updateQueue=a.updateQueue;b=a.dependencies;c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders};c.sibling=a.sibling;c.index=a.index;c.ref=a.ref;return c}function Oc(a,b,c,d,e,f){var g=2;d=a;if("function"===typeof a)Ge(a)&&(g=1);else if("string"===typeof a)g=
5;else a:switch(a){case Ma:return Ha(c.children,e,f,b);case Hj:g=8;e|=7;break;case Af:g=8;e|=1;break;case kc:return a=la(12,c,b,e|8),a.elementType=kc,a.type=kc,a.expirationTime=f,a;case lc:return a=la(13,c,b,e),a.type=lc,a.elementType=lc,a.expirationTime=f,a;case yd:return a=la(19,c,b,e),a.elementType=yd,a.expirationTime=f,a;default:if("object"===typeof a&&null!==a)switch(a.$$typeof){case Cf:g=10;break a;case Bf:g=9;break a;case zd:g=11;break a;case Ad:g=14;break a;case Ef:g=16;d=null;break a;case Df:g=
22;break a}throw Error(k(130,null==a?a:typeof a,""));}b=la(g,c,b,e);b.elementType=a;b.type=d;b.expirationTime=f;return b}function Ha(a,b,c,d){a=la(7,a,d,b);a.expirationTime=c;return a}function qe(a,b,c){a=la(6,a,null,b);a.expirationTime=c;return a}function re(a,b,c){b=la(4,null!==a.children?a.children:[],a.key,b);b.expirationTime=c;b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation};return b}function Ij(a,b,c){this.tag=b;this.current=null;this.containerInfo=
a;this.pingCache=this.pendingChildren=null;this.finishedExpirationTime=0;this.finishedWork=null;this.timeoutHandle=-1;this.pendingContext=this.context=null;this.hydrate=c;this.callbackNode=null;this.callbackPriority=90;this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Kh(a,b){var c=a.firstSuspendedTime;a=a.lastSuspendedTime;return 0!==c&&c>=b&&a<=b}function Ya(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;
c<b&&(a.firstSuspendedTime=b);if(d>b||0===c)a.lastSuspendedTime=b;b<=a.lastPingedTime&&(a.lastPingedTime=0);b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function yh(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function Ue(a,b){var c=a.lastExpiredTime;if(0===c||c>b)a.lastExpiredTime=b}
function md(a,b,c,d){var e=b.current,f=ka(),g=Vb.suspense;f=Va(f,e,g);a:if(c){c=c._reactInternalFiber;b:{if(Na(c)!==c||1!==c.tag)throw Error(k(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(N(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(k(171));}if(1===c.tag){var m=c.type;if(N(m)){c=Gg(c,m,h);break a}}c=h}else c=Ca;null===b.context?b.context=c:b.pendingContext=c;b=Ea(f,g);b.payload={element:a};d=void 0===
d?null:d;null!==d&&(b.callback=d);Fa(e,b);Ja(e,f);return f}function cf(a){a=a.current;if(!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Wh(a,b){a=a.memoizedState;null!==a&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function df(a,b){Wh(a,b);(a=a.alternate)&&Wh(a,b)}function ef(a,b,c){c=null!=c&&!0===c.hydrate;var d=new Ij(a,b,c),e=la(3,null,null,2===b?7:1===b?3:0);d.current=e;e.stateNode=d;ne(e);a[Lb]=d.current;c&&0!==b&&
xi(a,9===a.nodeType?a:a.ownerDocument);this._internalRoot=d}function bc(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function Jj(a,b){b||(b=a?9===a.nodeType?a.documentElement:a.firstChild:null,b=!(!b||1!==b.nodeType||!b.hasAttribute("data-reactroot")));if(!b)for(var c;c=a.lastChild;)a.removeChild(c);return new ef(a,0,b?{hydrate:!0}:void 0)}function nd(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;
if("function"===typeof e){var h=e;e=function(){var a=cf(g);h.call(a)}}md(b,g,a,e)}else{f=c._reactRootContainer=Jj(c,d);g=f._internalRoot;if("function"===typeof e){var m=e;e=function(){var a=cf(g);m.call(a)}}Rh(function(){md(b,g,a,e)})}return cf(g)}function Kj(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:gb,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function Xh(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;
if(!bc(b))throw Error(k(200));return Kj(a,b,null,c)}if(!ea)throw Error(k(227));var ki=function(a,b,c,d,e,f,g,h,m){var n=Array.prototype.slice.call(arguments,3);try{b.apply(c,n)}catch(C){this.onError(C)}},yb=!1,gc=null,hc=!1,pd=null,li={onError:function(a){yb=!0;gc=a}},td=null,rf=null,mf=null,ic=null,cb={},jc=[],qd={},db={},rd={},wa=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),M=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.assign,
sd=null,eb=null,fb=null,ee=function(a,b){return a(b)},eg=function(a,b,c,d,e){return a(b,c,d,e)},vd=function(){},vf=ee,Oa=!1,wd=!1,Z=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Scheduler,Lj=Z.unstable_cancelCallback,ff=Z.unstable_now,$f=Z.unstable_scheduleCallback,Mj=Z.unstable_shouldYield,Yh=Z.unstable_requestPaint,Pd=Z.unstable_runWithPriority,Nj=Z.unstable_getCurrentPriorityLevel,Oj=Z.unstable_ImmediatePriority,Zh=Z.unstable_UserBlockingPriority,ag=Z.unstable_NormalPriority,Pj=Z.unstable_LowPriority,
Qj=Z.unstable_IdlePriority,oi=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wf=Object.prototype.hasOwnProperty,yf={},xf={},E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){E[a]=
new L(a,0,!1,a,null,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var b=a[0];E[b]=new L(b,1,!1,a[1],null,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(a){E[a]=new L(a,2,!1,a.toLowerCase(),null,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){E[a]=new L(a,2,!1,a,null,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){E[a]=
new L(a,3,!1,a.toLowerCase(),null,!1)});["checked","multiple","muted","selected"].forEach(function(a){E[a]=new L(a,3,!0,a,null,!1)});["capture","download"].forEach(function(a){E[a]=new L(a,4,!1,a,null,!1)});["cols","rows","size","span"].forEach(function(a){E[a]=new L(a,6,!1,a,null,!1)});["rowSpan","start"].forEach(function(a){E[a]=new L(a,5,!1,a.toLowerCase(),null,!1)});var gf=/[\-:]([a-z])/g,hf=function(a){return a[1].toUpperCase()};"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var b=
a.replace(gf,hf);E[b]=new L(b,1,!1,a,null,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)});["xml:base","xml:lang","xml:space"].forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)});["tabIndex","crossOrigin"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!1)});E.xlinkHref=new L("xlinkHref",1,
!1,"xlink:href","http://www.w3.org/1999/xlink",!0);["src","href","action","formAction"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!0)});var da=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;da.hasOwnProperty("ReactCurrentDispatcher")||(da.ReactCurrentDispatcher={current:null});da.hasOwnProperty("ReactCurrentBatchConfig")||(da.ReactCurrentBatchConfig={suspense:null});var si=/^(.*)[\\\/]/,Q="function"===typeof Symbol&&Symbol.for,Pc=Q?Symbol.for("react.element"):60103,gb=Q?Symbol.for("react.portal"):
60106,Ma=Q?Symbol.for("react.fragment"):60107,Af=Q?Symbol.for("react.strict_mode"):60108,kc=Q?Symbol.for("react.profiler"):60114,Cf=Q?Symbol.for("react.provider"):60109,Bf=Q?Symbol.for("react.context"):60110,Hj=Q?Symbol.for("react.concurrent_mode"):60111,zd=Q?Symbol.for("react.forward_ref"):60112,lc=Q?Symbol.for("react.suspense"):60113,yd=Q?Symbol.for("react.suspense_list"):60120,Ad=Q?Symbol.for("react.memo"):60115,Ef=Q?Symbol.for("react.lazy"):60116,Df=Q?Symbol.for("react.block"):60121,zf="function"===
typeof Symbol&&Symbol.iterator,od,xh=function(a){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction(function(){return a(b,c,d,e)})}:a}(function(a,b){if("http://www.w3.org/2000/svg"!==a.namespaceURI||"innerHTML"in a)a.innerHTML=b;else{od=od||document.createElement("div");od.innerHTML="<svg>"+b.valueOf().toString()+"</svg>";for(b=od.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}}),Wb=function(a,
b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b},ib={animationend:nc("Animation","AnimationEnd"),animationiteration:nc("Animation","AnimationIteration"),animationstart:nc("Animation","AnimationStart"),transitionend:nc("Transition","TransitionEnd")},Id={},Of={};wa&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete ib.animationend.animation,delete ib.animationiteration.animation,delete ib.animationstart.animation),"TransitionEvent"in
window||delete ib.transitionend.transition);var $h=oc("animationend"),ai=oc("animationiteration"),bi=oc("animationstart"),ci=oc("transitionend"),Db="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pf=new ("function"===typeof WeakMap?WeakMap:Map),Ab=null,wi=function(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;
if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)lf(a,b[d],c[d]);else b&&lf(a,b,c);a._dispatchListeners=null;a._dispatchInstances=null;a.isPersistent()||a.constructor.release(a)}},qc=[],Rd=!1,fa=[],xa=null,ya=null,za=null,Eb=new Map,Fb=new Map,Jb=[],Nd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),
yi="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" "),dg={},cg=new Map,Td=new Map,Rj=["abort","abort",$h,"animationEnd",ai,"animationIteration",bi,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata",
"loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ci,"transitionEnd","waiting","waiting"];Sd("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),
0);Sd("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Sd(Rj,2);(function(a,b){for(var c=0;c<a.length;c++)Td.set(a[c],b)})("change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),0);var Hi=Zh,Gi=Pd,tc=!0,Kb={animationIterationCount:!0,
borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,
strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Sj=["Webkit","ms","Moz","O"];Object.keys(Kb).forEach(function(a){Sj.forEach(function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1);Kb[b]=Kb[a]})});var Ii=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),ng="$",og="/$",$d="$?",Zd="$!",Ze=null,$e=null,We="function"===typeof setTimeout?setTimeout:void 0,vj="function"===
typeof clearTimeout?clearTimeout:void 0,jf=Math.random().toString(36).slice(2),Aa="__reactInternalInstance$"+jf,vc="__reactEventHandlers$"+jf,Lb="__reactContainere$"+jf,Ba=null,ce=null,wc=null;M(R.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=xc)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!==
typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=xc)},persist:function(){this.isPersistent=xc},isPersistent:yc,destructor:function(){var a=this.constructor.Interface,b;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null;this.isPropagationStopped=this.isDefaultPrevented=yc;this._dispatchInstances=this._dispatchListeners=null}});R.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||
Date.now()},defaultPrevented:null,isTrusted:null};R.extend=function(a){function b(){return c.apply(this,arguments)}var c=this,d=function(){};d.prototype=c.prototype;d=new d;M(d,b.prototype);b.prototype=d;b.prototype.constructor=b;b.Interface=M({},c.Interface,a);b.extend=c.extend;sg(b);return b};sg(R);var Tj=R.extend({data:null}),Uj=R.extend({data:null}),Ni=[9,13,27,32],de=wa&&"CompositionEvent"in window,cc=null;wa&&"documentMode"in document&&(cc=document.documentMode);var Vj=wa&&"TextEvent"in window&&
!cc,xg=wa&&(!de||cc&&8<cc&&11>=cc),wg=String.fromCharCode(32),ua={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},
dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},vg=!1,mb=!1,Wj={eventTypes:ua,extractEvents:function(a,b,c,d,e){var f;if(de)b:{switch(a){case "compositionstart":var g=ua.compositionStart;break b;case "compositionend":g=ua.compositionEnd;break b;case "compositionupdate":g=
ua.compositionUpdate;break b}g=void 0}else mb?tg(a,c)&&(g=ua.compositionEnd):"keydown"===a&&229===c.keyCode&&(g=ua.compositionStart);g?(xg&&"ko"!==c.locale&&(mb||g!==ua.compositionStart?g===ua.compositionEnd&&mb&&(f=rg()):(Ba=d,ce="value"in Ba?Ba.value:Ba.textContent,mb=!0)),e=Tj.getPooled(g,b,c,d),f?e.data=f:(f=ug(c),null!==f&&(e.data=f)),lb(e),f=e):f=null;(a=Vj?Oi(a,c):Pi(a,c))?(b=Uj.getPooled(ua.beforeInput,b,c,d),b.data=a,lb(b)):b=null;return null===f?b:null===b?f:[f,b]}},Qi={color:!0,date:!0,
datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0},Ag={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}},Mb=null,Nb=null,kf=!1;wa&&(kf=Tf("input")&&(!document.documentMode||9<document.documentMode));var Xj={eventTypes:Ag,_isInputEventSupported:kf,extractEvents:function(a,b,c,d,e){e=b?Pa(b):window;var f=
e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Si;else if(yg(e))if(kf)g=Wi;else{g=Ui;var h=Ti}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Vi);if(g&&(g=g(a,b)))return zg(g,c,d);h&&h(a,e,b);"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Ed(e,"number",e.value)}},dc=R.extend({view:null,detail:null}),Yi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"},di=0,ei=0,fi=!1,gi=!1,ec=dc.extend({screenX:null,
screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:fe,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=di;di=a.screenX;return fi?"mousemove"===a.type?a.screenX-b:0:(fi=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=ei;ei=a.screenY;return gi?"mousemove"===
a.type?a.screenY-b:0:(gi=!0,0)}}),hi=ec.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),fc={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout",
"pointerover"]}},Yj={eventTypes:fc,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0===(e&32)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window;if(g){if(g=b,b=(b=c.relatedTarget||c.toElement)?Bb(b):null,null!==b){var h=Na(b);if(b!==h||5!==b.tag&&6!==b.tag)b=null}}else g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a){var m=ec;var n=fc.mouseLeave;
var l=fc.mouseEnter;var k="mouse"}else if("pointerout"===a||"pointerover"===a)m=hi,n=fc.pointerLeave,l=fc.pointerEnter,k="pointer";a=null==g?f:Pa(g);f=null==b?f:Pa(b);n=m.getPooled(n,g,c,d);n.type=k+"leave";n.target=a;n.relatedTarget=f;c=m.getPooled(l,b,c,d);c.type=k+"enter";c.target=f;c.relatedTarget=a;d=g;k=b;if(d&&k)a:{m=d;l=k;g=0;for(a=m;a;a=pa(a))g++;a=0;for(b=l;b;b=pa(b))a++;for(;0<g-a;)m=pa(m),g--;for(;0<a-g;)l=pa(l),a--;for(;g--;){if(m===l||m===l.alternate)break a;m=pa(m);l=pa(l)}m=null}else m=
null;l=m;for(m=[];d&&d!==l;){g=d.alternate;if(null!==g&&g===l)break;m.push(d);d=pa(d)}for(d=[];k&&k!==l;){g=k.alternate;if(null!==g&&g===l)break;d.push(k);k=pa(k)}for(k=0;k<m.length;k++)be(m[k],"bubbled",n);for(k=d.length;0<k--;)be(d[k],"captured",c);return 0===(e&64)?[n]:[n,c]}},Qa="function"===typeof Object.is?Object.is:Zi,$i=Object.prototype.hasOwnProperty,Zj=wa&&"documentMode"in document&&11>=document.documentMode,Eg={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},
dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},nb=null,he=null,Pb=null,ge=!1,ak={eventTypes:Eg,extractEvents:function(a,b,c,d,e,f){e=f||(d.window===d?d.document:9===d.nodeType?d:d.ownerDocument);if(!(f=!e)){a:{e=Jd(e);f=rd.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break a}e=!0}f=!e}if(f)return null;e=b?Pa(b):window;switch(a){case "focus":if(yg(e)||"true"===e.contentEditable)nb=e,he=b,Pb=null;break;case "blur":Pb=he=nb=null;
break;case "mousedown":ge=!0;break;case "contextmenu":case "mouseup":case "dragend":return ge=!1,Dg(c,d);case "selectionchange":if(Zj)break;case "keydown":case "keyup":return Dg(c,d)}return null}},bk=R.extend({animationName:null,elapsedTime:null,pseudoElement:null}),ck=R.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),dk=dc.extend({relatedTarget:null}),ek={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",
Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",
224:"Meta"},gk=dc.extend({key:function(a){if(a.key){var b=ek[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?(a=Ac(a),13===a?"Enter":String.fromCharCode(a)):"keydown"===a.type||"keyup"===a.type?fk[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:fe,charCode:function(a){return"keypress"===a.type?Ac(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===
a.type?Ac(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),hk=ec.extend({dataTransfer:null}),ik=dc.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:fe}),jk=R.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),kk=ec.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?
-a.wheelDelta:0},deltaZ:null,deltaMode:null}),lk={eventTypes:dg,extractEvents:function(a,b,c,d,e){e=cg.get(a);if(!e)return null;switch(a){case "keypress":if(0===Ac(c))return null;case "keydown":case "keyup":a=gk;break;case "blur":case "focus":a=dk;break;case "click":if(2===c.button)return null;case "auxclick":case "dblclick":case "mousedown":case "mousemove":case "mouseup":case "mouseout":case "mouseover":case "contextmenu":a=ec;break;case "drag":case "dragend":case "dragenter":case "dragexit":case "dragleave":case "dragover":case "dragstart":case "drop":a=
hk;break;case "touchcancel":case "touchend":case "touchmove":case "touchstart":a=ik;break;case $h:case ai:case bi:a=bk;break;case ci:a=jk;break;case "scroll":a=dc;break;case "wheel":a=kk;break;case "copy":case "cut":case "paste":a=ck;break;case "gotpointercapture":case "lostpointercapture":case "pointercancel":case "pointerdown":case "pointermove":case "pointerout":case "pointerover":case "pointerup":a=hi;break;default:a=R}b=a.getPooled(e,b,c,d);lb(b);return b}};(function(a){if(ic)throw Error(k(101));
ic=Array.prototype.slice.call(a);nf()})("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));(function(a,b,c){td=a;rf=b;mf=c})(ae,Hb,Pa);pf({SimpleEventPlugin:lk,EnterLeaveEventPlugin:Yj,ChangeEventPlugin:Xj,SelectEventPlugin:ak,BeforeInputEventPlugin:Wj});var ie=[],ob=-1,Ca={},B={current:Ca},G={current:!1},Ra=Ca,bj=Pd,je=$f,Rg=Lj,aj=Nj,Dc=Oj,Ig=Zh,Jg=ag,Kg=Pj,Lg=Qj,Qg={},yj=Mj,Cj=void 0!==Yh?Yh:function(){},qa=null,
Ec=null,ke=!1,ii=ff(),Y=1E4>ii?ff:function(){return ff()-ii},Ic={current:null},Hc=null,qb=null,Gc=null,Tg=0,Jc=2,Ga=!1,Vb=da.ReactCurrentBatchConfig,$g=(new ea.Component).refs,Mc={isMounted:function(a){return(a=a._reactInternalFiber)?Na(a)===a:!1},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;d=Va(d,a,e);e=Ea(d,e);e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;
d=Va(d,a,e);e=Ea(d,e);e.tag=1;e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=ka(),d=Vb.suspense;c=Va(c,a,d);d=Ea(c,d);d.tag=Jc;void 0!==b&&null!==b&&(d.callback=b);Fa(a,d);Ja(a,c)}},Qc=Array.isArray,wb=ah(!0),Fe=ah(!1),Sb={},ja={current:Sb},Ub={current:Sb},Tb={current:Sb},D={current:0},Sc=da.ReactCurrentDispatcher,X=da.ReactCurrentBatchConfig,Ia=0,z=null,K=null,J=null,Uc=!1,Tc={readContext:W,useCallback:S,useContext:S,
useEffect:S,useImperativeHandle:S,useLayoutEffect:S,useMemo:S,useReducer:S,useRef:S,useState:S,useDebugValue:S,useResponder:S,useDeferredValue:S,useTransition:S},dj={readContext:W,useCallback:ih,useContext:W,useEffect:eh,useImperativeHandle:function(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;return ze(4,2,gh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return ze(4,2,a,b)},useMemo:function(a,b){var c=ub();b=void 0===b?null:b;a=a();c.memoizedState=[a,b];return a},useReducer:function(a,b,c){var d=
ub();b=void 0!==c?c(b):b;d.memoizedState=d.baseState=b;a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b};a=a.dispatch=ch.bind(null,z,a);return[d.memoizedState,a]},useRef:function(a){var b=ub();a={current:a};return b.memoizedState=a},useState:xe,useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=xe(a),d=c[0],e=c[1];eh(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=
xe(!1),c=b[0];b=b[1];return[ih(Ce.bind(null,b,a),[b,a]),c]}},ej={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Vc,useRef:dh,useState:function(a){return Vc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Vc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Vc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,
b,a),[b,a]),c]}},fj={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Wc,useRef:dh,useState:function(a){return Wc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Wc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Wc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,b,a),[b,a]),c]}},ra=null,Ka=null,Wa=
!1,gj=da.ReactCurrentOwner,ia=!1,Je={dehydrated:null,retryTime:0};var jj=function(a,b,c,d){for(c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c;c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return;c=c.sibling}};var wh=function(a){};var ij=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode;Ta(ja.current);a=null;switch(c){case "input":f=
Cd(g,f);d=Cd(g,d);a=[];break;case "option":f=Fd(g,f);d=Fd(g,d);a=[];break;case "select":f=M({},f,{value:void 0});d=M({},d,{value:void 0});a=[];break;case "textarea":f=Gd(g,f);d=Gd(g,d);a=[];break;default:"function"!==typeof f.onClick&&"function"===typeof d.onClick&&(g.onclick=uc)}Ud(c,d);var h,m;c=null;for(h in f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(m in g=f[h],g)g.hasOwnProperty(m)&&(c||(c={}),c[m]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==
h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(db.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var k=d[h];g=null!=f?f[h]:void 0;if(d.hasOwnProperty(h)&&k!==g&&(null!=k||null!=g))if("style"===h)if(g){for(m in g)!g.hasOwnProperty(m)||k&&k.hasOwnProperty(m)||(c||(c={}),c[m]="");for(m in k)k.hasOwnProperty(m)&&g[m]!==k[m]&&(c||(c={}),c[m]=k[m])}else c||(a||(a=[]),a.push(h,c)),c=k;else"dangerouslySetInnerHTML"===h?(k=k?k.__html:void 0,g=g?g.__html:void 0,null!=k&&g!==k&&(a=a||
[]).push(h,k)):"children"===h?g===k||"string"!==typeof k&&"number"!==typeof k||(a=a||[]).push(h,""+k):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(db.hasOwnProperty(h)?(null!=k&&oa(e,h),a||g===k||(a=[])):(a=a||[]).push(h,k))}c&&(a=a||[]).push("style",c);e=a;if(b.updateQueue=e)b.effectTag|=4}};var kj=function(a,b,c,d){c!==d&&(b.effectTag|=4)};var pj="function"===typeof WeakSet?WeakSet:Set,wj="function"===typeof WeakMap?WeakMap:Map,sj=Math.ceil,gd=da.ReactCurrentDispatcher,
Uh=da.ReactCurrentOwner,H=0,Ye=8,ca=16,ma=32,Xa=0,hd=1,Oh=2,ad=3,bd=4,Xe=5,p=H,U=null,t=null,P=0,F=Xa,id=null,ta=1073741823,Yb=1073741823,kd=null,Xb=0,jd=!1,Re=0,Ph=500,l=null,cd=!1,Se=null,La=null,ld=!1,Zb=null,$b=90,bb=null,ac=0,af=null,dd=0,Ja=function(a,b){if(50<ac)throw ac=0,af=null,Error(k(185));a=ed(a,b);if(null!==a){var c=Cc();1073741823===b?(p&Ye)!==H&&(p&(ca|ma))===H?Te(a):(V(a),p===H&&ha()):V(a);(p&4)===H||98!==c&&99!==c||(null===bb?bb=new Map([[a,b]]):(c=bb.get(a),(void 0===c||c>b)&&bb.set(a,
b)))}};var zj=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||G.current)ia=!0;else{if(d<c){ia=!1;switch(b.tag){case 3:sh(b);Ee();break;case 5:bh(b);if(b.mode&4&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:N(b.type)&&Bc(b);break;case 4:se(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value;e=b.type._context;y(Ic,e._currentValue);e._currentValue=d;break;case 13:if(null!==b.memoizedState){d=b.child.childExpirationTime;
if(0!==d&&d>=c)return th(a,b,c);y(D,D.current&1);b=sa(a,b,c);return null!==b?b.sibling:null}y(D,D.current&1);break;case 19:d=b.childExpirationTime>=c;if(0!==(a.effectTag&64)){if(d)return vh(a,b,c);b.effectTag|=64}e=b.memoizedState;null!==e&&(e.rendering=null,e.tail=null);y(D,D.current);if(!d)return null}return sa(a,b,c)}ia=!1}}else ia=!1;b.expirationTime=0;switch(b.tag){case 2:d=b.type;null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;e=pb(b,B.current);rb(b,c);e=we(null,
b,d,a,e,c);b.effectTag|=1;if("object"===typeof e&&null!==e&&"function"===typeof e.render&&void 0===e.$$typeof){b.tag=1;b.memoizedState=null;b.updateQueue=null;if(N(d)){var f=!0;Bc(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null;ne(b);var g=d.getDerivedStateFromProps;"function"===typeof g&&Lc(b,d,g,a);e.updater=Mc;b.stateNode=e;e._reactInternalFiber=b;pe(b,d,a,c);b=Ie(null,b,d,!0,f,c)}else b.tag=0,T(null,b,e,c),b=b.child;return b;case 16:a:{e=b.elementType;null!==a&&(a.alternate=
null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;ri(e);if(1!==e._status)throw e._result;e=e._result;b.type=e;f=b.tag=Gj(e);a=aa(e,a);switch(f){case 0:b=He(null,b,e,a,c);break a;case 1:b=rh(null,b,e,a,c);break a;case 11:b=nh(null,b,e,a,c);break a;case 14:b=oh(null,b,e,aa(e.type,a),d,c);break a}throw Error(k(306,e,""));}return b;case 0:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),He(a,b,d,e,c);case 1:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),rh(a,b,d,e,c);
case 3:sh(b);d=b.updateQueue;if(null===a||null===d)throw Error(k(282));d=b.pendingProps;e=b.memoizedState;e=null!==e?e.element:null;oe(a,b);Qb(b,d,null,c);d=b.memoizedState.element;if(d===e)Ee(),b=sa(a,b,c);else{if(e=b.stateNode.hydrate)Ka=kb(b.stateNode.containerInfo.firstChild),ra=b,e=Wa=!0;if(e)for(c=Fe(b,null,d,c),b.child=c;c;)c.effectTag=c.effectTag&-3|1024,c=c.sibling;else T(a,b,d,c),Ee();b=b.child}return b;case 5:return bh(b),null===a&&De(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:
null,g=e.children,Yd(d,e)?g=null:null!==f&&Yd(d,f)&&(b.effectTag|=16),qh(a,b),b.mode&4&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(T(a,b,g,c),b=b.child),b;case 6:return null===a&&De(b),null;case 13:return th(a,b,c);case 4:return se(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=wb(b,null,d,c):T(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),nh(a,b,d,e,c);case 7:return T(a,b,b.pendingProps,c),b.child;case 8:return T(a,
b,b.pendingProps.children,c),b.child;case 12:return T(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context;e=b.pendingProps;g=b.memoizedProps;f=e.value;var h=b.type._context;y(Ic,h._currentValue);h._currentValue=f;if(null!==g)if(h=g.value,f=Qa(h,f)?0:("function"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823)|0,0===f){if(g.children===e.children&&!G.current){b=sa(a,b,c);break a}}else for(h=b.child,null!==h&&(h.return=b);null!==h;){var m=h.dependencies;if(null!==
m){g=h.child;for(var l=m.firstContext;null!==l;){if(l.context===d&&0!==(l.observedBits&f)){1===h.tag&&(l=Ea(c,null),l.tag=Jc,Fa(h,l));h.expirationTime<c&&(h.expirationTime=c);l=h.alternate;null!==l&&l.expirationTime<c&&(l.expirationTime=c);Sg(h.return,c);m.expirationTime<c&&(m.expirationTime=c);break}l=l.next}}else g=10===h.tag?h.type===b.type?null:h.child:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}h=g.sibling;if(null!==h){h.return=g.return;g=h;break}g=g.return}h=
g}T(a,b,e.children,c);b=b.child}return b;case 9:return e=b.type,f=b.pendingProps,d=f.children,rb(b,c),e=W(e,f.unstable_observedBits),d=d(e),b.effectTag|=1,T(a,b,d,c),b.child;case 14:return e=b.type,f=aa(e,b.pendingProps),f=aa(e.type,f),oh(a,b,e,f,d,c);case 15:return ph(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,N(d)?(a=!0,Bc(b)):a=!1,rb(b,c),Yg(b,d,e),pe(b,d,e,c),Ie(null,
b,d,!0,a,c);case 19:return vh(a,b,c)}throw Error(k(156,b.tag));};var bf=null,Ne=null,la=function(a,b,c,d){return new Fj(a,b,c,d)};ef.prototype.render=function(a){md(a,this._internalRoot,null,null)};ef.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;md(null,a,null,function(){b[Lb]=null})};var Di=function(a){if(13===a.tag){var b=Fc(ka(),150,100);Ja(a,b);df(a,b)}};var Yf=function(a){13===a.tag&&(Ja(a,3),df(a,3))};var Bi=function(a){if(13===a.tag){var b=ka();b=Va(b,a,null);Ja(a,
b);df(a,b)}};sd=function(a,b,c){switch(b){case "input":Dd(a,c);b=c.name;if("radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]');for(b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=ae(d);if(!e)throw Error(k(90));Gf(d);Dd(d,e)}}}break;case "textarea":Lf(a,c);break;case "select":b=c.value,null!=b&&hb(a,!!c.multiple,b,!1)}};(function(a,b,c,d){ee=a;eg=b;vd=c;vf=d})(Qh,function(a,b,c,d,e){var f=p;p|=4;
try{return Da(98,a.bind(null,b,c,d,e))}finally{p=f,p===H&&ha()}},function(){(p&(1|ca|ma))===H&&(uj(),xb())},function(a,b){var c=p;p|=2;try{return a(b)}finally{p=c,p===H&&ha()}});var mk={Events:[Hb,Pa,ae,pf,qd,lb,function(a){Kd(a,Ki)},sf,tf,sc,pc,xb,{current:!1}]};(function(a){var b=a.findFiberByHostInstance;return Ej(M({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:da.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){a=Sf(a);
return null===a?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:Bb,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"});I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mk;I.createPortal=Xh;I.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===
b){if("function"===typeof a.render)throw Error(k(188));throw Error(k(268,Object.keys(a)));}a=Sf(b);a=null===a?null:a.stateNode;return a};I.flushSync=function(a,b){if((p&(ca|ma))!==H)throw Error(k(187));var c=p;p|=1;try{return Da(99,a.bind(null,b))}finally{p=c,ha()}};I.hydrate=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!0,c)};I.render=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!1,c)};I.unmountComponentAtNode=function(a){if(!bc(a))throw Error(k(40));return a._reactRootContainer?
(Rh(function(){nd(null,null,a,!1,function(){a._reactRootContainer=null;a[Lb]=null})}),!0):!1};I.unstable_batchedUpdates=Qh;I.unstable_createPortal=function(a,b){return Xh(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)};I.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!bc(c))throw Error(k(200));if(null==a||void 0===a._reactInternalFiber)throw Error(k(38));return nd(a,b,c,!1,d)};I.version="16.13.1"});
</script>
    <script>const e = React.createElement;

function pathToString(path) {
  if (path[0] === '/') {
    return '/' + path.slice(1).join('/');
  } else {
    return path.join('/');
  }
}

function findCommonPath(files) {
  if (!files || !files.length) {
    return [];
  }

  function isPrefix(arr, prefix) {
    if (arr.length < prefix.length) {
      return false;
    }
    for (let i = prefix.length - 1; i >= 0; --i) {
      if (arr[i] !== prefix[i]) {
        return false;
      }
    }
    return true;
  }

  let commonPath = files[0].path.slice(0, -1);
  while (commonPath.length) {
    if (files.every(file => isPrefix(file.path, commonPath))) {
      break;
    }
    commonPath.pop();
  }
  return commonPath;
}

function findFolders(files) {
  if (!files || !files.length) {
    return [];
  }

  let folders = files.filter(file => file.path.length > 1).map(file => file.path[0]);
  folders = [...new Set(folders)]; // unique
  folders.sort();

  folders = folders.map(folder => {
    let filesInFolder = files
      .filter(file => file.path[0] === folder)
      .map(file => ({
        ...file,
        path: file.path.slice(1),
        parent: [...file.parent, file.path[0]],
      }));

    const children = findFolders(filesInFolder); // recursion

    return {
      is_folder: true,
      path: [folder],
      parent: files[0].parent,
      children,
      covered: children.reduce((sum, file) => sum + file.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.coverable, 0),
      prevRun: {
        covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
        coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
      },
    };
  });

  return [...folders, ...files.filter(file => file.path.length === 1)];
}

class App extends React.Component {
  constructor(...args) {
    super(...args);

    this.state = {
      current: [],
    };
  }

  componentDidMount() {
    this.updateStateFromLocation();
    window.addEventListener('hashchange', () => this.updateStateFromLocation(), false);
  }

  updateStateFromLocation() {
    if (window.location.hash.length > 1) {
      const current = window.location.hash.slice(1).split('/');
      this.setState({current});
    } else {
      this.setState({current: []});
    }
  }

  getCurrentPath() {
    let file = this.props.root;
    let path = [file];
    for (let p of this.state.current) {
      file = file.children.find(file => file.path[0] === p);
      if (!file) {
        return path;
      }
      path.push(file);
    }
    return path;
  }

  render() {
    const path = this.getCurrentPath();
    const file = path[path.length - 1];

    let w = null;
    if (file.is_folder) {
      w = e(FilesList, {
        folder: file,
        onSelectFile: this.selectFile.bind(this),
        onBack: path.length > 1 ? this.back.bind(this) : null,
      });
    } else {
      w = e(DisplayFile, {
        file,
        onBack: this.back.bind(this),
      });
    }

    return e('div', {className: 'app'}, w);
  }

  selectFile(file) {
    this.setState(
      ({current}) => {
        return {current: [...current, file.path[0]]};
      },
      () => this.updateHash(),
    );
  }

  back(file) {
    this.setState(
      ({current}) => {
        return {current: current.slice(0, current.length - 1)};
      },
      () => this.updateHash(),
    );
  }

  updateHash() {
    if (!this.state.current || !this.state.current.length) {
      window.location = '#';
    } else {
      window.location = '#' + this.state.current.join('/');
    }
  }
}

function FilesList({folder, onSelectFile, onBack}) {
  let files = folder.children;
  return e(
    'div',
    {className: 'display-folder'},
    e(FileHeader, {file: folder, onBack}),
    e(
      'table',
      {className: 'files-list'},
      e('thead', {className: 'files-list__head'}, e('tr', null, e('th', null, 'Path'), e('th', null, 'Coverage'))),
      e(
        'tbody',
        {className: 'files-list__body'},
        files.map(file => e(File, {file, onClick: onSelectFile})),
      ),
    ),
  );
}

function File({file, onClick}) {
  const coverage = file.coverable ? (file.covered / file.coverable) * 100 : -1;
  const coverageDelta =
    file.prevRun && (file.covered / file.coverable) * 100 - (file.prevRun.covered / file.prevRun.coverable) * 100;

  return e(
    'tr',
    {
      className:
        'files-list__file' +
        (coverage >= 0 && coverage < 50 ? ' files-list__file_low' : '') +
        (coverage >= 50 && coverage < 80 ? ' files-list__file_medium' : '') +
        (coverage >= 80 ? ' files-list__file_high' : '') +
        (file.is_folder ? ' files-list__file_folder' : ''),
      onClick: () => onClick(file),
    },
    e('td', null, e('a', null, pathToString(file.path))),
    e(
      'td',
      null,
      file.covered + ' / ' + file.coverable + (coverage >= 0 ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e(
        'span',
        {title: 'Change from the previous run'},
        coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : '',
      ),
    ),
  );
}

function DisplayFile({file, onBack}) {
  return e('div', {className: 'display-file'}, e(FileHeader, {file, onBack}), e(FileContent, {file}));
}

function FileHeader({file, onBack}) {
  const coverage = (file.covered / file.coverable) * 100;
  const coverageDelta = file.prevRun && coverage - (file.prevRun.covered / file.prevRun.coverable) * 100;

  return e(
    'div',
    {className: 'file-header'},
    onBack ? e('a', {className: 'file-header__back', onClick: onBack}, 'Back') : null,
    e('div', {className: 'file-header__name'}, pathToString([...file.parent, ...file.path])),
    e(
      'div',
      {className: 'file-header__stat'},
      'Covered: ' + file.covered + ' of ' + file.coverable + (file.coverable ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e(
        'span',
        {title: 'Change from the previous run'},
        coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : '',
      ),
      e('input', {id: 'theme-toggle', type: 'checkbox', hidden: true}),
      e('label', {for: 'theme-toggle', id: 'theme-toggle-label'}, ''),
    ),
  );
}

function FileContent({file}) {
  return e(
    'pre',
    {className: 'file-content'},
    file.content.split(/\r?\n/).map((line, index) => {
      const trace = file.traces.find(trace => trace.line === index + 1);
      const covered = trace && trace.stats.Line;
      const uncovered = trace && !trace.stats.Line;
      return e(
        'code',
        {
          className: 'code-line' + (covered ? ' code-line_covered' : '') + (uncovered ? ' code-line_uncovered' : ''),
          title: trace ? JSON.stringify(trace.stats, null, 2) : null,
        },
        line,
      );
    }),
  );
}

(function () {
  const commonPath = findCommonPath(data.files);
  const prevFilesMap = new Map();

  previousData &&
    previousData.files.forEach(file => {
      const path = file.path.slice(commonPath.length).join('/');
      prevFilesMap.set(path, file);
    });

  const files = data.files.map(file => {
    const path = file.path.slice(commonPath.length);
    const {covered = 0, coverable = 0} = prevFilesMap.get(path.join('/')) || {};
    return {
      ...file,
      path,
      parent: commonPath,
      prevRun: {covered, coverable},
    };
  });

  const children = findFolders(files);

  const root = {
    is_folder: true,
    children,
    path: commonPath,
    parent: [],
    covered: children.reduce((sum, file) => sum + file.covered, 0),
    coverable: children.reduce((sum, file) => sum + file.coverable, 0),
    prevRun: {
      covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
    },
  };

  ReactDOM.render(e(App, {root, prevFilesMap}), document.getElementById('root'));

  const toggle = document.getElementById('theme-toggle');
  const label = document.getElementById('theme-toggle-label');
  label.textContent = '';

  toggle.addEventListener('change', () => {
    if (toggle.checked) {
      document.documentElement.setAttribute('data-theme', 'dark');
      label.textContent = '';
    } else {
      document.documentElement.removeAttribute('data-theme');
      label.textContent = '';
    }
  });
})();
</script>
</body>
</html>